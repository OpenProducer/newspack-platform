(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{MediaUploadProvider:()=>ie,UploadError:()=>T,store:()=>te});var r={};e.r(r),e.d(r,{getItems:()=>p,getSettings:()=>g,isUploading:()=>f,isUploadingById:()=>h,isUploadingByUrl:()=>m});var n={};e.r(n),e.d(n,{getAllItems:()=>y,getBlobUrls:()=>E,getItem:()=>U,getPausedUploadForPost:()=>S,isBatchUploaded:()=>b,isPaused:()=>w,isUploadingToPost:()=>I});var o={};e.r(o),e.d(o,{addItems:()=>C,cancelItem:()=>F});var s={};e.r(s),e.d(s,{addItem:()=>j,finishOperation:()=>$,pauseQueue:()=>Q,prepareItem:()=>z,processItem:()=>x,removeItem:()=>W,resumeQueue:()=>V,revokeBlobUrls:()=>Y,updateSettings:()=>G,uploadItem:()=>H});const i=window.wp.data;let a=function(e){return e.Unknown="REDUX_UNKNOWN",e.Add="ADD_ITEM",e.Prepare="PREPARE_ITEM",e.Cancel="CANCEL_ITEM",e.Remove="REMOVE_ITEM",e.PauseItem="PAUSE_ITEM",e.ResumeItem="RESUME_ITEM",e.PauseQueue="PAUSE_QUEUE",e.ResumeQueue="RESUME_QUEUE",e.OperationStart="OPERATION_START",e.OperationFinish="OPERATION_FINISH",e.AddOperations="ADD_OPERATIONS",e.CacheBlobUrl="CACHE_BLOB_URL",e.RevokeBlobUrls="REVOKE_BLOB_URLS",e.UpdateSettings="UPDATE_SETTINGS",e}({}),u=function(e){return e.Processing="PROCESSING",e.Paused="PAUSED",e}({}),c=function(e){return e.Prepare="PREPARE",e.Upload="UPLOAD",e}({});const d={queue:[],queueStatus:"active",blobUrls:{},settings:{mediaUpload:()=>{}}},l=function(e=d,t={type:a.Unknown}){switch(t.type){case a.PauseQueue:return{...e,queueStatus:"paused"};case a.ResumeQueue:return{...e,queueStatus:"active"};case a.Add:return{...e,queue:[...e.queue,t.item]};case a.Cancel:return{...e,queue:e.queue.map((e=>e.id===t.id?{...e,error:t.error}:e))};case a.Remove:return{...e,queue:e.queue.filter((e=>e.id!==t.id))};case a.OperationStart:return{...e,queue:e.queue.map((e=>e.id===t.id?{...e,currentOperation:t.operation}:e))};case a.AddOperations:return{...e,queue:e.queue.map((e=>e.id!==t.id?e:{...e,operations:[...e.operations||[],...t.operations]}))};case a.OperationFinish:return{...e,queue:e.queue.map((e=>{if(e.id!==t.id)return e;const r=e.operations?e.operations.slice(1):[],n=e.attachment||t.item.attachment?{...e.attachment,...t.item.attachment}:void 0;return{...e,currentOperation:void 0,operations:r,...t.item,attachment:n,additionalData:{...e.additionalData,...t.item.additionalData}}}))};case a.CacheBlobUrl:{const r=e.blobUrls[t.id]||[];return{...e,blobUrls:{...e.blobUrls,[t.id]:[...r,t.blobUrl]}}}case a.RevokeBlobUrls:{const r={...e.blobUrls};return delete r[t.id],{...e,blobUrls:r}}case a.UpdateSettings:return{...e,settings:{...e.settings,...t.settings}}}return e};function p(e){return e.queue}function f(e){return e.queue.length>=1}function m(e,t){return e.queue.some((e=>e.attachment?.url===t||e.sourceUrl===t))}function h(e,t){return e.queue.some((e=>e.attachment?.id===t||e.sourceAttachmentId===t))}function g(e){return e.settings}function y(e){return e.queue}function U(e,t){return e.queue.find((e=>e.id===t))}function b(e,t){return 0===e.queue.filter((e=>t===e.batchId)).length}function I(e,t){return e.queue.some((e=>e.currentOperation===c.Upload&&e.additionalData.post===t))}function S(e,t){return e.queue.find((e=>e.status===u.Paused&&e.additionalData.post===t))}function w(e){return"paused"===e.queueStatus}function E(e,t){return e.blobUrls[t]||[]}const P={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let O;const R=new Uint8Array(16);function _(){if(!O&&(O="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!O))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(R)}const v=[];for(let e=0;e<256;++e)v.push((e+256).toString(16).slice(1));const A=function(e,t,r){if(P.randomUUID&&!t&&!e)return P.randomUUID();const n=(e=e||{}).random||(e.rng||_)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return v[e[t+0]]+v[e[t+1]]+v[e[t+2]]+v[e[t+3]]+"-"+v[e[t+4]]+v[e[t+5]]+"-"+v[e[t+6]]+v[e[t+7]]+"-"+v[e[t+8]]+v[e[t+9]]+"-"+v[e[t+10]]+v[e[t+11]]+v[e[t+12]]+v[e[t+13]]+v[e[t+14]]+v[e[t+15]]}(n)},B=window.wp.i18n;class T extends Error{constructor({code:e,message:t,file:r,cause:n}){super(t,{cause:n}),Object.setPrototypeOf(this,new.target.prototype),this.code=e,this.file=r}}function D(e,t){if(!t)return;const r=t.some((t=>t.includes("/")?t===e.type:e.type.startsWith(`${t}/`)));if(e.type&&!r)throw new T({code:"MIME_TYPE_NOT_SUPPORTED",message:(0,B.sprintf)(
// translators: %s: file name.
// translators: %s: file name.
(0,B.__)("%s: Sorry, this file type is not supported here."),e.name),file:e})}function q(e,t){const r=(n=t)?Object.entries(n).flatMap((([e,t])=>{const[r]=t.split("/");return[t,...e.split("|").map((e=>`${r}/${e}`))]})):null;var n;if(!r)return;const o=r.includes(e.type);if(e.type&&!o)throw new T({code:"MIME_TYPE_NOT_ALLOWED_FOR_USER",message:(0,B.sprintf)(
// translators: %s: file name.
// translators: %s: file name.
(0,B.__)("%s: Sorry, you are not allowed to upload this file type."),e.name),file:e})}function M(e,t){if(e.size<=0)throw new T({code:"EMPTY_FILE",message:(0,B.sprintf)(
// translators: %s: file name.
// translators: %s: file name.
(0,B.__)("%s: This file is empty."),e.name),file:e});if(t&&e.size>t)throw new T({code:"SIZE_ABOVE_LIMIT",message:(0,B.sprintf)(
// translators: %s: file name.
// translators: %s: file name.
(0,B.__)("%s: This file exceeds the maximum upload size for this site."),e.name),file:e})}function C({files:e,onChange:t,onSuccess:r,onError:n,onBatchSuccess:o,additionalData:s,allowedTypes:i}){return async({select:a,dispatch:u})=>{const c=A();for(const d of e){try{D(d,i),q(d,a.getSettings().allowedMimeTypes)}catch(e){n?.(e);continue}try{M(d,a.getSettings().maxUploadFileSize)}catch(e){n?.(e);continue}u.addItem({file:d,batchId:c,onChange:t,onSuccess:r,onBatchSuccess:o,onError:n,additionalData:s})}}}function F(e,t,r=!1){return async({select:n,dispatch:o})=>{const s=n.getItem(e);if(s){if(s.abortController?.abort(),!r){const{onError:e}=s;e?.(null!=t?t:new Error("Upload cancelled")),!e&&t&&console.error("Upload cancelled",t)}o({type:a.Cancel,id:e,error:t}),o.removeItem(e),o.revokeBlobUrls(e),s.batchId&&n.isBatchUploaded(s.batchId)&&s.onBatchSuccess?.()}}}const k=window.wp.blob;function L(e){return function(e,t){return new File([e],t,{type:e.type,lastModified:e.lastModified})}(e,e.name)}window.wp.url;class N extends File{constructor(e="stub-file"){super([],e)}}function j({file:e,batchId:t,onChange:r,onSuccess:n,onBatchSuccess:o,onError:s,additionalData:i={},sourceUrl:d,sourceAttachmentId:l,abortController:p,operations:f}){return async({dispatch:m})=>{const h=A(),g=function(e){if(e instanceof File)return e;const t=e.type.split("/")[1],r="application/pdf"===e.type?"document":e.type.split("/")[0];return new File([e],`${r}.${t}`,{type:e.type})}(e);let y;g instanceof N||(y=(0,k.createBlobURL)(g),m({type:a.CacheBlobUrl,id:h,blobUrl:y})),m({type:a.Add,item:{id:h,batchId:t,status:u.Processing,sourceFile:L(g),file:g,attachment:{url:y},additionalData:{convert_format:!1,...i},onChange:r,onSuccess:n,onBatchSuccess:o,onError:s,sourceUrl:d,sourceAttachmentId:l,abortController:p||new AbortController,operations:Array.isArray(f)?f:[c.Prepare]}}),m.processItem(h)}}function x(e){return async({select:t,dispatch:r})=>{if(t.isPaused())return;const n=t.getItem(e),{attachment:o,onChange:s,onSuccess:i,onBatchSuccess:u,batchId:d}=n,l=Array.isArray(n.operations?.[0])?n.operations[0][0]:n.operations?.[0];if(o&&s?.([o]),!l)return o&&i?.([o]),r.revokeBlobUrls(e),void(d&&t.isBatchUploaded(d)&&u?.());if(l)switch(r({type:a.OperationStart,id:e,operation:l}),l){case c.Prepare:r.prepareItem(n.id);break;case c.Upload:r.uploadItem(e)}}}function Q(){return{type:a.PauseQueue}}function V(){return async({select:e,dispatch:t})=>{t({type:a.ResumeQueue});for(const r of e.getAllItems())t.processItem(r.id)}}function W(e){return async({select:t,dispatch:r})=>{t.getItem(e)&&r({type:a.Remove,id:e})}}function $(e,t){return async({dispatch:r})=>{r({type:a.OperationFinish,id:e,item:t}),r.processItem(e)}}function z(e){return async({dispatch:t})=>{const r=[c.Upload];t({type:a.AddOperations,id:e,operations:r}),t.finishOperation(e,{})}}function H(e){return async({select:t,dispatch:r})=>{const n=t.getItem(e);t.getSettings().mediaUpload({filesList:[n.file],additionalData:n.additionalData,signal:n.abortController?.signal,onFileChange:([t])=>{(0,k.isBlobURL)(t.url)||r.finishOperation(e,{attachment:t})},onSuccess:([t])=>{r.finishOperation(e,{attachment:t})},onError:t=>{r.cancelItem(e,t)}})}}function Y(e){return async({select:t,dispatch:r})=>{const n=t.getBlobUrls(e);for(const e of n)(0,k.revokeBlobURL)(e);r({type:a.RevokeBlobUrls,id:e})}}function G(e){return{type:a.UpdateSettings,settings:e}}const K=window.wp.privateApis,{lock:X,unlock:J}=(0,K.__dangerousOptInToUnstableAPIsOnlyForCoreModules)("I acknowledge private features are not for use in themes or plugins and doing so will break in the next version of WordPress.","@wordpress/upload-media"),Z="core/upload-media",ee={reducer:l,selectors:r,actions:o},te=(0,i.createReduxStore)(Z,{reducer:l,selectors:r,actions:o});(0,i.register)(te),J(te).registerPrivateActions(s),J(te).registerPrivateSelectors(n);const re=window.wp.element,ne=window.wp.compose,oe=window.ReactJSXRuntime,se=(0,ne.createHigherOrderComponent)((e=>({useSubRegistry:t=!0,...r})=>{const n=(0,i.useRegistry)(),[o]=(0,re.useState)((()=>new WeakMap)),s=function(e,t,r){if(!r)return t;let n=e.get(t);return n||(n=(0,i.createRegistry)({},t),n.registerStore(Z,ee),e.set(t,n)),n}(o,n,t);return s===n?(0,oe.jsx)(e,{registry:n,...r}):(0,oe.jsx)(i.RegistryProvider,{value:s,children:(0,oe.jsx)(e,{registry:s,...r})})}),"withRegistryProvider")((e=>{const{children:t,settings:r}=e,{updateSettings:n}=J((0,i.useDispatch)(te));return(0,re.useEffect)((()=>{n(r)}),[r,n]),(0,oe.jsx)(oe.Fragment,{children:t})})),ie=se;(window.wp=window.wp||{}).uploadMedia=t})();
//# sourceMappingURL=index.min.js.map