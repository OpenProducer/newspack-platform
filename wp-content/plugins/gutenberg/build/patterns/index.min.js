!function(){"use strict";var e={d:function(t,n){for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{privateApis:function(){return F},store:function(){return v}});var n={};e.r(n),e.d(n,{convertSyncedPatternToStatic:function(){return g},createPattern:function(){return m},createPatternFromFile:function(){return y},setEditingPattern:function(){return f}});var a={};e.r(a),e.d(a,{isEditingPattern:function(){return w}});var r=window.wp.data,o=(0,r.combineReducers)({isEditingPattern:function(e={},t){return"SET_EDITING_PATTERN"===t?.type?{...e,[t.clientId]:t.isEditing}:e}}),s=window.wp.blocks,c=window.wp.coreData,i=window.wp.blockEditor,l=window.wp.i18n;const u={theme:"pattern",user:"wp_block"},p="all-patterns",d={full:"fully",unsynced:"unsynced"},_={"core/paragraph":{content:(0,l.__)("Content")}},m=(e,t,n,a)=>async({registry:r})=>{const o=t===d.unsynced?{wp_pattern_sync_status:t}:void 0,s={title:e,content:n,status:"publish",meta:o,wp_pattern_category:a};return await r.dispatch(c.store).saveEntityRecord("postType","wp_block",s)},y=(e,t)=>async({dispatch:n})=>{const a=await e.text();let r;try{r=JSON.parse(a)}catch(e){throw new Error("Invalid JSON file")}if("wp_block"!==r.__file||!r.title||!r.content||"string"!=typeof r.title||"string"!=typeof r.content||r.syncStatus&&"string"!=typeof r.syncStatus)throw new Error("Invalid pattern JSON file");return await n.createPattern(r.title,r.syncStatus,r.content,t)},g=e=>({registry:t})=>{const n=t.select(i.store).getBlock(e),a=t.select("core").getEditedEntityRecord("postType","wp_block",n.attributes.ref),r=(0,s.parse)("function"==typeof a.content?a.content(a):a.content);t.dispatch(i.store).replaceBlocks(n.clientId,r)};function f(e,t){return{type:"SET_EDITING_PATTERN",clientId:e,isEditing:t}}function w(e,t){return e.isEditingPattern[t]}var E=window.wp.privateApis;const{lock:b,unlock:S}=(0,E.__dangerousOptInToUnstableAPIsOnlyForCoreModules)("I know using unstable features means my theme or plugin will inevitably break in the next version of WordPress.","@wordpress/patterns"),C={reducer:o},v=(0,r.createReduxStore)("core/patterns",{...C});(0,r.register)(v),S(v).registerPrivateActions(n),S(v).registerPrivateSelectors(a);var h=window.React,k=window.wp.components,P=window.wp.element,x=window.wp.notices,T=window.wp.compose,B=window.wp.htmlEntities;const R=e=>(0,B.decodeEntities)(e),D="wp_pattern_category";function I({categoryTerms:e,onChange:t,categoryMap:n}){const[a,r]=(0,P.useState)(""),o=(0,T.useDebounce)(r,500),s=(0,P.useMemo)((()=>Array.from(n.values()).map((e=>R(e.label))).filter((e=>""===a||e.toLowerCase().includes(a.toLowerCase()))).sort(((e,t)=>e.localeCompare(t)))),[a,n]);return(0,h.createElement)(k.FormTokenField,{className:"patterns-menu-items__convert-modal-categories",value:e,suggestions:s,onChange:function(e){const n=e.reduce(((e,t)=>(e.some((e=>e.toLowerCase()===t.toLowerCase()))||e.push(t),e)),[]);t(n)},onInputChange:o,label:(0,l.__)("Categories"),tokenizeOnBlur:!0,__experimentalExpandOnFocus:!0,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})}function N({confirmLabel:e=(0,l.__)("Create"),defaultCategories:t=[],className:n="patterns-menu-items__convert-modal",content:a,modalTitle:o=(0,l.__)("Create pattern"),onClose:s,onError:i,onSuccess:u,defaultSyncType:_=d.full,defaultTitle:m=""}){const[y,g]=(0,P.useState)(_),[f,w]=(0,P.useState)(t),[E,b]=(0,P.useState)(m),[C,T]=(0,P.useState)(!1),{createPattern:B}=S((0,r.useDispatch)(v)),{saveEntityRecord:R,invalidateResolution:N}=(0,r.useDispatch)(c.store),{createErrorNotice:M}=(0,r.useDispatch)(x.store),{corePatternCategories:O,userPatternCategories:A}=(0,r.useSelect)((e=>{const{getUserPatternCategories:t,getBlockPatternCategories:n}=e(c.store);return{corePatternCategories:n(),userPatternCategories:t()}})),U=(0,P.useMemo)((()=>{const e=new Map;return[...A,...O].forEach((t=>{e.has(t.label)||"query"===t.name||e.set(t.label,{label:t.label,value:t.label,name:t.name})})),e}),[A,O]);return(0,h.createElement)(k.Modal,{title:o,onRequestClose:()=>{s(),b("")},overlayClassName:n},(0,h.createElement)("form",{onSubmit:e=>{e.preventDefault(),async function(e,t){if(E&&!C)try{T(!0);const n=await Promise.all(f.map((e=>async function(e){try{const t=U.get(e),n=t?{name:t.label,slug:t.name}:{name:e},a=await R("taxonomy",D,n,{throwOnError:!0});return N("getUserPatternCategories"),a.id}catch(e){if("term_exists"!==e.code)throw e;return e.data.term_id}}(e)))),r=await B(e,t,"function"==typeof a?a():a,n);u({pattern:r,categoryId:p})}catch(e){M(e.message,{type:"snackbar",id:"pattern-create"}),i?.()}finally{T(!1),w([]),b("")}}(E,y)}},(0,h.createElement)(k.__experimentalVStack,{spacing:"5"},(0,h.createElement)(k.TextControl,{label:(0,l.__)("Name"),value:E,onChange:b,placeholder:(0,l.__)("My pattern"),className:"patterns-create-modal__name-input",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,h.createElement)(I,{categoryTerms:f,onChange:w,categoryMap:U}),(0,h.createElement)(k.ToggleControl,{label:(0,l._x)("Synced","Option that makes an individual pattern synchronized"),help:(0,l.__)("Sync this pattern across multiple locations."),checked:y===d.full,onChange:()=>{g(y===d.full?d.unsynced:d.full)}}),(0,h.createElement)(k.__experimentalHStack,{justify:"right"},(0,h.createElement)(k.Button,{__next40pxDefaultSize:!0,variant:"tertiary",onClick:()=>{s(),b("")}},(0,l.__)("Cancel")),(0,h.createElement)(k.Button,{__next40pxDefaultSize:!0,variant:"primary",type:"submit","aria-disabled":!E||C,isBusy:C},e)))))}function M(e,t){return e.type!==u.user?t.core?.filter((t=>e.categories.includes(t.name))).map((e=>e.label)):t.user?.filter((t=>e.wp_pattern_category.includes(t.id))).map((e=>e.label))}var O=window.wp.primitives,A=(0,h.createElement)(O.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,h.createElement)(O.Path,{d:"M21.3 10.8l-5.6-5.6c-.7-.7-1.8-.7-2.5 0l-5.6 5.6c-.7.7-.7 1.8 0 2.5l5.6 5.6c.3.3.8.5 1.2.5s.9-.2 1.2-.5l5.6-5.6c.8-.7.8-1.9.1-2.5zm-1 1.4l-5.6 5.6c-.1.1-.3.1-.4 0l-5.6-5.6c-.1-.1-.1-.3 0-.4l5.6-5.6s.1-.1.2-.1.1 0 .2.1l5.6 5.6c.1.1.1.3 0 .4zm-16.6-.4L10 5.5l-1-1-6.3 6.3c-.7.7-.7 1.8 0 2.5L9 19.5l1.1-1.1-6.3-6.3c-.2 0-.2-.2-.1-.3z"}));function U({clientIds:e,rootClientId:t,closeBlockSettingsMenu:n}){const{createSuccessNotice:a}=(0,r.useDispatch)(x.store),{replaceBlocks:o}=(0,r.useDispatch)(i.store),{setEditingPattern:u}=S((0,r.useDispatch)(v)),[p,_]=(0,P.useState)(!1),m=(0,r.useSelect)((n=>{var a;const{canUser:r}=n(c.store),{getBlocksByClientId:o,canInsertBlockType:l,getBlockRootClientId:u}=n(i.store),p=t||(e.length>0?u(e[0]):void 0),d=null!==(a=o(e))&&void 0!==a?a:[];return!(1===d.length&&d[0]&&(0,s.isReusableBlock)(d[0])&&n(c.store).getEntityRecord("postType","wp_block",d[0].attributes.ref))&&l("core/block",p)&&d.every((e=>!!e&&e.isValid&&(0,s.hasBlockSupport)(e.name,"reusable",!0)))&&!!r("create","blocks")}),[e,t]),{getBlocksByClientId:y}=(0,r.useSelect)(i.store),g=(0,P.useCallback)((()=>(0,s.serialize)(y(e))),[y,e]);return m?(0,h.createElement)(h.Fragment,null,(0,h.createElement)(k.MenuItem,{icon:A,onClick:()=>_(!0),"aria-expanded":p,"aria-haspopup":"dialog"},(0,l.__)("Create pattern")),p&&(0,h.createElement)(N,{content:g,onSuccess:t=>{(({pattern:t})=>{if(t.wp_pattern_sync_status!==d.unsynced){const a=(0,s.createBlock)("core/block",{ref:t.id});o(e,a),u(a.clientId,!0),n()}a(t.wp_pattern_sync_status===d.unsynced?(0,l.sprintf)(
// translators: %s: the name the user has given to the pattern.
(0,l.__)("Unsynced pattern created: %s"),t.title.raw):(0,l.sprintf)(
// translators: %s: the name the user has given to the pattern.
(0,l.__)("Synced pattern created: %s"),t.title.raw),{type:"snackbar",id:"convert-to-pattern-success"}),_(!1)})(t)},onError:()=>{_(!1)},onClose:()=>{_(!1)}})):null}var z=window.wp.url,L=function({clientId:e}){const{canRemove:t,isVisible:n,managePatternsUrl:a}=(0,r.useSelect)((t=>{const{getBlock:n,canRemoveBlock:a,getBlockCount:r,getSettings:o}=t(i.store),{canUser:l}=t(c.store),u=n(e),p=o().__unstableIsBlockBasedTheme;return{canRemove:a(e),isVisible:!!u&&(0,s.isReusableBlock)(u)&&!!l("update","blocks",u.attributes.ref),innerBlockCount:r(e),managePatternsUrl:p&&l("read","templates")?(0,z.addQueryArgs)("site-editor.php",{path:"/patterns"}):(0,z.addQueryArgs)("edit.php",{post_type:"wp_block"})}}),[e]),{convertSyncedPatternToStatic:o}=S((0,r.useDispatch)(v));return n?(0,h.createElement)(h.Fragment,null,t&&(0,h.createElement)(k.MenuItem,{onClick:()=>o(e)},(0,l.__)("Detach")),(0,h.createElement)(k.MenuItem,{href:a},(0,l.__)("Manage patterns"))):null},j=window.wp.a11y;const F={};b(F,{CreatePatternModal:N,DuplicatePatternModal:function({pattern:e,onClose:t,onSuccess:n}){const{createSuccessNotice:a}=(0,r.useDispatch)(x.store),o=(0,r.useSelect)((e=>{const{getUserPatternCategories:t,getBlockPatternCategories:n}=e(c.store);return{core:n(),user:t()}}));if(!e)return null;const s={content:e.content,defaultCategories:M(e,o),defaultSyncType:e.type!==u.user?d.unsynced:e.wp_pattern_sync_status||d.full,defaultTitle:(0,l.sprintf)(/* translators: %s: Existing pattern title */
(0,l.__)("%s (Copy)"),"string"==typeof e.title?e.title:e.title.raw)};return(0,h.createElement)(N,{modalTitle:(0,l.__)("Duplicate pattern"),confirmLabel:(0,l.__)("Duplicate"),onClose:t,onError:t,onSuccess:function({pattern:e}){a((0,l.sprintf)(
// translators: %s: The new pattern's title e.g. 'Call to action (copy)'.
(0,l.__)('"%s" duplicated.'),e.title.raw),{type:"snackbar",id:"patterns-create"}),n?.({pattern:e})},...s})},RenamePatternModal:function({onClose:e,onError:t,onSuccess:n,pattern:a,...o}){const s=(0,B.decodeEntities)(a.title),[i,u]=(0,P.useState)(s),[p,d]=(0,P.useState)(!1),{editEntityRecord:_,__experimentalSaveSpecifiedEntityEdits:m}=(0,r.useDispatch)(c.store),{createSuccessNotice:y,createErrorNotice:g}=(0,r.useDispatch)(x.store);return(0,h.createElement)(k.Modal,{title:(0,l.__)("Rename"),...o,onRequestClose:e},(0,h.createElement)("form",{onSubmit:async r=>{if(r.preventDefault(),i&&i!==a.title&&!p)try{await _("postType",a.type,a.id,{title:i}),d(!0),u(""),e?.();const t=await m("postType",a.type,a.id,["title"],{throwOnError:!0});n?.(t),y((0,l.__)("Pattern renamed"),{type:"snackbar",id:"pattern-update"})}catch(e){t?.();const n=e.message&&"unknown_error"!==e.code?e.message:(0,l.__)("An error occurred while renaming the pattern.");g(n,{type:"snackbar",id:"pattern-update"})}finally{d(!1),u("")}}},(0,h.createElement)(k.__experimentalVStack,{spacing:"5"},(0,h.createElement)(k.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:(0,l.__)("Name"),value:i,onChange:u,required:!0}),(0,h.createElement)(k.__experimentalHStack,{justify:"right"},(0,h.createElement)(k.Button,{__next40pxDefaultSize:!0,variant:"tertiary",onClick:()=>{e?.(),u("")}},(0,l.__)("Cancel")),(0,h.createElement)(k.Button,{__next40pxDefaultSize:!0,variant:"primary",type:"submit"},(0,l.__)("Save"))))))},PatternsMenuItems:function({rootClientId:e}){return(0,h.createElement)(i.BlockSettingsMenuControls,null,(({selectedClientIds:t,onClose:n})=>(0,h.createElement)(h.Fragment,null,(0,h.createElement)(U,{clientIds:t,rootClientId:e,closeBlockSettingsMenu:n}),1===t.length&&(0,h.createElement)(L,{clientId:t[0]}))))},RenamePatternCategoryModal:function({category:e,existingCategories:t,onClose:n,onError:a,onSuccess:o,...s}){const i=(0,P.useId)(),u=(0,P.useRef)(),[p,d]=(0,P.useState)((0,B.decodeEntities)(e.name)),[_,m]=(0,P.useState)(!1),[y,g]=(0,P.useState)(!1),f=y?`patterns-rename-pattern-category-modal__validation-message-${i}`:void 0,{saveEntityRecord:w,invalidateResolution:E}=(0,r.useDispatch)(c.store),{createErrorNotice:b,createSuccessNotice:S}=(0,r.useDispatch)(x.store),C=()=>{n(),d("")};return(0,h.createElement)(k.Modal,{title:(0,l.__)("Rename"),onRequestClose:C,...s},(0,h.createElement)("form",{onSubmit:async r=>{if(r.preventDefault(),!_){if(!p||p===e.name){const e=(0,l.__)("Please enter a new name for this category.");return(0,j.speak)(e,"assertive"),g(e),void u.current?.focus()}if(t.patternCategories.find((t=>t.id!==e.id&&t.label.toLowerCase()===p.toLowerCase()))){const e=(0,l.__)("This category already exists. Please use a different name.");return(0,j.speak)(e,"assertive"),g(e),void u.current?.focus()}try{m(!0);const t=await w("taxonomy",D,{id:e.id,slug:e.slug,name:p});E("getUserPatternCategories"),o?.(t),n(),S((0,l.__)("Pattern category renamed."),{type:"snackbar",id:"pattern-category-update"})}catch(e){a?.(),b(e.message,{type:"snackbar",id:"pattern-category-update"})}finally{m(!1),d("")}}}},(0,h.createElement)(k.__experimentalVStack,{spacing:"5"},(0,h.createElement)(k.__experimentalVStack,{spacing:"2"},(0,h.createElement)(k.TextControl,{ref:u,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:(0,l.__)("Name"),value:p,onChange:e=>{y&&g(void 0),d(e)},"aria-describedby":f,required:!0}),y&&(0,h.createElement)("span",{className:"patterns-rename-pattern-category-modal__validation-message",id:f},y)),(0,h.createElement)(k.__experimentalHStack,{justify:"right"},(0,h.createElement)(k.Button,{__next40pxDefaultSize:!0,variant:"tertiary",onClick:C},(0,l.__)("Cancel")),(0,h.createElement)(k.Button,{__next40pxDefaultSize:!0,variant:"primary",type:"submit","aria-disabled":!p||p===e.name||_,isBusy:_},(0,l.__)("Save"))))))},PartialSyncingControls:function({name:e,attributes:t,setAttributes:n}){const a=_[e],r=Object.keys(a).map((e=>t.connections?.attributes?.[e]?.source));if(r.every((e=>e&&"pattern_attributes"!==e)))return null;return(0,h.createElement)(i.InspectorControls,{group:"advanced"},(0,h.createElement)(k.BaseControl,{__nextHasNoMarginBottom:!0},(0,h.createElement)(k.BaseControl.VisualLabel,null,(0,l.__)("Pattern overrides")),(0,h.createElement)(k.CheckboxControl,{__nextHasNoMarginBottom:!0,label:(0,l.__)("Allow instance overrides"),checked:r.some((e=>"pattern_attributes"===e)),onChange:e=>{!function(e){let r={...t.connections,attributes:{...t.connections?.attributes}};if(!e){for(const e of Object.keys(a))"pattern_attributes"===r.attributes[e]?.source&&delete r.attributes[e];return Object.keys(r.attributes).length||delete r.attributes,Object.keys(r).length||(r=void 0),void n({connections:r})}for(const e of Object.keys(a))r.attributes[e]||(r.attributes[e]={source:"pattern_attributes"});if("string"==typeof t.metadata?.id)return void n({connections:r});const o=((e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")),""))(6);n({connections:r,metadata:{...t.metadata,id:o}})}(e)}})))},PATTERN_TYPES:u,PATTERN_DEFAULT_CATEGORY:p,PATTERN_USER_CATEGORY:"my-patterns",EXCLUDED_PATTERN_SOURCES:["core","pattern-directory/core","pattern-directory/featured"],PATTERN_SYNC_TYPES:d,PARTIAL_SYNCING_SUPPORTED_BLOCKS:_}),(window.wp=window.wp||{}).patterns=t}();
//# sourceMappingURL=index.min.js.map