!function(){"use strict";var e={d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{privateApis:function(){return F},store:function(){return C}});var n={};e.r(n),e.d(n,{convertSyncedPatternToStatic:function(){return m},createPattern:function(){return p},createPatternFromFile:function(){return d},setEditingPattern:function(){return _}});var r={};e.r(r),e.d(r,{isEditingPattern:function(){return y}});var a=window.wp.data,o=(0,a.combineReducers)({isEditingPattern:function(e={},t){return"SET_EDITING_PATTERN"===t?.type?{...e,[t.clientId]:t.isEditing}:e}}),s=window.wp.blocks,c=window.wp.coreData,i=window.wp.blockEditor;const l="all-patterns",u={full:"fully",unsynced:"unsynced"},p=(e,t,n,r)=>async({registry:a})=>{const o=t===u.unsynced?{wp_pattern_sync_status:t}:void 0,s={title:e,content:n,status:"publish",meta:o,wp_pattern_category:r};return await a.dispatch(c.store).saveEntityRecord("postType","wp_block",s)},d=(e,t)=>async({dispatch:n})=>{const r=await e.text();let a;try{a=JSON.parse(r)}catch(e){throw new Error("Invalid JSON file")}if("wp_block"!==a.__file||!a.title||!a.content||"string"!=typeof a.title||"string"!=typeof a.content||a.syncStatus&&"string"!=typeof a.syncStatus)throw new Error("Invalid pattern JSON file");return await n.createPattern(a.title,a.syncStatus,a.content,t)},m=e=>({registry:t})=>{const n=t.select(i.store).getBlock(e),r=t.select("core").getEditedEntityRecord("postType","wp_block",n.attributes.ref),a=(0,s.parse)("function"==typeof r.content?r.content(r):r.content);t.dispatch(i.store).replaceBlocks(n.clientId,a)};function _(e,t){return{type:"SET_EDITING_PATTERN",clientId:e,isEditing:t}}function y(e,t){return e.isEditingPattern[t]}var g=window.wp.privateApis;const{lock:f,unlock:w}=(0,g.__dangerousOptInToUnstableAPIsOnlyForCoreModules)("I know using unstable features means my theme or plugin will inevitably break in the next version of WordPress.","@wordpress/patterns"),E={reducer:o},C=(0,a.createReduxStore)("core/patterns",{...E});(0,a.register)(C),w(C).registerPrivateActions(n),w(C).registerPrivateSelectors(r);var S=window.React,b=window.wp.components,h=window.wp.i18n,v=window.wp.element,k=window.wp.notices,P=window.wp.compose,T=window.wp.htmlEntities;const R=e=>(0,T.decodeEntities)(e),B="wp_pattern_category";function I({categoryTerms:e,onChange:t,categoryMap:n}){const[r,a]=(0,v.useState)(""),o=(0,P.useDebounce)(a,500),s=(0,v.useMemo)((()=>Array.from(n.values()).map((e=>R(e.label))).filter((e=>""===r||e.toLowerCase().includes(r.toLowerCase()))).sort(((e,t)=>e.localeCompare(t)))),[r,n]);return(0,S.createElement)(b.FormTokenField,{className:"patterns-menu-items__convert-modal-categories",value:e,suggestions:s,onChange:function(e){const n=e.reduce(((e,t)=>(e.some((e=>e.toLowerCase()===t.toLowerCase()))||e.push(t),e)),[]);t(n)},onInputChange:o,label:(0,h.__)("Categories"),tokenizeOnBlur:!0,__experimentalExpandOnFocus:!0,__next40pxDefaultSize:!0})}function N({confirmLabel:e=(0,h.__)("Create"),defaultCategories:t=[],className:n="patterns-menu-items__convert-modal",content:r,modalTitle:o=(0,h.__)("Create pattern"),onClose:s,onError:i,onSuccess:p,defaultSyncType:d=u.full,defaultTitle:m=""}){const[_,y]=(0,v.useState)(d),[g,f]=(0,v.useState)(t),[E,P]=(0,v.useState)(m),[T,R]=(0,v.useState)(!1),{createPattern:N}=w((0,a.useDispatch)(C)),{saveEntityRecord:x,invalidateResolution:D}=(0,a.useDispatch)(c.store),{createErrorNotice:M}=(0,a.useDispatch)(k.store),{corePatternCategories:A,userPatternCategories:O}=(0,a.useSelect)((e=>{const{getUserPatternCategories:t,getBlockPatternCategories:n}=e(c.store);return{corePatternCategories:n(),userPatternCategories:t()}})),U=(0,v.useMemo)((()=>{const e=new Map;return[...O,...A].forEach((t=>{e.has(t.label)||"query"===t.name||e.set(t.label,{label:t.label,value:t.label,name:t.name})})),e}),[O,A]);return(0,S.createElement)(b.Modal,{title:o,onRequestClose:()=>{s(),P("")},overlayClassName:n},(0,S.createElement)("form",{onSubmit:e=>{e.preventDefault(),async function(e,t){if(E&&!T)try{R(!0);const n=await Promise.all(g.map((e=>async function(e){try{const t=U.get(e),n=t?{name:t.label,slug:t.name}:{name:e},r=await x("taxonomy",B,n,{throwOnError:!0});return D("getUserPatternCategories"),r.id}catch(e){if("term_exists"!==e.code)throw e;return e.data.term_id}}(e)))),a=await N(e,t,"function"==typeof r?r():r,n);p({pattern:a,categoryId:l})}catch(e){M(e.message,{type:"snackbar",id:"pattern-create"}),i?.()}finally{R(!1),f([]),P("")}}(E,_)}},(0,S.createElement)(b.__experimentalVStack,{spacing:"5"},(0,S.createElement)(b.TextControl,{__nextHasNoMarginBottom:!0,label:(0,h.__)("Name"),value:E,onChange:P,placeholder:(0,h.__)("My pattern"),className:"patterns-create-modal__name-input"}),(0,S.createElement)(I,{categoryTerms:g,onChange:f,categoryMap:U}),(0,S.createElement)(b.ToggleControl,{label:(0,h.__)("Synced"),help:(0,h.__)("Editing the pattern will update it anywhere it is used."),checked:_===u.full,onChange:()=>{y(_===u.full?u.unsynced:u.full)}}),(0,S.createElement)(b.__experimentalHStack,{justify:"right"},(0,S.createElement)(b.Button,{variant:"tertiary",onClick:()=>{s(),P("")}},(0,h.__)("Cancel")),(0,S.createElement)(b.Button,{variant:"primary",type:"submit","aria-disabled":!E||T,isBusy:T},e)))))}function x(e,t){return e.id?t.user?.filter((t=>e.wp_pattern_category.includes(t.id))).map((e=>e.label)):t.core?.filter((t=>e.categories.includes(t.name))).map((e=>e.label))}var D=window.wp.primitives,M=(0,S.createElement)(D.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,S.createElement)(D.Path,{d:"M21.3 10.8l-5.6-5.6c-.7-.7-1.8-.7-2.5 0l-5.6 5.6c-.7.7-.7 1.8 0 2.5l5.6 5.6c.3.3.8.5 1.2.5s.9-.2 1.2-.5l5.6-5.6c.8-.7.8-1.9.1-2.5zm-1 1.4l-5.6 5.6c-.1.1-.3.1-.4 0l-5.6-5.6c-.1-.1-.1-.3 0-.4l5.6-5.6s.1-.1.2-.1.1 0 .2.1l5.6 5.6c.1.1.1.3 0 .4zm-16.6-.4L10 5.5l-1-1-6.3 6.3c-.7.7-.7 1.8 0 2.5L9 19.5l1.1-1.1-6.3-6.3c-.2 0-.2-.2-.1-.3z"}));function A({clientIds:e,rootClientId:t}){const{createSuccessNotice:n}=(0,a.useDispatch)(k.store),{replaceBlocks:r}=(0,a.useDispatch)(i.store),{setEditingPattern:o}=w((0,a.useDispatch)(C)),[l,p]=(0,v.useState)(!1),d=(0,a.useSelect)((n=>{var r;const{canUser:a}=n(c.store),{getBlocksByClientId:o,canInsertBlockType:l,getBlockRootClientId:u}=n(i.store),p=t||(e.length>0?u(e[0]):void 0),d=null!==(r=o(e))&&void 0!==r?r:[];return!(1===d.length&&d[0]&&(0,s.isReusableBlock)(d[0])&&n(c.store).getEntityRecord("postType","wp_block",d[0].attributes.ref))&&l("core/block",p)&&d.every((e=>!!e&&e.isValid&&(0,s.hasBlockSupport)(e.name,"reusable",!0)))&&!!a("create","blocks")}),[e,t]),{getBlocksByClientId:m}=(0,a.useSelect)(i.store),_=(0,v.useCallback)((()=>(0,s.serialize)(m(e))),[m,e]);return d?(0,S.createElement)(S.Fragment,null,(0,S.createElement)(b.MenuItem,{icon:M,onClick:()=>p(!0),"aria-expanded":l,"aria-haspopup":"dialog"},(0,h.__)("Create pattern")),l&&(0,S.createElement)(N,{content:_,onSuccess:t=>{(({pattern:t})=>{if(t.wp_pattern_sync_status!==u.unsynced){const n=(0,s.createBlock)("core/block",{ref:t.id});r(e,n),o(n.clientId,!0)}n(t.wp_pattern_sync_status===u.unsynced?(0,h.sprintf)(
// translators: %s: the name the user has given to the pattern.
(0,h.__)("Unsynced pattern created: %s"),t.title.raw):(0,h.sprintf)(
// translators: %s: the name the user has given to the pattern.
(0,h.__)("Synced pattern created: %s"),t.title.raw),{type:"snackbar",id:"convert-to-pattern-success"}),p(!1)})(t)},onError:()=>{p(!1)},onClose:()=>{p(!1)}})):null}var O=window.wp.url,U=function({clientId:e}){const{canRemove:t,isVisible:n,innerBlockCount:r,managePatternsUrl:o}=(0,a.useSelect)((t=>{const{getBlock:n,canRemoveBlock:r,getBlockCount:a,getSettings:o}=t(i.store),{canUser:l}=t(c.store),u=n(e),p=o().__unstableIsBlockBasedTheme;return{canRemove:r(e),isVisible:!!u&&(0,s.isReusableBlock)(u)&&!!l("update","blocks",u.attributes.ref),innerBlockCount:a(e),managePatternsUrl:p&&l("read","templates")?(0,O.addQueryArgs)("site-editor.php",{path:"/patterns"}):(0,O.addQueryArgs)("edit.php",{post_type:"wp_block"})}}),[e]),{convertSyncedPatternToStatic:l}=w((0,a.useDispatch)(C));return n?(0,S.createElement)(S.Fragment,null,(0,S.createElement)(b.MenuItem,{href:o},(0,h.__)("Manage patterns")),t&&(0,S.createElement)(b.MenuItem,{onClick:()=>l(e)},r>1?(0,h.__)("Detach patterns"):(0,h.__)("Detach pattern"))):null},L=window.wp.a11y;const F={};f(F,{CreatePatternModal:N,DuplicatePatternModal:function({pattern:e,onClose:t,onSuccess:n}){const{createSuccessNotice:r}=(0,a.useDispatch)(k.store),o=(0,a.useSelect)((e=>{const{getUserPatternCategories:t,getBlockPatternCategories:n}=e(c.store);return{core:n(),user:t()}}));if(!e)return null;const s={content:e.content,defaultCategories:x(e,o),defaultSyncType:e.id?e.wp_pattern_sync_status||u.full:u.unsynced,defaultTitle:(0,h.sprintf)(/* translators: %s: Existing pattern title */
(0,h.__)("%s (Copy)"),"string"==typeof e.title?e.title:e.title.raw)};return(0,S.createElement)(N,{modalTitle:(0,h.__)("Duplicate pattern"),confirmLabel:(0,h.__)("Duplicate"),onClose:t,onError:t,onSuccess:function({pattern:e}){r((0,h.sprintf)(
// translators: %s: The new pattern's title e.g. 'Call to action (copy)'.
(0,h.__)('"%s" duplicated.'),e.title.raw),{type:"snackbar",id:"patterns-create"}),n?.({pattern:e})},...s})},RenamePatternModal:function({onClose:e,onError:t,onSuccess:n,pattern:r,...o}){const s=(0,T.decodeEntities)(r.title),[i,l]=(0,v.useState)(s),[u,p]=(0,v.useState)(!1),{editEntityRecord:d,__experimentalSaveSpecifiedEntityEdits:m}=(0,a.useDispatch)(c.store),{createSuccessNotice:_,createErrorNotice:y}=(0,a.useDispatch)(k.store);return(0,S.createElement)(b.Modal,{title:(0,h.__)("Rename"),...o,onRequestClose:e},(0,S.createElement)("form",{onSubmit:async a=>{if(a.preventDefault(),i&&i!==r.title&&!u)try{await d("postType",r.type,r.id,{title:i}),p(!0),l(""),e?.();const t=await m("postType",r.type,r.id,["title"],{throwOnError:!0});n?.(t),_((0,h.__)("Pattern renamed"),{type:"snackbar",id:"pattern-update"})}catch(e){t?.();const n=e.message&&"unknown_error"!==e.code?e.message:(0,h.__)("An error occurred while renaming the pattern.");y(n,{type:"snackbar",id:"pattern-update"})}finally{p(!1),l("")}}},(0,S.createElement)(b.__experimentalVStack,{spacing:"5"},(0,S.createElement)(b.TextControl,{__nextHasNoMarginBottom:!0,label:(0,h.__)("Name"),value:i,onChange:l,required:!0}),(0,S.createElement)(b.__experimentalHStack,{justify:"right"},(0,S.createElement)(b.Button,{variant:"tertiary",onClick:()=>{e?.(),l("")}},(0,h.__)("Cancel")),(0,S.createElement)(b.Button,{variant:"primary",type:"submit"},(0,h.__)("Save"))))))},PatternsMenuItems:function({rootClientId:e}){return(0,S.createElement)(i.BlockSettingsMenuControls,null,(({selectedClientIds:t})=>(0,S.createElement)(S.Fragment,null,(0,S.createElement)(A,{clientIds:t,rootClientId:e}),1===t.length&&(0,S.createElement)(U,{clientId:t[0]}))))},RenamePatternCategoryModal:function({category:e,existingCategories:t,onClose:n,onError:r,onSuccess:o,...s}){const i=(0,v.useId)(),l=(0,v.useRef)(),[u,p]=(0,v.useState)((0,T.decodeEntities)(e.name)),[d,m]=(0,v.useState)(!1),[_,y]=(0,v.useState)(!1),g=_?`patterns-rename-pattern-category-modal__validation-message-${i}`:void 0,{saveEntityRecord:f,invalidateResolution:w}=(0,a.useDispatch)(c.store),{createErrorNotice:E,createSuccessNotice:C}=(0,a.useDispatch)(k.store),P=()=>{n(),p("")};return(0,S.createElement)(b.Modal,{title:(0,h.__)("Rename"),onRequestClose:P,...s},(0,S.createElement)("form",{onSubmit:async a=>{if(a.preventDefault(),!d){if(!u||u===e.name){const e=(0,h.__)("Please enter a new name for this category.");return(0,L.speak)(e,"assertive"),y(e),void l.current?.focus()}if(t.patternCategories.find((t=>t.id!==e.id&&t.label.toLowerCase()===u.toLowerCase()))){const e=(0,h.__)("This category already exists. Please use a different name.");return(0,L.speak)(e,"assertive"),y(e),void l.current?.focus()}try{m(!0);const t=await f("taxonomy",B,{id:e.id,slug:e.slug,name:u});w("getUserPatternCategories"),o?.(t),n(),C((0,h.__)("Pattern category renamed."),{type:"snackbar",id:"pattern-category-update"})}catch(e){r?.(),E(e.message,{type:"snackbar",id:"pattern-category-update"})}finally{m(!1),p("")}}}},(0,S.createElement)(b.__experimentalVStack,{spacing:"5"},(0,S.createElement)(b.__experimentalVStack,{spacing:"2"},(0,S.createElement)(b.TextControl,{ref:l,__nextHasNoMarginBottom:!0,label:(0,h.__)("Name"),value:u,onChange:e=>{_&&y(void 0),p(e)},"aria-describedby":g,required:!0}),_&&(0,S.createElement)("span",{className:"patterns-rename-pattern-category-modal__validation-message",id:g},_)),(0,S.createElement)(b.__experimentalHStack,{justify:"right"},(0,S.createElement)(b.Button,{variant:"tertiary",onClick:P},(0,h.__)("Cancel")),(0,S.createElement)(b.Button,{variant:"primary",type:"submit","aria-disabled":!u||u===e.name||d,isBusy:d},(0,h.__)("Save"))))))},PATTERN_TYPES:{theme:"pattern",user:"wp_block"},PATTERN_DEFAULT_CATEGORY:l,PATTERN_USER_CATEGORY:"my-patterns",PATTERN_CORE_SOURCES:["core","pattern-directory/core","pattern-directory/featured","pattern-directory/theme"],PATTERN_SYNC_TYPES:u}),(window.wp=window.wp||{}).patterns=t}();
//# sourceMappingURL=index.min.js.map