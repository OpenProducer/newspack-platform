(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{privateApis:()=>x});var n={};e.r(n),e.d(n,{__experimentalConvertSyncedPatternToStatic:()=>p,__experimentalCreatePattern:()=>i,__experimentalSetEditingPattern:()=>d});var r={};e.r(r),e.d(r,{__experimentalIsEditingPattern:()=>u});const a=window.wp.data,o=(0,a.combineReducers)({isEditingPattern:function(e={},t){return"SET_EDITING_PATTERN"===t?.type?{...e,[t.clientId]:t.isEditing}:e}}),c=window.wp.blocks,s=window.wp.coreData,l=window.wp.blockEditor,i=(e,t,n)=>async({registry:r,dispatch:a})=>{const o="unsynced"===t?{wp_pattern_sync_status:t}:void 0,i={title:e,content:n?(0,c.serialize)(r.select(l.store).getBlocksByClientId(n)):void 0,status:"publish",meta:o},p=await r.dispatch(s.store).saveEntityRecord("postType","wp_block",i);if("unsynced"===t||!n)return p;const d=(0,c.createBlock)("core/block",{ref:p.id});return r.dispatch(l.store).replaceBlocks(n,d),a.__experimentalSetEditingPattern(d.clientId,!0),p},p=e=>({registry:t})=>{const n=t.select(l.store).getBlock(e),r=t.select("core").getEditedEntityRecord("postType","wp_block",n.attributes.ref),a=(0,c.parse)("function"==typeof r.content?r.content(r):r.content);t.dispatch(l.store).replaceBlocks(n.clientId,a)};function d(e,t){return{type:"SET_EDITING_PATTERN",clientId:e,isEditing:t}}function u(e,t){return e.isEditingPattern[t]}const m={reducer:o,selectors:r,actions:n},_=(0,a.createReduxStore)("core/patterns",{...m});(0,a.register)(_);const w=window.wp.privateApis,{lock:y,unlock:g}=(0,w.__dangerousOptInToUnstableAPIsOnlyForCoreModules)("I know using unstable features means my plugin or theme will inevitably break on the next WordPress release.","@wordpress/patterns"),E=window.wp.element,k=window.wp.components,b=window.wp.i18n,h=window.wp.notices,v="my-patterns",C={full:void 0,unsynced:"unsynced"};function f({onSuccess:e,onError:t,clientIds:n,onClose:r,className:o="patterns-menu-items__convert-modal"}){const[c,s]=(0,E.useState)(C.full),[l,i]=(0,E.useState)(""),{__experimentalCreatePattern:p}=(0,a.useDispatch)(_),{createErrorNotice:d}=(0,a.useDispatch)(h.store),u=(0,E.useCallback)((async function(r,a){try{const t=await p(r,a,n);e({pattern:t,categoryId:v})}catch(e){d(e.message,{type:"snackbar",id:"convert-to-pattern-error"}),t()}}),[p,n,e,d,t]);return(0,E.createElement)(k.Modal,{title:(0,b.__)("Create pattern"),onRequestClose:()=>{r(),i("")},overlayClassName:o},(0,E.createElement)("form",{onSubmit:e=>{e.preventDefault(),u(l,c),i("")}},(0,E.createElement)(k.__experimentalVStack,{spacing:"5"},(0,E.createElement)(k.TextControl,{__nextHasNoMarginBottom:!0,label:(0,b.__)("Name"),value:l,onChange:i,placeholder:(0,b.__)("My pattern")}),(0,E.createElement)(k.ToggleControl,{label:(0,b.__)("Synced"),help:(0,b.__)("Editing the pattern will update it anywhere it is used."),checked:!c,onChange:()=>{s(c===C.full?C.unsynced:C.full)}}),(0,E.createElement)(k.__experimentalHStack,{justify:"right"},(0,E.createElement)(k.Button,{variant:"tertiary",onClick:()=>{r(),i("")}},(0,b.__)("Cancel")),(0,E.createElement)(k.Button,{variant:"primary",type:"submit"},(0,b.__)("Create"))))))}const I=window.wp.primitives,S=(0,E.createElement)(I.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,E.createElement)(I.Path,{d:"M21.3 10.8l-5.6-5.6c-.7-.7-1.8-.7-2.5 0l-5.6 5.6c-.7.7-.7 1.8 0 2.5l5.6 5.6c.3.3.8.5 1.2.5s.9-.2 1.2-.5l5.6-5.6c.8-.7.8-1.9.1-2.5zm-1 1.4l-5.6 5.6c-.1.1-.3.1-.4 0l-5.6-5.6c-.1-.1-.1-.3 0-.4l5.6-5.6s.1-.1.2-.1.1 0 .2.1l5.6 5.6c.1.1.1.3 0 .4zm-16.6-.4L10 5.5l-1-1-6.3 6.3c-.7.7-.7 1.8 0 2.5L9 19.5l1.1-1.1-6.3-6.3c-.2 0-.2-.2-.1-.3z"}));function B({clientIds:e,rootClientId:t}){const{createSuccessNotice:n}=(0,a.useDispatch)(h.store),[r,o]=(0,E.useState)(!1);return(0,a.useSelect)((n=>{var r;const{canUser:a}=n(s.store),{getBlocksByClientId:o,canInsertBlockType:i,getBlockRootClientId:p}=n(l.store),d=t||(e.length>0?p(e[0]):void 0),u=null!==(r=o(e))&&void 0!==r?r:[];return!(1===u.length&&u[0]&&(0,c.isReusableBlock)(u[0])&&n(s.store).getEntityRecord("postType","wp_block",u[0].attributes.ref))&&i("core/block",d)&&u.every((e=>!!e&&e.isValid&&(0,c.hasBlockSupport)(e.name,"reusable",!0)))&&!!a("create","blocks")}),[e,t])?(0,E.createElement)(E.Fragment,null,(0,E.createElement)(k.MenuItem,{icon:S,onClick:()=>o(!0),"aria-expanded":r,"aria-haspopup":"dialog"},(0,b.__)("Create pattern")),r&&(0,E.createElement)(f,{clientIds:e,onSuccess:e=>{(({pattern:e})=>{n("unsynced"===e.wp_pattern_sync_status?(0,b.sprintf)(
// translators: %s: the name the user has given to the pattern.
(0,b.__)("Unsynced Pattern created: %s"),e.title.raw):(0,b.sprintf)(
// translators: %s: the name the user has given to the pattern.
(0,b.__)("Synced Pattern created: %s"),e.title.raw),{type:"snackbar",id:"convert-to-pattern-success"}),o(!1)})(e)},onError:()=>{o(!1)},onClose:()=>{o(!1)}})):null}const P=window.wp.url,T=function({clientId:e}){const{canRemove:t,isVisible:n,innerBlockCount:r,managePatternsUrl:o}=(0,a.useSelect)((t=>{const{getBlock:n,canRemoveBlock:r,getBlockCount:a,getSettings:o}=t(l.store),{canUser:i}=t(s.store),p=n(e),d=o().__unstableIsBlockBasedTheme;return{canRemove:r(e),isVisible:!!p&&(0,c.isReusableBlock)(p)&&!!i("update","blocks",p.attributes.ref),innerBlockCount:a(e),managePatternsUrl:d&&i("read","templates")?(0,P.addQueryArgs)("site-editor.php",{path:"/patterns"}):(0,P.addQueryArgs)("edit.php",{post_type:"wp_block"})}}),[e]),{__experimentalConvertSyncedPatternToStatic:i}=(0,a.useDispatch)(_);return n?(0,E.createElement)(E.Fragment,null,(0,E.createElement)(k.MenuItem,{href:o},(0,b.__)("Manage patterns")),t&&(0,E.createElement)(k.MenuItem,{onClick:()=>i(e)},r>1?(0,b.__)("Detach patterns"):(0,b.__)("Detach pattern"))):null},x={};y(x,{CreatePatternModal:f,PatternsMenuItems:function({rootClientId:e}){return(0,E.createElement)(l.BlockSettingsMenuControls,null,(({selectedClientIds:t})=>(0,E.createElement)(E.Fragment,null,(0,E.createElement)(B,{clientIds:t,rootClientId:e}),1===t.length&&(0,E.createElement)(T,{clientId:t[0]}))))}}),(window.wp=window.wp||{}).patterns=t})();
//# sourceMappingURL=index.min.js.map