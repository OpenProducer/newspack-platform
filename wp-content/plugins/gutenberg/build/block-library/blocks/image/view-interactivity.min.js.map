{"version":3,"file":"./build/block-library/blocks/image/view-interactivity.min.js","mappings":"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","sources":["webpack://wp/external window [\"wp\",\"interactivity\"]","webpack://wp/./packages/block-library/build-module/image/@wordpress/block-library/src/image/view-interactivity.js"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"interactivity\"];","/**\n * WordPress dependencies\n */\nimport { store } from '@wordpress/interactivity';\n\nconst focusableSelectors = [\n\t'a[href]',\n\t'area[href]',\n\t'input:not([disabled]):not([type=\"hidden\"]):not([aria-hidden])',\n\t'select:not([disabled]):not([aria-hidden])',\n\t'textarea:not([disabled]):not([aria-hidden])',\n\t'button:not([disabled]):not([aria-hidden])',\n\t'iframe',\n\t'object',\n\t'embed',\n\t'[contenteditable]',\n\t'[tabindex]:not([tabindex^=\"-\"])',\n];\n\nstore(\n\t{\n\t\tstate: {\n\t\t\tcore: {\n\t\t\t\timage: {\n\t\t\t\t\twindowWidth: window.innerWidth,\n\t\t\t\t\twindowHeight: window.innerHeight,\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tactions: {\n\t\t\tcore: {\n\t\t\t\timage: {\n\t\t\t\t\tshowLightbox: ( { context, event } ) => {\n\t\t\t\t\t\t// We can't initialize the lightbox until the reference\n\t\t\t\t\t\t// image is loaded, otherwise the UX is broken.\n\t\t\t\t\t\tif ( ! context.core.image.imageLoaded ) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontext.core.image.initialized = true;\n\t\t\t\t\t\tcontext.core.image.lastFocusedElement =\n\t\t\t\t\t\t\twindow.document.activeElement;\n\t\t\t\t\t\tcontext.core.image.scrollDelta = 0;\n\n\t\t\t\t\t\tcontext.core.image.lightboxEnabled = true;\n\t\t\t\t\t\tsetStyles( context, event );\n\t\t\t\t\t\t// Hide overflow only when the animation is in progress,\n\t\t\t\t\t\t// otherwise the removal of the scrollbars will draw attention\n\t\t\t\t\t\t// to itself and look like an error\n\t\t\t\t\t\tdocument.documentElement.classList.add(\n\t\t\t\t\t\t\t'wp-has-lightbox-open'\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\thideLightbox: async ( { context, event } ) => {\n\t\t\t\t\t\tcontext.core.image.hideAnimationEnabled = true;\n\t\t\t\t\t\tif ( context.core.image.lightboxEnabled ) {\n\t\t\t\t\t\t\t// If scrolling, wait a moment before closing the lightbox.\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tcontext.core.image.lightboxAnimation === 'fade'\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tcontext.core.image.scrollDelta += event.deltaY;\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tevent.type === 'mousewheel' &&\n\t\t\t\t\t\t\t\t\tMath.abs(\n\t\t\t\t\t\t\t\t\t\twindow.scrollY -\n\t\t\t\t\t\t\t\t\t\t\tcontext.core.image.scrollDelta\n\t\t\t\t\t\t\t\t\t) < 10\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t\tcontext.core.image.lightboxAnimation === 'zoom'\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t// Disable scroll until the zoom animation ends.\n\t\t\t\t\t\t\t\t// Get the current page scroll position\n\t\t\t\t\t\t\t\tconst scrollTop =\n\t\t\t\t\t\t\t\t\twindow.pageYOffset ||\n\t\t\t\t\t\t\t\t\tdocument.documentElement.scrollTop;\n\t\t\t\t\t\t\t\tconst scrollLeft =\n\t\t\t\t\t\t\t\t\twindow.pageXOffset ||\n\t\t\t\t\t\t\t\t\tdocument.documentElement.scrollLeft;\n\t\t\t\t\t\t\t\t// if any scroll is attempted, set this to the previous value.\n\t\t\t\t\t\t\t\twindow.onscroll = function () {\n\t\t\t\t\t\t\t\t\twindow.scrollTo( scrollLeft, scrollTop );\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t// Enable scrolling after the animation finishes\n\t\t\t\t\t\t\t\tsetTimeout( function () {\n\t\t\t\t\t\t\t\t\twindow.onscroll = function () {};\n\t\t\t\t\t\t\t\t}, 400 );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdocument.documentElement.classList.remove(\n\t\t\t\t\t\t\t\t'wp-has-lightbox-open'\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tcontext.core.image.lightboxEnabled = false;\n\t\t\t\t\t\t\tcontext.core.image.lastFocusedElement.focus( {\n\t\t\t\t\t\t\t\tpreventScroll: true,\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\thandleKeydown: ( { context, actions, event } ) => {\n\t\t\t\t\t\tif ( context.core.image.lightboxEnabled ) {\n\t\t\t\t\t\t\tif ( event.key === 'Tab' || event.keyCode === 9 ) {\n\t\t\t\t\t\t\t\t// If shift + tab it change the direction\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tevent.shiftKey &&\n\t\t\t\t\t\t\t\t\twindow.document.activeElement ===\n\t\t\t\t\t\t\t\t\t\tcontext.core.image.firstFocusableElement\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\t\tcontext.core.image.lastFocusableElement.focus();\n\t\t\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t\t\t! event.shiftKey &&\n\t\t\t\t\t\t\t\t\twindow.document.activeElement ===\n\t\t\t\t\t\t\t\t\t\tcontext.core.image.lastFocusableElement\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\t\tcontext.core.image.firstFocusableElement.focus();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tevent.key === 'Escape' ||\n\t\t\t\t\t\t\t\tevent.keyCode === 27\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tactions.core.image.hideLightbox( {\n\t\t\t\t\t\t\t\t\tcontext,\n\t\t\t\t\t\t\t\t\tevent,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\thandleLoad: ( { state, context, effects, ref } ) => {\n\t\t\t\t\t\tcontext.core.image.imageLoaded = true;\n\t\t\t\t\t\tcontext.core.image.imageCurrentSrc = ref.currentSrc;\n\t\t\t\t\t\teffects.core.image.setButtonStyles( {\n\t\t\t\t\t\t\tstate,\n\t\t\t\t\t\t\tcontext,\n\t\t\t\t\t\t\tref,\n\t\t\t\t\t\t} );\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tselectors: {\n\t\t\tcore: {\n\t\t\t\timage: {\n\t\t\t\t\troleAttribute: ( { context } ) => {\n\t\t\t\t\t\treturn context.core.image.lightboxEnabled\n\t\t\t\t\t\t\t? 'dialog'\n\t\t\t\t\t\t\t: '';\n\t\t\t\t\t},\n\t\t\t\t\tlightboxObjectFit: ( { context } ) => {\n\t\t\t\t\t\tif ( context.core.image.initialized ) {\n\t\t\t\t\t\t\treturn 'cover';\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tenlargedImgSrc: ( { context } ) => {\n\t\t\t\t\t\treturn context.core.image.initialized\n\t\t\t\t\t\t\t? context.core.image.imageUploadedSrc\n\t\t\t\t\t\t\t: '';\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\teffects: {\n\t\t\tcore: {\n\t\t\t\timage: {\n\t\t\t\t\tsetCurrentSrc: ( { context, ref } ) => {\n\t\t\t\t\t\tif ( ref.complete ) {\n\t\t\t\t\t\t\tcontext.core.image.imageLoaded = true;\n\t\t\t\t\t\t\tcontext.core.image.imageCurrentSrc = ref.currentSrc;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tinitLightbox: async ( { context, ref } ) => {\n\t\t\t\t\t\tcontext.core.image.figureRef =\n\t\t\t\t\t\t\tref.querySelector( 'figure' );\n\t\t\t\t\t\tcontext.core.image.imageRef =\n\t\t\t\t\t\t\tref.querySelector( 'img' );\n\t\t\t\t\t\tif ( context.core.image.lightboxEnabled ) {\n\t\t\t\t\t\t\tconst focusableElements =\n\t\t\t\t\t\t\t\tref.querySelectorAll( focusableSelectors );\n\t\t\t\t\t\t\tcontext.core.image.firstFocusableElement =\n\t\t\t\t\t\t\t\tfocusableElements[ 0 ];\n\t\t\t\t\t\t\tcontext.core.image.lastFocusableElement =\n\t\t\t\t\t\t\t\tfocusableElements[\n\t\t\t\t\t\t\t\t\tfocusableElements.length - 1\n\t\t\t\t\t\t\t\t];\n\n\t\t\t\t\t\t\tref.querySelector( '.close-button' ).focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tsetButtonStyles: ( { state, context, ref } ) => {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\tnaturalWidth,\n\t\t\t\t\t\t\tnaturalHeight,\n\t\t\t\t\t\t\toffsetWidth,\n\t\t\t\t\t\t\toffsetHeight,\n\t\t\t\t\t\t} = ref;\n\n\t\t\t\t\t\t// If the image isn't loaded yet, we can't\n\t\t\t\t\t\t// calculate how big the button should be.\n\t\t\t\t\t\tif ( naturalWidth === 0 || naturalHeight === 0 ) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Subscribe to the window dimensions so we can\n\t\t\t\t\t\t// recalculate the styles if the window is resized.\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t( state.core.image.windowWidth ||\n\t\t\t\t\t\t\t\tstate.core.image.windowHeight ) &&\n\t\t\t\t\t\t\tcontext.core.image.scaleAttr === 'contain'\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// In the case of an image with object-fit: contain, the\n\t\t\t\t\t\t\t// size of the img element can be larger than the image itself,\n\t\t\t\t\t\t\t// so we need to calculate the size of the button to match.\n\n\t\t\t\t\t\t\t// Natural ratio of the image.\n\t\t\t\t\t\t\tconst naturalRatio = naturalWidth / naturalHeight;\n\t\t\t\t\t\t\t// Offset ratio of the image.\n\t\t\t\t\t\t\tconst offsetRatio = offsetWidth / offsetHeight;\n\n\t\t\t\t\t\t\tif ( naturalRatio > offsetRatio ) {\n\t\t\t\t\t\t\t\t// If it reaches the width first, keep\n\t\t\t\t\t\t\t\t// the width and recalculate the height.\n\t\t\t\t\t\t\t\tcontext.core.image.imageButtonWidth =\n\t\t\t\t\t\t\t\t\toffsetWidth;\n\t\t\t\t\t\t\t\tconst buttonHeight = offsetWidth / naturalRatio;\n\t\t\t\t\t\t\t\tcontext.core.image.imageButtonHeight =\n\t\t\t\t\t\t\t\t\tbuttonHeight;\n\t\t\t\t\t\t\t\tcontext.core.image.imageButtonTop =\n\t\t\t\t\t\t\t\t\t( offsetHeight - buttonHeight ) / 2;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// If it reaches the height first, keep\n\t\t\t\t\t\t\t\t// the height and recalculate the width.\n\t\t\t\t\t\t\t\tcontext.core.image.imageButtonHeight =\n\t\t\t\t\t\t\t\t\toffsetHeight;\n\t\t\t\t\t\t\t\tconst buttonWidth = offsetHeight * naturalRatio;\n\t\t\t\t\t\t\t\tcontext.core.image.imageButtonWidth =\n\t\t\t\t\t\t\t\t\tbuttonWidth;\n\t\t\t\t\t\t\t\tcontext.core.image.imageButtonLeft =\n\t\t\t\t\t\t\t\t\t( offsetWidth - buttonWidth ) / 2;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// In all other cases, we can trust that the size of\n\t\t\t\t\t\t\t// the image is the right size for the button as well.\n\n\t\t\t\t\t\t\tcontext.core.image.imageButtonWidth = offsetWidth;\n\t\t\t\t\t\t\tcontext.core.image.imageButtonHeight = offsetHeight;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t},\n\t{\n\t\tafterLoad: ( { state } ) => {\n\t\t\twindow.addEventListener(\n\t\t\t\t'resize',\n\t\t\t\tdebounce( () => {\n\t\t\t\t\tstate.core.image.windowWidth = window.innerWidth;\n\t\t\t\t\tstate.core.image.windowHeight = window.innerHeight;\n\t\t\t\t} )\n\t\t\t);\n\t\t},\n\t}\n);\n\nfunction setStyles( context, event ) {\n\t// The reference img element lies adjacent\n\t// to the event target button in the DOM.\n\tlet {\n\t\tnaturalWidth,\n\t\tnaturalHeight,\n\t\toffsetWidth: originalWidth,\n\t\toffsetHeight: originalHeight,\n\t} = event.target.nextElementSibling;\n\tlet { x: screenPosX, y: screenPosY } =\n\t\tevent.target.nextElementSibling.getBoundingClientRect();\n\n\t// Natural ratio of the image clicked to open the lightbox.\n\tconst naturalRatio = naturalWidth / naturalHeight;\n\t// Original ratio of the image clicked to open the lightbox.\n\tlet originalRatio = originalWidth / originalHeight;\n\n\t// If it has object-fit: contain, recalculate the original sizes\n\t// and the screen position without the blank spaces.\n\tif ( context.core.image.scaleAttr === 'contain' ) {\n\t\tif ( naturalRatio > originalRatio ) {\n\t\t\tconst heightWithoutSpace = originalWidth / naturalRatio;\n\t\t\t// Recalculate screen position without the top space.\n\t\t\tscreenPosY += ( originalHeight - heightWithoutSpace ) / 2;\n\t\t\toriginalHeight = heightWithoutSpace;\n\t\t} else {\n\t\t\tconst widthWithoutSpace = originalHeight * naturalRatio;\n\t\t\t// Recalculate screen position without the left space.\n\t\t\tscreenPosX += ( originalWidth - widthWithoutSpace ) / 2;\n\t\t\toriginalWidth = widthWithoutSpace;\n\t\t}\n\t}\n\toriginalRatio = originalWidth / originalHeight;\n\n\t// Typically, we use the image's full-sized dimensions. If those\n\t// dimensions have not been set (i.e. an external image with only one size),\n\t// the image's dimensions in the lightbox are the same\n\t// as those of the image in the content.\n\tlet imgMaxWidth = parseFloat(\n\t\tcontext.core.image.targetWidth !== 'none'\n\t\t\t? context.core.image.targetWidth\n\t\t\t: naturalWidth\n\t);\n\tlet imgMaxHeight = parseFloat(\n\t\tcontext.core.image.targetHeight !== 'none'\n\t\t\t? context.core.image.targetHeight\n\t\t\t: naturalHeight\n\t);\n\n\t// Ratio of the biggest image stored in the database.\n\tlet imgRatio = imgMaxWidth / imgMaxHeight;\n\tlet containerMaxWidth = imgMaxWidth;\n\tlet containerMaxHeight = imgMaxHeight;\n\tlet containerWidth = imgMaxWidth;\n\tlet containerHeight = imgMaxHeight;\n\t// Check if the target image has a different ratio than the original one (thumbnail).\n\t// Recalculate the width and height.\n\tif ( naturalRatio.toFixed( 2 ) !== imgRatio.toFixed( 2 ) ) {\n\t\tif ( naturalRatio > imgRatio ) {\n\t\t\t// If the width is reached before the height, we keep the maxWidth\n\t\t\t// and recalculate the height.\n\t\t\t// Unless the difference between the maxHeight and the reducedHeight\n\t\t\t// is higher than the maxWidth, where we keep the reducedHeight and\n\t\t\t// recalculate the width.\n\t\t\tconst reducedHeight = imgMaxWidth / naturalRatio;\n\t\t\tif ( imgMaxHeight - reducedHeight > imgMaxWidth ) {\n\t\t\t\timgMaxHeight = reducedHeight;\n\t\t\t\timgMaxWidth = reducedHeight * naturalRatio;\n\t\t\t} else {\n\t\t\t\timgMaxHeight = imgMaxWidth / naturalRatio;\n\t\t\t}\n\t\t} else {\n\t\t\t// If the height is reached before the width, we keep the maxHeight\n\t\t\t// and recalculate the width.\n\t\t\t// Unless the difference between the maxWidth and the reducedWidth\n\t\t\t// is higher than the maxHeight, where we keep the reducedWidth and\n\t\t\t// recalculate the height.\n\t\t\tconst reducedWidth = imgMaxHeight * naturalRatio;\n\t\t\tif ( imgMaxWidth - reducedWidth > imgMaxHeight ) {\n\t\t\t\timgMaxWidth = reducedWidth;\n\t\t\t\timgMaxHeight = reducedWidth / naturalRatio;\n\t\t\t} else {\n\t\t\t\timgMaxWidth = imgMaxHeight * naturalRatio;\n\t\t\t}\n\t\t}\n\t\tcontainerWidth = imgMaxWidth;\n\t\tcontainerHeight = imgMaxHeight;\n\t\timgRatio = imgMaxWidth / imgMaxHeight;\n\n\t\t// Calculate the max size of the container.\n\t\tif ( originalRatio > imgRatio ) {\n\t\t\tcontainerMaxWidth = imgMaxWidth;\n\t\t\tcontainerMaxHeight = containerMaxWidth / originalRatio;\n\t\t} else {\n\t\t\tcontainerMaxHeight = imgMaxHeight;\n\t\t\tcontainerMaxWidth = containerMaxHeight * originalRatio;\n\t\t}\n\t}\n\n\t// If the image has been pixelated on purpose, keep that size.\n\tif ( originalWidth > containerWidth || originalHeight > containerHeight ) {\n\t\tcontainerWidth = originalWidth;\n\t\tcontainerHeight = originalHeight;\n\t}\n\n\t// Calculate the final lightbox image size and the\n\t// scale factor. MaxWidth is either the window container\n\t// (accounting for padding) or the image resolution.\n\tlet horizontalPadding = 0;\n\tif ( window.innerWidth > 480 ) {\n\t\thorizontalPadding = 80;\n\t} else if ( window.innerWidth > 1920 ) {\n\t\thorizontalPadding = 160;\n\t}\n\tconst verticalPadding = 80;\n\n\tconst targetMaxWidth = Math.min(\n\t\twindow.innerWidth - horizontalPadding,\n\t\tcontainerWidth\n\t);\n\tconst targetMaxHeight = Math.min(\n\t\twindow.innerHeight - verticalPadding,\n\t\tcontainerHeight\n\t);\n\tconst targetContainerRatio = targetMaxWidth / targetMaxHeight;\n\n\tif ( originalRatio > targetContainerRatio ) {\n\t\t// If targetMaxWidth is reached before targetMaxHeight\n\t\tcontainerWidth = targetMaxWidth;\n\t\tcontainerHeight = containerWidth / originalRatio;\n\t} else {\n\t\t// If targetMaxHeight is reached before targetMaxWidth\n\t\tcontainerHeight = targetMaxHeight;\n\t\tcontainerWidth = containerHeight * originalRatio;\n\t}\n\n\tconst containerScale = originalWidth / containerWidth;\n\tconst lightboxImgWidth =\n\t\timgMaxWidth * ( containerWidth / containerMaxWidth );\n\tconst lightboxImgHeight =\n\t\timgMaxHeight * ( containerHeight / containerMaxHeight );\n\n\t// Add the CSS variables needed.\n\tlet styleTag = document.getElementById( 'wp-lightbox-styles' );\n\tif ( ! styleTag ) {\n\t\tstyleTag = document.createElement( 'style' );\n\t\tstyleTag.id = 'wp-lightbox-styles';\n\t\tdocument.head.appendChild( styleTag );\n\t}\n\n\t// As of this writing, using the calculations above will render the lightbox\n\t// with a small, erroneous whitespace on the left side of the image in iOS Safari,\n\t// perhaps due to an inconsistency in how browsers handle absolute positioning and CSS\n\t// transformation. In any case, adding 1 pixel to the container width and height solves\n\t// the problem, though this can be removed if the issue is fixed in the future.\n\tstyleTag.innerHTML = `\n\t\t:root {\n\t\t\t--wp--lightbox-initial-top-position: ${ screenPosY }px;\n\t\t\t--wp--lightbox-initial-left-position: ${ screenPosX }px;\n\t\t\t--wp--lightbox-container-width: ${ containerWidth + 1 }px;\n\t\t\t--wp--lightbox-container-height: ${ containerHeight + 1 }px;\n\t\t\t--wp--lightbox-image-width: ${ lightboxImgWidth }px;\n\t\t\t--wp--lightbox-image-height: ${ lightboxImgHeight }px;\n\t\t\t--wp--lightbox-scale: ${ containerScale };\n\t\t}\n\t`;\n}\n\nfunction debounce( func, wait = 50 ) {\n\tlet timeout;\n\treturn () => {\n\t\tconst later = () => {\n\t\t\ttimeout = null;\n\t\t\tfunc();\n\t\t};\n\t\tclearTimeout( timeout );\n\t\ttimeout = setTimeout( later, wait );\n\t};\n}\n"],"names":["window","focusableSelectors","store","state","core","image","windowWidth","innerWidth","windowHeight","innerHeight","actions","showLightbox","context","event","imageLoaded","initialized","lastFocusedElement","document","activeElement","scrollDelta","lightboxEnabled","naturalWidth","naturalHeight","offsetWidth","originalWidth","offsetHeight","originalHeight","target","nextElementSibling","x","screenPosX","y","screenPosY","getBoundingClientRect","naturalRatio","originalRatio","scaleAttr","heightWithoutSpace","widthWithoutSpace","imgMaxWidth","parseFloat","targetWidth","imgMaxHeight","targetHeight","imgRatio","containerMaxWidth","containerMaxHeight","containerWidth","containerHeight","toFixed","reducedHeight","reducedWidth","horizontalPadding","targetMaxWidth","Math","min","targetMaxHeight","containerScale","lightboxImgWidth","lightboxImgHeight","styleTag","getElementById","createElement","id","head","appendChild","innerHTML","setStyles","documentElement","classList","add","hideLightbox","async","hideAnimationEnabled","lightboxAnimation","deltaY","type","abs","scrollY","scrollTop","pageYOffset","scrollLeft","pageXOffset","onscroll","scrollTo","setTimeout","remove","focus","preventScroll","handleKeydown","key","keyCode","shiftKey","firstFocusableElement","preventDefault","lastFocusableElement","handleLoad","effects","ref","imageCurrentSrc","currentSrc","setButtonStyles","selectors","roleAttribute","lightboxObjectFit","enlargedImgSrc","imageUploadedSrc","setCurrentSrc","complete","initLightbox","figureRef","querySelector","imageRef","focusableElements","querySelectorAll","length","imageButtonWidth","buttonHeight","imageButtonHeight","imageButtonTop","buttonWidth","imageButtonLeft","afterLoad","addEventListener","func","wait","timeout","clearTimeout","later","debounce"],"sourceRoot":""}