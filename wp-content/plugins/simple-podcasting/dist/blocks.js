!function(){"use strict";var e=window.wp.element,t=window.wp.i18n,a=window.wp.blocks,n=window.lodash,s=window.wp.components,o=window.wp.data,i=window.wp.compose,r=window.wp.coreData,l=window.wp.a11y;const c={per_page:-1,orderby:"name",order:"asc",_fields:"id,name,parent",context:"view"},d=[];var m=(0,s.withFilters)("editor.PostTaxonomyType")((function(a){let{slug:m}=a;const[p,u]=(0,e.useState)(!1),[g,h]=(0,e.useState)(""),[_,b]=(0,e.useState)(""),[y,f]=(0,e.useState)(!1),[w,E]=(0,e.useState)(""),[v,C]=(0,e.useState)([]),x=(0,i.useDebounce)(l.speak,500),{hasCreateAction:N,hasAssignAction:T,terms:S,loading:k,availableTerms:P,taxonomy:A}=(0,o.useSelect)((e=>{const{getCurrentPost:t,getEditedPostAttribute:a}=e("core/editor"),{getTaxonomy:s,getEntityRecords:o,isResolving:i}=e(r.store),l=s(m);return{hasCreateAction:!!l&&(0,n.get)(t(),["_links","wp:action-create-"+l.rest_base],!1),hasAssignAction:!!l&&(0,n.get)(t(),["_links","wp:action-assign-"+l.rest_base],!1),terms:l?a(l.rest_base):d,loading:i("getEntityRecords",["taxonomy",m,c]),availableTerms:o("taxonomy",m,c)||d,taxonomy:l}}),[m]),{editPost:L}=(0,o.useDispatch)("core/editor"),{saveEntityRecord:R}=(0,o.useDispatch)(r.store),B=(0,e.useMemo)((()=>function(e,t){const a=e=>-1!==t.indexOf(e.id)||void 0!==e.children&&e.children.map(a).filter((e=>e)).length>0,n=[...e];return n.sort(((e,t)=>{const n=a(e),s=a(t);return n===s?0:n&&!s?-1:!n&&s?1:0})),n}(function(e){const t=e.map((e=>({children:[],parent:null,...e}))),a=(0,n.groupBy)(t,"parent");if(a.null&&a.null.length)return t;const s=e=>e.map((e=>{const t=a[e.id];return{...e,children:t&&t.length?s(t):[]}}));return s(a[0]||[])}(P),S)),[P]);if(!T)return null;const z=e=>{L({[A.rest_base]:e})},I=t=>t.map((t=>(0,e.createElement)("div",{key:t.id,className:"editor-post-taxonomies__hierarchical-terms-choice"},(0,e.createElement)(s.CheckboxControl,{checked:-1!==S.indexOf(t.id),onChange:()=>{(e=>{const t=S.includes(e)?(0,n.without)(S,e):[...S,e];z(t)})(parseInt(t.id,10))},label:(0,n.unescape)(t.name)}),!!t.children.length&&(0,e.createElement)("div",{className:"editor-post-taxonomies__hierarchical-terms-subchoices"},I(t.children))))),F=(e,t,a)=>(0,n.get)(A,["labels",e],"category"===m?t:a),M=F("add_new_item",(0,t.__)("Add new category"),(0,t.__)("Add new term")),D=F("new_item_name",(0,t.__)("Add new category"),(0,t.__)("Add new term")),O=F("parent_item",(0,t.__)("Parent Category"),(0,t.__)("Parent Term")),U=`— ${O} —`,$=M,W=(0,n.get)(A,["labels","search_items"],(0,t.__)("Search Terms")),q=(0,n.get)(A,["name"],(0,t.__)("Terms")),Y=P.length>=8;return(0,e.createElement)(e.Fragment,null,Y&&(0,e.createElement)(s.TextControl,{className:"editor-post-taxonomies__hierarchical-terms-filter",label:W,value:w,onChange:e=>{const a=B.map(function(e){const t=a=>{if(""===e)return a;const n={...a};return n.children.length>0&&(n.children=n.children.map(t).filter((e=>e))),(-1!==n.name.toLowerCase().indexOf(e.toLowerCase())||n.children.length>0)&&n};return t}(e)).filter((e=>e)),n=e=>{let t=0;for(let a=0;a<e.length;a++)t++,void 0!==e[a].children&&(t+=n(e[a].children));return t};E(e),C(a);const s=n(a),o=(0,t.sprintf)(/* translators: %d: number of results */
(0,t._n)("%d result found.","%d results found.",s),s);x(o,"assertive")}}),(0,e.createElement)("div",{className:"editor-post-taxonomies__hierarchical-terms-list",tabIndex:"0",role:"group","aria-label":q},I(""!==w?v:B)),!k&&N&&(0,e.createElement)(s.Button,{onClick:()=>{f(!y)},className:"editor-post-taxonomies__hierarchical-terms-add","aria-expanded":y,variant:"link"},M),y&&(0,e.createElement)("form",{onSubmit:async e=>{if(e.preventDefault(),""===g||p)return;const a=function(e,t,a){return(0,n.find)(e,(e=>(!e.parent&&!t||parseInt(e.parent)===parseInt(t))&&e.name.toLowerCase()===a.toLowerCase()))}(P,_,g);if(a)return(0,n.some)(S,(e=>e===a.id))||z([...S,a.id]),h(""),void b("");u(!0);const s=await(o={name:g,parent:_||void 0},R("taxonomy",m,o));var o;const i=(0,t.sprintf)(/* translators: %s: taxonomy name */
(0,t._x)("%s added","term"),(0,n.get)(A,["labels","singular_name"],"category"===m?(0,t.__)("Category"):(0,t.__)("Term")));(0,l.speak)(i,"assertive"),u(!1),h(""),b(""),z([...S,s.id])}},(0,e.createElement)(s.TextControl,{className:"editor-post-taxonomies__hierarchical-terms-input",label:D,value:g,onChange:e=>{h(e)},required:!0}),!!P.length&&(0,e.createElement)(s.TreeSelect,{label:O,noOptionLabel:U,onChange:e=>{b(e)},selectedId:_,tree:B}),(0,e.createElement)(s.Button,{variant:"secondary",type:"submit",className:"editor-post-taxonomies__hierarchical-terms-submit"},$)))}));const{__:__}=wp.i18n,{Component:p}=wp.element,{BlockControls:u,InspectorControls:g,MediaPlaceholder:h,MediaReplaceFlow:_,RichText:b}=wp.blockEditor,{FormToggle:y,PanelBody:f,PanelRow:w,SelectControl:E,TextControl:v,RadioControl:C}=wp.components,{Fragment:x}=wp.element,{apiFetch:N}=wp,T=["audio"];const{select:S}=wp.data,{createBlock:k}=wp.blocks;var P={from:[{type:"block",blocks:["core/audio"],transform:e=>k("podcasting/podcast",{id:e.id,src:e.src})}],to:[{type:"block",blocks:["core/audio"],isMatch:e=>{let{id:t}=e;if(!t)return!1;const{getMedia:a}=S("core"),n=a(t);return!!n&&n.mime_type.includes("audio")},transform:e=>k("core/audio",{src:e.src,id:e.id})}]};(0,a.registerBlockType)("podcasting/podcast",{title:(0,t.__)("Podcast","simple-podcasting"),description:(0,t.__)("Insert a podcast episode into a post. To add it to a podcast feed, select a podcast in document settings.","simple-podcasting"),category:"common",icon:"microphone",supports:{multiple:!1},attributes:{id:{type:"number"},src:{type:"string",source:"attribute",selector:"audio",attribute:"src"},url:{type:"string",source:"meta",meta:"podcast_url"},filesize:{type:"number",source:"meta",meta:"podcast_filesize"},duration:{type:"string",source:"meta",meta:"podcast_duration"},mime:{type:"string",source:"meta",meta:"podcast_mime"},caption:{type:"array",source:"children",selector:"figcaption"},captioned:{type:"boolean",source:"meta",meta:"podcast_captioned",default:!1},explicit:{type:"string",source:"meta",meta:"podcast_explicit",default:"no"},enclosure:{type:"string",source:"meta",meta:"enclosure"},seasonNumber:{type:"string",source:"meta",meta:"podcast_season_number"},episodeNumber:{type:"string",source:"meta",meta:"podcast_episode_number"},episodeType:{type:"string",source:"meta",meta:"podcast_episode_type"}},transforms:P,edit:class extends p{constructor(e){let{className:t}=e;super(...arguments),this.state={src:this.props.attributes.src?this.props.attributes.src:null,className:t}}componentWillUnmount(){wp.data.dispatch("core/editor").editPost({podcasting_podcasts:[]})}render(){const{setAttributes:t,isSelected:a,attributes:n}=this.props,{caption:s,explicit:o}=n,i=n.duration||"",r=n.captioned||"",l=n.seasonNumber||"",c=n.episodeNumber||"",d=n.episodeType||"",{className:p,src:S}=this.state,k=e=>{let a,n,s;e.mime?a=e.mime:e.mime_type&&(a=e.mime_type),e.filesizeInBytes?n=e.filesizeInBytes:e.media_details&&e.media_details.filesize&&(n=e.media_details.filesize),e.fileLength?s=e.fileLength:e.media_details&&e.media_details.length_formatted&&(s=e.media_details.length_formatted),t({id:e.id,src:e.url,url:e.url,mime:a,filesize:n,duration:s,caption:e.title,enclosure:e.url+"\n"+n+"\n"+a}),this.setState({src:e.url})},P=e=>{e!==S&&(N({path:`simple-podcasting/v1/external-url/?url=${e}`}).then((a=>{if(a.success){const{mime:n,filesize:s,duration:o}=a.data;t({src:e,url:e,id:null,mime:n,filesize:s,duration:o,caption:""})}})).catch((e=>{console.error(e)})),this.setState({src:e}))},A=(0,e.createElement)(u,{key:"controls"},S?(0,e.createElement)(_,{mediaURL:n.src,allowedTypes:T,accept:"audio/*",onSelect:k,onSelectURL:P}):null);return(0,e.createElement)(x,null,A,(0,e.createElement)(g,null,(0,e.createElement)(f,{title:__("Podcast Settings","simple-podcasting")},(0,e.createElement)(w,null,(0,e.createElement)("div",{id:"hierar-podcasting_podcasts"},(0,e.createElement)(m,{slug:"podcasting_podcasts"}))),(0,e.createElement)(w,null,(0,e.createElement)("label",{htmlFor:"podcast-captioned-form-toggle"},__("Closed Captioned","simple-podcasting")),(0,e.createElement)(y,{id:"podcast-captioned-form-toggle",label:__("Closed Captioned","simple-podcasting"),checked:r,onChange:()=>t({captioned:!r})})),(0,e.createElement)(w,null,(0,e.createElement)(E,{label:__("Explicit Content","simple-podcasting"),value:o,options:[{value:"no",label:__("No","simple-podcasting")},{value:"yes",label:__("Yes","simple-podcasting")},{value:"clean",label:__("Clean","simple-podcasting")}],onChange:e=>t({explicit:e})})),(0,e.createElement)(w,null,(0,e.createElement)(v,{label:__("Length (MM:SS)","simple-podcasting"),value:i,onChange:e=>t({duration:e})})),(0,e.createElement)(w,null,(0,e.createElement)(v,{label:__("Season Number","simple-podcasting"),value:l,onChange:e=>t({seasonNumber:e})})),(0,e.createElement)(w,null,(0,e.createElement)(v,{label:__("Episode Number","simple-podcasting"),value:c,onChange:e=>t({episodeNumber:e})})),(0,e.createElement)(w,null,(0,e.createElement)(C,{label:__("Episode Type","simple-podcasting"),selected:d,options:[{label:__("None","simple-podcasting"),value:"none"},{label:__("Full","simple-podcasting"),value:"full"},{label:__("Trailer","simple-podcasting"),value:"trailer"},{label:__("Bonus","simple-podcasting"),value:"bonus"}],onChange:e=>t({episodeType:e})})))),(0,e.createElement)("div",{className:p},S?(0,e.createElement)("figure",{key:"audio",className:p},(0,e.createElement)("audio",{controls:"controls",src:S}),(s&&s.length||!!a)&&(0,e.createElement)(b,{tagName:"figcaption",placeholder:__("Write caption…","simple-podcasting"),value:s,onChange:e=>t({caption:e}),isSelected:a})):(0,e.createElement)(h,{icon:"microphone",labels:{title:__("Podcast","simple-podcasting"),name:__("a podcast episode","simple-podcasting")},className:p,onSelect:k,onSelectURL:P,accept:"audio/*",allowedTypes:T,value:this.props.attributes})))}},save:t=>{const{id:a,src:n,caption:s}=t.attributes;return(0,e.createElement)("figure",{className:a?`podcast-${a}`:null},(0,e.createElement)("audio",{controls:"controls",src:n}),s&&s.length>0&&(0,e.createElement)("figcaption",null,s))}})}();