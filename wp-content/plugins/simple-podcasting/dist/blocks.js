(()=>{"use strict";const e=window.React,t=window.wp.i18n,a=window.wp.blocks,s=window.wp.components,o=window.wp.element,l=window.wp.data,n=window.lodash,i=window.wp.compose,c=window.wp.coreData,r=window.wp.a11y,d={per_page:-1,orderby:"name",order:"asc",_fields:"id,name,parent",context:"view"},p=[],m=(0,s.withFilters)("editor.PostTaxonomyType")((function({slug:a}){const[m,u]=(0,o.useState)(!1),[g,_]=(0,o.useState)(""),[h,y]=(0,o.useState)(""),[E,b]=(0,o.useState)(!1),[w,f]=(0,o.useState)(""),[k,v]=(0,o.useState)([]),C=(0,i.useDebounce)(r.speak,500),{hasCreateAction:N,hasAssignAction:T,terms:x,loading:S,availableTerms:A,taxonomy:D}=(0,l.useSelect)((e=>{const{getCurrentPost:t,getEditedPostAttribute:s}=e("core/editor"),{getTaxonomy:o,getEntityRecords:l,isResolving:i}=e(c.store),r=o(a);return{hasCreateAction:!!r&&(0,n.get)(t(),["_links","wp:action-create-"+r.rest_base],!1),hasAssignAction:!!r&&(0,n.get)(t(),["_links","wp:action-assign-"+r.rest_base],!1),terms:r?s(r.rest_base):p,loading:i("getEntityRecords",["taxonomy",a,d]),availableTerms:l("taxonomy",a,d)||p,taxonomy:r}}),[a]),{editPost:B}=(0,l.useDispatch)("core/editor"),{saveEntityRecord:I}=(0,l.useDispatch)(c.store),P=(0,o.useMemo)((()=>function(e,t){const a=e=>-1!==t.indexOf(e.id)||void 0!==e.children&&e.children.map(a).filter((e=>e)).length>0,s=[...e];return s.sort(((e,t)=>{const s=a(e),o=a(t);return s===o?0:s&&!o?-1:!s&&o?1:0})),s}(function(e){const t=e.map((e=>({children:[],parent:null,...e}))),a=(0,n.groupBy)(t,"parent");if(a.null&&a.null.length)return t;const s=e=>e.map((e=>{const t=a[e.id];return{...e,children:t&&t.length?s(t):[]}}));return s(a[0]||[])}(A),x)),[A]);if(!T)return null;const L=e=>{B({[D.rest_base]:e})},R=t=>t.map((t=>(0,e.createElement)("div",{key:t.id,className:"editor-post-taxonomies__hierarchical-terms-choice"},(0,e.createElement)(s.CheckboxControl,{checked:-1!==x.indexOf(t.id),onChange:()=>{(e=>{const t=x.includes(e)?(0,n.without)(x,e):[...x,e];L(t)})(parseInt(t.id,10))},label:(0,n.unescape)(t.name)}),!!t.children.length&&(0,e.createElement)("div",{className:"editor-post-taxonomies__hierarchical-terms-subchoices"},R(t.children))))),F=(e,t,s)=>(0,n.get)(D,["labels",e],"category"===a?t:s),M=F("add_new_item",(0,t.__)("Add new category"),(0,t.__)("Add new term")),z=F("new_item_name",(0,t.__)("Add new category"),(0,t.__)("Add new term")),U=F("parent_item",(0,t.__)("Parent Category"),(0,t.__)("Parent Term")),q=`— ${U} —`,O=M,$=(0,n.get)(D,["labels","search_items"],(0,t.__)("Search Terms")),V=(0,n.get)(D,["name"],(0,t.__)("Terms")),Q=A.length>=8;return(0,e.createElement)(e.Fragment,null,Q&&(0,e.createElement)(s.TextControl,{className:"editor-post-taxonomies__hierarchical-terms-filter",label:$,value:w,onChange:e=>{const a=P.map(function(e){const t=a=>{if(""===e)return a;const s={...a};return s.children.length>0&&(s.children=s.children.map(t).filter((e=>e))),(-1!==s.name.toLowerCase().indexOf(e.toLowerCase())||s.children.length>0)&&s};return t}(e)).filter((e=>e)),s=e=>{let t=0;for(let a=0;a<e.length;a++)t++,void 0!==e[a].children&&(t+=s(e[a].children));return t};f(e),v(a);const o=s(a),l=(0,t.sprintf)(/* translators: %d: number of results */ /* translators: %d: number of results */
(0,t._n)("%d result found.","%d results found.",o),o);C(l,"assertive")}}),(0,e.createElement)("div",{className:"editor-post-taxonomies__hierarchical-terms-list",tabIndex:"0",role:"group","aria-label":V},R(""!==w?k:P)),!S&&N&&(0,e.createElement)(s.Button,{onClick:()=>{b(!E)},className:"editor-post-taxonomies__hierarchical-terms-add","aria-expanded":E,variant:"link"},M),E&&(0,e.createElement)("form",{onSubmit:async e=>{if(e.preventDefault(),""===g||m)return;const s=function(e,t,a){return(0,n.find)(e,(e=>(!e.parent&&!t||parseInt(e.parent)===parseInt(t))&&e.name.toLowerCase()===a.toLowerCase()))}(A,h,g);if(s)return(0,n.some)(x,(e=>e===s.id))||L([...x,s.id]),_(""),void y("");u(!0);const o=await(l={name:g,parent:h||void 0},I("taxonomy",a,l));var l;const i=(0,t.sprintf)(/* translators: %s: taxonomy name */ /* translators: %s: taxonomy name */
(0,t._x)("%s added","term"),(0,n.get)(D,["labels","singular_name"],"category"===a?(0,t.__)("Category"):(0,t.__)("Term")));(0,r.speak)(i,"assertive"),u(!1),_(""),y(""),L([...x,o.id])}},(0,e.createElement)(s.TextControl,{className:"editor-post-taxonomies__hierarchical-terms-input",label:z,value:g,onChange:e=>{_(e)},required:!0}),!!A.length&&(0,e.createElement)(s.TreeSelect,{label:U,noOptionLabel:q,onChange:e=>{y(e)},selectedId:h,tree:P}),(0,e.createElement)(s.Button,{variant:"secondary",type:"submit",className:"editor-post-taxonomies__hierarchical-terms-submit"},O)))})),{__}=wp.i18n,{BlockControls:u,InspectorControls:g,MediaPlaceholder:_,MediaReplaceFlow:h,MediaUpload:y,MediaUploadCheck:E,RichText:b}=wp.blockEditor,{ToggleControl:w,PanelBody:f,PanelRow:k,SelectControl:v,TextControl:C,RadioControl:N}=wp.components,{Fragment:T}=wp.element,{apiFetch:x}=wp,S=["audio"],{select:A}=wp.data;function D(t){const{className:n,setAttributes:i,isSelected:c,attributes:r,featuredImageUrl:d,setFeaturedImage:p,removeFeaturedImage:D,featuredImageId:B}=t,{caption:I,explicit:P,displayDuration:L,displayShowTitle:R,displayEpisodeTitle:F,displayArt:M,displayExplicitBadge:z,displaySeasonNumber:U,displayEpisodeNumber:q,displayEpisodeType:O}=r,$=r.duration||"",V=r.captioned||"",Q=r.seasonNumber||"",W=r.episodeNumber||"",Y=r.episodeType||"",[j,G]=(0,o.useState)(t.attributes.src);(0,o.useEffect)((()=>()=>wp.data.dispatch("core/editor").editPost({podcasting_podcasts:[]})));const H=(0,l.useSelect)((e=>e("core/editor").getEditedPostAttribute("title"))),J=e=>{let t,a,s;e.mime?t=e.mime:e.mime_type&&(t=e.mime_type),e.filesizeInBytes?a=e.filesizeInBytes:e.media_details&&e.media_details.filesize&&(a=e.media_details.filesize),e.fileLength?s=e.fileLength:e.media_details&&e.media_details.length_formatted&&(s=e.media_details.length_formatted),i({id:e.id,src:e.url,url:e.url,mime:t,filesize:a,duration:s,caption:e.title,enclosure:e.url+"\n"+a+"\n"+t}),G(e.url)},K=e=>{e!==j&&(x({path:`simple-podcasting/v1/external-url/?url=${e}`}).then((t=>{if(t.success){const{mime:a,filesize:s,duration:o}=t.data;i({src:e,url:e,id:null,mime:a,filesize:s,duration:o,displayDurationValue:o,caption:""})}})).catch((e=>{console.error(e)})),G(e))},X=(0,e.createElement)(u,{key:"controls"},j?(0,e.createElement)(h,{mediaURL:r.src,allowedTypes:S,accept:"audio/*",onSelect:J,onSelectURL:K}):null),{getCurrentPost:Z}=A("core/editor"),ee=Z(),te=ee?ee.podcasting_podcasts[0]:null,ae=A("core").getEntityRecords("taxonomy","podcasting_podcasts",{per_page:1,term_id:te}),se=ae?ae[0].name:null,oe=ae?ae[0].meta.podcasting_image_url:null;return(0,e.createElement)(T,null,X,(0,e.createElement)(g,null,(0,e.createElement)(f,{title:__("Podcast Settings","simple-podcasting")},(0,e.createElement)(k,null,(0,e.createElement)("div",{id:"hierar-podcasting_podcasts"},(0,e.createElement)(m,{slug:"podcasting_podcasts"}))),(0,e.createElement)(k,null,(0,e.createElement)(w,{id:"podcast-captioned-form-toggle",label:__("Closed Captioned","simple-podcasting"),checked:V,onChange:()=>i({captioned:!V})})),(0,e.createElement)(k,null,(0,e.createElement)(w,{label:__("Display Listen Time","simple-podcasting"),checked:L,onChange:()=>i({displayDuration:!L})})),(0,e.createElement)(k,null,(0,e.createElement)(w,{label:__("Display Show Title","simple-podcasting"),checked:R,onChange:()=>i({displayShowTitle:!R})})),(0,e.createElement)(k,null,(0,e.createElement)(w,{label:__("Display Episode Title","simple-podcasting"),checked:F,onChange:()=>i({displayEpisodeTitle:!F})})),(0,e.createElement)(k,null,(0,e.createElement)(w,{label:__("Display Show Art","simple-podcasting"),checked:M,onChange:()=>i({displayArt:!M})})),(0,e.createElement)(k,null,(0,e.createElement)(w,{label:__("Display Explicit Badge","simple-podcasting"),checked:z,onChange:()=>i({displayExplicitBadge:!z})})),(0,e.createElement)(k,null,(0,e.createElement)(w,{label:__("Display Season Number","simple-podcasting"),checked:U,onChange:()=>i({displaySeasonNumber:!U})})),(0,e.createElement)(k,null,(0,e.createElement)(w,{label:__("Display Episode Number","simple-podcasting"),checked:q,onChange:()=>i({displayEpisodeNumber:!q}),help:!F&&__('The "Display Episode Title" setting should be enabled for this to display the episode number.',"simple-podcasting")})),(0,e.createElement)(k,null,(0,e.createElement)(w,{label:__("Display Episode Type","simple-podcasting"),checked:O,onChange:()=>i({displayEpisodeType:!O})})),(0,e.createElement)(k,null,(0,e.createElement)(v,{label:__("Explicit Content","simple-podcasting"),value:P,options:[{value:"no",label:__("No","simple-podcasting")},{value:"yes",label:__("Yes","simple-podcasting")},{value:"clean",label:__("Clean","simple-podcasting")}],onChange:e=>i({explicit:e})})),(0,e.createElement)(k,null,(0,e.createElement)(C,{label:__("Length (MM:SS)","simple-podcasting"),value:$,onChange:e=>i({duration:e})})),(0,e.createElement)(k,null,(0,e.createElement)(C,{label:__("Season Number","simple-podcasting"),value:Q,onChange:e=>i({seasonNumber:e})})),(0,e.createElement)(k,null,(0,e.createElement)(C,{label:__("Episode Number","simple-podcasting"),value:W,onChange:e=>i({episodeNumber:e})})),(0,e.createElement)(k,null,(0,e.createElement)(N,{label:__("Episode Type","simple-podcasting"),selected:Y,options:[{label:__("None","simple-podcasting"),value:"none"},{label:__("Full","simple-podcasting"),value:"full"},{label:__("Trailer","simple-podcasting"),value:"trailer"},{label:__("Bonus","simple-podcasting"),value:"bonus"}],onChange:e=>i({episodeType:e})})),(0,e.createElement)(k,null,(0,e.createElement)(s.Button,{variant:"secondary",onClick:()=>(0,l.dispatch)("core/block-editor").insertBlocks((0,a.createBlock)("podcasting/podcast-transcript"))},__("Add Transcript","simple-podcasting"))),(0,e.createElement)("h3",{style:{marginTop:"20px"}},__("Cover Image","simple-podcasting")),(0,e.createElement)("p",null,__("The featured image of the current post is used as the episode cover art. Please select a featured image to set it.","simple-podcasting")),(0,e.createElement)(k,{className:"cover-art-container"},d&&(0,e.createElement)("img",{src:d,alt:"Cover Image"}),(0,e.createElement)(E,null,(0,e.createElement)(y,{onSelect:e=>{p(e.id)},allowedTypes:["image"],render:({open:t})=>(0,e.createElement)(s.Button,{isSecondary:!0,onClick:t},__(d?"Replace Cover Art":"Select Cover Art","simple-podcasting")),value:B})),d&&(0,e.createElement)(s.Button,{isLink:!0,isDestructive:!0,onClick:D},__("Delete Cover Art","simple-podcasting"))))),(0,e.createElement)("div",{className:"wp-block-podcasting-podcast-outer"},j?(0,e.createElement)(T,null,(0,e.createElement)("div",{className:"wp-block-podcasting-podcast__container"},oe&&M&&(0,e.createElement)("div",{className:"wp-block-podcasting-podcast__show-art"},(0,e.createElement)("div",{className:"wp-block-podcasting-podcast__image"},(0,e.createElement)("img",{src:oe,alt:se}))),(0,e.createElement)("div",{className:"wp-block-podcasting-podcast__details"},F&&H&&(0,e.createElement)("h3",{className:"wp-block-podcasting-podcast__show-title"},q&&W&&(0,e.createElement)("span",null,W,"."),H),(0,e.createElement)("div",{className:"wp-block-podcasting-podcast__show-details"},R&&(0,e.createElement)("span",{className:"wp-block-podcasting-podcast__title"},se),U&&Q&&(0,e.createElement)("span",{className:"wp-block-podcasting-podcast__season"},__("Season: ","simple-podcasting"),Q),q&&W&&(0,e.createElement)("span",{className:"wp-block-podcasting-podcast__episode"},__("Episode: ","simple-podcasting"),W)),(0,e.createElement)("div",{className:"wp-block-podcasting-podcast__show-details"},L&&$&&(0,e.createElement)("span",{className:"wp-block-podcasting-podcast__duration"},__("Listen Time: ","simple-podcasting"),$),O&&"none"!==Y&&(0,e.createElement)("span",{className:"wp-block-podcasting-podcast__episode-type"},__("Episode type: ","simple-podcasting"),Y),z&&(0,e.createElement)("span",{className:"wp-block-podcasting-podcast__explicit-badge"},__("Explicit: ","simple-podcasting"),P)))),(0,e.createElement)("figure",{key:"audio",className:n},(I&&I.length||!!c)&&(0,e.createElement)(b,{tagName:"figcaption",placeholder:__("Write caption…","simple-podcasting"),className:"wp-block-podcasting-podcast__caption",value:I,onChange:e=>i({caption:e}),isSelected:c}),(0,e.createElement)("audio",{controls:"controls",src:j}))):(0,e.createElement)(_,{icon:"microphone",labels:{title:__("Podcast","simple-podcasting"),name:__("a podcast episode","simple-podcasting")},className:n,onSelect:J,onSelectURL:K,accept:"audio/*",allowedTypes:S,value:r})))}const{select:B}=wp.data,{createBlock:I}=wp.blocks,P={from:[{type:"block",blocks:["core/audio"],transform:e=>I("podcasting/podcast",{id:e.id,src:e.src})}],to:[{type:"block",blocks:["core/audio"],isMatch:({id:e})=>{if(!e)return!1;const{getMedia:t}=B("core"),a=t(e);return!!a&&a.mime_type.includes("audio")},transform:e=>I("core/audio",{src:e.src,id:e.id})}]},L=((0,a.registerBlockType)("podcasting/podcast",{title:(0,t.__)("Podcast","simple-podcasting"),description:(0,t.__)("Insert a podcast episode into a post. To add it to a podcast feed, select a podcast in document settings.","simple-podcasting"),category:"common",icon:"microphone",supports:{multiple:!1},attributes:{id:{type:"number"},src:{type:"string",source:"attribute",selector:"audio",attribute:"src"},url:{type:"string",source:"meta",meta:"podcast_url"},filesize:{type:"number",source:"meta",meta:"podcast_filesize"},duration:{type:"string",source:"meta",meta:"podcast_duration"},mime:{type:"string",source:"meta",meta:"podcast_mime"},caption:{type:"array",source:"children",selector:"figcaption"},captioned:{type:"boolean",source:"meta",meta:"podcast_captioned",default:!1},explicit:{type:"string",source:"meta",meta:"podcast_explicit"},enclosure:{type:"string",source:"meta",meta:"enclosure"},seasonNumber:{type:"string",source:"meta",meta:"podcast_season_number"},episodeNumber:{type:"string",source:"meta",meta:"podcast_episode_number"},episodeType:{type:"string",source:"meta",meta:"podcast_episode_type"},displayDuration:{type:"boolean",default:!1},displayShowTitle:{type:"boolean",default:!1},displayEpisodeTitle:{type:"boolean",default:!1},displayArt:{type:"boolean",default:!1},displayExplicitBadge:{type:"boolean",default:!1},displaySeasonNumber:{type:"boolean",default:!1},displayEpisodeNumber:{type:"boolean",default:!1},displayEpisodeType:{type:"boolean",default:!1}},transforms:P,edit:function(t){const a=function(){const e=(0,l.useSelect)((e=>e("core/editor").getEditedPostAttribute("featured_media")),[]),{editPost:t}=(0,l.useDispatch)("core/editor");return{featuredImageUrl:(0,l.useSelect)((t=>{const{getMedia:a}=t("core"),s=a(e);return s?.source_url}),[e]),setFeaturedImage:e=>{t({featured_media:e})},removeFeaturedImage:()=>{t({featured_media:0})},featuredImageId:e}}();return(0,e.createElement)(D,{...t,...a})},save:t=>{const{id:a,src:s,caption:o}=t.attributes;return(0,e.createElement)("figure",{className:a?`podcast-${a}`:null},o&&o.length>0&&(0,e.createElement)("figcaption",{className:"wp-block-podcasting-podcast__caption"},o),(0,e.createElement)("audio",{controls:"controls",src:s}))}}),"podcasting/latest-episode");(0,a.registerBlockVariation)("core/query",{name:L,title:"Latest Podcast Episode",description:"Displays the latest podcast episode.",isActive:["simple-podcasting"],icon:"microphone",attributes:{namespace:L,query:{postType:"post",podcastingQuery:"not_empty"}},allowedControls:[],scope:["inserter"],innerBlocks:[["core/post-template",{},[["core/group",{className:"podcasting-latest-episode"},[["core/post-featured-image"],["core/group",{className:"podcasting-latest-episode__content"},[["core/post-title"],["core/post-date"],["core/post-excerpt"]]]]]]],["core/query-no-results"]]})})();