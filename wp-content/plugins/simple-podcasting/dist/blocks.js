(()=>{"use strict";const e=window.React,t=window.wp.i18n,a=window.wp.blocks,s=window.wp.components,o=window.wp.element,l=window.wp.data,{__}=wp.i18n,{BlockControls:i,InspectorControls:c,MediaPlaceholder:n,MediaReplaceFlow:p,MediaUpload:r,MediaUploadCheck:d,RichText:m}=wp.blockEditor,{ToggleControl:u,PanelBody:g,PanelRow:y,SelectControl:b,TextControl:E,RadioControl:_}=wp.components,{Fragment:h}=wp.element,{apiFetch:f}=wp,w=["audio"],{select:k}=wp.data;function N(t){const{className:k,setAttributes:N,isSelected:v,attributes:C,featuredImageUrl:T,setFeaturedImage:S,removeFeaturedImage:x,featuredImageId:B}=t,{caption:D,explicit:I,displayDuration:A,displayShowTitle:P,displayEpisodeTitle:z,displayArt:L,displayExplicitBadge:R,displaySeasonNumber:M,displayEpisodeNumber:F,displayEpisodeType:U}=C,q=C.duration||"",$=C.captioned||"",V=C.seasonNumber||"",Q=C.episodeNumber||"",W=C.episodeType||"",[Y,j]=(0,o.useState)(t.attributes.src),G=(0,l.useSelect)((e=>e("core/editor").getEditedPostAttribute("title"))),H=e=>{let t,a,s;e.mime?t=e.mime:e.mime_type&&(t=e.mime_type),e.filesizeInBytes?a=e.filesizeInBytes:e.media_details&&e.media_details.filesize&&(a=e.media_details.filesize),e.fileLength?s=e.fileLength:e.media_details&&e.media_details.length_formatted&&(s=e.media_details.length_formatted),N({id:e.id,src:e.url,url:e.url,mime:t,filesize:a,duration:s,caption:e.title,enclosure:e.url+"\n"+a+"\n"+t}),j(e.url)},J=e=>{e!==Y&&(f({path:`simple-podcasting/v1/external-url/?url=${e}`}).then((t=>{if(t.success){const{mime:a,filesize:s,duration:o}=t.data;N({src:e,url:e,id:null,mime:a,filesize:s,duration:o,displayDurationValue:o,caption:""})}})).catch((e=>{console.error(e)})),j(e))},K=(0,e.createElement)(i,{key:"controls"},Y?(0,e.createElement)(p,{mediaURL:C.src,allowedTypes:w,accept:"audio/*",onSelect:H,onSelectURL:J}):null),O=(0,l.useSelect)((e=>{const t=e("core/editor").getEditedPostAttribute("podcasting_podcasts");return t?t[0]:null})),X=(0,l.useSelect)((e=>e("core").getEntityRecords("taxonomy","podcasting_podcasts",{include:[O]}))),Z=X&&X[0]?X[0]?.name:null,ee=X&&X[0]?X[0]?.meta?.podcasting_image_url:null;return(0,e.createElement)(h,null,K,(0,e.createElement)(c,null,(0,e.createElement)(g,{title:__("Podcast Settings","simple-podcasting"),className:"simple-podcast-settings"},(0,e.createElement)(y,null,(0,e.createElement)(u,{id:"podcast-captioned-form-toggle",label:__("Closed Captioned","simple-podcasting"),checked:$,onChange:()=>N({captioned:!$})})),(0,e.createElement)(y,null,(0,e.createElement)(u,{label:__("Display Listen Time","simple-podcasting"),checked:A,onChange:()=>N({displayDuration:!A})})),(0,e.createElement)(y,null,(0,e.createElement)(u,{label:__("Display Show Title","simple-podcasting"),checked:P,onChange:()=>N({displayShowTitle:!P})})),(0,e.createElement)(y,null,(0,e.createElement)(u,{label:__("Display Episode Title","simple-podcasting"),checked:z,onChange:()=>N({displayEpisodeTitle:!z})})),(0,e.createElement)(y,null,(0,e.createElement)(u,{label:__("Display Show Art","simple-podcasting"),checked:L,onChange:()=>N({displayArt:!L})})),(0,e.createElement)(y,null,(0,e.createElement)(u,{label:__("Display Explicit Badge","simple-podcasting"),checked:R,onChange:()=>N({displayExplicitBadge:!R})})),(0,e.createElement)(y,null,(0,e.createElement)(u,{label:__("Display Season Number","simple-podcasting"),checked:M,onChange:()=>N({displaySeasonNumber:!M})})),(0,e.createElement)(y,null,(0,e.createElement)(u,{label:__("Display Episode Number","simple-podcasting"),checked:F,onChange:()=>N({displayEpisodeNumber:!F}),help:!z&&__('The "Display Episode Title" setting should be enabled for this to display the episode number.',"simple-podcasting")})),(0,e.createElement)(y,null,(0,e.createElement)(u,{label:__("Display Episode Type","simple-podcasting"),checked:U,onChange:()=>N({displayEpisodeType:!U})})),(0,e.createElement)(y,null,(0,e.createElement)(b,{label:__("Explicit Content","simple-podcasting"),value:I,options:[{value:"no",label:__("No","simple-podcasting")},{value:"yes",label:__("Yes","simple-podcasting")},{value:"clean",label:__("Clean","simple-podcasting")}],onChange:e=>N({explicit:e})})),(0,e.createElement)(y,null,(0,e.createElement)(E,{label:__("Length (MM:SS)","simple-podcasting"),value:q,onChange:e=>N({duration:e})})),(0,e.createElement)(y,null,(0,e.createElement)(E,{label:__("Season Number","simple-podcasting"),value:V,onChange:e=>N({seasonNumber:e})})),(0,e.createElement)(y,null,(0,e.createElement)(E,{label:__("Episode Number","simple-podcasting"),value:Q,onChange:e=>N({episodeNumber:e})})),(0,e.createElement)(y,null,(0,e.createElement)(_,{label:__("Episode Type","simple-podcasting"),selected:W,options:[{label:__("None","simple-podcasting"),value:"none"},{label:__("Full","simple-podcasting"),value:"full"},{label:__("Trailer","simple-podcasting"),value:"trailer"},{label:__("Bonus","simple-podcasting"),value:"bonus"}],onChange:e=>N({episodeType:e})})),(0,e.createElement)(y,null,(0,e.createElement)(s.Button,{variant:"secondary",onClick:()=>(0,l.dispatch)("core/block-editor").insertBlocks((0,a.createBlock)("podcasting/podcast-transcript"))},__("Add Transcript","simple-podcasting"))),(0,e.createElement)("h3",{style:{marginTop:"20px"}},__("Cover Image","simple-podcasting")),(0,e.createElement)("p",null,__("The featured image of the current post is used as the episode cover art. Please select a featured image to set it.","simple-podcasting")),(0,e.createElement)(y,{className:"cover-art-container"},T&&(0,e.createElement)("img",{src:T,alt:"Cover Image"}),(0,e.createElement)(d,null,(0,e.createElement)(r,{onSelect:e=>{S(e.id)},allowedTypes:["image"],render:({open:t})=>(0,e.createElement)(s.Button,{isSecondary:!0,onClick:t},__(T?"Replace Cover Art":"Select Cover Art","simple-podcasting")),value:B})),T&&(0,e.createElement)(s.Button,{isLink:!0,isDestructive:!0,onClick:x},__("Delete Cover Art","simple-podcasting"))))),(0,e.createElement)("div",{className:"wp-block-podcasting-podcast-outer"},Y?(0,e.createElement)(h,null,(0,e.createElement)("div",{className:"wp-block-podcasting-podcast__container"},L&&(T||ee)&&(0,e.createElement)("div",{className:"wp-block-podcasting-podcast__show-art"},(0,e.createElement)("div",{className:"wp-block-podcasting-podcast__image"},(0,e.createElement)("img",{src:T||ee,alt:Z}))),(0,e.createElement)("div",{className:"wp-block-podcasting-podcast__details"},z&&G&&(0,e.createElement)("h3",{className:"wp-block-podcasting-podcast__show-title"},F&&Q&&(0,e.createElement)("span",null,Q,"."),G),(0,e.createElement)("div",{className:"wp-block-podcasting-podcast__show-details"},P&&(0,e.createElement)("span",{className:"wp-block-podcasting-podcast__title"},Z),M&&V&&(0,e.createElement)("span",{className:"wp-block-podcasting-podcast__season"},__("Season: ","simple-podcasting"),V),F&&Q&&(0,e.createElement)("span",{className:"wp-block-podcasting-podcast__episode"},__("Episode: ","simple-podcasting"),Q)),(0,e.createElement)("div",{className:"wp-block-podcasting-podcast__show-details"},A&&q&&(0,e.createElement)("span",{className:"wp-block-podcasting-podcast__duration"},__("Listen Time: ","simple-podcasting"),q),U&&"none"!==W&&(0,e.createElement)("span",{className:"wp-block-podcasting-podcast__episode-type"},__("Episode type: ","simple-podcasting"),W),R&&(0,e.createElement)("span",{className:"wp-block-podcasting-podcast__explicit-badge"},__("Explicit: ","simple-podcasting"),I)))),(0,e.createElement)("figure",{key:"audio",className:k},(D&&D.length||!!v)&&(0,e.createElement)(m,{tagName:"figcaption",placeholder:__("Write captionâ€¦","simple-podcasting"),className:"wp-block-podcasting-podcast__caption",value:D,onChange:e=>N({caption:e}),isSelected:v}),(0,e.createElement)("audio",{controls:"controls",src:Y}))):(0,e.createElement)(n,{icon:"microphone",labels:{title:__("Podcast","simple-podcasting"),name:__("a podcast episode","simple-podcasting")},className:k,onSelect:H,onSelectURL:J,accept:"audio/*",allowedTypes:w,value:C})))}const{select:v}=wp.data,{createBlock:C}=wp.blocks,T={from:[{type:"block",blocks:["core/audio"],transform:e=>C("podcasting/podcast",{id:e.id,src:e.src})}],to:[{type:"block",blocks:["core/audio"],isMatch:({id:e})=>{if(!e)return!1;const{getMedia:t}=v("core"),a=t(e);return!!a&&a.mime_type.includes("audio")},transform:e=>C("core/audio",{src:e.src,id:e.id})}]},S=[{attributes:{id:{type:"number"},src:{type:"string",source:"attribute",selector:"audio",attribute:"src"},url:{type:"string",source:"meta",meta:"podcast_url"},filesize:{type:"number",source:"meta",meta:"podcast_filesize"},duration:{type:"string",source:"meta",meta:"podcast_duration"},mime:{type:"string",source:"meta",meta:"podcast_mime"},caption:{type:"array",source:"children",selector:"figcaption"},captioned:{type:"boolean",source:"meta",meta:"podcast_captioned",default:!1},explicit:{type:"string",source:"meta",meta:"podcast_explicit",default:"no"},enclosure:{type:"string",source:"meta",meta:"enclosure"},seasonNumber:{type:"string",source:"meta",meta:"podcast_season_number"},episodeNumber:{type:"string",source:"meta",meta:"podcast_episode_number"},episodeType:{type:"string",source:"meta",meta:"podcast_episode_type"}},supports:{multiple:!1},save:t=>{const{id:a,src:s,caption:o}=t.attributes;return(0,e.createElement)("figure",{className:a?`podcast-${a}`:null},(0,e.createElement)("audio",{controls:"controls",src:s}),o&&o.length>0&&(0,e.createElement)("figcaption",null,o))}}],x=((0,a.registerBlockType)("podcasting/podcast",{title:(0,t.__)("Podcast","simple-podcasting"),description:(0,t.__)("Insert a podcast episode into a post. To add it to a podcast feed, select a podcast in document settings.","simple-podcasting"),category:"common",icon:"microphone",supports:{multiple:!1},attributes:{id:{type:"number"},src:{type:"string",source:"attribute",selector:"audio",attribute:"src"},url:{type:"string",source:"meta",meta:"podcast_url"},filesize:{type:"number",source:"meta",meta:"podcast_filesize"},duration:{type:"string",source:"meta",meta:"podcast_duration"},mime:{type:"string",source:"meta",meta:"podcast_mime"},caption:{type:"array",source:"children",selector:"figcaption"},captioned:{type:"boolean",source:"meta",meta:"podcast_captioned",default:!1},explicit:{type:"string",source:"meta",meta:"podcast_explicit"},enclosure:{type:"string",source:"meta",meta:"enclosure"},seasonNumber:{type:"string",source:"meta",meta:"podcast_season_number"},episodeNumber:{type:"string",source:"meta",meta:"podcast_episode_number"},episodeType:{type:"string",source:"meta",meta:"podcast_episode_type"},displayDuration:{type:"boolean",default:!1},displayShowTitle:{type:"boolean",default:!1},displayEpisodeTitle:{type:"boolean",default:!1},displayArt:{type:"boolean",default:!1},displayExplicitBadge:{type:"boolean",default:!1},displaySeasonNumber:{type:"boolean",default:!1},displayEpisodeNumber:{type:"boolean",default:!1},displayEpisodeType:{type:"boolean",default:!1}},transforms:T,edit:function(t){const a=function(){const e=(0,l.useSelect)((e=>e("core/editor").getEditedPostAttribute("featured_media")),[]),{editPost:t}=(0,l.useDispatch)("core/editor");return{featuredImageUrl:(0,l.useSelect)((t=>{const{getMedia:a}=t("core"),s=a(e);return s?.source_url}),[e]),setFeaturedImage:e=>{t({featured_media:e})},removeFeaturedImage:()=>{t({featured_media:0})},featuredImageId:e}}();return(0,e.createElement)(N,{...t,...a})},save:t=>{const{id:a,src:s,caption:o}=t.attributes;return(0,e.createElement)("figure",{className:a?`podcast-${a}`:null},o&&o.length>0&&(0,e.createElement)("figcaption",{className:"wp-block-podcasting-podcast__caption"},o),(0,e.createElement)("audio",{controls:"controls",src:s}))},deprecated:S}),"podcasting/latest-episode");(0,a.registerBlockVariation)("core/query",{name:x,title:"Latest Podcast Episode",description:"Displays the latest podcast episode.",isActive:["simple-podcasting"],icon:"microphone",attributes:{namespace:x,query:{postType:"post",podcastingQuery:"not_empty"}},allowedControls:[],scope:["inserter"],innerBlocks:[["core/post-template",{},[["core/group",{className:"podcasting-latest-episode"},[["core/post-featured-image"],["core/group",{className:"podcasting-latest-episode__content"},[["core/post-title"],["core/post-date"],["core/post-excerpt"]]]]]]],["core/query-no-results"]]})})();