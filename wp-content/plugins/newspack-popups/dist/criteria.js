(()=>{"use strict";const t={default:(t,e)=>t.value===e.value,list__in:(t,e)=>{let i=e.value;return"string"==typeof i&&(i=e.value.split(",").map((t=>t.trim()))),!!Array.isArray(i)&&(Array.isArray(t.value)?t.value.some((t=>i.some((e=>e==t)))):!(!t.value||!i.some((e=>e==t.value))))},list__not_in:(t,e)=>{let i=e.value;return"string"==typeof i&&(i=e.value.split(",").map((t=>t.trim()))),!(Array.isArray(i)&&(Array.isArray(t.value)?t.value.some((t=>i.some((e=>e==t)))):t.value&&i.some((e=>e==t.value))))},range:(t,e)=>{const{min:i,max:r}=e.value;return!(!t.value||i&&t.value<i||r&&t.value>r)}};window.newspackPopupsCriteria=window.newspackPopupsCriteria||{criteria:{}},window.newspackPopupsCriteria.criteria=window.newspackPopupsCriteria.criteria||{};const e={};function i(i,r={}){if(!i)throw new Error("Criteria must have an ID.");const n={id:i,matchingFunction:"default",...r,...e[i]};return n._matched={},n.matches=e=>{const i=JSON.stringify(e);if(void 0!==n._matched[i])return n._matched[i];const r=window.newspackReaderActivation;return r||console.warn("Reader activation script not loaded."),(e=>{n._configured||(n._configured=!0,n.matchingAttribute||(n.matchingAttribute=n.id),"string"==typeof n.matchingFunction&&t[n.matchingFunction]&&(n.matchingFunction=t[n.matchingFunction].bind(null,n)),"function"==typeof n.matchingFunction?("function"==typeof e?.on&&e.on("data",(()=>{n._matched={}})),"function"==typeof n.matchingAttribute?n.value=n.matchingAttribute(e):"string"==typeof n.matchingAttribute&&("function"==typeof e?.store?.get?n.value=e.store.get(n.matchingAttribute):console.warn(`Reader data library not loaded. Unable to fetch value for '${n.id}'`))):console.warn(`Unable to configure matching function for criteria ${n.id}.`))})(r),n._matched[i]=n.matchingFunction(e,r),n._matched[i]},window.newspackPopupsCriteria.criteria||(window.newspackPopupsCriteria.criteria={}),window.newspackPopupsCriteria.criteria[i]=n,n}function r(t){return t?window.newspackPopupsCriteria.criteria[t]:window.newspackPopupsCriteria.criteria}function n(t,i){let n=r(t);n||(e[t]=e[t]||{},n=e[t]),n._matched={},n.matchingAttribute=i}function a(t,i){let n=r(t);n||(e[t]=e[t]||{},n=e[t]),n._matched={},n.matchingFunction=i}if(n("articles_read",(t=>t.getUniqueActivitiesBy("article_view","post_id").filter((t=>t.timestamp>Date.now()-2592e6)).length)),n("articles_read_in_session",(t=>{const e=t.getUniqueActivitiesBy("article_view","post_id");if(!e.length)return 0;if(e.sort(((t,e)=>e.timestamp-t.timestamp)),e[0].timestamp<Date.now()-18e5)return 0;let i=0;for(;i<e.length&&e[i+1]&&e[i].timestamp-e[i+1].timestamp<18e5;)i++;return 1+i})),a("favorite_categories",((t,e)=>{let i=!1;const r=e.getUniqueActivitiesBy("article_view","post_id");if(1>=r.length)return i;const n=r.reduce(((t,e)=>(e.data?.categories?.length&&t.push(...e.data.categories),t)),[]).reduce(((t,e)=>(t[e]=(t[e]||0)+1,t)),{}),a=Object.entries(n);return a.sort(((t,e)=>e[1]-t[1])),a&&a.length?((!a[1]||a[0][1]>a[1][1])&&-1<t.value.indexOf(parseInt(a[0][0]))&&(i=!0),i):i})),a("donation",((t,{store:e})=>{switch(t.value){case"donors":return e.get("is_donor");case"non-donors":return!e.get("is_donor");case"formers-donors":return e.get("is_former_donor")}})),a("newsletter",((t,{store:e})=>{switch(t.value){case"subscribers":return e.get("is_newsletter_subscriber");case"non-subscribers":return!e.get("is_newsletter_subscriber")}})),a("user_account",((t,{store:e})=>{switch(t.value){case"with-account":return e.get("reader")?.email;case"without-account":return!e.get("reader")?.email}})),newspackPopupsCriteria.criteria={},newspackPopupsCriteria?.config)for(const t in newspackPopupsCriteria.config)i(t,newspackPopupsCriteria.config[t])})();