(()=>{"use strict";const e=(e,t,s={})=>!(!newspackPopupsData||!newspackPopupsData[t])&&{...newspackPopupsData[t],...s,action:e},t=(e,t="np_prompt_interaction")=>{"function"==typeof gtag&&e&&gtag("event",t,e)},s=e=>{const t=e.split("_");return parseInt(t[t.length-1])},n=e=>{const t=e.currentTarget.closest(".newspack-lightbox");t&&t.contains(e.currentTarget)&&(t.style.display="none"),t.overlayId&&window.newspackReaderActivation?.overlays&&window.newspackReaderActivation.overlays.remove(t.overlayId),e.preventDefault()},r=(e,t)=>{newspack_popups_view.debug&&(window.newspack_popups_debug=window.newspack_popups_debug||{},window.newspack_popups_debug[e]=t)};window.newspackPopupsCriteria=window.newspackPopupsCriteria||{criteria:{}},window.newspackPopupsCriteria.criteria=window.newspackPopupsCriteria.criteria||{};const o=864e5,a={day:o,week:7*o,month:30*o},i=e=>{for(const s of e){const e=(t=s.criteria_id)?window.newspackPopupsCriteria.criteria[t]:window.newspackPopupsCriteria.criteria;if(e&&!e.matches(s))return!1}var t;return!0},c=(e,t=null)=>{const s=((e=null)=>{e||(e=window.location.search);const t=new URLSearchParams(e);return t.get("view_as")?t.get("view_as").split(";").reduce(((e,t)=>{const s=t.split(":");return 1===s.length?e[s[0]]=!0:e[s[0]]=s[1],e}),{}):null})(t);if(s?.segment)return s.segment;const n=[];for(const t in e)i(e[t].criteria)&&n.push({id:t,priority:e[t].priority});return n.length?(n.sort(((e,t)=>e.priority-t.priority)),n[0].id):null},p=(e,t,n,o=null)=>{const i=e.getAttribute("id");let c=!0;const p=[],u={element:e},d=e.getAttribute("data-suppression");if(!0===o||!1===o)u.override=!0,o||(c=!1,p.push("Prompt suppressed by override."));else if(d){const e=n.store.get("utm_source")||[],t=new URLSearchParams(window.location.search).get("utm_source");let s=!1;-1<e.indexOf(d)&&(s=!0),s||d!==t||(s=!0,n.store.set("utm_source",[...e,t])),s&&(p.push(`Prompt suppressed by utm_source=${d}.`),c=!1)}else if(n){const[r,o,u,d]=e.getAttribute("data-frequency").split(","),l=n.store.get("pageviews");if(l[d]){const e=l[d].count||0;e<=parseInt(r)&&(p.push(`Prompt displayed starting at pageview ${parseInt(r)+1}. Reader has only ${e} pageviews.`),c=!1),0<o&&0<Math.max(0,e-(parseInt(r)+1))%(parseInt(o)+1)&&(p.push(`Prompt displayed once every ${parseInt(o)+1} pageviews.`),c=!1);const t=s(i),w=(n.getActivities("prompt_seen")||[]).filter((e=>e.data?.prompt_id===t&&a[d]>Date.now()-e.timestamp));0<parseInt(u)&&w.length>=parseInt(u)&&(p.push(`Prompt already displayed the max of ${u} times.`),c=!1)}const w=e.getAttribute("data-segments")?e.getAttribute("data-segments").split(","):null;w&&0>w.indexOf(t)&&(p.push("Reader does not match promptâ€™s assigned segments."),c=!1)}return u.displayed=c,0<p.length&&(u.suppression=p),r(i,u),c},u=e=>{let t;const s=new IntersectionObserver((n=>{n.forEach((n=>{n.isIntersecting?t||(t=setTimeout((()=>{e(),s.unobserve(n.target)}),250)):t&&(clearTimeout(t),t=!1)}))}),{threshold:.5});return s},d=e=>{const t=(t=null)=>{const o=newspack_popups_view?.segments||{},i=c(o);let d;r("matchingSegment",i),t&&(e=>{const t=Date.now(),s={day:{count:0,start:t},week:{count:0,start:t},month:{count:0,start:t},...e.store.get("pageviews")||{}};let n;document.body.classList.forEach((e=>{0===e.indexOf("page-id-")&&(n=parseInt(e.replace("page-id-","")))})),n&&parseInt(newspack_popups_view?.donor_landing_page)===n&&e.store.set("is_donor",!0);for(const e in s)a[e]<t-s[e].start&&(s[e].count=0,s[e].start=t),s[e].count++;e.store.set("pageviews",s)})(t),e.forEach((e=>{const r=e.getAttribute("id"),a=e.classList.contains("newspack-lightbox"),l=((e,t=!1,s=!1,n=null)=>e===((e=null)=>{e||(e=window.location.search);const t=new URLSearchParams(e);return t.get("pid")?parseInt(t.get("pid")):null})(n)||(!t||!s)&&null)(s(r),a,d);[...e.querySelectorAll(".newspack-lightbox__close, button.newspack-lightbox-overlay")].forEach((e=>{e.addEventListener("click",n)}));const w=p(e,i,t,l);if(!d&&a&&w&&(d=!0),w){const n=()=>{const t=e.getAttribute("data-delay")||0;setTimeout(i,t)},i=()=>{const r=c(o);p(e,r,t,l)&&(t?.overlays&&t.overlays.get().length?n():(e.classList.remove("hidden"),t&&((e,t)=>{u((()=>t.dispatchActivity("prompt_seen",{prompt_id:s(e.getAttribute("id"))}))).observe(e,{attributes:!0})})(e,t),a&&t?.overlays&&(e.overlayId=t.overlays.add())))};if(a)if(e.getAttribute("data-scroll")){const e=document.getElementById(`page-position-marker_${r}`);e&&u(i).observe(e)}else n();else i()}}))};newspack_popups_view.segments?(window.newspackRAS=window.newspackRAS||[],window.newspackRAS.push(t)):t()},l=n=>{n.forEach((n=>{new MutationObserver((r=>{r.forEach((r=>{"amp-access-hide"!==r.attributeName||"attributes"!==r.type||r.target.hasAttribute("amp-access-hide")||(()=>{const r=e("loaded",s(n.getAttribute("id")));t(r)})()}))})).observe(n,{attributes:!0})}))};var w;"undefined"!=typeof window&&(w=()=>{const n=[...document.querySelectorAll(".newspack-popup-container")];d(n),(n=>{"function"==typeof gtag&&(l(n),window.newspackRAS=window.newspackRAS||[],window.newspackRAS.push((s=>{s.on("activity",(({detail:{action:s,data:n}})=>{if("prompt_seen"===s){const{prompt_id:s}=n,r=e("seen",s);t(r)}}))})),(n=>{n.forEach((n=>{const r=n.querySelector(".newspack-lightbox__close"),o=[...n.querySelectorAll(".newspack-popup-container form")];if(r){const a=()=>{const r=e("dismissed",s(n.getAttribute("id")));t(r)};r.addEventListener("click",a),o.forEach((e=>{e.addEventListener("submit",(()=>r.removeEventListener("click",a)))}))}}))})(n),(n=>{n.forEach((n=>{const r=[...n.querySelectorAll(".newspack-popup-container a")],o=r=>{const o={};r.currentTarget?.href&&"#"!==r.currentTarget?.href&&(o.action_value=r.currentTarget.getAttribute("href"));const a=e("clicked",s(n.getAttribute("id")),o);t(a)};r.forEach((e=>e.addEventListener("click",o)))}))})(n),(n=>{n.forEach((n=>{const r=[...n.querySelectorAll(".newspack-popup-container form")],o=()=>{const r=e("form_submission",s(n.getAttribute("id")));t(r)};r.forEach((e=>e.addEventListener("submit",o)))}))})(n))})(n)},"undefined"!=typeof document&&("complete"!==document.readyState&&"interactive"!==document.readyState?document.addEventListener("DOMContentLoaded",w):w()))})();