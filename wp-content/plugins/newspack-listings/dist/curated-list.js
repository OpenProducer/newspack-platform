(()=>{"use strict";function t(e,r){const s=new XMLHttpRequest;s.onreadystatechange=()=>{if(4===s.readyState){if(s.status>=200&&s.status<300){const t=JSON.parse(s.responseText),r=s.getResponseHeader("next-url");return e.onSuccess(t,r)}return r?t(e,r-1):e.onError()}},s.open("GET",e.url),s.send()}function e(t){let e=!1;var r;return t&&Array.isArray(t)&&(e=!0,t.length&&(r=t[0],!Object.prototype.hasOwnProperty.call(r,"html")||"string"!=typeof t[0].html)&&(e=!1)),e}Array.prototype.forEach.call(document.querySelectorAll(".newspack-listings__curated-list.has-more-button"),function(r){const s=r.querySelector("[data-next]");if(!s)return;const n=r.querySelector(".newspack-listings__list-container"),o=s.textContent.trim(),a=r.querySelector(".loading").textContent;let i=!1;s.addEventListener("click",()=>{if(i)return!1;function c(){i=!1,r.classList.remove("is-loading"),r.classList.add("is-error"),s.textContent=o}i=!0,r.classList.remove("is-error"),r.classList.add("is-loading"),a&&(s.textContent=a),t({url:s.getAttribute("data-next"),onSuccess:function(t,a){if(!e(t))return c();if(t.length){const e=t.map(t=>t.html).join("");n.insertAdjacentHTML("beforeend",e)}a&&s.setAttribute("data-next",a),t.length&&a||r.classList.remove("has-more-button"),i=!1,r.classList.remove("is-loading"),s.textContent=o},onError:c},3)})}),Array.prototype.forEach.call(document.querySelectorAll(".newspack-listings__curated-list.show-sort-ui"),function(r){const s=r.querySelector(".newspack-listings__sort-ui"),n=r.querySelector(".newspack-listings__sort-select-control"),o=r.querySelectorAll('[name="newspack-listings__sort-order"]'),a=r.querySelector(".newspack-listings__sort-order-container");if(!(s&&n&&o.length&&a))return;const i=r.querySelector("[data-next]"),c=Array.prototype.concat.call(Array.prototype.slice.call(o),[n]),l=r.querySelector(".newspack-listings__list-container"),u=s.getAttribute("data-url"),d=r.classList.contains("has-more-button");let g=!1,y=s.querySelector("[selected]").value,p=s.querySelector("[checked]").value;const m=s=>{if(g)return!1;g=!0,r.classList.remove("is-error"),r.classList.add("is-loading"),"select"===s.target.tagName.toLowerCase()?y=s.target.value:p=s.target.value,"post__in"===s.target.value?a.classList.add("is-hidden"):a.classList.remove("is-hidden");const n=`${u}&${encodeURIComponent("query[sortBy]")}=${y}&${encodeURIComponent("query[order]")}=${p}`;function o(){g=!1,r.classList.remove("is-loading"),r.classList.add("is-error")}d&&i&&(r.classList.add("has-more-button"),i.setAttribute("data-next",n)),t({url:n,onSuccess:function(t,s){if(!e(t))return o();if(t.length){l.textContent="";const e=t.map(t=>t.html).join("");l.insertAdjacentHTML("beforeend",e)}s&&i&&i.setAttribute("data-next",s),g=!1,r.classList.remove("is-loading")},onError:o},3)};c.forEach(t=>t.addEventListener("change",m))})})();