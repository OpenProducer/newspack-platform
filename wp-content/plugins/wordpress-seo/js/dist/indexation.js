(()=>{"use strict";var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=window.wp.element,s=window.jQuery;var n=t.n(s);const i=window.wp.i18n,r=window.yoast.componentsNew,o=window.yoast.styleGuide,a=window.yoast.propTypes;var d=t.n(a);const c=window.yoast.helpers,l=window.yoast.styledComponents;var p=t.n(l);class h extends Error{constructor(t,e,s,n,i){super(t),this.name="RequestError",this.url=e,this.method=s,this.statusCode=n,this.stackTrace=i}}const x=window.ReactJSXRuntime,{stripTagsFromHtmlString:g}=c.strings,u=["a","p"],w=p().div`
	margin-top: 8px;
`,m=p().pre`
	overflow-x: scroll;
	max-width: 500px;
	border: 1px solid;
	padding: 16px;
`;function y({title:t,value:e=""}){return e?(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:t}),(0,x.jsx)("br",{}),e]}):null}function S({title:t,value:e=""}){return e?(0,x.jsxs)("details",{children:[(0,x.jsx)("summary",{children:t}),(0,x.jsx)(m,{children:e})]}):null}function _({message:t,error:e}){return(0,x.jsxs)(r.Alert,{type:"error",children:[(0,x.jsx)("div",{dangerouslySetInnerHTML:{__html:g(t,u)}}),(0,x.jsxs)("details",{children:[(0,x.jsx)("summary",{children:(0,i.__)("Error details","wordpress-seo")}),(0,x.jsxs)(w,{children:[(0,x.jsx)(y,{title:(0,i.__)("Request URL","wordpress-seo"),value:e.url}),(0,x.jsx)(y,{title:(0,i.__)("Request method","wordpress-seo"),value:e.method}),(0,x.jsx)(y,{title:(0,i.__)("Status code","wordpress-seo"),value:e.statusCode}),(0,x.jsx)(y,{title:(0,i.__)("Error message","wordpress-seo"),value:e.message}),(0,x.jsx)(S,{title:(0,i.__)("Response","wordpress-seo"),value:e.parseString}),(0,x.jsx)(S,{title:(0,i.__)("Error stack trace","wordpress-seo"),value:e.stackTrace})]})]})]})}y.propTypes={title:d().string.isRequired,value:d().any},S.propTypes={title:d().string.isRequired,value:d().string},_.propTypes={message:d().string.isRequired,error:d().oneOfType([d().instanceOf(Error),d().instanceOf(h)]).isRequired};class j extends Error{constructor(t,e){super(t),this.name="ParseError",this.parseString=e}}const f="idle",I="in_progress",A="errored",v="completed";class T extends e.Component{constructor(t){super(t),this.settings=yoastIndexingData,this.state={state:f,processed:0,error:null,amount:parseInt(this.settings.amount,10),firstTime:"1"===this.settings.firstTime},this.startIndexing=this.startIndexing.bind(this),this.stopIndexing=this.stopIndexing.bind(this)}async doIndexingRequest(t,e){const s=await fetch(t,{method:"POST",headers:{"X-WP-Nonce":e}}),n=await s.text();let i;try{i=JSON.parse(n)}catch(t){throw new j("Error parsing the response to JSON.",n)}if(!s.ok){const e=i.data?i.data.stackTrace:"";throw new h(i.message,t,"POST",s.status,e)}return i}async doPreIndexingAction(t){"function"==typeof this.props.preIndexingActions[t]&&await this.props.preIndexingActions[t](this.settings)}async doPostIndexingAction(t,e){"function"==typeof this.props.indexingActions[t]&&await this.props.indexingActions[t](e.objects,this.settings)}async doIndexing(t){let s=this.settings.restApi.root+this.settings.restApi.indexing_endpoints[t];for(;this.isState(I)&&!1!==s;)try{await this.doPreIndexingAction(t);const n=await this.doIndexingRequest(s,this.settings.restApi.nonce);await this.doPostIndexingAction(t,n),(0,e.flushSync)((()=>{this.setState((t=>({processed:t.processed+n.objects.length,firstTime:!1})))})),s=n.next_url}catch(t){(0,e.flushSync)((()=>{this.setState({state:A,error:t,firstTime:!1})}))}}async index(){for(const t of Object.keys(this.settings.restApi.indexing_endpoints))await this.doIndexing(t);this.isState(A)||this.isState(f)||this.completeIndexing()}async startIndexing(){this.setState({processed:0,state:I},this.index)}completeIndexing(){this.setState({state:v})}stopIndexing(){this.setState((t=>({state:f,processed:0,amount:t.amount-t.processed})))}componentDidMount(){var t,e;if(!this.settings.disabled&&(this.props.indexingStateCallback(0===this.state.amount?"completed":this.state.state),"true"===new URLSearchParams(window.location.search).get("start-indexation"))){const s=function(t,e){const s=new URL(t);return s.searchParams.delete("start-indexation"),s.href}(window.location.href);null,t=document.title,e=s,window.history.pushState(null,t,e),this.startIndexing()}}componentDidUpdate(t,e){this.state.state!==e.state&&this.props.indexingStateCallback(this.state.state)}isState(t){return this.state.state===t}renderFirstIndexationNotice(){return(0,x.jsx)(r.Alert,{type:"info",children:(0,i.__)("This feature includes and replaces the Text Link Counter and Internal Linking Analysis","wordpress-seo")})}renderStartButton(){return(0,x.jsx)(r.NewButton,{variant:"primary",onClick:this.startIndexing,children:(0,i.__)("Start SEO data optimization","wordpress-seo")})}renderStopButton(){return(0,x.jsx)(r.NewButton,{variant:"secondary",onClick:this.stopIndexing,children:(0,i.__)("Stop SEO data optimization","wordpress-seo")})}renderDisabledTool(){return(0,x.jsxs)(e.Fragment,{children:[(0,x.jsx)("p",{children:(0,x.jsx)(r.NewButton,{variant:"secondary",disabled:!0,children:(0,i.__)("Start SEO data optimization","wordpress-seo")})}),(0,x.jsx)(r.Alert,{type:"info",children:(0,i.__)("SEO data optimization is disabled for non-production environments.","wordpress-seo")})]})}renderProgressBar(){return(0,x.jsxs)(e.Fragment,{children:[(0,x.jsx)(r.ProgressBar,{style:{height:"16px",margin:"8px 0"},progressColor:o.colors.$color_pink_dark,max:parseInt(this.state.amount,10),value:this.state.processed}),(0,x.jsx)("p",{style:{color:o.colors.$palette_grey_text},children:(0,i.__)("Optimizing SEO dataâ€¦ This may take a while.","wordpress-seo")})]})}renderErrorAlert(){return(0,x.jsx)(_,{message:yoastIndexingData.errorMessage,error:this.state.error})}renderTool(){return(0,x.jsxs)(e.Fragment,{children:[this.isState(I)&&this.renderProgressBar(),this.isState(A)&&this.renderErrorAlert(),this.isState(f)&&this.state.firstTime&&this.renderFirstIndexationNotice(),this.isState(I)?this.renderStopButton():this.renderStartButton()]})}render(){return this.settings.disabled?this.renderDisabledTool():this.isState(v)||0===this.state.amount?(0,x.jsx)(r.Alert,{type:"success",children:(0,i.__)("SEO data optimization complete","wordpress-seo")}):this.renderTool()}}T.propTypes={indexingActions:d().object,preIndexingActions:d().object,indexingStateCallback:d().func},T.defaultProps={indexingActions:{},preIndexingActions:{},indexingStateCallback:()=>{}};const b=T;let E;function O(){var t;null===(t=E)||void 0===t||t.render((0,x.jsx)(b,{preIndexingActions:window.yoast.indexing.preIndexingActions,indexingActions:window.yoast.indexing.indexingActions}))}window.yoast=window.yoast||{},window.yoast.indexing=window.yoast.indexing||{},window.yoast.indexing.preIndexingActions={},window.yoast.indexing.indexingActions={},window.yoast.indexing.registerPreIndexingAction=(t,e)=>{window.yoast.indexing.preIndexingActions[t]=e,O()},window.yoast.indexing.registerIndexingAction=(t,e)=>{window.yoast.indexing.indexingActions[t]=e,O()},n()((function(){const t=document.getElementById("yoast-seo-indexing-action");t&&(E=(0,e.createRoot)(t)),O()}))})();