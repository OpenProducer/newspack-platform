(()=>{"use strict";let e;var t;t=function(){const t=new Event("newspack-newsletters-subscribe-success");document.querySelectorAll(".newspack-newsletters-subscribe").forEach((s=>{const n=s.querySelector("form");if(!n)return;const r=s.querySelector(".newspack-newsletters-subscribe__response"),a=s.querySelector(".newspack-newsletters-subscribe__message"),c=s.querySelector('input[type="email"]'),i=s.querySelector('button[type="submit"]'),d=document.createElement("span");d.classList.add("spinner"),n.endFlow=(e,l=500,o=!1)=>{s.setAttribute("data-status",l);const u=document.createElement("p");c.removeAttribute("disabled"),i.removeChild(d),i.removeAttribute("disabled"),n.classList.remove("in-progress"),u.innerHTML=o?s.getAttribute("data-success-message"):e,a.appendChild(u),u.className=`message status-${l}`,200===l&&(s.replaceChild(r,n),n.dispatchEvent(t))},n.addEventListener("submit",(t=>{if(t.preventDefault(),a.innerHTML="",n.classList.add("in-progress"),i.disabled=!0,i.appendChild(d),!n.npe?.value)return n.endFlow(newspack_newsletters_subscribe_block.invalid_email,400);const s=new FormData(n);if(!s.has("npe")||!s.get("npe"))return n.endFlow(newspack_newsletters_subscribe_block.invalid_email,400);e&&s.set("newspack_newsletters_subscribe",e),c.setAttribute("disabled","true"),i.setAttribute("disabled","true"),fetch(n.getAttribute("action")||window.location.pathname,{method:"POST",headers:{Accept:"application/json"},body:s}).then((t=>{t.json().then((({message:s,newspack_newsletters_subscribed:r,newspack_newsletters_subscribe:a})=>{e=a,n.endFlow(s,t.status,r)}))}))}))}))},"undefined"!=typeof document&&("complete"!==document.readyState&&"interactive"!==document.readyState?document.addEventListener("DOMContentLoaded",t):t())})();