(()=>{"use strict";window.newspackRAS=window.newspackRAS||[],window.newspackRAS.push((function(e){var t;t=function(){document.querySelectorAll(".newspack-registration").forEach((t=>{const n=t.querySelector("form");if(!n)return;const s=t.querySelector(".newspack-registration__response"),a=n.querySelector('button[type="submit"]'),i=document.createElement("span");i.classList.add("spinner");let r=t.querySelector(".newspack-registration__registration-success");n.startLoginFlow=()=>{s.classList.add("newspack-registration--hidden"),s.innerHTML="",a.disabled=!0,a.appendChild(i),t.classList.add("newspack-registration--in-progress")},n.endLoginFlow=(o=null,c=500,d=null)=>{let l;if(d?.existing_user&&(r=t.querySelector(".newspack-registration__login-success")),o){l=document.createElement("p"),l.textContent=o;const e=r.querySelector("p");e&&d?.sso&&e.replaceWith(l)}const u=200===c;t.classList.add("newspack-registration--"+(u?"success":"error")),u?(r.classList.remove("newspack-registration--hidden"),n.remove(),d?.email&&(e.setReaderEmail(d.email),e.setAuthenticated(d?.authenticated))):l&&(s.appendChild(l),s.classList.remove("newspack-registration--hidden")),a.contains(i)&&a.removeChild(i),a.disabled=!1,t.classList.remove("newspack-registration--in-progress")},n.addEventListener("submit",(e=>{if(e.preventDefault(),n.startLoginFlow(),!n.npe?.value)return n.endLoginFlow("Please enter a vaild email address.",400);const t=new FormData(n);if(!t.has("npe")||!t.get("npe"))return n.endFlow("Please enter a vaild email address.",400);fetch(n.getAttribute("action")||window.location.pathname,{method:"POST",headers:{Accept:"application/json"},body:t}).then((e=>{e.json().then((({message:t,data:s})=>n.endLoginFlow(t,e.status,s)))})).catch((e=>{n.endLoginFlow(e,400)}))})),e.on("reader",(({detail:{authenticated:e}})=>{e&&n.endLoginFlow(null,200)}))}))},"undefined"!=typeof document&&("complete"!==document.readyState&&"interactive"!==document.readyState?document.addEventListener("DOMContentLoaded",t):t())}))})();