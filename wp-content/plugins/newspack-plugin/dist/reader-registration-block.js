(()=>{"use strict";window.newspackRAS=window.newspackRAS||[],window.newspackRAS.push((function(e){var t;t=function(){document.querySelectorAll(".newspack-registration").forEach((t=>{const a=t.querySelector("form");if(!a)return;let n=new FormData(a);const s=t.querySelector(".newspack-registration__response"),i=a.querySelector('button[type="submit"]'),o=document.createElement("span");o.classList.add("spinner");let r=t.querySelector(".newspack-registration__registration-success");a.startLoginFlow=()=>{s.classList.add("newspack-registration--hidden"),s.innerHTML="",i.disabled=!0,i.appendChild(o),t.classList.add("newspack-registration--in-progress")},a.endLoginFlow=(d=null,c=500,l=null)=>{let p;if(l?.existing_user&&(r=t.querySelector(".newspack-registration__login-success")),d){p=document.createElement("p"),p.textContent=d;const e=r.querySelector("p");e&&l?.sso&&e.replaceWith(p)}const u=200===c;if(t.classList.add("newspack-registration--"+(u?"success":"error")),u){if(r.classList.remove("newspack-registration--hidden"),l?.email&&(n=new FormData(a),e.setReaderEmail(l.email),e.setAuthenticated(l?.authenticated),l.authenticated&&!l.existing_user)){const t=n.getAll("lists[]"),a={email:l.email};l?.metadata?.newspack_popup_id&&(a.newspack_popup_id=l.metadata.newspack_popup_id),l?.metadata?.gate_post_id&&(a.gate_post_id=l.metadata.gate_post_id),t?.length&&e.dispatchActivity("newsletter_signup",{...a,newsletters_subscription_method:"reader-registration",lists:t}),e.dispatchActivity("reader_registered",{...a,registration_method:l?.metadata?.registration_method||"registration-block"})}a.remove()}else p&&(s.appendChild(p),s.classList.remove("newspack-registration--hidden"));i.contains(o)&&i.removeChild(o),i.disabled=!1,t.classList.remove("newspack-registration--in-progress")},a.addEventListener("submit",(e=>(e.preventDefault(),a.startLoginFlow(),a.npe?.value?(n=new FormData(a),n.has("npe")&&n.get("npe")?void fetch(a.getAttribute("action")||window.location.pathname,{method:"POST",headers:{Accept:"application/json"},body:n}).then((e=>{e.json().then((({message:t,data:n})=>a.endLoginFlow(t,e.status,n)))})).catch((e=>{a.endLoginFlow(e,400)})):a.endFlow("Please enter a vaild email address.",400)):a.endLoginFlow("Please enter a vaild email address.",400)))),e.on("reader",(({detail:{authenticated:e}})=>{e&&a.endLoginFlow(null,200)}))}))},"undefined"!=typeof document&&("complete"!==document.readyState&&"interactive"!==document.readyState?document.addEventListener("DOMContentLoaded",t):t())}))})();