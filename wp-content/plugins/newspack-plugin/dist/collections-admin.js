(()=>{"use strict";var e,t={569:(e,t,n)=>{var a=n(1622);class l{constructor({metaDefinitions:e,orderColumnName:t,inlineEditTax:n}){this.metaDefinitions=e,this.orderColumnName=t,this.inlineEditTax=n,this.originalEdit=n.edit,this.originalSave=n.save,this.isSortedByOrder=document.querySelector(`.wp-list-table #${t}`)?.classList.contains("sorted"),this.init()}init(){this.inlineEditTax.edit=this.handleEdit.bind(this),this.inlineEditTax.save=this.handleSave.bind(this)}handleEdit(e){this.originalEdit.apply(this.inlineEditTax,arguments);const t=parseInt("object"==typeof e?this.inlineEditTax.getId(e):e,10);if(!t)return;const n=document.querySelector(`#tag-${t}`),a=document.querySelector(`#edit-${t}`);if(!n||!a)return;const l=n.querySelector(`.column-${this.orderColumnName}`),i=a.querySelector(`input[name="${this.metaDefinitions.section_order.key}"]`);l&&i&&(i.value=l.textContent.trim())}handleSave(){return this.isSortedByOrder&&jQuery(document).one("ajaxSuccess",(e,t,n)=>{n?.data?.includes("action=inline-save-tax")&&window.location.reload()}),this.originalSave.apply(this.inlineEditTax,arguments)}}(0,a.Qc)(()=>{const{sectionTaxonomy:e}=window.newspackCollections||{},{inlineEditTax:t}=window;e?.metaDefinitions&&e?.orderColumnName&&t&&new l({...e,inlineEditTax:t})});var i=n(7723);const o=window.wp.plugins,r=window.wp.editPost;var s=n(6427),c=n(7143),p=n(6087);const u=window.wp.editor;var d=n(4715),m=n(3784),h=n(5556),g=n.n(h),w=n(790);const b=new Map,f=({attachmentId:e,onRemove:t})=>{const[n,a]=(0,p.useState)(()=>b.get(e)||null),[l,o]=(0,p.useState)(!1);return(0,p.useEffect)(()=>{e&&!n&&(o(!0),wp.apiFetch({path:`/wp/v2/media/${e}`}).then(t=>{const n={url:t.source_url||t.url||"",title:t?.title?.rendered||"file"};b.set(e,n),a(n)}).catch(()=>a(null)).finally(()=>o(!1)))},[e,n]),l?(0,w.jsx)(s.Spinner,{}):n?.url&&n?.title?(0,w.jsxs)("div",{className:"attachment-info",children:[(0,w.jsx)(s.Dashicon,{icon:"pdf"}),(0,w.jsx)(s.ExternalLink,{className:"attachment-name",href:n.url,children:n.title}),t&&(0,w.jsx)(s.Button,{isSmall:!0,isDestructive:!0,onClick:t,icon:"no-alt",label:(0,i.__)("Remove attachment","newspack-plugin")})]}):(0,w.jsx)("span",{children:"File info unavailable"})};f.propTypes={attachmentId:g().oneOfType([g().string,g().number]).isRequired,onRemove:g().func};const y=f,v=e=>{try{return new URL(e),!0}catch{return!1}},k=({metaKey:e,meta:t,updateMeta:n,...a})=>{const{baseControlProps:l,controlProps:o}=(0,s.useBaseControlProps)(a),[r,c]=(0,p.useState)({}),[u,h]=(0,p.useState)(null),[g,f]=(0,p.useState)(null),k=t[e]||[],x=(0,p.useCallback)(()=>{const t=[...k,{type:"link",label:"",url:""}];n(e,t)},[k,n,e]),C=(0,p.useCallback)(t=>{const a=k.filter((e,n)=>n!==t);n(e,a.length>0?a:null),c(n=>{const a={...n};return delete a[`${e}_${t}`],a})},[k,n,e]),j=(0,p.useCallback)((t,a,l)=>{const i=[...k];i[t]={...i[t],[a]:l},n(e,i)},[k,n,e]),_=(0,p.useCallback)((t,n)=>{c(a=>{const l=`${e}_${t}`;if(!n||v(n)){const e={...a};return delete e[l],e}return{...a,[l]:(0,i.__)("Please enter a valid URL.","newspack-plugin")}})},[e]),S=(0,p.useCallback)((t,a)=>{if(a&&"application/pdf"===a.mime){const l={url:a.source_url||a.url||"",title:a.title||"file"};b.set(a.id,l);const i=[...k];i[t]={...i[t],type:"attachment",id:a.id},n(e,i),c(n=>{const a={...n};return delete a[`${e}_${t}`],a})}else c(n=>({...n,[`${e}_${t}`]:(0,i.__)("Please upload a PDF file.","newspack-plugin")}))},[k,n,e]),T=(0,p.useMemo)(()=>k.map((e,t)=>e=>S(t,e)),[S,k.length]),D=(0,p.useCallback)(e=>{h(e)},[]),P=(0,p.useCallback)(t=>{const a=t.target.closest(".cta-input-row");if(!a)return h(null),void f(null);const l=parseInt(a.id.replace("cta-",""),10);if(null!==u&&!isNaN(l)&&u!==l){const t=[...k],[a]=t.splice(u,1);t.splice(l,0,a),c(t=>{const n={};return Object.entries(t).forEach(([t,a])=>{const i=t.match(new RegExp(`^${e}_(\\d+)$`));if(i){const t=parseInt(i[1],10);let o;o=t===u?l:t<u&&t>=l?t+1:t>u&&t<=l?t-1:t,n[`${e}_${o}`]=a}else n[t]=a}),n}),n(e,t)}h(null),f(null)},[k,u,n,e]),E=(0,p.useCallback)(e=>{f(e)},[]);return(0,w.jsxs)(s.BaseControl,{...l,children:[k.map((t,n)=>{const a=`${e}_${n}`,l=!!r[a],c=u===n,p=g===n;return(0,w.jsx)(s.Draggable,{elementId:`cta-${n}`,transferData:{},onDragStart:()=>D(n),onDragEnd:P,onDragOver:()=>E(n),children:({onDraggableStart:e,onDraggableEnd:u})=>(0,w.jsxs)("div",{className:`cta-input-row ${c?"cta-dragging":""} ${p?"cta-drag-over":""}`,id:`cta-${n}`,onDragOver:e=>{e.preventDefault(),f(n)},onDragLeave:()=>f(null),onDrop:e=>{e.preventDefault(),P(e)},children:[(0,w.jsx)(s.Button,{className:"cta-drag-handle",icon:m.A,draggable:!0,onDragStart:e,onDragEnd:u,label:(0,i.__)("Drag to reorder","newspack-plugin")}),(0,w.jsx)(s.TextControl,{value:t.label||"",onChange:e=>j(n,"label",e),placeholder:(0,i.__)("Enter a label…","newspack-plugin"),label:(0,i.__)("Label","newspack-plugin")}),(0,w.jsx)(s.SelectControl,{value:t.type||"link",onChange:e=>j(n,"type",e),options:[{label:(0,i.__)("External Link","newspack-plugin"),value:"link"},{label:(0,i.__)("File Upload","newspack-plugin"),value:"attachment"}],label:(0,i.__)("Type","newspack-plugin")}),"link"===t.type?(0,w.jsx)(s.TextControl,{value:t.url||"",onChange:e=>j(n,"url",e),onBlur:e=>_(n,e.target.value),className:l?"meta-field-error":"",help:r[a],placeholder:(0,i.__)("Enter the URL…","newspack-plugin"),label:(0,i.__)("URL","newspack-plugin")}):(0,w.jsx)(s.BaseControl,{label:(0,i.__)("File","newspack-plugin"),className:l?"meta-field-error":"",help:r[a],id:`${o.id}-attachment-${n}`,children:t.id?(0,w.jsx)(y,{attachmentId:t.id,onRemove:()=>j(n,"id",null)}):(0,w.jsx)(d.MediaUpload,{onSelect:T[n],allowedTypes:["application/pdf"],render:({open:e})=>(0,w.jsx)(s.Button,{isSecondary:!0,isSmall:!0,onClick:e,className:"upload-button",children:(0,i.__)("Upload PDF","newspack-plugin")})})}),(0,w.jsx)(s.Button,{isSecondary:!0,isSmall:!0,isDestructive:!0,onClick:()=>C(n),className:"remove-cta-button",children:(0,i.__)("Remove CTA","newspack-plugin")})]})},n)}),(0,w.jsx)(s.Button,{isSecondary:!0,onClick:x,className:"add-cta-button",children:(0,i.__)("Add CTA","newspack-plugin")})]})};k.propTypes={metaKey:g().string.isRequired,meta:g().object.isRequired,updateMeta:g().func.isRequired};const x=k,C=({postType:e,metaDefinitions:t,panelTitle:n})=>{const[a,l]=(0,p.useState)({}),{editPost:o}=(0,c.useDispatch)(u.store),{currentPostType:d,meta:m={}}=(0,c.useSelect)(e=>{const t=e(u.store);return{currentPostType:t.getCurrentPostType(),meta:t.getEditedPostAttribute("meta")||{}}},[]),h=(0,p.useCallback)((e,t)=>{o({meta:{[e]:t}})},[o]),g=(0,p.useCallback)(e=>{l(t=>Object.fromEntries(Object.entries(t).filter(([t])=>t!==e)))},[]),b=(0,p.useCallback)((e,t,n)=>{if(!t)return h(e,null),void g(e);"url"===n&&l(n=>!t||v(t)?(g(e),n):{...n,[e]:(0,i.__)("Please enter a valid URL.","newspack-plugin")})},[h,g]);return e===d&&(0,w.jsx)(r.PluginDocumentSettingPanel,{name:"newspack-collections-meta-panel",title:n,className:"newspack-collections-meta-panel",icon:"media-document",children:(0,w.jsx)("div",{className:"collection-meta-fields",children:Object.entries(t).map(([e,t])=>{if("ctas"===e)return(0,w.jsx)(x,{metaKey:t.key,label:t.label,help:t.help,meta:m,updateMeta:h},t.key);if("select"===t.field_type&&t.options)return(0,w.jsx)(s.SelectControl,{label:t.label,help:t.help,value:m[t.key]||t.default||"",options:t.options,onChange:e=>h(t.key,e)},t.key);const n=!!a[t.key];return(0,w.jsx)(s.TextControl,{label:t.label,help:a[t.key]||t.help,value:m[t.key]||"",type:t.type,onChange:e=>h(t.key,e),onBlur:e=>b(t.key,e.target.value,t.type),className:n?"meta-field-error":""},t.key)})})})};(0,a.Qc)(()=>{const{collectionPostType:e}=window.newspackCollections||{};e?.postType&&e?.metaDefinitions&&e?.panelTitle&&(0,o.registerPlugin)("newspack-collection-meta-panel",{render:()=>(0,w.jsx)(C,{...e}),icon:"media-document"})});const j=window.wp.domReady,_=({panelTitle:e,metaDefinitions:t})=>{const{editPost:n}=(0,c.useDispatch)(u.store),{currentPostType:a,meta:l={}}=(0,c.useSelect)(e=>{const t=e(u.store);return{currentPostType:t.getCurrentPostType(),meta:t.getEditedPostAttribute("meta")||{}}},[]),i=(0,p.useCallback)((e,t,a)=>{let l=t;"integer"===a?l=""===t?"":parseInt(t,10)||0:"boolean"===a&&(l=!!t),n({meta:{[e]:l}})},[n]);return"post"===a&&(0,w.jsx)(r.PluginDocumentSettingPanel,{name:"newspack-post-meta-panel",title:e,icon:"media-document",children:Object.entries(t).map(([e,t])=>((e,t)=>{const{key:n,type:a,label:o,help:r}=t;return"boolean"===a?(0,w.jsx)(s.ToggleControl,{label:o,checked:!!l[n],onChange:e=>i(n,e,a),help:r},e):"integer"===a?(0,w.jsx)(s.TextControl,{label:o,type:"number",value:l[n]||"",onChange:e=>i(n,e,a),help:r,min:0},e):null})(e,t))})};n.n(j)()(()=>{const{postMeta:e}=window.newspackCollections||{};e?.panelTitle&&e?.metaDefinitions&&(0,o.registerPlugin)("newspack-post-meta-panel",{render:()=>(0,w.jsx)(_,{...e}),icon:"media-document"})})},790:e=>{e.exports=window.ReactJSXRuntime},4715:e=>{e.exports=window.wp.blockEditor},5573:e=>{e.exports=window.wp.primitives},6087:e=>{e.exports=window.wp.element},6427:e=>{e.exports=window.wp.components},7143:e=>{e.exports=window.wp.data},7723:e=>{e.exports=window.wp.i18n}},n={};function a(e){var l=n[e];if(void 0!==l)return l.exports;var i=n[e]={id:e,loaded:!1,exports:{}};return t[e](i,i.exports,a),i.loaded=!0,i.exports}a.m=t,e=[],a.O=(t,n,l,i)=>{if(!n){var o=1/0;for(p=0;p<e.length;p++){for(var[n,l,i]=e[p],r=!0,s=0;s<n.length;s++)(!1&i||o>=i)&&Object.keys(a.O).every(e=>a.O[e](n[s]))?n.splice(s--,1):(r=!1,i<o&&(o=i));if(r){e.splice(p--,1);var c=l();void 0!==c&&(t=c)}}return t}i=i||0;for(var p=e.length;p>0&&e[p-1][2]>i;p--)e[p]=e[p-1];e[p]=[n,l,i]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.j=744,(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var l=n.length-1;l>-1&&(!e||!/^http(s?):/.test(e));)e=n[l--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={744:0};a.O.j=t=>0===e[t];var t=(t,n)=>{var l,i,[o,r,s]=n,c=0;if(o.some(t=>0!==e[t])){for(l in r)a.o(r,l)&&(a.m[l]=r[l]);if(s)var p=s(a)}for(t&&t(n);c<o.length;c++)i=o[c],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return a.O(p)},n=globalThis.webpackChunknewspack=globalThis.webpackChunknewspack||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var l=a.O(void 0,[223],()=>a(569));l=a.O(l)})();