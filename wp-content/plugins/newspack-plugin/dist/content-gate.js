(()=>{"use strict";const e=(e,t="np_reader_activation_interaction")=>{if("function"==typeof window.gtag&&e){for(const t of Object.keys(e))"boolean"==typeof e[t]?e[t]=e[t]?"yes":"no":"true"===e[t]?e[t]="yes":"false"===e[t]&&(e[t]="no"),e[t]=e[t].toString();window.gtag("event",t,e)}};function t(e="log",...t){"true"===localStorage.getItem("newspack-reader-activation-debug")&&console["error"===e?"error":"log"](...t)}const n="np_gate_interaction",o={...newspack_content_gate.metadata,referrer:window.location.pathname};function a(e){return!!e&&e.offsetWidth>0&&e.offsetHeight>0}function i(e,t){return t&&(o.gate_has_donation_block=a(t.querySelector(".wp-block-newspack-blocks-donate"))?"yes":"no",o.gate_has_registration_block=a(t.querySelector(".newspack-registration"))?"yes":"no",o.gate_has_checkout_button=a(t.querySelector(".wp-block-newspack-blocks-checkout-button"))?"yes":"no",o.gate_has_registration_link=a(t.querySelector('a[href="#register_modal"]'))?"yes":"no",o.gate_has_signin_link=a(t.querySelector('a[href="#signin_modal"]'))?"yes":"no"),((e={},t={})=>{const n={...e};return t?.newspack_popup_id&&(n.newspack_popup_id=t.newspack_popup_id),t?.gate_post_id&&(n.gate_post_id=t.gate_post_id),t?.sso&&(n.sso=t.sso),n})({...e,...o})}function c(t){"function"==typeof window.gtag&&(!function(t){[...document.querySelectorAll(".newspack-reader-auth form"),...t.querySelectorAll(".newspack-registration form"),...t.querySelectorAll(".wp-block-newspack-blocks-checkout-button form"),...t.querySelectorAll(".wp-block-newspack-blocks-donate form")].forEach(o=>{if(!o.querySelector('input[name="gate_post_id"]')){const a=document.createElement("input");a.type="hidden",a.name="gate_post_id",a.value=newspack_content_gate.metadata?.gate_post_id||"1",o.appendChild(a),o.addEventListener("submit",o=>function(t,o){if("function"!=typeof window.gtag)return;const a={action:"form_submission"},c=new FormData(t.target),r={};for(const e of c.entries())r[e[0]]=e[1];if(r["reader-activation-auth-form"]&&r.action&&(a.action_type="register"===r.action?"registration":"signin"),r.newspack_reader_registration&&(a.action_type="registration"),r.newspack_donate&&(a.action_type="donation",r.donation_currency&&(a.donation_currency=r.donation_currency),r.donation_frequency&&(a.donation_frequency=r.donation_frequency,r[`donation_value_${r.donation_frequency}`]&&(a.donation_amount=r[`donation_value_${r.donation_frequency}`],"other"===a.donation_amount&&r[`donation_value_${r.donation_frequency}_other`]&&(a.donation_amount=r[`donation_value_${r.donation_frequency}_other`])))),r.newspack_checkout){a.action_type="checkout_button";const e=t.target.getAttribute("data-checkout")?JSON.parse(t.target.getAttribute("data-checkout")):null;e&&Object.assign(a,e)}e(i(a,o),n)}(o,t))}})}(t),e(i({action:"seen"},t),n))}var r;r=function(){const o=document.querySelector(".newspack-content-gate__gate");if(o)if(t("log","[Gate] initReloadHandler called"),window.newspackRAS=window.newspackRAS||[],window.newspackRAS.push(function(o){t("log","[Gate] RAS initialized");let a=!1;const c=function(c){if(t("log","[Gate] refreshPage called with event:",c),t("log","[Gate] Event detail:",c?.detail),t("log","[Gate] Event detail action:",c?.detail?.action),t("log","[Gate] Pending checkout:",window?.newspackReaderActivation?.getPendingCheckout()),c?.detail?.action&&"reader_registered"===c.detail.action&&!window?.newspackReaderActivation?.getPendingCheckout()&&(t("log","[Gate] reader_registered action detected"),a=!0),c?.detail?.overlays&&c.detail.removed){const o=window?.newspackReaderActivation?.getActivities();t("log","[Gate] Overlay removed, activities:",o);const c=o?.[o.length-1]||{},r=["checkout_completed","reader_registered","reader_logged_in","newsletter_signup"];o.length&&r.includes(c.action)?(t("log","[Gate] Valid action detected:",c.action),a=!0,document.body.classList.add("newspack-content-gate__gate-passed")):(a=!1,"function"==typeof window.gtag&&e(i({action:"dismissed"}),n))}c?.detail?.action&&"reader_logged_in"===c.detail.action&&(t("log","[Gate] reader_logged_in action detected"),a=!0),setTimeout(()=>{const e=o.overlays.get(),n=window?.newspackReaderActivation?.getActivities();t("log","[Gate] Checking reload conditions - overlays:",e,"reload:",a),t("log","[Gate] Current activities:",n),!e.length&&a&&(t("log","[Gate] Reloading page!"),window.location.reload())},5)};o.on("overlay",c),o.on("activity",c)}),o.classList.contains("newspack-content-gate__overlay-gate"))!function(e){let t=document.querySelector(".entry-content");t||(t=document.querySelector("#content")),e.style.removeProperty("display");let n=!1;const o=()=>{let o=!1;(t?.getBoundingClientRect().top||0)-window.innerHeight/2<0&&(o=!0,n||c(e),n=!0),e.setAttribute("data-visible",o)};document.addEventListener("scroll",o),o()}(o);else{const e=()=>{(o?.getBoundingClientRect().top||0)-window.innerHeight/2<0&&"function"==typeof window.gtag&&(c(o),document.removeEventListener("scroll",e))};document.addEventListener("scroll",e),e()}},"undefined"!=typeof document&&("complete"!==document.readyState&&"interactive"!==document.readyState?document.addEventListener("DOMContentLoaded",r):r())})();