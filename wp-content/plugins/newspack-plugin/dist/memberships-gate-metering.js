(()=>{const e=newspack_metering_settings,t="metering-"+e.gate_id||0;function n(n){const o=function(n){const o=function(){const t=new Date;switch(t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),e.period){case"day":t.setDate(t.getDate()+1);break;case"week":const e=6-t.getDay();t.setDate(t.getDate()+e);break;case"month":t.setMonth(t.getMonth()+1),t.setDate(1)}return parseInt(t.getTime()/1e3,10)}(),i=n.get(t)||{content:[],expiration:o};return i.expiration=parseInt(i.expiration,10)||0,i.expiration!==o&&(i.expiration<o&&(i.content=[]),i.expiration=o),n.set(t,i),i}(n.store);let i=!1;e.count<=o.content.length&&!o.content.includes(e.post_id)?(!function(){const t=document.querySelector(".entry-content");if(!t)return;document.querySelectorAll(".newspack-popup").forEach((e=>{e.parentNode.removeChild(e)})),t.innerHTML=e.excerpt;const n=document.getElementById("comments");n&&n.remove();const o=document.querySelector(".newspack-memberships__inline-gate");o&&t.appendChild(o)}(),n.dispatchActivity("metering_restricted",{post_id:e.post_id,metering:o}),i=!0):document.querySelectorAll(".newspack-memberships__gate").forEach((e=>{e.parentNode.removeChild(e)})),i||(e.article_view&&n.dispatchActivity(e.article_view.action,e.article_view.data),o.content.includes(e.post_id)||(o.content.push(e.post_id),n.store.set(t,o)))}window.newspackRAS=window.newspackRAS||[],window.newspackRAS.push((e=>n(e)))})();