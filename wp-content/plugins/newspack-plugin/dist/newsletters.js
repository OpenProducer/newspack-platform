(()=>{"use strict";var e,t={1452:(e,t,n)=>{n(8209);var s=n(6087),i=n(7723),r=n(5135),a=n(216),l=n(5880),o=n.n(l),c=n(3916),p=n.n(c),d=n(583),u=n.n(d),w=n(2193),h=n.n(w),g=n(8059),_=n.n(g),k=n(1455),v=n.n(k),x=n(6427),f=n(790);const m=({onUpdate:e,newslettersConfig:t,isOnboarding:n=!0,authUrl:a=!1,provider:l,setProvider:c=(()=>{}),setAuthUrl:d=(()=>{}),setLockedLists:w=(()=>{})})=>{const[g,k]=(0,s.useState)(!1),[m,b]=(0,s.useState)(!1),[j,y]=r.JL.useObjectState({});(0,s.useEffect)((()=>{const e=t?.newspack_newsletters_service_provider||"";l!==e&&(b(!1),c(e),!l&&E()?w(!1):w(!0))}),[t?.newspack_newsletters_service_provider]),(0,s.useEffect)((()=>{S(t?.newspack_newsletters_service_provider)}),[t?.newspack_newsletters_service_provider]);const S=e=>{d(!1),e&&"constant_contact"===e&&(k(!0),v()({path:`/newspack-newsletters/v1/${e}/verify_token`}).then((e=>{!e.valid&&e.auth_url?d(e.auth_url):d(!1)})).catch((()=>{d(!1)})).finally((()=>{k(!1)})))},C=t=>{y(t),e&&e(p()(t.settings,u()("value")))},L=()=>{b(!1),v()({path:"/newspack/v1/wizard/newspack-newsletters/settings"}).then(C).catch(b)},O=()=>{const e=j.settings.newspack_newsletters_service_provider,t=e?.value;return e?.options?.find((e=>e.value===t))?.name},E=()=>{const e=t?.newspack_newsletters_service_provider;if(!e)return!1;const n=new RegExp(`${e}.*key`);return Object.keys(t).filter((e=>n.test(e))).some((e=>!!t[e]))},T=()=>{a&&(window.open(a,"esp_oauth","width=500,height=600").opener={verify:_()((()=>{window.location.reload()}))})},P=async()=>{b(!1),k(!0),v()({path:"/newspack/v1/wizard/newspack-newsletters/settings",method:"POST",data:t}).finally((()=>{c(t?.newspack_newsletters_service_provider),S(t?.newspack_newsletters_service_provider),w(!1),k(!1)}))};(0,s.useEffect)(L,[]);const z=e=>({disabled:g,value:j.settings[e]?.value||"",checked:Boolean(j.settings[e]?.value),label:j.settings[e]?.description,placeholder:j.settings[e]?.placeholder,options:j.settings[e]?.options?.map((e=>({value:e.value,label:e.name})))||null,onChange:t=>C({settings:{[e]:{value:t}}})});return!m&&h()(j)?(0,f.jsx)("div",{className:"flex justify-around mt4",children:(0,f.jsx)(r.E$,{})}):(0,f.jsxs)(f.Fragment,{children:[!1===j.configured&&(0,f.jsx)(r.I2,{plugins:["newspack-newsletters"],withoutFooterButton:!0,onStatus:({complete:e})=>e&&L()}),!0===j.configured&&(()=>{const e=z("newspack_newsletters_service_provider");return(0,f.jsx)(r.Lz,{isMedium:!0,title:(0,i.__)("Email Service Provider","newspack-plugin"),description:(0,i.__)("Connect an email service provider (ESP) to author and send newsletters.","newspack-plugin"),notification:m?m?.message||(0,i.__)("Something went wrong.","newspack-plugin"):null,notificationLevel:"error",hasGreyHeader:!0,actionContent:(0,f.jsx)(r.$n,{disabled:g,variant:"primary",onClick:P,children:(0,i.__)("Save Settings","newspack-plugin")}),disabled:g,children:(0,f.jsxs)(r.xA,{gutter:16,columns:1,children:[!1!==a&&(0,f.jsxs)(r.Zp,{isSmall:!0,children:[(0,f.jsx)("h3",{children:(0,i.__)("Authorize Application","newspack-plugin")}),(0,f.jsx)("p",{children:(0,i.sprintf)(
// translators: %s is the name of the ESP.
// translators: %s is the name of the ESP.
(0,i.__)("Authorize %s to connect to Newspack.","newspack-plugin"),O())}),(0,f.jsx)(r.$n,{isSecondary:!0,onClick:T,children:(0,i.__)("Authorize","newspack-plugin")})]}),"campaign_monitor"===j?.settings?.newspack_newsletters_service_provider?.value&&(0,f.jsxs)(x.Notice,{status:"warning",isDismissible:!1,children:[(0,f.jsx)("h2",{children:(0,i.__)("Campaign Monitor support will be deprecated","newspack-plugin")}),(0,f.jsx)("p",{children:(0,i.__)("Please connect a different service provider to ensure continued support.","newspack-")})]}),o()(j.settings).filter((t=>!t.provider||t.provider===e.value)).map((e=>{if(n&&!e.onboarding)return null;switch(e.type){case"select":return(0,f.jsx)(r.Yq,{...z(e.key)},e.key);case"checkbox":return(0,f.jsx)(x.CheckboxControl,{...z(e.key)},e.key);default:return(0,f.jsxs)(r.xA,{columns:1,gutter:8,children:[(0,f.jsx)(r.xt,{...z(e.key)}),e.help&&e.helpURL&&(0,f.jsx)("p",{children:(0,f.jsx)(x.ExternalLink,{href:e.helpURL,children:e.help})})]},e.key)}}))]})})})()]})},b=({lockedLists:e,onUpdate:t,provider:n})=>{const[a,l]=(0,s.useState)(!1),[o,c]=(0,s.useState)(!1),[p,d]=(0,s.useState)([]),u=e=>{d(e),"function"==typeof t&&t(e)},w=(e,t)=>n=>{const s=[...p];s[e][t]=n,u(s)};if((0,s.useEffect)((()=>{l(!1),n&&!e&&(d([]),l(!1),c(!0),v()({path:"/newspack-newsletters/v1/lists"}).then(u).catch(l).finally((()=>c(!1))))}),[n,e]),!o&&!p?.length&&!a)return null;if(o&&!p?.length&&!a)return(0,f.jsx)("div",{className:"flex justify-around mt4",children:(0,f.jsx)(r.E$,{})});const h=e?(0,i.__)("Please save your ESP settings before changing your subscription lists.","newspack-plugin"):a?a?.message||(0,i.__)("Something went wrong.","newspack-plugin"):null;return(0,f.jsx)(r.Lz,{isMedium:!0,title:(0,i.__)("Subscription Lists","newspack-plugin"),description:(0,i.__)("Manage the lists available to readers for subscription.","newspack-plugin"),notification:h,notificationLevel:a?"error":"warning",hasGreyHeader:!0,actionContent:(0,f.jsxs)(f.Fragment,{children:[newspack_newsletters_wizard.new_subscription_lists_url&&(0,f.jsx)(r.$n,{variant:"secondary",disabled:o||e,href:newspack_newsletters_wizard.new_subscription_lists_url,children:(0,i.__)("Add New","newspack-plugin")}),(0,f.jsx)(r.$n,{isPrimary:!0,onClick:()=>{l(!1),c(!0),v()({path:"/newspack-newsletters/v1/lists",method:"post",data:{lists:p}}).then(u).catch(l).finally((()=>c(!1)))},disabled:o||e,children:(0,i.__)("Save Subscription Lists","newspack-plugin")})]}),disabled:o||e,children:!e&&!a&&p.map(((e,t)=>(0,f.jsx)(r.Lz,{isSmall:!0,simple:!0,hasWhiteHeader:!0,title:e.name,description:e?.type_label?e.type_label:null,disabled:o,toggleOnChange:w(t,"active"),toggleChecked:e.active,className:e?.id&&(e.id.startsWith("group")||e.id.startsWith("tag"))?"newspack-newsletters-sub-list-item":"",actionText:e?.edit_link?(0,f.jsx)(x.ExternalLink,{href:e.edit_link,children:(0,i.__)("Edit","newspack-plugin")}):null,children:e.active&&"local"!==e?.type&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(r.xt,{label:(0,i.__)("List title","newspack-plugin"),value:e.title,disabled:o||"local"===e?.type,onChange:w(t,"title")}),(0,f.jsx)(x.TextareaControl,{label:(0,i.__)("List description","newspack-plugin"),value:e.description,disabled:o||"local"===e?.type,onChange:w(t,"description")})]})},t)))})},j=()=>{const[{newslettersConfig:e},t]=r.JL.useObjectState({}),[n,a]=(0,s.useState)(""),[l,o]=(0,s.useState)(!1),[c,p]=(0,s.useState)(!1);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("h1",{children:(0,i.__)("Settings","newspack-plugin")}),(0,f.jsx)(m,{isOnboarding:!1,onUpdate:e=>t({newslettersConfig:e}),authUrl:c,newslettersConfig:e,provider:n,setProvider:a,setAuthUrl:p,setLockedLists:o}),(0,f.jsx)(b,{lockedLists:l,provider:n})]})},y=(0,r.c_)((()=>(0,f.jsx)(j,{}))),S="/newspack/v1/wizard/newspack-newsletters/settings/tracking",C=(0,r.c_)((()=>{const[e,t]=(0,s.useState)(!1),[n,a]=(0,s.useState)({}),l=e=>async s=>{const i={...n,[e]:s};t(!0),v()({path:S,method:"POST",data:i}).then((()=>{a(i)})).finally((()=>{t(!1)}))};return(0,s.useEffect)((()=>{t(!0),v()({path:S}).then((e=>{a(e)})).finally((()=>{t(!1)}))}),[]),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("h1",{children:(0,i.__)("Tracking","newspack-plugin")}),(0,f.jsx)(r.Lz,{title:(0,i.__)("Click-tracking","newspack-plugin"),description:(0,i.__)("Track the clicks on the links in your newsletter.","newspack-plugin"),disabled:e,toggleOnChange:l("click"),toggleChecked:n.click}),(0,f.jsx)(r.Lz,{title:(0,i.__)("Tracking pixel","newspack-plugin"),description:(0,i.__)("Track the opens of your newsletter.","newspack-plugin"),disabled:e,toggleOnChange:l("pixel"),toggleChecked:n.pixel})]})})),{HashRouter:L,Redirect:O,Route:E,Switch:T}=a.A;class P extends s.Component{render(){const{pluginRequirements:e}=this.props,t=[{label:(0,i.__)("Settings","newspack-plugin"),path:"/"},{label:(0,i.__)("Tracking","newspack-plugin"),path:"/tracking"}];return(0,f.jsx)(s.Fragment,{children:(0,f.jsx)(L,{hashType:"slash",children:(0,f.jsxs)(T,{children:[e,(0,f.jsx)(E,{path:"/",exact:!0,render:()=>(0,f.jsx)(y,{headerText:(0,i.__)("Newsletters / Settings","newspack-plugin"),tabbedNavigation:t})}),(0,f.jsx)(E,{path:"/tracking",render:()=>(0,f.jsx)(C,{headerText:(0,i.__)("Newsletters / Tracking","newspack-plugin"),tabbedNavigation:t})}),(0,f.jsx)(O,{to:"/"})]})})})}}(0,s.render)((0,s.createElement)((0,r.Aq)(P,["newspack-newsletters"])),document.getElementById("newspack-newsletters"))},1609:e=>{e.exports=window.React},790:e=>{e.exports=window.ReactJSXRuntime},1455:e=>{e.exports=window.wp.apiFetch},6427:e=>{e.exports=window.wp.components},7143:e=>{e.exports=window.wp.data},6087:e=>{e.exports=window.wp.element},2619:e=>{e.exports=window.wp.hooks},8537:e=>{e.exports=window.wp.htmlEntities},7723:e=>{e.exports=window.wp.i18n},8558:e=>{e.exports=window.wp.keycodes},5573:e=>{e.exports=window.wp.primitives},3832:e=>{e.exports=window.wp.url}},n={};function s(e){var i=n[e];if(void 0!==i)return i.exports;var r=n[e]={id:e,loaded:!1,exports:{}};return t[e](r,r.exports,s),r.loaded=!0,r.exports}s.m=t,e=[],s.O=(t,n,i,r)=>{if(!n){var a=1/0;for(p=0;p<e.length;p++){for(var[n,i,r]=e[p],l=!0,o=0;o<n.length;o++)(!1&r||a>=r)&&Object.keys(s.O).every((e=>s.O[e](n[o])))?n.splice(o--,1):(l=!1,r<a&&(a=r));if(l){e.splice(p--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var p=e.length;p>0&&e[p-1][2]>r;p--)e[p]=e[p-1];e[p]=[n,i,r]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),s.j=841,(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=n[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={841:0};s.O.j=t=>0===e[t];var t=(t,n)=>{var i,r,[a,l,o]=n,c=0;if(a.some((t=>0!==e[t]))){for(i in l)s.o(l,i)&&(s.m[i]=l[i]);if(o)var p=o(s)}for(t&&t(n);c<a.length;c++)r=a[c],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(p)},n=globalThis.webpackChunknewspack=globalThis.webpackChunknewspack||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=s.O(void 0,[223],(()=>s(1452)));i=s.O(i)})();