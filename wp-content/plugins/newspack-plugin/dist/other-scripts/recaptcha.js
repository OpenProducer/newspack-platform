(()=>{"use strict";function e(e){"undefined"!=typeof document&&("complete"!==document.readyState&&"interactive"!==document.readyState?document.addEventListener("DOMContentLoaded",e):e())}window.newspack_grecaptcha=window.newspack_grecaptcha||{destroy:function(e=[]){a&&(e.length?e:[...document.querySelectorAll("form[data-newspack-recaptcha]")]).forEach((e=>{!function(e){const t=e.querySelector('input[name="g-recaptcha-response"]');t&&t.parentElement.removeChild(t)}(e)}))},render:d,version:newspack_recaptcha_data.version};const t="v2"===newspack_recaptcha_data.version.substring(0,2),a="v3"===newspack_recaptcha_data.version,c=newspack_recaptcha_data.site_key,n="v2_invisible"===newspack_recaptcha_data.version;function r(e,t="submit"){if(e)return grecaptcha.execute(c,{action:t}).then((t=>{e.value=t}))}function o(e){let t=e.querySelector('input[name="g-recaptcha-response"]');if(!t){t=document.createElement("input"),t.type="hidden",t.name="g-recaptcha-response",e.appendChild(t);const a=e.getAttribute("data-newspack-recaptcha")||"submit";r(t,a),setInterval((()=>r(t,a)),3e4),jQuery&&(jQuery(document).on("updated_checkout",(()=>r(t,a))),jQuery(document.body).on("checkout_error",(()=>r(t,a))))}}function i(e){const t=parseInt(e.getAttribute("data-recaptcha-widget-id"));isNaN(t)||grecaptcha.reset(t)}function s(e,t=null,a=null){const r={sitekey:c,size:n?"invisible":"normal",isolated:!0};[...e.querySelectorAll('input[type="submit"], button[type="submit"]')].forEach((c=>{if(c.hasAttribute("data-skip-recaptcha"))return;if(c.hasAttribute("data-recaptcha-widget-id"))return void i(c);const n=()=>{t?.(),e.requestSubmit(c),i(c)},o=()=>{const t=parseInt(c.getAttribute("data-recaptcha-retry-count"))||0;if(t<3)i(c),grecaptcha.execute(c.getAttribute("data-recaptcha-widget-id")),c.setAttribute("data-recaptcha-retry-count",t+1);else{const t=wp.i18n.__("There was an error connecting with reCAPTCHA. Please reload the page and try again.","newspack-plugin");a?a(t):function(e,t){const a=document.createElement("p");a.textContent=t;const c=document.createElement("div");c.classList.add("newspack-recaptcha-error"),c.appendChild(a),e.parentElement.classList.contains("newspack-newsletters-subscribe")?e.append(c):(c.classList.add("newspack-ui__notice","newspack-ui__notice--error"),e.insertBefore(c,e.firstChild))}(e,t)}},d=document.createElement("div");d.classList.add("grecaptcha-container"),c.parentElement.append(d);const u=grecaptcha.render(d,{...r,callback:n,"error-callback":o,"expired-callback":o});c.setAttribute("data-recaptcha-widget-id",u),jQuery&&(jQuery(document).on("updated_checkout",(()=>s(e,t,a))),jQuery(document.body).on("checkout_error",(()=>s(e,t,a)))),c.addEventListener("click",(t=>{t.preventDefault(),t.stopImmediatePropagation(),function(e){const t=e.querySelectorAll(".newspack-recaptcha-error");for(const e of t)e.parentElement.removeChild(e)}(e),c.hasAttribute("data-skip-recaptcha")?n():grecaptcha.execute(u).then((()=>{window?.location!==window?.parent?.location&&document.body.scrollIntoView({behavior:"smooth"})}))}))}))}function d(c=[],n=null,r=null){if(!grecaptcha)return e((()=>grecaptcha.ready((()=>d(c,n,r)))));(c.length?c:[...document.querySelectorAll("form[data-newspack-recaptcha]")]).forEach((e=>{e.hasAttribute("data-recaptcha-rendered")?(t&&s(e,n,r),a&&o(e)):(e.addEventListener("focusin",(()=>{t&&s(e,n,r),a&&o(e)})),e.setAttribute("data-recaptcha-rendered","true"))}))}e((function(){grecaptcha.ready(d)}))})();