(()=>{"use strict";var e,s={1020:(e,s,t)=>{var n=t(7723),i=t(6087),o=t(7143),r=t(6427);const a=window.wp.editor,l=window.wp.plugins,d=window.wp.date;var p=t(1455),c=t.n(p),u=t(790);const h="deleted",g=({postId:e,postStatus:s})=>{const[t,o]=(0,i.useState)(!0),[l,p]=(0,i.useState)(null),[g,_]=(0,i.useState)(null),[w,b]=(0,i.useState)(null),[m,f]=(0,i.useState)(null),j=async()=>{try{o(!0),b(null);const s=await c()({path:`/newspack/v1/nextdoor/post-status/${e}`});_(s)}catch(e){b(e.message||(0,n.__)("Failed to load Nextdoor status.","newspack-plugin"))}finally{o(!1)}},v=async(e,s,t)=>{try{p(s),b(null),f(null);const n=await c()({path:e,method:s});n.success?(f(n.message||t.success),await j()):b(n.message||t.error)}catch(e){b(e.message||(0,n.__)("Failed to communicate with Nextdoor.","newspack-plugin"))}finally{p(null),k()}},k=()=>{setTimeout((()=>{b(null),f(null)}),5e3)},y=e=>{if(!e)return"";const s=(0,d.getSettings)().formats.datetimeAbbreviated||"Y-m-d g:i a";return(0,d.dateI18n)(s,e)};return(0,i.useEffect)((()=>{e&&j()}),[e]),(0,u.jsx)(a.PluginSidebar,{name:"nextdoor-publish",title:(0,n.__)("Nextdoor","newspack-plugin"),icon:x,className:"nextdoor-post-plugin",children:t?(0,u.jsxs)(r.Flex,{justify:"center",className:"nextdoor-sidebar__loading",children:[(0,u.jsx)(r.FlexItem,{children:(0,u.jsx)(r.Spinner,{})}),(0,u.jsx)(r.FlexItem,{children:(0,u.jsx)("p",{children:(0,n.__)("Loading Nextdoor status…","newspack-plugin")})})]}):g?.can_publish?"publish"!==s?(0,u.jsx)(r.Notice,{status:"info",isDismissible:!1,children:(0,n.__)("Post must be published before sharing to Nextdoor.","newspack-plugin")}):(0,u.jsxs)(u.Fragment,{children:[w&&(0,u.jsx)(r.Notice,{status:"error",isDismissible:!1,children:w}),m&&(0,u.jsx)(r.Notice,{status:"success",isDismissible:!1,children:m}),g?.is_shared?(0,u.jsxs)(r.Panel,{children:[(0,u.jsx)(r.PanelHeader,{children:(0,u.jsxs)("p",{className:"nextdoor-sidebar__status-header",children:[(0,n.__)("Status:","newspack-plugin")," ",g.ingestion_status]})}),(0,u.jsxs)(r.PanelBody,{children:[(0,u.jsxs)("div",{className:"nextdoor-sidebar__status-text",children:["valid"===g.ingestion_status&&(0,u.jsx)("p",{children:(0,n.__)("This post is available in your Nextdoor community.","newspack-plugin")}),"invalid"===g.ingestion_status&&g.ingestion_errors?.length>0&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("p",{children:(0,n.__)("This post could not be published on Nextdoor for the following reasons:","newspack-plugin")}),(0,u.jsx)("ul",{className:"nextdoor-sidebar__error-list",children:g.ingestion_errors.map(((e,s)=>(0,u.jsx)("li",{children:e},s)))}),(0,u.jsx)("p",{children:(0,n.__)("Please refer to the Publisher policy on Nextdoor for content guidelines.","newspack-plugin")})]}),"unprocessed"===g.ingestion_status&&(0,u.jsx)("p",{children:(0,n.__)("This post is being processed by Nextdoor. It may take a while (~1 Hour) as Nextdoor runs ML models on it for its distribution and moderation before it starts appearing on the page profile.","newspack-plugin")}),h===g.ingestion_status&&(0,u.jsx)("p",{children:(0,n.__)("This post was removed from Nextdoor.","newspack-plugin")})]}),g.shared_at&&(0,u.jsxs)("p",{className:"nextdoor-sidebar__status-text nextdoor-sidebar__status-text--default",children:[(0,u.jsx)("strong",{children:(0,n.__)("Shared:","newspack-plugin")})," ",y(g.shared_at)]}),g.updated_at&&(0,u.jsxs)("p",{className:"nextdoor-sidebar__status-text nextdoor-sidebar__status-text--default",children:[(0,u.jsx)("strong",{children:(0,n.__)("Updated:","newspack-plugin")})," ",y(g.updated_at)]}),h!==g.ingestion_status&&(0,u.jsxs)("div",{className:"nextdoor-sidebar__actions",children:[(0,u.jsx)(r.Button,{variant:"primary",onClick:()=>{v(`/newspack/v1/nextdoor/update-post/${e}`,"PUT",{success:(0,n.__)("Update sent to Nextdoor.","newspack-plugin"),error:(0,n.__)("Failed to update.","newspack-plugin")})},isBusy:"update"===l,disabled:"update"===l||"delete"===l,size:"small",children:"update"===l?(0,n.__)("Updating…","newspack-plugin"):(0,n.__)("Update","newspack-plugin")}),(0,u.jsx)(r.Button,{variant:"secondary",isDestructive:!0,onClick:()=>{v(`/newspack/v1/nextdoor/delete-post/${e}`,"DELETE",{success:(0,n.__)("Post removed from Nextdoor.","newspack-plugin"),error:(0,n.__)("Failed to remove post.","newspack-plugin")})},isBusy:"delete"===l,disabled:"update"===l||"delete"===l,size:"small",children:"delete"===l?(0,n.__)("Removing…","newspack-plugin"):(0,n.__)("Remove","newspack-plugin")})]})]})]}):(0,u.jsx)(r.Panel,{children:(0,u.jsxs)(r.PanelBody,{children:[(0,u.jsx)("p",{className:"nextdoor-sidebar__description",children:(0,n.__)("Share this post to your Nextdoor community to engage local readers.","newspack-plugin")}),(0,u.jsx)(r.Button,{variant:"primary",onClick:()=>{v(`/newspack/v1/nextdoor/publish-post/${e}`,"POST",{success:(0,n.__)("Published to Nextdoor.","newspack-plugin"),error:(0,n.__)("Failed to publish.","newspack-plugin")})},isBusy:"publish"===l,disabled:"publish"===l,children:"publish"===l?(0,n.__)("Publishing…","newspack-plugin"):(0,n.__)("Publish on Nextdoor","newspack-plugin")})]})})]}):(0,u.jsx)(r.Notice,{status:"warning",isDismissible:!1,children:(0,n.__)("You do not have permission to publish to Nextdoor. Please contact the site administrator.","newspack-plugin")})})},x=(0,u.jsx)(r.SVG,{xmlns:"http://www.w3.org/2000/svg","enable-background":"new 0 0 24 24",viewBox:"0 0 24 24",id:"nextdoor",children:(0,u.jsx)("polygon",{points:"19.879 21.5 19.879 11.703 22.039 13.014 24 9.821 12.001 2.5 7.88 5.017 7.88 2.5 4.122 2.5 4.122 7.305 0 9.821 1.962 13.014 4.123 11.703 4.123 21.5"})});(0,l.registerPlugin)("newspack-nextdoor-post-plugin",{render:()=>{const{postId:e,postStatus:s}=(0,o.useSelect)((e=>{const{getCurrentPostId:s,getCurrentPostAttribute:t}=e("core/editor");return{postId:s(),postStatus:t("status")}}),[]);return(0,u.jsx)(g,{postId:e,postStatus:s})},icon:x})},790:e=>{e.exports=window.ReactJSXRuntime},1455:e=>{e.exports=window.wp.apiFetch},6427:e=>{e.exports=window.wp.components},7143:e=>{e.exports=window.wp.data},6087:e=>{e.exports=window.wp.element},7723:e=>{e.exports=window.wp.i18n}},t={};function n(e){var i=t[e];if(void 0!==i)return i.exports;var o=t[e]={id:e,loaded:!1,exports:{}};return s[e](o,o.exports,n),o.loaded=!0,o.exports}n.m=s,e=[],n.O=(s,t,i,o)=>{if(!t){var r=1/0;for(p=0;p<e.length;p++){for(var[t,i,o]=e[p],a=!0,l=0;l<t.length;l++)(!1&o||r>=o)&&Object.keys(n.O).every((e=>n.O[e](t[l])))?t.splice(l--,1):(a=!1,o<r&&(r=o));if(a){e.splice(p--,1);var d=i();void 0!==d&&(s=d)}}return s}o=o||0;for(var p=e.length;p>0&&e[p-1][2]>o;p--)e[p]=e[p-1];e[p]=[t,i,o]},n.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return n.d(s,{a:s}),s},n.d=(e,s)=>{for(var t in s)n.o(s,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:s[t]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.j=384,(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var s=n.g.document;if(!e&&s&&(s.currentScript&&(e=s.currentScript.src),!e)){var t=s.getElementsByTagName("script");if(t.length)for(var i=t.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=t[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e+"../"})(),(()=>{var e={384:0};n.O.j=s=>0===e[s];var s=(s,t)=>{var i,o,[r,a,l]=t,d=0;if(r.some((s=>0!==e[s]))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(l)var p=l(n)}for(s&&s(t);d<r.length;d++)o=r[d],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(p)},t=globalThis.webpackChunknewspack=globalThis.webpackChunknewspack||[];t.forEach(s.bind(null,0)),t.push=s.bind(null,t.push.bind(t))})();var i=n.O(void 0,[223],(()=>n(1020)));i=n.O(i)})();