(()=>{"use strict";var e,t={4049:(e,t,n)=>{n.r(t),n(5674);var a=n(9307),s=n(5736),i=n(3520),r=n(9674);const l=s.__;class o extends a.Component{render(){return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(i.fM,{title:l("Google Analytics"),description:l("Configure and view site analytics"),actionText:l("View"),handoff:"google-site-kit",editLink:newspack_analytics_wizard_data.analyticsConnectionError?void 0:"admin.php?page=googlesitekit-module-analytics"}))}}const c=(0,i.a4)(o);var d=n(4942);const m=s.__,p=[{value:"HIT",label:m("Hit","newspack")},{value:"SESSION",label:m("Session","newspack")},{value:"USER",label:m("User","newspack")},{value:"PRODUCT",label:m("Product","newspack")}];class u extends a.Component{constructor(){super(...arguments),(0,d.Z)(this,"state",{error:newspack_analytics_wizard_data.analyticsConnectionError,customDimensions:newspack_analytics_wizard_data.customDimensions,newDimensionName:"",newDimensionScope:p[0].value}),(0,d.Z)(this,"handleAPIError",(e=>{let{message:t}=e;this.setState({error:t})})),(0,d.Z)(this,"handleCustomDimensionCreation",(()=>{const{wizardApiFetch:e}=this.props,{customDimensions:t,newDimensionName:n,newDimensionScope:a}=this.state;e({path:"/newspack/v1/wizard/analytics/custom-dimensions",method:"POST",data:{name:n,scope:a}}).then((e=>{this.setState({customDimensions:[...t,e]})})).catch(this.handleAPIError)})),(0,d.Z)(this,"handleCustomDimensionSetting",(e=>t=>{const{wizardApiFetch:n}=this.props;n({path:`/newspack/v1/wizard/analytics/custom-dimensions/${e}`,method:"POST",data:{role:t}}).then((e=>{this.setState({customDimensions:e})})).catch(this.handleAPIError)}))}render(){const{error:e,customDimensions:t,newDimensionName:n,newDimensionScope:s}=this.state;return(0,a.createElement)("div",{className:"newspack__analytics-configuration"},(0,a.createElement)(i.M$,{title:m("User-defined custom dimensions","newspack"),description:m("Collect and analyze data that Google Analytics doesn't automatically track","newspack")}),e?(0,a.createElement)(i.qX,{noticeText:e,isError:!0,rawHTML:!0}):(0,a.createElement)(a.Fragment,null,(0,a.createElement)("table",null,(0,a.createElement)("thead",null,(0,a.createElement)("tr",null,[m("Name","newspack"),m("ID","newspack"),m("Role","newspack")].map(((e,t)=>(0,a.createElement)("th",{key:t},e))))),(0,a.createElement)("tbody",null,t.map((e=>(0,a.createElement)("tr",{key:e.id},(0,a.createElement)("td",null,e.name),(0,a.createElement)("td",null,(0,a.createElement)("code",null,e.id)),(0,a.createElement)("td",null,(0,a.createElement)(i.Yw,{options:newspack_analytics_wizard_data.customDimensionsOptions,value:e.role||"",onChange:this.handleCustomDimensionSetting(e.id),className:"newspack__analytics-configuration__select"}))))))),(0,a.createElement)(i.M$,{title:m("Create new custom dimension","newspack")}),(0,a.createElement)(i.rj,{columns:1,gutter:16},(0,a.createElement)(i.rj,{rowGap:16},(0,a.createElement)(i.w4,{value:n,onChange:e=>this.setState({newDimensionName:e}),label:m("Name","newspack")}),(0,a.createElement)(i.Yw,{value:s,onChange:e=>this.setState({newDimensionScope:e}),label:m("Scope","newspack"),options:p})),(0,a.createElement)("div",{className:"flex justify-end"},(0,a.createElement)(i.zx,{onClick:this.handleCustomDimensionCreation,disabled:0===n.length,variant:"primary"},m("Save","newspack"))))))}}const h=(0,i.a4)(u);var w=n(2819),E=n(5609),v=n(1984),g=n(8184),k=n(4184),b=n.n(k);const _=s.__,y=[{value:"click",label:_("Click","newspack")},{value:"submit",label:_("Submit","newspack")}],C={event_name:"",event_category:"",event_label:"",on:y[0].value,element:"",amp_element:"",non_interaction:!0,is_active:!0},f="/newspack/v1/wizard/analytics/ntg";class S extends a.Component{constructor(){super(...arguments),(0,d.Z)(this,"state",{error:newspack_analytics_wizard_data.analyticsConnectionError,customEvents:newspack_analytics_wizard_data.customEvents,editedEvent:C,editedEventId:null,ntgEventsStatus:{}}),(0,d.Z)(this,"handleAPIError",(e=>{let{message:t}=e;return this.setState({error:t})})),(0,d.Z)(this,"updateCustomEvents",(e=>{const{wizardApiFetch:t}=this.props;t({path:"/newspack/v1/wizard/analytics/custom-events",method:"POST",data:{events:e}}).then((e=>{let{events:t}=e;return this.setState({customEvents:t,editedEvent:C,editedEventId:null})})).catch(this.handleAPIError)})),(0,d.Z)(this,"handleCustomEventEdit",(()=>{const{customEvents:e,editedEvent:t,editedEventId:n}=this.state;"new"===n?this.updateCustomEvents([...e,t]):this.updateCustomEvents(e.map((e=>e.id===n?t:e)))})),(0,d.Z)(this,"updateEditedEvent",(e=>t=>this.setState((n=>{let{editedEvent:a}=n;return{editedEvent:{...a,[e]:t}}})))),(0,d.Z)(this,"setEditModal",(e=>()=>{const t=null!==e&&(0,w.find)(this.state.customEvents,["id",e]);this.setState({editedEventId:e,...t?{editedEvent:t}:{editedEvent:C}})}))}componentDidMount(){this.props.wizardApiFetch({path:f}).then((e=>this.setState({ntgEventsStatus:e})))}render(){const{error:e,customEvents:t,editedEvent:n,editedEventId:s}=this.state,{isLoading:r}=this.props,l="new"===s;return(0,a.createElement)("div",{className:"newspack__analytics-configuration"},(0,a.createElement)("div",{className:"newspack__analytics-configuration__header"},(0,a.createElement)(i.M$,{title:_("User-defined custom events","newspack"),description:_("Collect and analyze specific user interactions","newspack"),noMargin:!0}),(0,a.createElement)(i.zx,{onClick:this.setEditModal("new"),variant:"primary"},_("Add New Custom Event","newspack"))),(0,a.createElement)(i.qX,{rawHTML:!0,isInfo:!0,noticeText:`${_("This is an advanced feature, read more about it on our","newspack")} <a href="https://newspack.pub/support/analytics">${_("support page","newspack")}</a>.`}),e?(0,a.createElement)(i.qX,{noticeText:e,isError:!0,rawHTML:!0}):(0,a.createElement)(a.Fragment,null,(0,a.createElement)("table",null,(0,a.createElement)("thead",null,(0,a.createElement)("tr",null,[_("Active","newspack"),_("Action","newspack"),_("Category","newspack"),_("Label","newspack"),_("Trigger","newspack"),_("Edit","newspack")].map(((e,t)=>(0,a.createElement)("th",{key:t},e))))),(0,a.createElement)("tbody",null,t.map((e=>(0,a.createElement)("tr",{key:e.id},(0,a.createElement)("td",null,(0,a.createElement)("span",{className:b()("newspack-checkbox-icon",e.is_active&&"newspack-checkbox-icon--checked")},e.is_active&&(0,a.createElement)(v.Z,{icon:g.Z}))),(0,a.createElement)("td",null,e.event_name),(0,a.createElement)("td",null,e.event_category),(0,a.createElement)("td",null,e.event_label),(0,a.createElement)("td",null,(0,a.createElement)("code",null,e.on)),(0,a.createElement)("td",null,(0,a.createElement)(i.zx,{variant:"link",onClick:this.setEditModal(e.id)},_("Edit","newspack")))))))),null!==s&&(0,a.createElement)(i.u_,{title:_(l?"Add New Custom Event":"Editing Custom Event","newspack"),onRequestClose:this.setEditModal(null)},(0,a.createElement)(a.Fragment,null,(0,a.createElement)(i.rj,{gutter:32,rowGap:16},(0,a.createElement)(i.w4,{disabled:r,value:n.event_name,onChange:this.updateEditedEvent("event_name"),label:_("Action","newspack"),required:!0}),(0,a.createElement)(i.w4,{disabled:r,value:n.event_category,onChange:this.updateEditedEvent("event_category"),label:_("Category","newspack"),required:!0}),(0,a.createElement)(i.w4,{disabled:r,value:n.event_label,onChange:this.updateEditedEvent("event_label"),label:_("Label","newspack")}),(0,a.createElement)(i.Yw,{disabled:r,value:n.on,onChange:this.updateEditedEvent("on"),label:_("Trigger","newspack"),options:y,required:!0}),(0,a.createElement)(i.w4,{disabled:r,value:n.element,onChange:this.updateEditedEvent("element"),label:_("Selector","newspack"),className:"code",required:!0}),(0,a.createElement)(i.w4,{disabled:r,value:n.amp_element,onChange:this.updateEditedEvent("amp_element"),label:_("AMP Selector","newspack"),className:"code"})),(0,a.createElement)(E.CheckboxControl,{disabled:r,checked:n.non_interaction,onChange:this.updateEditedEvent("non_interaction"),label:_("Non-interaction event","newspack")}),(0,a.createElement)(E.CheckboxControl,{disabled:r,checked:n.is_active,onChange:this.updateEditedEvent("is_active"),label:_("Active","newspack")}),(0,a.createElement)(i.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},!l&&(0,a.createElement)(i.zx,{isSecondary:!0,disabled:r,onClick:()=>this.updateCustomEvents(this.state.customEvents.filter((e=>{let{id:t}=e;return n.id!==t})))},_("Delete","newspack")),(0,a.createElement)(i.zx,{onClick:this.handleCustomEventEdit,disabled:(o=n,!Boolean(o.event_name&&o.event_category&&o.on&&o.element)||r),isPrimary:!0},_(l?"Save":"Update","newspack")))))),(0,a.createElement)(i.fM,{isMedium:!0,title:_("News Tagging Guide custom events","newspack"),description:()=>(0,a.createElement)(a.Fragment,null,_("Free tool that helps you make the most of Google Analytics by capturing better data.","newspack")," ",(0,a.createElement)(E.ExternalLink,{href:"https://newsinitiative.withgoogle.com/training/datatools/ntg",key:"info-link"},_("More info","newspack"))),toggle:!0,disabled:void 0===this.state.ntgEventsStatus.enabled,toggleChecked:this.state.ntgEventsStatus.enabled,toggleOnChange:()=>this.props.wizardApiFetch({path:f,method:this.state.ntgEventsStatus.enabled?"DELETE":"POST",quiet:!0}).then((e=>this.setState({ntgEventsStatus:e})))}));var o}}const x=(0,i.a4)(S),T=s.__,{HashRouter:z,Redirect:D,Route:A,Switch:M}=r.Z,N=[{label:T("Plugins","newspack"),path:"/",exact:!0},{label:T("Custom Dimensions","newspack"),path:"/custom-dimensions"},{label:T("Custom Events","newspack"),path:"/custom-events"}];class O extends a.Component{render(){const{pluginRequirements:e,wizardApiFetch:t,isLoading:n}=this.props,s={headerText:T("Analytics","newspack"),subHeaderText:T("Track traffic and activity","newspack"),tabbedNavigation:N,wizardApiFetch:t,isLoading:n};return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(z,{hashType:"slash"},(0,a.createElement)(M,null,e,(0,a.createElement)(A,{path:"/custom-dimensions",exact:!0,render:()=>(0,a.createElement)(h,s)}),(0,a.createElement)(A,{path:"/custom-events",exact:!0,render:()=>(0,a.createElement)(x,s)}),(0,a.createElement)(A,{path:"/",exact:!0,render:()=>(0,a.createElement)(c,s)}),(0,a.createElement)(D,{to:"/"}))))}}(0,a.render)((0,a.createElement)((0,i.uF)(O,["google-site-kit"])),document.getElementById("newspack-analytics-wizard"))},9196:e=>{e.exports=window.React},2819:e=>{e.exports=window.lodash},6292:e=>{e.exports=window.moment},6989:e=>{e.exports=window.wp.apiFetch},5609:e=>{e.exports=window.wp.components},9818:e=>{e.exports=window.wp.data},9307:e=>{e.exports=window.wp.element},2694:e=>{e.exports=window.wp.hooks},2629:e=>{e.exports=window.wp.htmlEntities},5736:e=>{e.exports=window.wp.i18n},9630:e=>{e.exports=window.wp.keycodes},444:e=>{e.exports=window.wp.primitives},6483:e=>{e.exports=window.wp.url}},n={};function a(e){var s=n[e];if(void 0!==s)return s.exports;var i=n[e]={exports:{}};return t[e].call(i.exports,i,i.exports,a),i.exports}a.m=t,e=[],a.O=(t,n,s,i)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,s,i]=e[d],l=!0,o=0;o<n.length;o++)(!1&i||r>=i)&&Object.keys(a.O).every((e=>a.O[e](n[o])))?n.splice(o--,1):(l=!1,i<r&&(r=i));if(l){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[n,s,i]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.j=142,(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={142:0};a.O.j=t=>0===e[t];var t=(t,n)=>{var s,i,[r,l,o]=n,c=0;if(r.some((t=>0!==e[t]))){for(s in l)a.o(l,s)&&(a.m[s]=l[s]);if(o)var d=o(a)}for(t&&t(n);c<r.length;c++)i=r[c],a.o(e,i)&&e[i]&&e[i][0](),e[r[c]]=0;return a.O(d)},n=globalThis.webpackChunkwebpack=globalThis.webpackChunkwebpack||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=a.O(void 0,[351],(()=>a(4049)));s=a.O(s);var i=window;for(var r in s)i[r]=s[r];s.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})})();