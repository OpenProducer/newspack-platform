(()=>{"use strict";var e,t={992:(e,t,n)=>{var o=n(6427),s=n(6087),r=n(7143);const a=window.wp.editPost;var i=n(7723);const l=window.wp.plugins;var c=n(7677),d=n(5095);const p=window.wp.coreData;var u=n(790);const m={_fields:"id,name",context:"view"},k='\n\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n\t\t<path d="M13 11.8l6.1-6.3-1-1-6.1 6.2-6.1-6.2-1 1 6.1 6.3-6.5 6.7 1 1 6.5-6.6 6.5 6.6 1-1z" />\n\t</svg>\n',h=({token:e,onInsert:t})=>(0,u.jsxs)("span",{className:"components-form-token-field__token token-inline-block",children:[(0,u.jsx)("span",{className:"components-form-token-field__token-text",children:e.name}),(0,u.jsx)(o.Button,{className:"components-form-token-field__insert-token is-small has-icon token-inline-block__insert",onClick:t,children:(0,u.jsx)(c.A,{icon:d.A})})]}),b=({tokens:e,tokensInUse:t,insertToken:n})=>(0,u.jsx)("div",{className:"tokens",children:e.map((e=>!t.includes(e.id)&&(0,u.jsx)(h,{token:e,onInsert:()=>n(e)},e.id)))});(0,l.registerPlugin)("newspack-bylines-sidebar",{render:()=>{const[e,t]=(0,s.useState)([]),[n,l]=(0,s.useState)(null),c=(0,s.useRef)(null),{editPost:d}=(0,r.useDispatch)("core/editor"),{postId:h}=(0,r.useSelect)((e=>({postId:e("core/editor").getCurrentPostId()})),[]),w=function(e){const{postAuthor:t,coAuthors:n}=(0,r.useSelect)((t=>({postAuthor:t(p.store).getUser(t("core/editor").getEditedPostAttribute("author"),m),coAuthors:e&&t("cap/authors")?t("cap/authors").getAuthors(e):[]})));return n.length?n.filter((e=>"wpuser"===e.userType)).map((e=>({id:parseInt(e.id),name:e.display}))):[t]}(h),{getEditedPostAttribute:g}=(0,r.useSelect)((e=>e("core/editor"))),[f,y]=(0,s.useState)(!!g("meta")[newspackBylines.metaKeyActive]),[v,_]=(0,s.useState)(!1),x=g("meta")[newspackBylines.metaKeyByline],[S,A]=(0,s.useState)(x),j=(0,s.useCallback)((e=>{A((e=>{const t=e.cloneNode(!0);return t.querySelectorAll("span[data-token]").forEach((e=>{const t=e.dataset.token,n=e.querySelector("span"),o=n?n.innerText.trim():"";t&&o&&e.replaceWith(document.createTextNode(`[Author id=${t}]${o}[/Author]`))})),t.innerHTML})(e)),C(e)})),$=(0,s.useCallback)((()=>{A(x)}),[x]),T=(0,s.useCallback)((()=>{d({meta:{[newspackBylines.metaKeyByline]:S}})}),[S]),C=e=>{const n=[...e.querySelectorAll("span button[data-token]")].map((e=>Number(e.dataset.token)));t(n)},E=(0,s.useCallback)((e=>{e&&v&&(c.current=e,e.innerHTML=(e=>{const t=`<span id="token-$1" contenteditable="false" draggable="true" class="components-form-token-field__token token-inline-block author-token" data-token="$1">\n\t\t<span class="components-form-token-field__token-text">$2</span>\n\t\t<button\n\t\t\tclass="components-button components-form-token-field__remove-token token-inline-block__remove"\n\t\t\ttype="button"\n\t\t\tdata-token="$1"\n\t\t>\n\t\t\t${k}\n\t\t</button>\n\t</span>`;return e.replace(/\[Author id=(\d*)\](\D*)\[\/Author\]/g,t)})(x),e.addEventListener("blur",N),e.addEventListener("input",(()=>j(e))),e.addEventListener("click",(({target:t})=>{t.classList.contains("token-inline-block__remove")&&(t.closest(".token-inline-block").remove(),j(e))})),C(e))}),[v]),N=()=>{const{current:e}=c,t=e.ownerDocument.getSelection().getRangeAt(0),n=t.cloneRange();n.selectNodeContents(e),n.setEnd(t.endContainer,t.endOffset);const o=e.ownerDocument.createElement("div");o.appendChild(n.cloneContents()),l(o.innerHTML.length)},B=(0,s.useMemo)((()=>(0,u.jsx)("div",{contentEditable:!0,className:"newspack-byline-textarea",ref:E})),[v]);return(0,u.jsxs)(a.PluginDocumentSettingPanel,{className:"newspack-byline",name:"newspack-byline-settings-panel",title:(0,i.__)("Byline","newspack-plugin"),children:[(0,u.jsx)(o.ToggleControl,{className:"newspack-byline-toggle",checked:f,help:(0,i.__)("Provides flexibility in defining how the byline appears.","newspack-plugin"),label:(0,i.__)("Enable custom byline","newspack-plugin"),onChange:()=>{return e=!f,d({meta:{[newspackBylines.metaKeyActive]:e}}),y(e),void(x||(()=>{let e;w.forEach(((t,n)=>{0===n?e="By":n===w.length-1?e=w.length>2?e+", and":e+" and":e+=",",e+=` [Author id=${t.id}]${t.name}[/Author]`})),e&&d({meta:{[newspackBylines.metaKeyByline]:e}})})());var e}}),f&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("p",{className:"description newspack-byline-preview",dangerouslySetInnerHTML:{__html:(O=x,O.replace(/\[Author id=(\d*)\](\D*)\[\/Author\]/g,'<span class="newspack-byline-author" id="token-$1" data-token="$1">$2</span>'))}}),(0,u.jsx)(o.Button,{className:"newspack-byline-customize-btn",variant:"secondary",onClick:()=>_(!0),children:(0,i.__)("Edit byline","newspack-plugin")}),v&&(0,u.jsxs)(o.Modal,{className:"newspack-byline-customize-modal",title:(0,i.__)("Edit byline","newspack-plugin"),onRequestClose:()=>{$(),_(!1)},children:[B,(0,u.jsx)(b,{tokens:w,tokensInUse:e,insertToken:e=>{let{innerHTML:t}=c.current;const o=`token-${e.id}`,s=`<span id="${o}" contenteditable="false" draggable="true" class="components-form-token-field__token token-inline-block author-token" data-token="${e.id}">\n\t\t\t\t<span class="components-form-token-field__token-text">\n\t\t\t\t\t${e.name}\n\t\t\t\t</span>\n\t\t\t\t<button\n\t\t\t\t\tclass="components-button components-form-token-field__remove-token token-inline-block__remove"\n\t\t\t\t\ttype="button"\n\t\t\t\t\tdata-token="${e.id}"\n\t\t\t\t>\n\t\t\t\t\t${k}\n\t\t\t\t</button>\n\t\t\t</span>`,r=null!=n?n:t.length;r===t.length&&(t+="&nbsp;"),c.current.innerHTML=t.slice(0,r)+s+t.slice(r),j(c.current);const a=Array.from(c.current.querySelectorAll("span[data-token]")).indexOf(c.current.querySelector(`#${o}`)),i=document.createRange();i.setStart(c.current,2*(a+1)),i.collapse(!0);const l=c.current.ownerDocument.getSelection();l.removeAllRanges(),l.addRange(i),c.current.focus()}}),(0,u.jsx)("div",{className:"newspack-byline-customize-modal-btns",children:(0,u.jsx)(o.Button,{variant:"primary",onClick:()=>{T(),_(!1)},children:(0,i.__)("Update","newspack-plugin")})})]})]})]});var O},icon:!1})},790:e=>{e.exports=window.ReactJSXRuntime},6427:e=>{e.exports=window.wp.components},7143:e=>{e.exports=window.wp.data},6087:e=>{e.exports=window.wp.element},7723:e=>{e.exports=window.wp.i18n},5573:e=>{e.exports=window.wp.primitives}},n={};function o(e){var s=n[e];if(void 0!==s)return s.exports;var r=n[e]={id:e,loaded:!1,exports:{}};return t[e](r,r.exports,o),r.loaded=!0,r.exports}o.m=t,e=[],o.O=(t,n,s,r)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){for(var[n,s,r]=e[d],i=!0,l=0;l<n.length;l++)(!1&r||a>=r)&&Object.keys(o.O).every((e=>o.O[e](n[l])))?n.splice(l--,1):(i=!1,r<a&&(a=r));if(i){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,s,r]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.j=925,(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var s=n.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=n[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={925:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var s,r,[a,i,l]=n,c=0;if(a.some((t=>0!==e[t]))){for(s in i)o.o(i,s)&&(o.m[s]=i[s]);if(l)var d=l(o)}for(t&&t(n);c<a.length;c++)r=a[c],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return o.O(d)},n=globalThis.webpackChunknewspack=globalThis.webpackChunknewspack||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=o.O(void 0,[223],(()=>o(992)));s=o.O(s)})();