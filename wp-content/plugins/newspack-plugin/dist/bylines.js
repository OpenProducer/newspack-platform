(()=>{"use strict";var e,t={992:(e,t,n)=>{var o=n(6427),s=n(7143);const r=window.wp.editPost;var a=n(7723);const i=window.wp.plugins;var l=n(1455),c=n.n(l),d=n(7677),p=n(5095);const u=window.wp.coreData;var k=n(1609),m=n(790);const h={_fields:"id,name",context:"view"},w='\n\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n\t\t<path d="M13 11.8l6.1-6.3-1-1-6.1 6.2-6.1-6.2-1 1 6.1 6.3-6.5 6.7 1 1 6.5-6.6 6.5 6.6 1-1z" />\n\t</svg>\n',b=e=>{const t=e.cloneNode(!0);return t.querySelectorAll("span[data-token]").forEach((e=>{const t=e.dataset.token,n=e.querySelector("span"),o=n?n.innerText.trim():"";t&&o&&e.replaceWith(document.createTextNode(`[Author id=${t}]${o}[/Author]`))})),t.innerHTML},g=({insertToken:e,onMount:t,tokens:n,tokensInUse:s,updateCursorPos:r,updateBylineMeta:a})=>{const[i,l]=(0,k.useState)(!1),c=()=>l(!1);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(o.Button,{className:"newspack-byline-customize-btn",variant:"secondary",onClick:()=>l(!0),children:"Edit byline"}),i&&(0,m.jsxs)(o.Modal,{className:"newspack-byline-customize-modal",title:"Edit byline",onRequestClose:c,children:[(0,m.jsx)("div",{className:"newspack-byline-textarea",contentEditable:"true",onBlur:r,onInput:({currentTarget:e})=>a(e),ref:t}),(0,m.jsx)(v,{tokens:n,tokensInUse:s,insertToken:e}),(0,m.jsx)("div",{className:"newspack-byline-customize-modal-btns",children:(0,m.jsx)(o.Button,{variant:"primary",onClick:c,children:"Save"})})]})]})},f=({token:e,onInsert:t})=>(0,m.jsxs)("span",{className:"components-form-token-field__token token-inline-block",children:[(0,m.jsx)("span",{className:"components-form-token-field__token-text",children:e.name}),(0,m.jsx)(o.Button,{className:"components-form-token-field__insert-token is-small has-icon token-inline-block__insert",onClick:t,children:(0,m.jsx)(d.A,{icon:p.A})})]}),v=({tokens:e,tokensInUse:t,insertToken:n})=>(0,m.jsx)("div",{className:"tokens",children:e.map((e=>!t.includes(e.id)&&(0,m.jsx)(f,{token:e,onInsert:()=>n(e)},e.id)))});(0,i.registerPlugin)("newspack-bylines-sidebar",{render:()=>{const[e,t]=(0,k.useState)([]),[n,i]=(0,k.useState)([]),[l,d]=(0,k.useState)(null),[p,f]=(0,k.useState)([]),v=(0,k.useRef)(null),y=(0,s.useDispatch)("core/notices"),{editPost:_}=(0,s.useDispatch)("core/editor"),{postId:x}=(0,s.useSelect)((e=>({postId:e("core/editor").getCurrentPostId()})),[]),{getEditedPostAttribute:j}=(0,s.useSelect)((e=>e("core/editor"))),{postAuthor:S}=(0,s.useSelect)((e=>{const{getUser:t}=e(u.store);return{postAuthor:t(j("author"),h)}})),[A,B]=(0,k.useState)(!!j("meta")[newspackBylines.metaKeyActive]),T=j("meta")[newspackBylines.metaKeyByline],$=(0,k.useCallback)((e=>{_({meta:{[newspackBylines.metaKeyByline]:b(e)}}),N(e)})),N=e=>{const t=[...e.querySelectorAll("span button[data-token]")].map((e=>Number(e.dataset.token)));JSON.stringify(t)!==JSON.stringify(n)&&i(t)},C=e=>Object.values(e).map((e=>({id:e.id,name:e.display_name})));function E(e){"AbortError"!==e.name&&y.createErrorNotice(e.message,{isDismissible:!0})}(0,k.useEffect)((()=>{p&&t(p)}),[p]),(0,k.useEffect)((()=>{if(x&&newspackBylines.is_co_authors_plus_active){const e=new AbortController;return c()({path:`/coauthors/v1/coauthors?post_id=${x}`,signal:e.signal}).then(C).then(f).catch(E),()=>{e.abort()}}}),[x]),(0,k.useEffect)((()=>{newspackBylines.is_co_authors_plus_active||void 0!==S&&f([S])}),[S]);const O=(0,k.useCallback)((e=>{e&&(v.current=e,e.innerHTML=(e=>{const t=`<span id="token-$1" contenteditable="false" draggable="true" class="components-form-token-field__token token-inline-block author-token" data-token="$1">\n\t\t<span class="components-form-token-field__token-text">$2</span>\n\t\t<button\n\t\t\tclass="components-button components-form-token-field__remove-token token-inline-block__remove"\n\t\t\ttype="button"\n\t\t\tdata-token="$1"\n\t\t>\n\t\t\t${w}\n\t\t</button>\n\t</span>`;return e.replace(/\[Author id=(\d*)\](\D*)\[\/Author\]/g,t)})(T),e.addEventListener("click",(({target:t})=>{t.classList.contains("token-inline-block__remove")&&(t.closest(".token-inline-block").remove(),$(e))})),N(e))}));return(0,m.jsxs)(r.PluginDocumentSettingPanel,{className:"newspack-byline",name:"Newspack Byline Settings Panel",title:(0,a.__)("Byline","newspack-plugin"),children:[(0,m.jsx)(o.ToggleControl,{className:"newspack-byline-toggle",checked:A,help:(0,a.__)("Provides flexibility in defining how the byline appears.","newspack-plugin"),label:(0,a.__)("Enable custom byline","newspack-plugin"),onChange:()=>{return t=!A,_({meta:{[newspackBylines.metaKeyActive]:t}}),B(t),void(T||(()=>{let t;e.forEach(((n,o)=>{0===o?t="By":o===e.length-1?t=e.length>2?t+", and":t+" and":t+=",",t+=` [Author id=${n.id}]${n.name}[/Author]`})),t&&_({meta:{[newspackBylines.metaKeyByline]:t}})})());var t}}),A&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("p",{className:"description newspack-byline-preview",dangerouslySetInnerHTML:{__html:(P=T,P.replace(/\[Author id=(\d*)\](\D*)\[\/Author\]/g,'<span class="newspack-byline-author" id="token-$1" data-token="$1">$2</span>'))}}),(0,m.jsx)(g,{insertToken:e=>{let{innerHTML:t}=v.current;const n=`<span id="token-${e.id}" contenteditable="false" draggable="true" class="components-form-token-field__token token-inline-block author-token" data-token="${e.id}">\n\t\t\t\t<span class="components-form-token-field__token-text">\n\t\t\t\t\t${e.name}\n\t\t\t\t</span>\n\t\t\t\t<button\n\t\t\t\t\tclass="components-button components-form-token-field__remove-token token-inline-block__remove"\n\t\t\t\t\ttype="button"\n\t\t\t\t\tdata-token="${e.id}"\n\t\t\t\t>\n\t\t\t\t\t${w}\n\t\t\t\t</button>\n\t\t\t</span>`,o=null!=l?l:t.length;o===t.length&&(t+="&nbsp;"),v.current.innerHTML=t.slice(0,o)+n+t.slice(o),$(v.current)},onMount:O,tokens:e,tokensInUse:n,updateCursorPos:()=>{const{current:e}=v,t=e.ownerDocument.getSelection().getRangeAt(0),n=t.cloneRange();n.selectNodeContents(e),n.setEnd(t.endContainer,t.endOffset);const o=e.ownerDocument.createElement("div");o.appendChild(n.cloneContents()),d(o.innerHTML.length)},updateBylineMeta:$})]})]});var P},icon:!1})},1609:e=>{e.exports=window.React},790:e=>{e.exports=window.ReactJSXRuntime},1455:e=>{e.exports=window.wp.apiFetch},6427:e=>{e.exports=window.wp.components},7143:e=>{e.exports=window.wp.data},6087:e=>{e.exports=window.wp.element},7723:e=>{e.exports=window.wp.i18n},5573:e=>{e.exports=window.wp.primitives}},n={};function o(e){var s=n[e];if(void 0!==s)return s.exports;var r=n[e]={id:e,loaded:!1,exports:{}};return t[e](r,r.exports,o),r.loaded=!0,r.exports}o.m=t,e=[],o.O=(t,n,s,r)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){for(var[n,s,r]=e[d],i=!0,l=0;l<n.length;l++)(!1&r||a>=r)&&Object.keys(o.O).every((e=>o.O[e](n[l])))?n.splice(l--,1):(i=!1,r<a&&(a=r));if(i){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,s,r]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.j=925,(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var s=n.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=n[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={925:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var s,r,[a,i,l]=n,c=0;if(a.some((t=>0!==e[t]))){for(s in i)o.o(i,s)&&(o.m[s]=i[s]);if(l)var d=l(o)}for(t&&t(n);c<a.length;c++)r=a[c],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return o.O(d)},n=globalThis.webpackChunknewspack=globalThis.webpackChunknewspack||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=o.O(void 0,[223],(()=>o(992)));s=o.O(s)})();