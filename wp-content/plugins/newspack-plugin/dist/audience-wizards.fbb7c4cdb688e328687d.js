(globalThis.webpackChunknewspack=globalThis.webpackChunknewspack||[]).push([[662],{8169:(e,n,s)=>{"use strict";s.d(n,{A:()=>i});var t=s(5573),a=s(790);const i=(0,a.jsx)(t.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,a.jsx)(t.Path,{d:"M13 19h-2v-2h2v2zm0-6h-2v-2h2v2zm0-6h-2V5h2v2z"})})},9214:(e,n,s)=>{"use strict";s.d(n,{A:()=>i});var t=s(5573),a=s(790);const i=(0,a.jsxs)(t.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:[(0,a.jsx)(t.Path,{d:"m19 7.5h-7.628c-.3089-.87389-1.1423-1.5-2.122-1.5-.97966 0-1.81309.62611-2.12197 1.5h-2.12803v1.5h2.12803c.30888.87389 1.14231 1.5 2.12197 1.5.9797 0 1.8131-.62611 2.122-1.5h7.628z"}),(0,a.jsx)(t.Path,{d:"m19 15h-2.128c-.3089-.8739-1.1423-1.5-2.122-1.5s-1.8131.6261-2.122 1.5h-7.628v1.5h7.628c.3089.8739 1.1423 1.5 2.122 1.5s1.8131-.6261 2.122-1.5h2.128z"})]})},3731:(e,n,s)=>{"use strict";s.d(n,{FF:()=>t,L0:()=>a,Zs:()=>i,tF:()=>c});const t="nrh",a="wc",i="other",c="newspack-audience-donations"},7207:(e,n,s)=>{"use strict";s.r(n),s.d(n,{default:()=>Re}),s(8209);var t=s(6087),a=s(7723),i=s(3832),c=s(5373),r=s(5135),l=s(216),o=s(8558),p=s(8169),d=s(6427),u=s(790);const g=({dismiss:e,hasPrompts:n,hasPublished:s,isArchive:t,onActivate:i,onArchive:c,onDeactivate:l,onDelete:p,onDuplicate:g,onRename:_,onUnarchive:h})=>(0,u.jsxs)(r.AM,{position:"bottom right",onFocusOutside:()=>e(),onKeyDown:n=>o.ESCAPE===n.keyCode&&e(),children:[(0,u.jsx)(d.MenuItem,{onClick:()=>e(),className:"screen-reader-text",children:(0,a.__)("Close Popover","newspack-plugin")}),n&&(0,u.jsx)(d.MenuItem,{onClick:()=>{e(),i()},className:"newspack-button",children:(0,a.__)("Activate all prompts","newspack-plugin")}),s&&(0,u.jsx)(d.MenuItem,{onClick:()=>{e(),l()},className:"newspack-button",children:(0,a.__)("Deactivate all prompts","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>{e(),g()},className:"newspack-button",children:(0,a.__)("Duplicate","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>{e(),_()},className:"newspack-button",children:(0,a.__)("Rename","newspack-plugin")}),!t&&(0,u.jsx)(d.MenuItem,{onClick:()=>{e(),c()},className:"newspack-button",children:(0,a.__)("Archive","newspack-plugin")}),t&&(0,u.jsx)(d.MenuItem,{onClick:()=>{e(),h()},className:"newspack-button",children:(0,a.__)("Unarchive","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>{e(),p()},className:"newspack-button",children:(0,a.__)("Delete","newspack-plugin")})]});var _=s(5573);const h=(0,u.jsx)(_.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(_.Path,{d:"M18.5 10.5H10v8h8a.5.5 0 00.5-.5v-7.5zm-10 0h-3V18a.5.5 0 00.5.5h2.5v-8zM6 4h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2z"})}),m=(0,u.jsx)(_.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(_.Path,{d:"M18 5.5H6a.5.5 0 00-.5.5v3h13V6a.5.5 0 00-.5-.5zm.5 5H10v8h8a.5.5 0 00.5-.5v-7.5zm-10 0h-3V18a.5.5 0 00.5.5h2.5v-8zM6 4h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2z"})}),w=e=>{const[n,s]=(0,t.useState)(null),[a,c]=(0,t.useState)(!1),[l,o]=(0,t.useState)(Math.floor(9999*Math.random())),p=window?.newspackAudienceCampaigns?.preview_post,d=window?.newspackAudienceCampaigns?.frontend_url||"/",{campaign:g=!1,onLoad:_=(()=>{}),segment:h="",showUnpublished:m=!1,url:w=p||d}=e;(0,t.useEffect)((()=>{a||s(k(w))}),[a]);const k=e=>{const n=h.length?[`segment:${h}`]:["segment:everyone"];return m&&n.push("show_unpublished:true"),g?n.push(`campaign:${g}`):n.push("all"),n.push("session_id:"+l),(0,i.addQueryArgs)(e,{view_as:n.join(";")})};return(0,u.jsx)(r.LQ,{...e,onLoad:e=>{e&&([...e.contentWindow.document.querySelectorAll("a")].forEach((e=>{const n=e.getAttribute("href");0===n.indexOf(d)&&e.setAttribute("href",k(n))})),c(!0),_(e))},onClose:()=>{o(Math.floor(9999*Math.random())),c(!1)},url:n})};var k=s(1455),x=s.n(k),f=s(8537),v=s(9214);const b=({deletePopup:e,restorePopup:n,onFocusOutside:s,prompt:t,previewPopup:i,publishPopup:c,setIsDuplicatePromptModalVisible:l,unpublishPopup:p})=>{const{id:g,edit_link:_,status:h}=t,m="publish"===h,w="trash"===h;return(0,u.jsxs)(r.AM,{position:"bottom left",onFocusOutside:s,onKeyDown:e=>o.ESCAPE===e.keyCode&&s(),className:"newspack-popover__campaigns__primary-popover",children:[(0,u.jsx)(d.MenuItem,{onClick:()=>s(),className:"screen-reader-text",children:(0,a.__)("Close Popover","newspack-plugin")}),w?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(d.MenuItem,{onClick:()=>n(g),className:"newspack-button",children:(0,a.__)("Restore","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>e(g),className:"newspack-button",children:(0,a.__)("Delete permanently","newspack-plugin")})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(d.MenuItem,{onClick:()=>{s(),i(t)},className:"newspack-button",children:(0,a.__)("Preview","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{href:(0,f.decodeEntities)(_),className:"newspack-button",isLink:!0,children:(0,a.__)("Edit","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>l(!0),className:"newspack-button",children:(0,a.__)("Duplicate","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>{s(),(m?p:c)(g)},className:"newspack-button",children:m?(0,a.__)("Deactivate","newspack-plugin"):(0,a.__)("Activate","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>e(g),className:"newspack-button",children:(0,a.__)("Delete","newspack-plugin")})]}),(0,u.jsxs)("div",{className:"newspack-popover__campaigns__info",children:[(0,a.__)("ID:","newspack-plugin")," ",g]})]})};var j=s(2619),y=s(104),C=s.n(y),S=s(3673),A=s.n(S);const P=window.newspackAudienceCampaigns?.criteria||[],$=e=>-1<(window.newspackAudienceCampaigns?.overlay_placements||[]).indexOf(e.options.placement),T=e=>"above_header"===e.options.placement,N=e=>{const n=window.newspackAudienceCampaigns?.custom_placements||{};return-1<Object.keys(n).indexOf(e.options.placement)},F={top:(0,a.__)("Top Overlay","newspack-plugin"),top_left:(0,a.__)("Top Left Overlay","newspack-plugin"),top_right:(0,a.__)("Top Right Overlay","newspack-plugin"),center:(0,a.__)("Center Overlay","newspack-plugin"),center_left:(0,a.__)("Center Left Overlay","newspack-plugin"),center_right:(0,a.__)("Center Right Overlay","newspack-plugin"),bottom:(0,a.__)("Bottom Overlay","newspack-plugin"),bottom_left:(0,a.__)("Bottom Left Overlay","newspack-plugin"),bottom_right:(0,a.__)("Bottom Right Overlay","newspack-plugin"),inline:(0,a.__)("Inline","newspack-plugin"),archives:(0,a.__)("In archive pages","newspack-plugin"),above_header:(0,a.__)("Above Header","newspack-plugin"),manual:(0,a.__)("Manual Only","newspack-plugin")},L=({options:{frequency:e,placement:n}})=>{const s=window.newspackAudienceCampaigns?.custom_placements||{};return"manual"===e||s.hasOwnProperty(n)?(0,a.__)("Custom Placement","newspack-plugin"):F[n]},E=e=>{const n=window.newspackAudienceCampaigns?.custom_placements,s=window.newspackAudienceCampaigns?.overlay_placements,t=Object.keys(F).filter((n=>$(e)?-1<s.indexOf(n):-1===s.indexOf(n))).map((e=>({label:F[e],value:e})));return!$(e)&&n?t.concat(Object.keys(n).map((e=>({label:n[e],value:e})))):t},z={once:(0,a.__)("Once a month","newspack-plugin"),weekly:(0,a.__)("Once a week","newspack-plugin"),daily:(0,a.__)("Once a day","newspack-plugin"),always:(0,a.__)("Every pageview","newspack-plugin"),custom:(0,a.__)("Custom frequency (edit prompt to manage)","newspack-plugin")},M=(e,n=!1)=>"publish"!==e||n?"newspack-card__is-disabled":"newspack-card__is-supported",O=e=>{const{categories:n,tags:s,campaign_groups:t,status:i}=e,c=[];if(t.length>0){const e=t.map((({name:e})=>e)).join(", ");c.push((1===t.length?(0,a.__)("Campaign: ","newspack-plugin"):(0,a.__)("Campaigns: ","newspack-plugin"))+e)}return n.length>0&&c.push((0,a.__)("Categories: ","newspack-plugin")+n.map((e=>e.name)).join(", ")),s.length>0&&c.push((0,a.__)("Tags: ","newspack-plugin")+s.map((e=>e.name)).join(", ")),"pending"===i&&c.push((0,a.__)("Pending review","newspack-plugin")),"future"===i&&c.push((0,a.__)("Scheduled","newspack-plugin")),c.push((0,a.__)("Frequency: ","newspack-plugin")+W(e)),c.length?c.join(" | "):null},D=e=>{const n=[];if(e.configuration.is_disabled&&n.push((0,a.__)("Segment disabled","newspack-plugin")),e.criteria)for(const s of P){const t=e.criteria.find((({criteria_id:e})=>e===s.id));if(t?.value){let e=t.value;if(s.options){const n=s.options.find((({value:e})=>e===t.value));n&&(e=n.label)}if(Array.isArray(e))e=e.join(", ");else if("object"==typeof e){const n=[];for(const s in e)e[s]&&n.push(`${s}: ${e[s]}`);e=n.join(", ")}const i=(0,j.applyFilters)("newspack.wizards.campaigns.segmentDescription.criteriaMessage",(0,a.sprintf)("%1$s: %2$s",s.name,e),e,s,t);i&&n.push(i)}}return()=>(0,u.jsx)(t.Fragment,{children:n.map(((e,s)=>(0,u.jsxs)(t.Fragment,{children:[e," ",n.length!==s+1?" | ":null]},s)))})},I=C()((async e=>{const n=await Promise.all(e.map((async e=>{try{return(await x()({path:(0,i.addQueryArgs)("/wp/v2/categories/"+e,{_fields:"name"})})).name}catch(e){return""}})));return A()(n)})),q=({ids:e})=>{const[n,s]=(0,t.useState)([]);return(0,t.useEffect)((()=>{I(e).then(s)}),[e]),n.length?(0,u.jsxs)("span",{children:[(0,a.__)("Favorite Categories:","newspack-plugin")," ",n.length?n.join(", "):""]}):null};(0,j.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.favoriteCategories",((e,n,s,t)=>"favorite_categories"===s.id?t.value?.length?(0,u.jsx)(q,{ids:t.value}):null:e));const R=C()((async e=>{try{const n=await x()({path:e});return(Array.isArray(n)?n:Object.values(n)).map((e=>({id:isNaN(parseInt(e.id))?e.id.toString():parseInt(e.id),label:e.title||e.name})))}catch(e){return[]}})),B=({label:e,ids:n,path:s})=>{const[a,i]=(0,t.useState)([]);return(0,t.useEffect)((()=>{R(s).then(i)}),[n]),a.length?(0,u.jsxs)("span",{children:[e," ",a.length?a.filter((e=>n.includes(e.id))).map((e=>e.label)).join(", "):""]}):null};(0,j.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.newsletterSubscribedLists",((e,n,s,t)=>["subscribed_lists","not_subscribed_lists"].includes(s.id)?t.value?.length?(0,u.jsx)(B,{label:"subscribed_lists"===s.id?(0,a.__)("Subscribed to:","newspack-plugin"):(0,a.__)("Not subscribed to:","newspack-plugin"),ids:t.value,path:"/newspack-newsletters/v1/lists_config"}):null:e)),(0,j.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.activeSubscriptions",((e,n,s,t)=>["active_subscriptions","not_active_subscriptions"].includes(s.id)?t.value?.length?(0,u.jsx)(B,{label:"active_subscriptions"===s.id?(0,a.__)("Has active subscription(s):","newspack-plugin"):(0,a.__)("Does not have active subscription(s):","newspack-plugin"),ids:t.value,path:`${newspackAudienceCampaigns.api}/subscription-products`}):null:e)),(0,j.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.activeMemberships",((e,n,s,t)=>["active_memberships","not_active_memberships"].includes(s.id)?t.value?.length?(0,u.jsx)(B,{label:"active_memberships"===s.id?(0,a.__)("Has active membership(s):","newspack-plugin"):(0,a.__)("Does not have active membership(s):","newspack-plugin"),ids:t.value,path:"/wc/v3/memberships/plans?per_page=100"}):null:e));const H=e=>$(e)||T(e)?(0,a.sprintf)(
// Translators: %s is prompt type (above-header or overlay).
// Translators: %s is prompt type (above-header or overlay).
(0,a.__)("If multiple %s are rendered on the same pageview, only the most recent one will be displayed.","newspack-plugin"),T(e)?(0,a.__)("above-header prompts","newspack-plugin"):(0,a.__)("overlays","newspack-plugin")):N(e)?(0,a.__)("If multiple prompts are rendered in the same custom placement, only the most recent one will be displayed.","newspack-plugin"):"",V=(e,n)=>{const s=[];if("publish"===n.status&&(T(n)||$(n)||N(n))){const s=n.categories,t=e.filter((e=>{const t=e.categories,a=0===s.length&&0===t.length||s.some((e=>t.some((n=>e.term_id===n.term_id))));return"publish"===e.status&&e.id!==n.id&&(i=e,n.options.placement===i.options.placement)&&((e,n)=>{const s=e.map((e=>e.term_id)),t=n.map((e=>e.term_id));return!s.length&&!t.length||s.some((e=>-1<t.indexOf(e)))})(n.segments,e.segments)&&a;var i})),i=(0,j.applyFilters)("newspack.wizards.campaigns.conflictingPrompts",t,n,e);return 0<i.length?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("strong",{children:(0,a.sprintf)(
// Translators: %s: 'Conflicts' or 'Conflict' depending on number of conflicts.
// Translators: %s: 'Conflicts' or 'Conflict' depending on number of conflicts.
(0,a.__)("%s detected:","newspack-plugin"),1<i.length?(0,a.__)("Conflicts","newspack-plugin"):(0,a.__)("Conflict","newspack-plugin"))}),(0,u.jsx)("ul",{children:i.map((e=>(0,u.jsx)("li",{children:(0,u.jsxs)("p",{"data-testid":`conflict-warning-${n.id}`,children:[(0,u.jsx)("strong",{children:(0,a.sprintf)("%s: ",e.title)}),(0,u.jsx)("span",{children:H(n)})]})},e.id)))})]}):null}return s.length?s.join(" "):null},W=({options:{frequency:e}})=>z[e],{SettingsCard:G}=r.wB,U=({prompt:e,disabled:n,onClose:s,updatePopup:i})=>{const[c,l]=r.JL.useObjectState(e),{excluded_categories:o=[],excluded_tags:p=[]}=c.options||{},[d,g]=(0,t.useState)(0<o.length||0<p.length||!1);return(0,u.jsxs)(r.aF,{title:e.title,onRequestClose:s,isWide:!0,children:[(0,u.jsx)(r.$n,{onClick:()=>s(),className:"screen-reader-text",children:(0,a.__)("Close Modal","newspack-plugin")}),(0,u.jsxs)(r.xA,{gutter:64,columns:1,children:[(0,u.jsx)(G,{title:(0,a.__)("Campaigns","newspack-plugin"),description:(0,a.__)("Assign a prompt to one or more campaigns for easier management","newspack-plugin"),columns:1,className:"newspack-settings__campaigns",noBorder:!0,children:(0,u.jsx)(r.vn,{disabled:n,value:c.campaign_groups||[],onChange:e=>l({campaign_groups:e}),label:(0,a.__)("Campaigns","newspack-plugin"),taxonomy:"newspack_popups_taxonomy",hideLabelFromVision:!0})}),(0,u.jsxs)(G,{title:(0,a.__)("Settings","newspack-plugin"),description:(0,a.__)("When and how should the prompt be displayed","newspack-plugin"),columns:$(e)?3:2,className:"newspack-settings__settings",rowGap:16,noBorder:!0,children:[(0,u.jsx)(r.Yq,{label:(0,a.__)("Frequency","newspack-plugin"),disabled:n,onChange:e=>{l({options:{frequency:e}})},options:Object.keys(z).map((e=>({label:z[e],value:e}))),value:c.options.frequency}),(0,u.jsx)(r.Yq,{label:$(e)?(0,a.__)("Position","newspack-plugin"):(0,a.__)("Placement","newspack-plugin"),disabled:n,onChange:e=>{l({options:{placement:e}})},options:E(e),value:c.options.placement}),$(e)&&(0,u.jsx)(r.Yq,{label:(0,a.__)("Size","newspack-plugin"),disabled:n,onChange:e=>{l({options:{overlay_size:e}})},options:window.newspackAudienceCampaigns?.overlay_sizes,value:c.options.overlay_size})]}),(0,u.jsxs)(G,{title:(0,a.__)("Targeting","newspack-plugin"),description:()=>(0,u.jsxs)(u.Fragment,{children:[(0,a.__)("Under which conditions should the prompt be displayed","newspack-plugin"),(0,u.jsx)("br",{}),(0,a.__)("If multiple conditions are set, all will have to be satisfied in order to display the prompt","newspack-plugin")]}),className:"newspack-settings__targeting",columns:1,rowGap:16,noBorder:!0,children:[(0,u.jsxs)(r.xA,{columns:3,rowGap:16,children:[(0,u.jsx)(r.vn,{disabled:n,value:c.segments||[],onChange:e=>l({segments:e}),label:(0,a.__)("Segments","newspack-plugin"),taxonomy:"popup_segment"}),(0,u.jsx)(r.vn,{label:(0,a.__)("Post categories","newspack-plugin"),disabled:n,hideHelpFromVision:!0,value:c.categories||[],onChange:e=>l({categories:e}),description:(0,a.__)("Prompt will only appear on posts with the specified categories.","newspack-plugin")}),(0,u.jsx)(r.vn,{label:(0,a.__)("Post tags","newspack-plugin"),disabled:n,hideHelpFromVision:!0,taxonomy:"tags",value:c.tags||[],onChange:e=>l({tags:e}),description:(0,a.__)("Prompt will only appear on posts with the specified tags.","newspack-plugin")})]}),(0,u.jsx)("div",{children:(0,u.jsx)(r.$n,{isLink:!0,onClick:()=>g(!d),children:(0,a.sprintf)(
// Translators: whether to show or hide advanced settings fields.
// Translators: whether to show or hide advanced settings fields.
(0,a.__)("%s Advanced Settings","newspack-plugin"),d?(0,a.__)("Hide","newspack-plugin"):(0,a.__)("Show","newspack-plugin"))})}),d&&(0,u.jsxs)(r.xA,{columns:3,rowGap:16,children:[(0,u.jsx)(r.vn,{label:(0,a.__)("Category Exclusions","newspack-plugin"),disabled:n,hideHelpFromVision:!0,value:o||[],onChange:e=>l({options:{excluded_categories:e.map((e=>e.id))}}),description:(0,a.__)("Prompt will not appear on posts with the specified categories.","newspack-plugin")}),(0,u.jsx)(r.vn,{label:(0,a.__)("Tag Exclusions","newspack-plugin"),disabled:n,hideHelpFromVision:!0,taxonomy:"tags",value:p||[],onChange:e=>l({options:{excluded_tags:e.map((e=>e.id))}}),description:(0,a.__)("Prompt will not appear on posts with the specified tags.","newspack-plugin")})]})]})]}),(0,u.jsxs)(r.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,u.jsx)(r.$n,{onClick:s,variant:"secondary",children:(0,a.__)("Cancel","newspack-plugin")}),(0,u.jsx)(r.$n,{onClick:()=>{i(c).then(s)},variant:"primary",children:(0,a.__)("Save","newspack-plugin")})]})]})},Z=e=>{const[n,s]=(0,t.useState)(!1),[i,c]=(0,t.useState)(!1),[l,o]=(0,t.useState)(!1),[d,g]=(0,t.useState)(null),{className:_,description:h,duplicated:m,duplicatePopup:w,inFlight:k,resetDuplicated:j,prompt:y={},segments:C,warning:S}=e,{campaign_groups:A,id:P,edit_link:$,title:T}=y;(0,t.useEffect)((()=>{l&&!d&&N()}),[l]);const N=async()=>{const e=parseInt(y?.duplicate_of||y.id);try{const n=await x()({path:`${newspackAudienceCampaigns.api}/${e}/${y.id}/duplicate`});g(n)}catch(e){g(T+(0,a.__)(" copy","newspack-plugin"))}};return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(r.Lz,{isSmall:!0,badge:L(y),className:_,title:T.length?(0,f.decodeEntities)(T):(0,a.__)("(no title)","newspack-plugin"),titleLink:(0,f.decodeEntities)($),description:h,notification:S,notificationLevel:"error",actionText:(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)("div",{className:"newspack-audience-campaigns__buttons",children:[(0,u.jsx)(r.$n,{className:n&&"popover-active",onClick:()=>s(!n),icon:v.A,label:(0,a.__)("Prompt settings","newspack-plugin"),tooltipPosition:"bottom center"}),(0,u.jsx)(r.$n,{className:i&&"popover-active",onClick:()=>c(!i),icon:p.A,label:(0,a.__)("More options","newspack-plugin"),tooltipPosition:"bottom center"}),i&&(0,u.jsx)(b,{onFocusOutside:()=>c(!1),prompt:y,setIsDuplicatePromptModalVisible:o,...e})]})})},P),n&&(0,u.jsx)(U,{prompt:y,disabled:k,onClose:()=>s(!1),segments:C,updatePopup:e.updatePopup}),l&&(0,u.jsx)(r.aF,{className:"newspack-popups__duplicate-modal",title:
// Translators: %s: The title of the item.
// Translators: %s: The title of the item.
(0,a.sprintf)((0,a.__)("Duplicate “%s”","newspack-plugin"),T),onRequestClose:()=>{o(!1),g(null),j()},children:m?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(r.$T,{isSuccess:!0,noticeText:(0,a.sprintf)(
// Translators: %s: The title of the item.
// Translators: %s: The title of the item.
(0,a.__)("Duplicate of “%s” created as a draft.","newspack-plugin"),T)}),!A&&(0,u.jsx)(r.$T,{isWarning:!0,noticeText:(0,a.__)("This prompt is currently not assigned to any campaign.","newspack-plugin")}),(0,u.jsxs)(r.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,u.jsx)(r.$n,{isSecondary:!0,onClick:()=>{o(!1),g(null),j()},children:(0,a.__)("Close","newspack-plugin")}),(0,u.jsx)(r.$n,{isPrimary:!0,href:`/wp-admin/post.php?post=${m}&action=edit`,children:(0,a.__)("Edit","newspack-plugin")})]})]}):(0,u.jsxs)(u.Fragment,{children:[!A&&(0,u.jsx)(r.$T,{isWarning:!0,noticeText:(0,a.__)("This prompt will not be assigned to any campaign.","newspack-plugin")}),(0,u.jsx)(r.xt,{disabled:k||null===d,label:(0,a.__)("Title","newspack-plugin"),value:d,onChange:e=>g(e)}),(0,u.jsxs)(r.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,u.jsx)(r.$n,{disabled:k,isSecondary:!0,onClick:()=>{o(!1),g(null),j()},children:(0,a.__)("Cancel","newspack-plugin")}),(0,u.jsx)(r.$n,{disabled:k||null===d,isPrimary:!0,onClick:()=>{const e=d.trim()||N();w(P,e)},children:(0,a.__)("Duplicate","newspack-plugin")})]})]})})]})},Y=(0,u.jsx)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24",children:(0,u.jsx)(d.Path,{d:"M4 9h16v2H4V9zm0 4h10v2H4v-2z"})}),Q=(0,u.jsxs)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24",children:[(0,u.jsx)(d.Path,{d:"M17 14H7v3h10v-3z"}),(0,u.jsx)(d.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})]}),J=(0,u.jsxs)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24",children:[(0,u.jsx)(d.Path,{d:"M16 10H8v4h8v-4z"}),(0,u.jsx)(d.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})]}),X=(0,u.jsxs)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24",children:[(0,u.jsx)(d.Path,{d:"M17 7H7v3h10V7z"}),(0,u.jsx)(d.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})]}),K=(0,u.jsx)(d.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,u.jsx)(d.Path,{d:"M18 4H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm.5 14c0 .3-.2.5-.5.5H6c-.3 0-.5-.2-.5-.5V6c0-.3.2-.5.5-.5h12c.3 0 .5.2.5.5v12zM7 11h2V9H7v2zm0 4h2v-2H7v2zm3-4h7V9h-7v2zm0 4h7v-2h-7v2z"})}),ee=(0,u.jsx)(d.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,u.jsx)(d.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v3.5h-15V5c0-.3.2-.5.5-.5zm8 5.5h6.5v3.5H13V10zm-1.5 3.5h-7V10h7v3.5zm-7 5.5v-4h7v4.5H5c-.3 0-.5-.2-.5-.5zm14.5.5h-6V15h6.5v4c0 .3-.2.5-.5.5z"})}),ne=(e,n,s)=>{const t=[];return e&&t.push(`placement=${e}`),+n>0&&t.push(`group=${n}`),s&&t.push(`segment=${s}`),"/wp-admin/post-new.php?post_type=newspack_popups_cpt&"+t.join("&")},se=e=>{const{campaignData:n,campaignId:s,segment:i}=e,[c,l]=(0,t.useState)(!1),{label:o,id:p,prompts:d}=i,g="unassigned"!==s?parseInt(s):-1;let _;_="unassigned"===s?(0,a.__)("No unassigned prompts in this segment.","newspack-plugin"):n?(0,a.__)("No prompts in this segment for","newspack-plugin")+" "+n.name+".":(0,a.__)("No active prompts in this segment.","newspack-plugin");const k=D(i);return(0,u.jsxs)(r.Zp,{isSmall:!0,className:"newspack-campaigns__segment-group__card",children:[(0,u.jsxs)("div",{className:"newspack-campaigns__segment-group__card__segment",children:[(0,u.jsxs)("div",{className:"newspack-campaigns__segment-group__card__segment-title",children:[(0,u.jsx)("h3",{children:p?(0,u.jsxs)(r.$n,{href:`#/segments/${p}`,label:(0,a.__)("Edit Segment ","newspack-plugin"),isLink:!0,showTooltip:!0,tooltipPosition:"bottom center",children:[(0,a.__)("Segment: ","newspack-plugin"),o]}):o}),(0,u.jsx)("span",{className:"newspack-campaigns__segment-group__description",children:p?k():(0,a.__)("All readers, regardless of segment","newspack-plugin")})]}),(0,u.jsxs)("div",{className:"newspack-campaigns__segment-group__card__segment-actions",children:[(0,u.jsx)(w,{campaign:!!s&&g,segment:p,showUnpublished:!!s,renderButton:({showPreview:e})=>(0,u.jsx)(r.$n,{isSmall:!0,variant:"tertiary",onClick:()=>e(),children:(0,a.__)("Preview Segment","newspack-plugin")})}),"unassigned"!==s&&(0,u.jsxs)(t.Fragment,{children:[(0,u.jsx)(r.$n,{isSmall:!0,variant:"secondary",onClick:()=>l(!c),children:(0,a.__)("Add New Prompt","newspack-plugin")}),c&&(0,u.jsx)(r.aF,{title:(0,a.__)("Add New Prompt","newspack-plugin"),onRequestClose:()=>l(!1),shouldCloseOnEsc:!1,shouldCloseOnClickOutside:!1,isWide:!0,children:(0,u.jsxs)(r.xA,{gutter:32,columns:3,children:[(0,u.jsx)(r.dr,{href:ne("overlay-center",s,p),title:(0,a.__)("Center Overlay","newspack-plugin"),desc:(0,a.__)("Fixed at the center of the screen","newspack-plugin"),icon:J}),(0,u.jsx)(r.dr,{href:ne("overlay-top",s,p),title:(0,a.__)("Top Overlay","newspack-plugin"),desc:(0,a.__)("Fixed at the top of the screen","newspack-plugin"),icon:X}),(0,u.jsx)(r.dr,{href:ne("overlay-bottom",s,p),title:(0,a.__)("Bottom Overlay","newspack-plugin"),desc:(0,a.__)("Fixed at the bottom of the screen","newspack-plugin"),icon:Q}),(0,u.jsx)(r.dr,{href:ne(null,s,p),title:(0,a.__)("Inline","newspack-plugin"),desc:(0,a.__)("Embedded in content","newspack-plugin"),icon:Y}),(0,u.jsx)(r.dr,{href:ne("archives",s,p),title:(0,a.__)("In Archive Pages","newspack-plugin"),desc:(0,a.__)("Embedded once or many times in archive pages","newspack-plugin"),icon:K}),(0,u.jsx)(r.dr,{href:ne("above-header",s,p),title:(0,a.__)("Above Header","newspack-plugin"),desc:(0,a.__)("Embedded at the very top of the page","newspack-plugin"),icon:h}),(0,u.jsx)(r.dr,{href:ne("custom",s,p),title:(0,a.__)("Custom Placement","newspack-plugin"),desc:(0,a.__)("Only appears when placed in content","newspack-plugin"),icon:m}),(0,u.jsx)(r.dr,{href:ne("manual",s,p),title:(0,a.__)("Manual Only","newspack-plugin"),desc:(0,a.__)("Only appears where Single Prompt block is inserted","newspack-plugin"),icon:ee})]})})]})]})]}),(0,u.jsx)(r.Zp,{noBorder:!0,className:"newspack-campaigns__segment-group__action-cards",children:d.map((n=>(0,u.jsx)(Z,{className:M(n.status,i.configuration.is_disabled),description:O(n),warning:V(d,n),prompt:n,...e},n.id)))}),d.length<1?(0,u.jsx)("p",{className:"newspack-campaigns__segment-group__empty-segment-text",children:_}):""]})},te=(0,t.createContext)({prompts:[]});var ae=s(6942),ie=s.n(ae),ce=s(7309),re=s.n(ce);const{useHistory:le}=r.Ix,oe="active",pe=e=>2===e?(0,a.__)("Rename Campaign","newspack-plugin"):1===e?(0,a.__)("Duplicate Campaign","newspack-plugin"):(0,a.__)("Add New Campaign","newspack-plugin"),de=e=>2===e?(0,a.__)("Rename","newspack-plugin"):1===e?(0,a.__)("Duplicate","newspack-plugin"):(0,a.__)("Add","newspack-plugin"),ue=(e,n)=>{if("trash"===n)return e.filter((({status:e})=>"trash"===e));const s=e.filter((({status:e})=>"trash"!==e));return oe===n?s.filter((({status:e})=>"publish"===e)):"all"===n?s.filter((({status:e})=>"trash"!==e)):"unassigned"===n?s.filter((({campaign_groups:e})=>!e||!e.length)):s.filter((({campaign_groups:e})=>e&&e.find((e=>+e.term_id==+n))))},ge=(e,n)=>{const s=[];return s.push(...e.map((({name:e,id:s,configuration:t,criteria:a})=>({label:e,id:s,configuration:t,criteria:a,prompts:n.filter((({segments:e})=>!!e&&!!e.find((e=>e.term_id===parseInt(s)))))})))),s.push({label:(0,a.__)("Everyone","newspack-plugin"),id:"",prompts:n.filter((({segments:e})=>0===e.length)),configuration:{}}),s},_e=(0,r.c_)((e=>{const{campaignId:n=oe,campaigns:s=[],manageCampaignGroup:i,segments:c,createCampaignGroup:l,duplicateCampaignGroup:d,deleteCampaignGroup:_,archiveCampaignGroup:h,renameCampaignGroup:m}=e,w=(0,t.useRef)(null),[k,x]=(0,t.useState)(),[f,v]=(0,t.useState)(),[b,j]=(0,t.useState)(),[y,C]=(0,t.useState)(),S=(0,t.useContext)(te),A=ue(S,n),P=ue(S,"unassigned").length;(0,t.useEffect)((()=>{f&&w.current.querySelector("input").focus()}),[f]);const $=le(),T=e=>{3===b?l(e):2===b?m(n,e):1===b&&d(n,e),v(!1)},N=s.filter((({status:e})=>"archive"!==e)),F=s.filter((({status:e})=>"archive"===e)),L=((e,n)=>n.reduce(((n,s)=>+e>0&&+e==+s.term_id?s:n),null))(n,s),E=[{key:oe,name:(0,a.__)("Active Prompts","newspack-plugin")},{key:"all",name:(0,a.__)("All Prompts","newspack-plugin")},{key:"trash",name:(0,a.__)("Trash","newspack-plugin")},...P?[{key:"unassigned",name:(0,a.__)("Unassigned Prompts","newspack-plugin")}]:[],...N.length?[{key:"header-campaigns",name:(0,a.__)("Campaigns","newspack-plugin"),className:"is-header"}]:[],...N.map((({term_id:e,name:n})=>({key:String(e),name:n,className:"newspack-campaigns__campaign-group__select-control-group-item"}))),...F.length?[{key:"header-archived-campaigns",name:(0,a.__)("Archived Campaigns","newspack-plugin"),className:"is-header"}]:[],...F.map((({term_id:e,name:n})=>({key:String(e),name:n+" "+(0,a.__)("(archived)","newspack-plugin"),className:"newspack-campaigns__campaign-group__select-control-group-item"})))];return(0,u.jsxs)(t.Fragment,{children:[(0,u.jsxs)(r.Zp,{headerActions:!0,noBorder:!0,children:[(0,u.jsxs)("div",{className:"newspack-campaigns__campaign-group__filter-group-actions",children:[(0,u.jsx)(r.Jv,{label:(0,a.__)("Campaigns","newspack-plugin"),options:E.map((e=>({...e,className:ie()(e.className,{"is-selected":e.key===n})}))),onChange:({selectedItem:{key:e}})=>oe===e?$.push("/campaigns"):$.push(`/campaigns/${e}`),value:re()(E,["key",n||oe]),hideLabelFromVision:!0}),L&&(0,u.jsxs)("div",{className:"newspack-campaigns__campaign-group__filter-group-actions__button",children:[(0,u.jsx)(r.$n,{className:k&&"popover-active",onClick:()=>x(!k),icon:p.A,label:(0,a.__)("Actions","newspack-plugin"),tooltipPosition:"bottom center"}),k&&(0,u.jsx)(g,{dismiss:()=>x(!1),isArchive:L&&"archive"===L.status,onActivate:()=>i(A),onArchive:()=>h(n,!0),onDeactivate:()=>i(A,"DELETE"),onDelete:()=>_(n),onDuplicate:()=>{v(!0),C(""),j(1)},onRename:()=>{C(L.name),v(!0),j(2)},onUnarchive:()=>h(n,!1),hasPrompts:A.length>0,hasPublished:A.some((({status:e})=>"publish"===e))})]})]}),(0,u.jsxs)("div",{className:"newspack-campaigns__campaign-group__add-new-button",children:[(0,u.jsx)(r.$n,{isPrimary:!0,onClick:()=>{v(!f),C(""),j(3)},children:(0,a.__)("Add New Campaign","newspack-plugin")}),f&&(0,u.jsxs)(r.aF,{title:pe(b),onRequestClose:()=>{v(!1)},children:[(0,u.jsx)("div",{ref:w,children:(0,u.jsx)(r.xt,{placeholder:(0,a.__)("Campaign Name","newspack-plugin"),onChange:C,label:(0,a.__)("Campaign Name","newspack-plugin"),hideLabelFromVision:!0,value:y,onKeyDown:e=>{o.ENTER===e.keyCode&&""!==y&&(e.preventDefault(),T(y))}})}),(0,u.jsxs)(r.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,u.jsx)(r.$n,{variant:"secondary",onClick:()=>{v(!1)},children:(0,a.__)("Cancel","newspack-plugin")}),(0,u.jsx)(r.$n,{variant:"primary",disabled:!y,onClick:()=>T(y),children:de(b)})]})]})]})]}),ge(c,A).map(((s,t)=>oe===n&&s.configuration.is_disabled?null:(0,u.jsx)(se,{segment:s,campaignId:n,campaignData:L,...e},t)))]})})),he=(0,r.c_)((()=>(0,u.jsx)(r.x5,{pluginSlug:"newspack-audience-campaigns",isWizard:!0,title:null})));var me=s(7677);const we=(0,u.jsx)(_.SVG,{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(_.Path,{d:"M8 7h2V5H8v2zm0 6h2v-2H8v2zm0 6h2v-2H8v2zm6-14v2h2V5h-2zm0 8h2v-2h-2v2zm0 6h2v-2h-2v2z"})});var ke=s(3756),xe=s(2485);const{NavLink:fe,useHistory:ve}=r.Ix,be=()=>(0,u.jsx)(fe,{to:"segments/new",children:(0,u.jsx)(r.$n,{variant:"primary",children:(0,a.__)("Add New Segment","newspack-plugin")})}),je=({inFlight:e,segment:n,segments:s,deleteSegment:i,dropTargetIndex:c,setDropTargetIndex:l,index:g,sortSegments:_,totalSegments:h,wrapperRef:m,toggleSegmentStatus:w})=>{const[k,x]=(0,t.useState)(!1),[f,v]=(0,t.useState)(!1),b=()=>x(!1),j=ve(),y=0===g,C=g+1===h,S=g===c,A=C&&c>=h,P=t=>{if(e)return;const a=[...s],i=t>g?t-1:t;a.splice(g,1),a.splice(i,0,n),a.forEach(((e,n)=>e.priority=n)),JSON.stringify(a)!==JSON.stringify(s)&&_(a)},$=()=>{if(e)return;let n=g-1;0>n&&(n=0),P(n)},T=()=>{if(e)return;let n=g+2;h<n&&(n=h),P(n)};return(0,u.jsx)("div",{className:"newspack-campaigns__draggable"+(f?" is-dragging":"")+(S?" is-drop-target":"")+(A?" drop-target-after":""),id:`segment-${n.id}`,children:(0,u.jsx)(d.Draggable,{elementId:`segment-${n.id}`,transferData:{},onDragStart:()=>{f||e||v(!0)},onDragEnd:()=>{e||(null!==c&&P(c),l(null),v(!1))},onDragOver:n=>{if(e)return;const s=m.current.getBoundingClientRect(),t=n.pageY<=s.top+window.scrollY,a=n.pageY>=s.bottom+window.scrollY;if(t||a||n.target.classList.contains("newspack-action-card")){let e=Array.prototype.slice.call(m.current.querySelectorAll(".newspack-campaigns__draggable")).indexOf(n.target.parentElement);(0>e||e===g+1)&&(e=g),t&&(e=0),a&&(e=h),l(e)}},children:({onDraggableStart:e,onDraggableEnd:s})=>(0,u.jsx)(r.Lz,{isSmall:!0,title:n.name,titleLink:`#/segments/${n.id}`,description:D(n),toggleChecked:!n.configuration.is_disabled,toggleOnChange:()=>w(n),badge:n.is_criteria_duplicated?(0,a.__)("Duplicate","newspack-plugin"):void 0,actionText:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(r.$n,{onClick:()=>x(!k),label:(0,a.__)("More options","newspack-plugin"),icon:p.A,className:k&&"popover-active"}),k&&(0,u.jsxs)(r.AM,{position:"bottom left",onKeyDown:e=>o.ESCAPE===e.keyCode&&b,onFocusOutside:b,children:[(0,u.jsx)(d.MenuItem,{onClick:()=>b(),className:"screen-reader-text",children:(0,a.__)("Close Popover","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>j.push(`/segments/${n.id}`),className:"newspack-button",children:(0,a.__)("Edit","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>i(n),className:"newspack-button",children:(0,a.__)("Delete","newspack-plugin")})]})]}),children:(0,u.jsxs)("div",{className:"newspack-campaigns__segment-priority-controls",children:[(0,u.jsx)("div",{className:"drag-handle",draggable:!0,onDragStart:e,onDragEnd:s,children:(0,u.jsx)(me.A,{icon:we,height:18,width:18})}),(0,u.jsxs)("div",{className:"movers",children:[(0,u.jsx)(r.$n,{icon:ke.A,onClick:$,disabled:y,label:(0,a.__)("Move segment position up","newspack-plugin")}),(0,u.jsx)(r.$n,{icon:xe.A,onClick:T,disabled:C,label:(0,a.__)("Move segment position down","newspack-plugin")})]})]})})})})},ye=({wizardApiFetch:e,segments:n,setSegments:s,isLoading:i})=>{const[c,l]=(0,t.useState)(null),[o,p]=(0,t.useState)(null),[d,g]=(0,t.useState)(!1),[_,h]=(0,t.useState)(null),m=(0,t.useRef)();(0,t.useEffect)((()=>{window.scrollTo(0,0)}),[]);const w=n=>{g(!0),h(null),e({path:`${newspackAudienceCampaigns.api}/segmentation/${n.id}`,method:"POST",quiet:!0,data:{name:n.name,configuration:{...n.configuration,is_disabled:!n.configuration.is_disabled},criteria:n.criteria}}).then((e=>{g(!1),s(e)})).catch((()=>{g(!1)}))},k=n=>{g(!0),h(null),e({path:`${newspackAudienceCampaigns.api}/segmentation/${n.id}`,method:"DELETE",quiet:!0}).then((e=>{g(!1),s(e)})).catch((()=>{g(!1)}))},x=t=>{h(null),p(t),g(!0),e({path:`${newspackAudienceCampaigns.api}/segmentation-sort`,method:"POST",data:{segmentIds:t.map((e=>e.id))},quiet:!0}).then((e=>{g(!1),p(null),s(e)})).catch((e=>{g(!1),h(e.message||(0,a.__)("There was an error sorting segments. Please try again.","newspack-plugin")),s(n)}))};if(null===n)return null;const f=o||n;return n.length?(0,u.jsxs)(t.Fragment,{children:[_&&(0,u.jsx)(r.$T,{noticeText:_,isError:!0}),(0,u.jsxs)(r.Zp,{headerActions:!0,noBorder:!0,children:[(0,u.jsx)("h2",{children:(0,a.__)("Audience segments","newspack-plugin")}),(0,u.jsx)(be,{})]}),(0,u.jsx)("div",{className:"newspack-campaigns-wizard-segments__list"+(d?" is-loading":""),ref:m,children:f.map(((e,s)=>(0,u.jsx)(je,{deleteSegment:k,inFlight:d||i>0,segment:e,segments:n,sortSegments:x,index:s,wrapperRef:m,dropTargetIndex:c,setDropTargetIndex:l,totalSegments:n.length,toggleSegmentStatus:w},e.id)))})]}):(0,u.jsxs)(t.Fragment,{children:[(0,u.jsxs)(r.Zp,{headerActions:!0,noBorder:!0,children:[(0,u.jsx)("h2",{children:(0,a.__)("You have no saved audience segments.","newspack-plugin")}),(0,u.jsx)(be,{})]}),(0,u.jsx)("p",{children:(0,a.__)("Create audience segments to target visitors by engagement, activity, and more.","newspack-plugin")})]})};var Ce=s(5255);function Se({label:e,help:n,placeholder:s,value:t,onChange:a,path:i}){const c=e=>({value:isNaN(parseInt(e.id))?e.id.toString():parseInt(e.id),label:e.title||e.name});return(0,u.jsx)(Ce.A,{label:e,help:n,placeholder:s,tokens:t||[],fetchSuggestions:async()=>{const e=await x()({path:i});return(Array.isArray(e)?e:Object.values(e)).map(c)},fetchSavedInfo:async e=>{const n=await x()({path:i});return(Array.isArray(n)?n:Object.values(n)).filter((n=>e.includes(n.id))).map(c)},onChange:a})}const{useHistory:Ae}=r.Ix,{SettingsCard:Pe,SettingsSection:$e,MinMaxSetting:Te}=r.wB,Ne={is_disabled:!1};(0,j.addFilter)("newspack.criteria.input","newspack.favoriteCategories",(function(e,n,s,t){return"favorite_categories"===n.id?(0,u.jsx)(r.vn,{value:s||[],onChange:e=>{t(e.map((e=>e.id)))},label:n.name,hideLabelFromVision:!0}):e})),(0,j.addFilter)("newspack.criteria.input","newspack.newsletterSubscribedLists",(function(e,n,s,t){return["subscribed_lists","not_subscribed_lists"].includes(n.id)?(0,u.jsx)(Se,{placeholder:(0,a.__)("Start typing to search for lists…","newspack-plugin"),path:"/newspack-newsletters/v1/lists_config",value:s,onChange:t}):e})),(0,j.addFilter)("newspack.criteria.input","newspack.activeSubscriptions",(function(e,n,s,t){return["active_subscriptions","not_active_subscriptions"].includes(n.id)?(0,u.jsx)(Se,{placeholder:(0,a.__)("Start typing to search for products…","newspack-plugin"),path:`${newspackAudienceCampaigns.api}/subscription-products`,value:s,onChange:t}):e})),(0,j.addFilter)("newspack.criteria.input","newspack.activeMemberships",(function(e,n,s,t){return["active_memberships","not_active_memberships"].includes(n.id)?(0,u.jsx)(Se,{placeholder:(0,a.__)("Start typing to search for membership plans…","newspack-plugin"),path:"/wc/v3/memberships/plans?per_page=100",value:s,onChange:t}):e}));const Fe=({segmentId:e,setSegments:n,wizardApiFetch:s})=>{const i=window.newspackAudienceCampaigns?.criteria||[],[c,l]=r.JL.useObjectState(Ne),[o,p]=(0,t.useState)(""),[g,_]=(0,t.useState)([]),[h,m]=(0,t.useState)([]),[w,k]=(0,t.useState)(""),x=Ae(),[f,v]=(0,t.useState)("[]"),b=h!==JSON.stringify(g)||w!==o||JSON.stringify(f.is_disabled)!==JSON.stringify(c.is_disabled),y=r.JL.usePrompt(b,(0,a.__)("There are unsaved changes to this segment. Discard changes?","newspack-plugin")),C="new"===e;(0,t.useEffect)((()=>{C||s({path:`${newspackAudienceCampaigns.api}/segmentation`}).then((n=>{const s=re()(n,(({id:n})=>n===e));if(s){const e={...Ne,...s.configuration};l(e),v(e),p(s.name),k(s.name),_([...s.criteria]),m(JSON.stringify(s.criteria))}}))}),[C]);const S=e=>{const n=(e=>{const n=g.find((n=>n.criteria_id===e));return n?n.value:""})(e.id),s=(t=e.id,e=>{const n=[...g],s=n.find((e=>e.criteria_id===t));s?!e||Array.isArray(e)&&0===e.length?n.splice(n.indexOf(s),1):Array.isArray(e)||"object"!=typeof e?s.value=e:s.value={...s.value,...e}:e&&n.push({criteria_id:t,value:e}),_(n)});var t;return(0,j.applyFilters)("newspack.criteria.input","range"===e.matching_function?(0,u.jsx)(Te,{"data-testid":`newspack-criteria-${e.id}`,min:n?.min,max:n?.max,onChangeMin:e=>s({min:e}),onChangeMax:e=>s({max:e})}):e.options?.length?(0,u.jsx)(r.Yq,{"data-testid":`newspack-criteria-${e.id}`,isWide:!0,onChange:s,value:n,options:e.options}):(0,u.jsx)(r.xt,{"data-testid":`newspack-criteria-${e.id}`,isWide:!0,placeholder:e.placeholder,help:e.help,value:n,onChange:s}),e,n,s)};return(0,u.jsxs)(t.Fragment,{children:[(0,u.jsx)(r.xt,{placeholder:(0,a.__)("Untitled Segment","newspack-plugin"),value:o,onChange:p,label:(0,a.__)("Title","newspack-plugin"),className:"newspack-campaigns-wizard-segments__title"}),(0,u.jsx)(Pe,{title:(0,a.__)("Segment Status","newspack-plugin"),description:(0,a.__)("If not enabled, the segment will be ignored for reader segmentation.","newspack-plugin"),noBorder:!0,children:(0,u.jsx)(d.ToggleControl,{label:(0,a.__)("Segment enabled","newspack-plugin"),checked:!c.is_disabled,onChange:()=>l({is_disabled:!c.is_disabled})})}),(0,u.jsx)(Pe,{title:(0,a.__)("Reader Engagement","newspack-plugin"),description:(0,a.__)("Target readers based on their browsing behavior.","newspack-plugin"),noBorder:!0,children:i.filter((e=>"reader_engagement"===e.category)).map((e=>(0,u.jsx)($e,{title:e.name,description:e.description,children:S(e)},e.id)))}),(0,u.jsx)(Pe,{title:(0,a.__)("Registration","newspack-plugin"),description:(0,a.__)("Target readers based on their user account registration status.","newspack-plugin"),columns:3,noBorder:!0,children:i.filter((e=>"reader_activity"===e.category)).map((e=>(0,u.jsx)($e,{title:e.name,description:e.description,children:S(e)},e.id)))}),(0,u.jsx)(Pe,{title:(0,a.__)("Newsletters","newspack-plugin"),description:(0,a.__)("Target readers based on their newsletter subscription status.","newspack-plugin"),columns:3,noBorder:!0,children:i.filter((e=>"newsletter"===e.category)).map((e=>(0,u.jsx)($e,{title:e.name,description:e.description,children:S(e)},e.id)))}),(0,u.jsx)(Pe,{title:(0,a.__)("Reader Revenue","newspack-plugin"),description:(0,a.__)("Target readers based on their revenue activity.","newspack-plugin"),columns:3,noBorder:!0,children:i.filter((e=>"reader_revenue"===e.category)).map((e=>(0,u.jsx)($e,{title:e.name,description:e.description,children:S(e)},e.id)))}),(0,u.jsx)(Pe,{title:(0,a.__)("Referrer Sources","newspack-plugin"),description:(0,a.__)("Target readers based on where they’re coming from.","newspack-plugin"),notification:(0,a.__)("Segments using these options will apply only to the first page visited after coming from an external source.","newspack-plugin"),columns:2,noBorder:!0,children:i.filter((e=>"referrer_sources"===e.category)).map((e=>(0,u.jsx)($e,{title:e.name,description:e.description,children:S(e)},e.id)))}),(0,u.jsxs)("div",{className:"newspack-buttons-card",children:[(0,u.jsx)(r.$n,{disabled:!(()=>{const e={...c},n={...Ne};return delete e.is_disabled,delete n.is_disabled,o.length>0&&g.length})()||!C&&!b,isPrimary:!0,onClick:()=>{y();const t=C?`${newspackAudienceCampaigns.api}/segmentation`:`${newspackAudienceCampaigns.api}/segmentation/${e}`;s({path:t,method:"POST",data:{name:o,criteria:g,configuration:c},quiet:!0}).then(n).then(x.push("/segments"))},children:(0,a.__)("Save","newspack-plugin")}),(0,u.jsx)(r.$n,{isSecondary:!0,href:"#/segments",children:(0,a.__)("Cancel","newspack-plugin")})]})]})},Le=(0,r.c_)((({wizardApiFetch:e,match:n,...s})=>{const t=n.params.id;return t?(0,u.jsx)(Fe,{segmentId:t,wizardApiFetch:e,...s}):(0,u.jsx)(ye,{wizardApiFetch:e,...s})})),{HashRouter:Ee,Redirect:ze,Route:Me,Switch:Oe}=l.A,De=(0,a.__)("Audience Management / Campaigns","newspack-plugin"),Ie=[{label:(0,a.__)("Campaigns","newpack-plugin"),path:"/campaigns",exact:!0},{label:(0,a.__)("Segments","newpack-plugin"),path:"/segments",exact:!1},{label:(0,a.__)("Settings","newpack-plugin"),path:"/settings",exact:!0}];class qe extends t.Component{constructor(e){super(e),this.state={campaigns:[],prompts:[],segments:[],settings:[],previewUrl:null,duplicated:null,inFlight:!1}}onWizardReady=()=>{this.refetch()};refetch=()=>{const{setError:e,wizardApiFetch:n}=this.props;n({path:newspackAudienceCampaigns.api}).then(this.updateAfterAPI).catch((n=>e(n)))};updatePopup=({id:e,...n})=>{const{setError:s,wizardApiFetch:t}=this.props;return this.setState({inFlight:!0}),t({path:`${newspackAudienceCampaigns.api}/${e}`,method:"POST",data:{config:n},quiet:!0}).then(this.updateAfterAPI).catch((e=>s(e)))};deletePopup=e=>{const{setError:n,wizardApiFetch:s}=this.props;return s({path:`${newspackAudienceCampaigns.api}/${e}`,method:"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e)))};restorePopup=e=>{const{setError:n,wizardApiFetch:s}=this.props;return s({path:`${newspackAudienceCampaigns.api}/${e}/restore`,method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e)))};publishPopup=e=>{const{setError:n,wizardApiFetch:s}=this.props;return s({path:`${newspackAudienceCampaigns.api}/${e}/publish`,method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e)))};unpublishPopup=e=>{const{setError:n,wizardApiFetch:s}=this.props;return s({path:`${newspackAudienceCampaigns.api}/${e}/publish`,method:"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e)))};duplicatePopup=(e,n)=>{const{setError:s,wizardApiFetch:t}=this.props;return this.setState({inFlight:!0}),t({path:(0,i.addQueryArgs)(`${newspackAudienceCampaigns.api}/${e}/duplicate`,{title:n}),method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((()=>{s({code:"duplicate_prompt_error",message:(0,a.__)("Error duplicating prompt. Please try again later.","newspack-plugin")})}))};previewUrlForPopup=({options:e,id:n})=>{const{placement:s,trigger_type:t}=e,a=window.newspackAudienceCampaigns?.preview_query_keys||{},i={};Object.keys(e).forEach((n=>{a.hasOwnProperty(n)&&(i[a[n]]=e[n])}));let r="/";return"archives"===s&&window.newspackAudienceCampaigns?.preview_archive?r=window.newspackAudienceCampaigns.preview_archive:("inline"===s||"scroll"===t)&&window&&window.newspackAudienceCampaigns?.preview_post&&(r=window.newspackAudienceCampaigns?.preview_post),`${r}?${(0,c.stringify)({...i,pid:n})}`};updateAfterAPI=({campaigns:e,prompts:n,segments:s,settings:t,duplicated:a=null})=>this.setState({campaigns:e,prompts:n,segments:s,settings:t,duplicated:a,inFlight:!1});manageCampaignGroup=(e,n="POST")=>{const{setError:s,wizardApiFetch:t}=this.props;return t({path:`${newspackAudienceCampaigns.api}/batch-publish/`,data:{ids:e.map((e=>e.id))},method:n,quiet:!0}).then(this.updateAfterAPI).catch((e=>s(e)))};render(){const{pluginRequirements:e,setError:n,isLoading:s,wizardApiFetch:t,startLoading:a,doneLoading:i}=this.props,{campaigns:c,inFlight:l,prompts:o,segments:p,settings:d,previewUrl:g,duplicated:_}=this.state;return(0,u.jsx)(r.LQ,{url:g,renderButton:({showPreview:r})=>{const g={headerText:De,tabbedNavigation:Ie,setError:n,isLoading:s,startLoading:a,doneLoading:i,wizardApiFetch:t,prompts:o,segments:p,settings:d,duplicated:_,inFlight:l},h={...g,manageCampaignGroup:this.manageCampaignGroup,updatePopup:this.updatePopup,deletePopup:this.deletePopup,restorePopup:this.restorePopup,duplicatePopup:this.duplicatePopup,previewPopup:e=>this.setState({previewUrl:this.previewUrlForPopup(e)},(()=>r())),publishPopup:this.publishPopup,resetDuplicated:()=>this.setState({duplicated:null}),unpublishPopup:this.unpublishPopup,refetch:this.refetch};return(0,u.jsx)(Ee,{hashType:"slash",children:(0,u.jsxs)(Oe,{children:[e,(0,u.jsx)(Me,{path:"/campaigns/:id?",render:e=>{const s=e.match.params.id;return(0,u.jsx)(te.Provider,{value:o,children:(0,u.jsx)(_e,{...h,archiveCampaignGroup:(e,s)=>t({path:`${newspackAudienceCampaigns.api}/archive-campaign/${e}`,method:s?"POST":"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e))),campaignId:s,createCampaignGroup:s=>t({path:`${newspackAudienceCampaigns.api}/create-campaign/`,method:"POST",data:{name:s},quiet:!0}).then((n=>{this.setState({campaigns:n.campaigns,prompts:n.prompts,segments:n.segments,settings:n.settings}),e.history.push(`/campaigns/${n.term_id}`)})).catch((e=>n(e))),deleteCampaignGroup:s=>t({path:`${newspackAudienceCampaigns.api}/delete-campaign/${s}`,method:"DELETE",quiet:!0}).then((n=>{this.setState({campaigns:n.campaigns,prompts:n.prompts,segments:n.segments,settings:n.settings}),e.history.push("/campaigns/")})).catch((e=>n(e))),duplicateCampaignGroup:(s,a)=>t({path:`${newspackAudienceCampaigns.api}/duplicate-campaign/${s}`,method:"POST",data:{name:a},quiet:!0}).then((n=>{this.setState({campaigns:n.campaigns,prompts:n.prompts,segments:n.segments,settings:n.settings}),e.history.push(`/campaigns/${n.term_id}`)})).catch((e=>n(e))),renameCampaignGroup:(e,s)=>t({path:`${newspackAudienceCampaigns.api}/rename-campaign/${e}`,method:"POST",data:{name:s},quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e))),campaigns:c})})}}),(0,u.jsx)(Me,{path:"/segments/:id?",render:e=>(0,u.jsx)(Le,{...e,...g,setSegments:e=>this.setState({segments:e})})}),(0,u.jsx)(Me,{path:"/settings",render:()=>(0,u.jsx)(he,{...g})}),(0,u.jsx)(ze,{to:"/campaigns"})]})})}})}}const Re=(0,r.Aq)(qe)},8445:(e,n,s)=>{"use strict";s.r(n),s.d(n,{default:()=>b}),s(8209);var t=s(5880),a=s.n(t),i=s(7723),c=s(6087),r=s(5135),l=s(9445),o=s(7143),p=s(6427),d=s(790);class u extends c.Component{render(){const{currencySymbol:e,error:n,label:s,min:t,value:a,onChange:i}=this.props;return(0,d.jsxs)("div",{className:"newspack-donations-wizard__money-input-container",children:[(0,d.jsx)("p",{className:"input-label",children:s}),(0,d.jsxs)("div",{className:"newspack-donations-wizard__money-input",children:[(0,d.jsx)("div",{className:"currency",children:e}),(0,d.jsx)(r.xt,{type:"number",hideLabelFromVision:!0,label:s,min:t,value:a,onChange:i})]}),n&&(0,d.jsx)("p",{className:"newspack-donations-wizard__money-input-error",children:n})]})}}const g=u;var _=s(3276),h=s(5829),m=s(3731);const w=()=>{const{additional_settings:e={}}=(0,l.l)(m.tF),{updateWizardSettings:n}=(0,o.useDispatch)(_.S),s=(e,s)=>n({slug:m.tF,path:["additional_settings",e],value:s}),{saveWizardSettings:t}=(0,o.useDispatch)(_.S),a=()=>t({slug:m.tF,section:"settings",payloadPath:["additional_settings"]});return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.Lz,{isMedium:!0,title:(0,i.__)("Collect transaction fees","newspack-plugin"),description:(0,i.__)("Allow donors to optionally cover transaction fees imposed by payment processors.","newspack-plugin"),notificationLevel:"info",toggleChecked:e.allow_covering_fees,toggleOnChange:()=>{s("allow_covering_fees",!e.allow_covering_fees),a()},hasGreyHeader:e.allow_covering_fees,hasWhiteHeader:!e.allow_covering_fees,children:e.allow_covering_fees&&(0,d.jsxs)(r.xA,{noMargin:!0,rowGap:16,children:[(0,d.jsx)(r.xt,{type:"number",step:"0.1",value:e.fee_multiplier,label:(0,i.__)("Fee multiplier","newspack-plugin"),onChange:e=>s("fee_multiplier",e)}),(0,d.jsx)(r.xt,{type:"number",step:"0.1",value:e.fee_static,label:(0,i.__)("Fee static portion","newspack-plugin"),onChange:e=>s("fee_static",e)}),(0,d.jsx)(r.xt,{value:e.allow_covering_fees_label,label:(0,i.__)("Custom message","newspack-plugin"),placeholder:(0,i.__)("A message to explain the transaction fee option (optional).","newspack-plugin"),onChange:e=>s("allow_covering_fees_label",e)}),(0,d.jsx)(p.CheckboxControl,{label:(0,i.__)("Cover fees by default","newspack-plugin"),checked:e.allow_covering_fees_default,onChange:()=>s("allow_covering_fees_default",!e.allow_covering_fees_default),help:(0,i.__)("If enabled, the option to cover the transaction fee will be checked by default.","newspack-plugin")})]})}),e.allow_covering_fees&&(0,d.jsx)("div",{className:"newspack-buttons-card",children:(0,d.jsx)(r.$n,{isPrimary:!0,onClick:a,children:(0,i.__)("Save Settings","newspack-plugin")})})]})},k={once:{tieredLabel:(0,i.__)("One-time donations"),staticLabel:(0,i.__)("Suggested one-time donation amount")},month:{tieredLabel:(0,i.__)("Monthly donations"),staticLabel:(0,i.__)("Suggested donation amount per month")},year:{tieredLabel:(0,i.__)("Annual donations"),staticLabel:(0,i.__)("Suggested donation amount per year")}},x=Object.keys(k),f=()=>{const e=(0,l.l)(m.tF),{updateWizardSettings:n}=(0,o.useDispatch)(_.S);if(!e.donation_data||"errors"in e.donation_data)return null;const{amounts:s,currencySymbol:t,tiered:a,disabledFrequencies:c,minimumDonation:u,trashed:h}=e.donation_data,w=e=>s=>n({slug:m.tF,path:["donation_data",...e],value:s}),f=x.map((e=>({key:e,...k[e]}))),v=parseFloat(u),b=window.newspackAudienceDonations?.can_use_name_your_price;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(r.Zp,{headerActions:!0,noBorder:!0,children:[(0,d.jsx)(r.X3,{title:(0,i.__)("Suggested Donations","newspack-plugin"),description:(0,i.__)("Set suggested donation amounts. These will be the default settings for the Donate block.","newspack-plugin"),noMargin:!0}),b&&(0,d.jsx)(r.Yq,{label:(0,i.__)("Donation Type","newspack-plugin"),onChange:()=>w(["tiered"])(!a),buttonOptions:[{value:!0,label:(0,i.__)("Tiered","newspack-plugin")},{value:!1,label:(0,i.__)("Untiered","newspack-plugin")}],buttonSmall:!0,value:a,hideLabelFromVision:!0})]}),Array.isArray(h)&&0<h.length&&(0,d.jsx)(r.$T,{isError:!0,children:(0,d.jsx)("span",{dangerouslySetInnerHTML:{__html:(0,i.sprintf)(
// Translators: %1$s is a link to the trashed products. %2$s is a comma-separated list of trashed product names.
// Translators: %1$s is a link to the trashed products. %2$s is a comma-separated list of trashed product names.
(0,i.__)('One or more donation products is in trash. Please <a href="%1$s">restore the product(s)</a> to continue using donation features: %2$s',"newspack-plugin"),"/wp-admin/edit.php?post_status=trash&post_type=product",h.join(", "))}})}),a?(0,d.jsx)(r.xA,{columns:1,children:f.map((e=>{const n=c[e.key],a=Object.values(c).filter(Boolean).length===x.length-1;return(0,d.jsx)(r.Zp,{noBorder:!0,children:(0,d.jsxs)(r.xA,{columns:1,gutter:8,children:[(0,d.jsx)(p.ToggleControl,{checked:!n,onChange:()=>w(["disabledFrequencies",e.key])(!n),label:e.tieredLabel,disabled:!n&&a}),!n&&(0,d.jsxs)(r.xA,{columns:3,rowGap:16,children:[(0,d.jsx)(g,{currencySymbol:t,label:(0,i.__)("Low-tier"),error:s[e.key][0]<v?(0,i.__)("Warning: suggested donations should be at least the minimum donation amount.","newspack-plugin"):null,value:s[e.key][0],min:v,onChange:w(["amounts",e.key,0])}),(0,d.jsx)(g,{currencySymbol:t,label:(0,i.__)("Mid-tier"),error:s[e.key][1]<v?(0,i.__)("Warning: suggested donations should be at least the minimum donation amount.","newspack-plugin"):null,value:s[e.key][1],min:v,onChange:w(["amounts",e.key,1])}),(0,d.jsx)(g,{currencySymbol:t,label:(0,i.__)("High-tier"),error:s[e.key][2]<v?(0,i.__)("Warning: suggested donations should be at least the minimum donation amount.","newspack-plugin"):null,value:s[e.key][2],min:v,onChange:w(["amounts",e.key,2])})]})]})},e.key)}))}):(0,d.jsx)(r.xA,{columns:1,children:(0,d.jsx)(r.Zp,{noBorder:!0,children:(0,d.jsx)(r.xA,{columns:3,rowGap:16,children:f.map((e=>{const n=c[e.key],a=Object.values(c).filter(Boolean).length===x.length-1;return(0,d.jsxs)(r.xA,{columns:1,gutter:16,children:[(0,d.jsx)(p.ToggleControl,{checked:!n,onChange:()=>w(["disabledFrequencies",e.key])(!n),label:e.tieredLabel,disabled:!n&&a}),!n&&(0,d.jsx)(g,{currencySymbol:t,label:e.staticLabel,value:s[e.key][3],min:v,error:s[e.key][3]<v?(0,i.__)("Warning: suggested donations should be at least the minimum donation amount.","newspack-plugin"):null,onChange:w(["amounts",e.key,3])},e.key)]},e.key)}))})})}),(0,d.jsx)(r.xA,{columns:3,children:(0,d.jsx)(r.xt,{label:(0,i.__)("Minimum donation","newspack-plugin"),help:(0,i.__)("Set minimum donation amount. Setting a reasonable minimum donation amount can help protect your site from bot attacks.","newspack-plugin"),type:"number",min:1,value:v,onChange:e=>w(["minimumDonation"])(e)})})]})},v=()=>{const e=(0,l.l)(m.tF),{saveWizardSettings:n}=(0,o.useDispatch)(_.S);return(0,d.jsxs)(h.A,{title:(0,i.__)("Configuration","newspack-plugin"),children:[e.donation_page&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(r.Zp,{noBorder:!0,headerActions:!0,children:[(0,d.jsx)(r.X3,{title:(0,i.__)("Donations Landing Page","newspack-plugin"),noMargin:!0}),(0,d.jsx)(r.$n,{variant:"secondary",isSmall:!0,href:e.donation_page.editUrl,onClick:void 0,children:(0,i.__)("Edit Page")})]}),"publish"===e.donation_page.status?(0,d.jsx)(r.$T,{isSuccess:!0,noticeText:(0,i.__)("Your donations landing page is published.","newspack-plugin")}):(0,d.jsx)(r.$T,{isError:!0,noticeText:(0,i.__)("Your donations landing page is not yet published.","newspack-plugin")})]}),(0,d.jsx)(f,{}),(0,d.jsx)("div",{className:"newspack-buttons-card",children:(0,d.jsx)(r.$n,{variant:"primary",onClick:()=>n({slug:m.tF,payloadPath:["donation_data"],auxData:{saveDonationProduct:!0}}),children:(0,i.__)("Save Settings","newspack-plugin")})}),(0,d.jsx)(r.X3,{title:(0,i.__)("Additional Settings","newspack-plugin")}),(0,d.jsx)(w,{})]})},b=(0,r.Aq)((0,c.forwardRef)(((e,n)=>{const{platform_data:s,donation_data:t}=(0,l.l)(m.tF),c=s?.platform,o=[{label:(0,i.__)("Configuration","newspack-plugin"),path:"/configuration",render:v,isHidden:c===m.Zs}];return(0,d.jsx)(r.sQ,{headerText:(0,i.__)("Audience Management / Donations","newspack-plugin"),sections:o,apiSlug:m.tF,renderAboveSections:()=>a()(t?.errors).map(((e,n)=>(0,d.jsx)(r.$T,{isError:!0,noticeText:e},n))),requiredPlugins:["newspack-blocks"],ref:n})})))},2445:(e,n,s)=>{"use strict";s.r(n),s.d(n,{default:()=>se});var t=s(7723),a=s(6087),i=s(6427),c=s(1455),r=s.n(c),l=s(5135),o=s(5829),p=s(9026),d=s(790);function u({slug:e,config:n,getSharedProps:s,inFlight:a,prerequisite:c,saveConfig:r,skipPrerequisite:o}){const{href:u}=c,g=Boolean(c.is_skipped),_=Boolean(g||c.active),h=Object.keys(c.fields||{});let m=(0,t.__)("Pending","newspack-plugin");return _&&(m=(0,t.__)("Ready","newspack-plugin")),g&&!c.active&&(m=(0,t.__)("Skipped","newspack-plugin")),c.is_unavailable&&(m=(0,t.__)("Unavailable","newspack-plugin")),(0,d.jsx)(l.Lz,{className:"newspack-ras-wizard__prerequisite",isMedium:!0,expandable:!c.is_unavailable,collapse:_,title:c.label,description:(0,t.sprintf)(/* translators: %s: Prerequisite status */ /* translators: %s: Prerequisite status */
(0,t.__)("Status: %s","newspack-plugin"),m),checkbox:_&&!g?"checked":"unchecked",notificationLevel:"info",notification:_&&c.fields&&c.warning&&Object.keys(c.fields).filter((e=>""===n[e])).length?c.warning:null,children:c.is_unavailable?null:(0,d.jsxs)(d.Fragment,{children:[c.description&&(0,d.jsxs)("p",{children:[c.description,c.help_url&&(0,d.jsxs)(d.Fragment,{children:[" ",(0,d.jsx)(i.ExternalLink,{href:c.help_url,children:(0,t.__)("Learn more","newspack-plugin")})]})]}),(c.fields||c.action_text)&&(0,d.jsx)(l.xA,{columns:2,gutter:16,children:(0,d.jsxs)("div",{className:"button-group",children:[c.fields&&(0,d.jsxs)(d.Fragment,{children:[h.map((e=>{if(c.fields&&c.fields[e])return(0,d.jsx)(l.xt,{label:c.fields[e].label,help:c.fields[e].description,...s(e,"text")},e)})),(0,d.jsx)(l.$n,{variant:"primary",onClick:()=>{const e={};h.forEach((s=>{n[s]&&(e[s]=n[s])})),r(e)},disabled:a,children:a?(0,t.__)("Saving…","newspack-plugin"):(0,t.sprintf)(
// Translators: Save or Update settings.
// Translators: Save or Update settings.
(0,t.__)("%s settings","newspack-plugin"),_?(0,t.__)("Update","newspack-plugin"):(0,t.__)("Save","newspack-plugin"))})]}),u&&c.action_text&&(0,d.jsxs)(d.Fragment,{children:[(!c.hasOwnProperty("action_enabled")||c.action_enabled)&&(0,d.jsx)(l.$n,{variant:"primary",onClick:()=>{c.instructions&&window.localStorage.setItem(p.J,JSON.stringify({message:(0,t.sprintf)(
// Translators: %s is specific instructions for satisfying the prerequisite.
// Translators: %s is specific instructions for satisfying the prerequisite.
(0,t.__)("%1$s%2$sReturn to the Audience Configuration page to complete the settings and activate%3$s.","newspack-plugin"),c.instructions+" ",window.newspackAudience?.reader_activation_url?`<a href="${window.newspackAudience.reader_activation_url}">`:"",window.newspackAudience?.reader_activation_url?"</a>":""),url:u})),window.location.href=u},children:(_?(0,t.__)("Update ","newspack-plugin"):c.fields?(0,t.__)("Save ","newspack-plugin"):(0,t.__)("Configure ","newspack-plugin"))+c.action_text}),c.hasOwnProperty("action_enabled")&&!c.action_enabled&&(0,d.jsx)(l.$n,{variant:"secondary",disabled:!0,children:c.disabled_text||c.action_text})]}),c.skippable&&!c.active&&!g&&(0,d.jsx)(l.$n,{variant:"secondary",isDestructive:!0,onClick:()=>{o({prerequisite:e,skip:!0})},children:(0,t.__)("Skip","newspack-plugin")})]})})]})})}function g({title:e,value:n,onChange:s}){const[i,c]=(0,a.useState)(!1),[o,p]=(0,a.useState)([]),[u,g]=(0,a.useState)(!1);(0,a.useEffect)((()=>{g(!1),c(!0),r()({path:"/newspack-newsletters/v1/lists"}).then((e=>{const n=_?e.filter((e=>"Mailchimp Audience"===e.type_label)):e;p(n)})).catch(g).finally((()=>c(!1)))}),[]);const _="Mailchimp"===e,h=_?(0,t.__)("Audience ID","newspack-plugin"):(0,t.__)("Master List","newspack-plugin"),m=_?(0,t.__)("Choose an audience to receive reader activity data.","newspack-plugin"):(0,t.__)("Choose a master list to which all registered readers will be added.","newspack-plugin"),w=e=>n=>s&&s(e,n);return(0,d.jsxs)(d.Fragment,{children:[u&&(0,d.jsx)(l.$T,{noticeText:u?.message||(0,t.__)("Something went wrong.","newspack-plugin"),isError:!0}),(0,d.jsx)(l.X3,{title:(0,t.sprintf)(/** Translators: %s is the email service provider title */ /** Translators: %s is the email service provider title */(0,t.__)("%s settings","newspack-plugin"),e),description:(0,t.sprintf)(/** Translators: %s is the email service provider title */ /** Translators: %s is the email service provider title */(0,t.__)("Settings for the %s integration.","newspack-plugin"),e)}),""===n.masterList&&(0,d.jsx)(l.$T,{noticeText:(0,t.sprintf)(
// Translators: 1 is the term used to refer to lists for a given email service provider and 2 is the email service provider title
// Translators: 1 is the term used to refer to lists for a given email service provider and 2 is the email service provider title
(0,t.__)("No %1$s selected. You will not be able to send reader activity data to %2$s.","newspack-plugin"),h,e),isError:!0}),(0,d.jsx)(l.Yq,{label:h,help:m,disabled:i,value:_?n.audienceId:n.masterList,onChange:w(_?"audienceId":"masterList"),options:[{value:"",label:(0,t.__)("None","newspack-plugin")},...o.map((e=>({label:e.name,value:e.id})))]}),"readerDefaultStatus"in n&&n.audienceId&&(0,d.jsx)(l.Yq,{label:(0,t.__)("Default reader status","newspack-plugin"),help:(0,t.sprintf)(
// Translators: %s is the email service provider title.
// Translators: %s is the email service provider title.
(0,t.__)("Choose which %s status readers should have by default if they are not subscribed to any newsletters","newspack-plugin"),e),disabled:i,value:n.readerDefaultStatus,onChange:w("readerDefaultStatus"),options:[{value:"transactional",label:(0,t.__)("Transactional/Non-Subscribed","newspack-plugin")},{value:"subscribed",label:(0,t.__)("Subscribed","newspack-plugin")}]})]})}const _=({availableFields:e,getSharedProps:n,selectedFields:s,updateConfig:a})=>(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(l.X3,{title:(0,t.__)("Metadata field settings","newspack-plugin"),description:(0,t.__)("Select which data to sync for each contact.","newspack-plugin")}),(0,d.jsx)(l.xt,{label:(0,t.__)("Metadata field prefix","newspack-plugin"),help:(0,t.__)("A string to prefix metadata fields attached to each contact synced to the ESP. Required to ensure that metadata field names are unique. Default: NP_","newspack-plugin"),...n("metadata_prefix","text")}),(0,d.jsx)(l.xA,{columns:3,rowGap:16,children:e.map(((e,n)=>(0,d.jsx)(i.CheckboxControl,{className:"newspack-checkbox-control",label:e.replace(": ",""),checked:s.includes(e),onChange:n=>{const t=[...s];a("metadata_fields",n?[...t,e]:t.filter((n=>n!==e)))}},n)))})]});var h=s(5573);const m=(0,d.jsx)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,d.jsx)(h.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})});var w=s(7677),k=s(3756),x=s(2485),f=s(9936),v=s(1821);function b({lists:e,selected:n=[],onChange:s=(()=>{})}){if(!Array.isArray(e)&&e.errors)return(0,d.jsx)(i.Notice,{status:"error",isDismissible:!1,children:Object.values(e.errors).join(", ")});const a=()=>e.filter((e=>e.active&&!n.find((({id:n})=>n===e.id))));return(0,d.jsxs)("div",{className:"newspack__newsletter-list-control",children:[(0,d.jsx)("div",{className:"newspack__newsletter-list-control__selected",children:n.map((a=>{const i=(c=a.id,e.find((e=>e.id===c)));var c;return i?(0,d.jsx)(f.A,{title:i.name,description:()=>(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("input",{type:"checkbox",checked:a.checked,onChange:()=>{const e=n.findIndex((({id:e})=>e===a.id)),t=[...n];t[e].checked=!t[e].checked,s(t)}}),(0,t.__)("Checked by default","newspack-plugin")]}),isSmall:!0,actionText:(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(v.A,{onClick:()=>s(n.filter((({id:e})=>e!==a.id))),label:(0,t.__)("Remove","newspack-plugin"),icon:m})}),children:n.length>1&&(0,d.jsxs)("span",{className:"newspack__newsletter-list-control__sort-handle",children:[(0,d.jsx)("button",{onClick:()=>{const e=n.findIndex((({id:e})=>e===a.id));if(0===e)return;const t=[...n];t.splice(e,1),t.splice(e-1,0,a),s(t)},className:0===n.findIndex((({id:e})=>e===a.id))?"disabled":"",children:(0,d.jsx)(w.A,{icon:k.A})}),(0,d.jsx)("button",{onClick:()=>{const e=n.findIndex((({id:e})=>e===a.id)),t=[...n];t.splice(e,1),t.splice(e+1,0,a),s(t)},className:n.findIndex((({id:e})=>e===a.id))===n.length-1?"disabled":"",children:(0,d.jsx)(w.A,{icon:x.A})})]})},`selected-${a.id}`):null}))}),a().length>0&&(0,d.jsxs)("p",{className:"newspack__newsletter-list-control__lists",children:[n.length>0?(0,d.jsx)("strong",{children:(0,t.__)("Add more lists:","newspack-plugin")}):(0,d.jsx)("strong",{children:(0,t.__)("Select lists:","newspack-plugin")})," ",a().map((e=>(0,d.jsx)(v.A,{variant:"secondary",onClick:()=>s([...n,{id:e.id,checked:!0}]),children:e.name},e.id)))]})]})}var j=s(5373),y=s(9491),C=s(7143),S=s(3832),A=s(9445),P=s(3276);const $=()=>{const{salesforce_redirect_url:e}=window?.newspackAudience||{},n=(0,A.l)("newspack-audience/salesforce"),[s,c]=(0,a.useState)(n.refresh_token),[r,o]=(0,a.useState)(null),{createNotice:p}=(0,C.useDispatch)("core/notices"),u=(0,y.useCopyToClipboard)(e,(()=>{p("info",(0,t.__)("Redirect URL copied to clipboard.","newspack-plugin"),{isDismissible:!0,type:"snackbar"})})),{saveWizardSettings:g,wizardApiFetch:_}=(0,C.useDispatch)(P.S);return(0,a.useEffect)((()=>{const n=(0,j.parse)(window.location.search).code;n&&(window.history.replaceState({},"",e),(async n=>{try{const s=await _({path:"/newspack/salesforce/v1/tokens",method:"POST",data:{code:n,redirect_uri:e}}),{access_token:t,client_id:a,client_secret:i,instance_url:r,refresh_token:l}=s;t&&l&&g({slug:"newspack-audience/salesforce",payloadPath:["salesforce_settings"],updatePayload:{path:["salesforce_settings"],value:{access_token:t,client_id:a,client_secret:i,instance_url:r,refresh_token:l}}}),c(!0)}catch(e){o((0,t.__)("We couldn’t establish a connection to Salesforce. Please verify your Consumer Key and Secret and try connecting again.","newspack-plugin"))}})(n))}),[]),(0,a.useEffect)((()=>{s?(async()=>{const e=await _({path:"/newspack/salesforce/v1/connection-status",method:"POST",isQuietFetch:!0});e.error&&o(e.error)})():o(null)}),[s]),(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(l.x5,{afterUpdate:n=>{let s,t;if((n?.salesforce||[]).forEach((e=>{"newspack_salesforce_client_id"===e.key?s=e.value:"newspack_salesforce_client_secret"===e.key&&(t=e.value)})),s&&t&&e){const n=(0,S.addQueryArgs)("https://login.salesforce.com/services/oauth2/authorize",{response_type:"code",client_id:encodeURIComponent(s),client_secret:encodeURIComponent(t),redirect_uri:encodeURI(e)});window.location.assign(n)}else c(!1)},pluginSlug:"newspack/salesforce",title:(0,t.__)("Salesforce Settings","newspack-plugin"),description:()=>(0,d.jsxs)(d.Fragment,{children:[r&&(0,d.jsx)(l.$T,{noticeText:r,isWarning:!0}),s&&!r&&(0,d.jsx)(l.$T,{noticeText:(0,t.__)("Your site is connected to Salesforce.","newspack-plugin"),isSuccess:!0}),(0,t.__)("Establish a connection to sync WooCommerce order data to Salesforce. To connect with Salesforce, create or choose a Connected App for this site in your Salesforce dashboard. Make sure to paste the full URL for this page (","newspack-plugin"),(0,d.jsx)(i.Button,{ref:u,className:"newspack-button is-link",children:(0,t.__)("copy to clipboard","newspack-plugin")}),(0,t.__)(") into the “Callback URL” field in the Connected App’s settings. ","newspack-plugin"),(0,d.jsx)(i.ExternalLink,{href:"https://help.salesforce.com/articleView?id=connected_app_create.htm",children:(0,t.__)("Learn how to create a Connected App","newspack-plugin")})]})})})},T=(0,l.c_)((({config:e,fetchConfig:n,updateConfig:s,getSharedProps:c,saveConfig:h,skipPrerequisite:m,prerequisites:w,espSyncErrors:k,error:x,inFlight:f})=>{const[v,j]=(0,a.useState)(!1),[y,C]=(0,a.useState)([]),[S,A]=(0,a.useState)("");return(0,a.useEffect)((()=>{window.scrollTo(0,0),window.localStorage.removeItem(p.J)}),[]),(0,a.useEffect)((()=>{r()({path:"/newspack/v1/wizard/newspack-newsletters/settings"}).then((e=>{var n;A(null!==(n=e?.settings?.newspack_newsletters_service_provider?.value)&&void 0!==n?n:"")}))}),[]),(0,a.useEffect)((()=>{const e=!y.length&&w&&Object.keys(w).every((e=>w[e]?.active||w[e]?.is_skipped));j(e),w&&C(Object.keys(w).reduce(((e,n)=>{const s=w[n];if(s.plugins)for(const n in s.plugins)s.plugins[n]||e.push(n);return e}),[]))}),[w]),(0,d.jsxs)(o.A,{title:(0,t.__)("Audience Management","newspack-plugin"),description:(0,d.jsxs)(d.Fragment,{children:[(0,t.__)("Newspack's Audience Management system is a set of features that aim to increase reader loyalty, promote engagement, and drive revenue. ","newspack-plugin"),(0,d.jsx)(i.ExternalLink,{href:"https://help.newspack.com/engagement/audience-management-system",children:(0,t.__)("Learn more","newspack-plugin")})]}),children:[x&&(0,d.jsx)(l.$T,{noticeText:x?.message||(0,t.__)("Something went wrong.","newspack-plugin"),isError:!0}),0<y.length&&(0,d.jsx)(l.$T,{noticeText:(0,t.__)("The following plugins are required.","newspack-plugin"),isWarning:!0}),0===y.length&&w&&!v&&(0,d.jsx)(l.$T,{noticeText:(0,t.__)("Complete these settings to enable Audience Management.","newspack-plugin"),isWarning:!0}),w&&v&&e.enabled&&(0,d.jsx)(l.$T,{noticeText:(0,t.__)("Audience Management is enabled.","newspack-plugin"),isSuccess:!0}),!w&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(l.E$,{isLeft:!0}),(0,t.__)("Fetching status…","newspack-plugin")]}),0<y.length&&w&&(0,d.jsx)(l.I2,{plugins:y,withoutFooterButton:!0,onStatus:({complete:e})=>e&&n()}),!y.length&&w&&Object.keys(w).map((s=>(0,d.jsx)(u,{slug:s,config:e,getSharedProps:c,inFlight:f,prerequisite:w[s],fetchConfig:n,saveConfig:h,skipPrerequisite:m},s))),e.enabled&&(0,d.jsxs)(l.Zp,{noBorder:!0,children:[(0,d.jsx)("hr",{}),(0,d.jsx)(l.X3,{title:(0,t.__)("Newsletter Subscription Lists","newspack-plugin")}),(0,d.jsx)(l.Lz,{title:(0,t.__)("Present newsletter signup after checkout and registration","newspack-plugin"),description:(0,t.__)("Ask readers to sign up for newsletters after creating an account or completing a purchase.","newspack-plugin"),toggleChecked:e.use_custom_lists,toggleOnChange:e=>s("use_custom_lists",e)}),e.use_custom_lists&&(0,d.jsx)(b,{lists:newspackAudience.available_newsletter_lists,selected:e.newsletter_lists,onChange:e=>s("newsletter_lists",e)}),(0,d.jsx)("hr",{}),(0,d.jsx)(l.X3,{title:(0,t.__)("Email Service Provider (ESP) Advanced Settings","newspack-plugin"),description:(0,t.__)("Settings for Newspack Newsletters integration.","newspack-plugin")}),(0,d.jsx)(l.xt,{label:(0,t.__)("Newsletter subscription text on registration","newspack-plugin"),help:(0,t.__)("The text to display while subscribing to newsletters from the sign-in modal.","newspack-plugin"),...c("newsletters_label","text")}),(0,d.jsx)(l.Lz,{description:(0,t.__)("Configure options for syncing reader data to the connected ESP.","newspack-plugin"),hasGreyHeader:!0,isMedium:!0,title:(0,t.__)("Sync contacts to ESP","newspack-plugin"),toggleChecked:e.sync_esp,toggleOnChange:e=>s("sync_esp",e),children:e.sync_esp&&(0,d.jsxs)(d.Fragment,{children:[0<Object.keys(k).length&&(0,d.jsx)(l.$T,{noticeText:Object.values(k).join(" "),isError:!0}),"mailchimp"===S&&(0,d.jsx)(g,{title:"Mailchimp",value:{audienceId:e.mailchimp_audience_id,readerDefaultStatus:e.mailchimp_reader_default_status},onChange:(e,n)=>{"audienceId"===e&&s("mailchimp_audience_id",n),"readerDefaultStatus"===e&&s("mailchimp_reader_default_status",n)}}),"active_campaign"===S&&(0,d.jsx)(g,{title:"ActiveCampaign",value:{masterList:e.active_campaign_master_list},onChange:(e,n)=>{"masterList"===e&&s("active_campaign_master_list",n)}}),"constant_contact"===S&&(0,d.jsx)(g,{title:"Constant Contact",value:{masterList:e.constant_contact_list_id},onChange:(e,n)=>{"masterList"===e&&s("constant_contact_list_id",n)}}),(0,d.jsx)(_,{availableFields:newspackAudience.esp_metadata_fields||[],selectedFields:e.metadata_fields,updateConfig:s,getSharedProps:c})]})}),(0,d.jsx)("div",{className:"newspack-buttons-card",children:(0,d.jsx)(l.$n,{isPrimary:!0,onClick:()=>{if(e.sync_esp){if("mailchimp"===S&&""===e.mailchimp_audience_id)return void alert((0,t.__)("Please select a Mailchimp Audience ID.","newspack-plugin"));if("active_campaign"===S&&""===e.active_campaign_master_list)return void alert((0,t.__)("Please select an ActiveCampaign Master List.","newspack-plugin"));if("constant_contact"===S&&""===e.constant_contact_list_id)return void alert((0,t.__)("Please select a Constant Contact Master List.","newspack-plugin"))}h({newsletters_label:e.newsletters_label,mailchimp_audience_id:e.mailchimp_audience_id,mailchimp_reader_default_status:e.mailchimp_reader_default_status,active_campaign_master_list:e.active_campaign_master_list,constant_contact_list_id:e.constant_contact_list_id,use_custom_lists:e.use_custom_lists,newsletter_lists:e.newsletter_lists,sync_esp:e.sync_esp,metadata_fields:e.metadata_fields,metadata_prefix:e.metadata_prefix,woocommerce_registration_required:e.woocommerce_registration_required,woocommerce_checkout_privacy_policy_text:e.woocommerce_checkout_privacy_policy_text,woocommerce_enable_subscription_confirmation:e.woocommerce_enable_subscription_confirmation,woocommerce_subscription_confirmation_text:e.woocommerce_subscription_confirmation_text,woocommerce_enable_terms_confirmation:e.woocommerce_enable_terms_confirmation,woocommerce_terms_confirmation_text:e.woocommerce_terms_confirmation_text,woocommerce_terms_confirmation_url:e.woocommerce_terms_confirmation_url,woocommerce_post_checkout_success_text:e.woocommerce_post_checkout_success_text,woocommerce_post_checkout_registration_success_text:e.woocommerce_post_checkout_registration_success_text})},disabled:f,children:(0,t.__)("Save Settings","newspack-plugin")})})]}),newspackAudience.can_use_salesforce&&(0,d.jsxs)(l.Zp,{noBorder:!0,children:[(0,d.jsx)("hr",{}),(0,d.jsx)($,{})]})]})}));function N({inFlight:e,prompt:n,setInFlight:s,setPrompts:c}){const[o,p]=(0,a.useState)({}),[u,g]=(0,a.useState)(!1),[_,h]=(0,a.useState)(!1),[m,w]=(0,a.useState)(!1),[k,x]=(0,a.useState)(null),[f,v]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(Array.isArray(n?.user_input_fields)){const e={...o};n.user_input_fields.forEach((n=>{e[n.name]=n.value||n.default})),p(e)}n.featured_image_id&&(s(!0),r()({path:`/wp/v2/media/${n.featured_image_id}`}).then((e=>{(e?.source_url||e?.url)&&x({url:e.source_url||e.url})})).catch(g).finally((()=>{s(!1)})))}),[n]),(0,a.useEffect)((()=>{setTimeout((()=>w(!1)),5e3)}),[m]);const b=(0,d.jsx)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24",children:(0,d.jsx)(i.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M4.5001 13C5.17092 13.3354 5.17078 13.3357 5.17066 13.3359L5.17346 13.3305C5.1767 13.3242 5.18233 13.3135 5.19036 13.2985C5.20643 13.2686 5.23209 13.2218 5.26744 13.1608C5.33819 13.0385 5.44741 12.8592 5.59589 12.6419C5.89361 12.2062 6.34485 11.624 6.95484 11.0431C8.17357 9.88241 9.99767 8.75 12.5001 8.75C15.0025 8.75 16.8266 9.88241 18.0454 11.0431C18.6554 11.624 19.1066 12.2062 19.4043 12.6419C19.5528 12.8592 19.662 13.0385 19.7328 13.1608C19.7681 13.2218 19.7938 13.2686 19.8098 13.2985C19.8179 13.3135 19.8235 13.3242 19.8267 13.3305L19.8295 13.3359C19.8294 13.3357 19.8293 13.3354 20.5001 13C21.1709 12.6646 21.1708 12.6643 21.1706 12.664L21.1702 12.6632L21.1693 12.6614L21.1667 12.6563L21.1588 12.6408C21.1522 12.6282 21.1431 12.6108 21.1315 12.5892C21.1083 12.5459 21.0749 12.4852 21.0311 12.4096C20.9437 12.2584 20.8146 12.0471 20.6428 11.7956C20.2999 11.2938 19.7823 10.626 19.0798 9.9569C17.6736 8.61759 15.4977 7.25 12.5001 7.25C9.50252 7.25 7.32663 8.61759 5.92036 9.9569C5.21785 10.626 4.70033 11.2938 4.35743 11.7956C4.1856 12.0471 4.05654 12.2584 3.96909 12.4096C3.92533 12.4852 3.89191 12.5459 3.86867 12.5892C3.85705 12.6108 3.84797 12.6282 3.84141 12.6408L3.83346 12.6563L3.8309 12.6614L3.82997 12.6632L3.82959 12.664C3.82943 12.6643 3.82928 12.6646 4.5001 13ZM12.5001 16C14.4331 16 16.0001 14.433 16.0001 12.5C16.0001 10.567 14.4331 9 12.5001 9C10.5671 9 9.0001 10.567 9.0001 12.5C9.0001 14.433 10.5671 16 12.5001 16Z",fill:e?"#828282":"#3366FF"})}),y=l.JL.usePrompt(_,(0,t.__)("You have unsaved changes. Discard changes?","newspack-plugin")),C=n.help_info||null;return(0,d.jsx)(l.Lz,{isMedium:!0,expandable:!0,collapse:n.ready&&!f,title:n.title,description:(0,t.sprintf)(
// Translators: Status of the prompt.
// Translators: Status of the prompt.
(0,t.__)("Status: %s","newspack-plugin"),_?(0,t.__)("Unsaved changes","newspack-plugin"):n.ready?(0,t.__)("Ready","newspack-plugin"):(0,t.__)("Pending","newspack-plugin")),checkbox:n.ready&&!_?"checked":"unchecked",children:(0,d.jsxs)(l.xA,{columns:2,gutter:64,className:"newspack-ras-campaign__grid",children:[(0,d.jsxs)("div",{className:"newspack-ras-campaign__fields",children:[n.user_input_fields.map((n=>(0,d.jsxs)(a.Fragment,{children:["array"===n.type&&Array.isArray(n.options)&&(0,d.jsx)(i.BaseControl,{id:`newspack-engagement-wizard__${n.name}`,label:n.label,children:n.options.map((s=>(0,d.jsx)(i.BaseControl,{id:`newspack-engagement-wizard__${s.id}`,className:"newspack-checkbox-control",help:s.description,children:(0,d.jsx)(i.CheckboxControl,{disabled:e,label:s.label,value:s.id,checked:o[n.name]?.indexOf(s.id)>-1,onChange:e=>{const t={...o};!e&&t[n.name].indexOf(s.id)>-1&&(t[n.name].value=t[n.name].splice(t[n.name].indexOf(s.id),1)),e&&-1===t[n.name].indexOf(s.id)&&t[n.name].push(s.id),p(t),h(!0)}})},s.id)))}),"string"===n.type&&n.max_length&&Array.isArray(o)&&150<n.max_length&&(0,d.jsx)(i.TextareaControl,{className:"newspack-textarea-control",label:n.label,disabled:e,help:`${o[n.name]?.length||0} / ${n.max_length}`,onChange:e=>{if(e.length>n.max_length)return;const s={...o};s[n.name]=e,p(s),h(!0)},placeholder:"string"==typeof n.default?n.default:"",rows:10,value:"string"==typeof o[n.name]?o[n.name]:""}),"string"===n.type&&n.max_length&&150>=n.max_length&&(0,d.jsx)(l.xt,{label:n.label,disabled:e,help:`${o[n.name]?.length||0} / ${n.max_length}`,onChange:e=>{if(e.length>n.max_length)return;const s={...o};s[n.name]=e,p(s),h(!0)},placeholder:n.default,value:o[n.name]||""}),"int"===n.type&&"featured_image_id"===n.name&&(0,d.jsx)(i.BaseControl,{id:`newspack-engagement-wizard__${n.name}`,label:n.label,children:(0,d.jsx)(l.BR,{buttonLabel:(0,t.__)("Select file","newspack-plugin"),disabled:e,image:k,onChange:e=>{const s={...o};s[n.name]=e?.id||0,s[n.name],o[n.name],p(s),h(!0),x(e?.url?e:null)}})})]},n.name))),u&&(0,d.jsx)(l.$T,{noticeText:u?.message||(0,t.__)("Something went wrong.","newspack-plugin"),isError:!0}),m&&(0,d.jsx)(l.$T,{noticeText:m,isSuccess:!0}),(0,d.jsxs)("div",{className:"newspack-buttons-card",children:[(0,d.jsx)(l.$n,{isPrimary:!0,onClick:()=>{var e,a;v(!1),e=n.slug,a=o,new Promise(((n,i)=>{y&&y(),g(!1),w(!1),s(!0),r()({path:"/newspack-popups/v1/audience-management/campaign",method:"post",data:{slug:e,data:a}}).then((e=>{c(e),w((0,t.__)("Prompt saved.","newspack-plugin")),h(!1),n()})).catch((e=>{g(e),i(e)})).finally((()=>{s(!1)}))}))},disabled:e,children:e?(0,t.__)("Saving…","newspack-plugin"):(0,t.sprintf)(
// Translators: Save or Update settings.
// Translators: Save or Update settings.
(0,t.__)("%s prompt settings","newspack-plugin"),n.ready?(0,t.__)("Update","newspack-plugin"):(0,t.__)("Save","newspack-plugin"))}),(0,d.jsx)(l.LQ,{url:(({options:e,slug:n})=>{const{placement:s,trigger_type:t}=e,a=window.newspackAudience.preview_query_keys,i={preset:n,values:o};Object.keys(e).forEach((n=>{a.hasOwnProperty(n)&&(i[a[n]]=e[n])}));let c="/";return"archives"===s&&window.newspackAudience?.preview_archive?c=window.newspackAudience.preview_archive:("inline"===s||"scroll"===t)&&window&&window.newspackAudience?.preview_post&&(c=window.newspackAudience?.preview_post),`${c}?${(0,j.stringify)({...i})}`})(n),renderButton:({showPreview:n})=>(0,d.jsx)(l.$n,{disabled:e,icon:b,isSecondary:!0,onClick:async()=>n(),children:(0,t.__)("Preview prompt","newspack-plugin")})})]})]}),C&&(0,d.jsxs)("div",{className:"newspack-ras-campaign__help",children:[C.screenshot&&(0,d.jsx)("img",{src:C.screenshot,alt:n.title}),C.description&&(0,d.jsxs)("p",{children:[(0,d.jsx)("span",{dangerouslySetInnerHTML:{__html:C.description}})," ",C.url&&(0,d.jsx)(i.ExternalLink,{href:"https://none.com",children:(0,t.__)("Learn more","newspack-plugin")})]}),C.recommendations&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("h4",{className:"newspack-ras-campaign__recommendation-heading",children:(0,t.__)("We recommend","newspack-plugin")}),(0,d.jsx)("ul",{children:C.recommendations.map(((e,n)=>(0,d.jsx)("li",{children:(0,d.jsx)("span",{dangerouslySetInnerHTML:{__html:e}})},n)))})]})]})]})})}var F=s(216);const{useHistory:L}=F.A,E=(0,l.c_)((({error:e,setError:n,skipPrerequisite:s})=>{const{reader_activation_url:i}=newspackAudience,[c,p]=(0,a.useState)(!1),[u,g]=(0,a.useState)(null),[_,h]=(0,a.useState)(!1),m=L();return(0,a.useEffect)((()=>{window.scrollTo(0,0),n(!1),p(!0),r()({path:"/newspack-popups/v1/audience-management/campaign"}).then((e=>{g(e)})).catch(n).finally((()=>p(!1)))}),[]),(0,a.useEffect)((()=>{Array.isArray(u)&&0<u.length&&h(u.every((e=>e.ready)))}),[u]),(0,d.jsxs)(o.A,{title:(0,t.__)("Set Up Audience Management Campaign","newspack-plugin"),description:(0,t.__)("Preview and customize the prompts, or use our suggested defaults.","newspack-plugin"),children:[e&&(0,d.jsx)(l.$T,{noticeText:e?.message||(0,t.__)("Something went wrong.","newspack-plugin"),isError:!0}),!u&&!e&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(l.E$,{isLeft:!0}),(0,t.__)("Retrieving prompts…","newspack-plugin")]}),u&&u.map((e=>(0,d.jsx)(N,{prompt:e,inFlight:c,setInFlight:p,setPrompts:g},e.slug))),(0,d.jsxs)("div",{className:"newspack-buttons-card",children:[(0,d.jsx)(l.$n,{variant:"secondary",isDestructive:!0,disabled:c,onClick:()=>{s({prerequisite:"ras_campaign",skip:!0},(()=>m.push("/complete")))},children:(0,t.__)("Skip","newspack-plugin")}),(0,d.jsx)(l.$n,{isPrimary:!0,disabled:c||!_,href:`${i}complete`,children:(0,t.__)("Continue","newspack-plugin")}),(0,d.jsx)(l.$n,{isSecondary:!0,disabled:c,href:i,children:(0,t.__)("Back","newspack-plugin")})]})]})})),z=[{text:(0,t.__)("Your <strong>current segments and prompts</strong> will be deactivated and archived.","newspack-plugin"),isSkipped:'<span class="is-skipped">[skipped]</span>'},{text:(0,t.__)("<strong>Reader registration</strong> will be activated to enable better targeting for driving engagement and conversations.","newspack-plugin")},{text:(0,t.__)("The <strong>Audience Management campaign</strong> will be activated with default segments and settings.","newspack-plugin"),isSkipped:'<span class="is-skipped">[skipped]</span>'}],M={campaignsSegments:(0,t.__)("Setting up new segments…","newspack-plugin"),readerRegistration:(0,t.__)("Activating reader registration…","newspack-plugin"),campaignsPrompts:(0,t.__)("Activating Audience Management Campaign…","newspack-plugin")},O=(0,l.c_)((({fetchConfig:e})=>{const[n,s]=(0,a.useState)(!1),[c,p]=(0,a.useState)(!1),[u,g]=(0,a.useState)(null),[_,h]=(0,a.useState)(!1),[m,w]=(0,a.useState)(!1),k=(0,a.useRef)(),[x,f]=(0,a.useState)(Object.values(M)),{reader_activation_url:v,is_skipped_campaign_setup:b=""}=newspackAudience,j="1"===b;(0,a.useEffect)((()=>{j&&f([M.readerRegistration])}),[j]);for(const e in z){var y;if(!z[e].text)continue;const n=j?` ${null!==(y=z[e].isSkipped)&&void 0!==y?y:""}`:"";var C;z[e]=`${z[e].text}${n}`,j&&(z[e]+=` ${null!==(C=z[e].isSkipped)&&void 0!==C?C:""}`)}return(0,a.useEffect)((()=>{k.current&&clearTimeout(k.current),c&&s(!1),!c&&n&&0<=u&&u<x.length&&(h(x[u]),k.current=setTimeout((()=>{g((e=>e+1))}),1e3+1e3*Math.random())),u>=x.length&&m&&(g(x.length+1),h((0,t.__)("Done!","newspack-plugin")),setTimeout((()=>{e().finally((()=>{s(!1),window.location.replace(v)}))}),3e3))}),[m,u]),(0,d.jsx)("div",{className:"newspack-ras-campaign__completed",children:(0,d.jsxs)(o.A,{title:(0,t.__)("Enable Audience Management","newspack-plugin"),description:(0,d.jsxs)(d.Fragment,{children:[(0,t.__)("An easy way to let your readers register for your site, sign up for newsletters, or become donors and paid members. ","newspack-plugin"),(0,d.jsx)(i.ExternalLink,{href:"https://help.newspack.com",children:(0,t.__)("Learn more","newspack-plugin")})]}),children:[n&&(0,d.jsx)(l.Zp,{className:"newspack-ras-campaign__completed-card",children:(0,d.jsx)(l.z2,{completed:u,displayFraction:!1,total:x.length+1,label:_})}),!n&&(0,d.jsxs)(l.Zp,{className:"newspack-ras-campaign__completed-card",children:[(0,d.jsx)("h2",{children:(0,t.__)("You're all set to enable Audience Management!","newspack-plugin")}),(0,d.jsx)("p",{children:(0,t.__)("This is what will happen next:","newspack-plugin")}),(0,d.jsx)(l.Zp,{noBorder:!0,className:"justify-center",children:(0,d.jsx)(l._y,{stepsListItems:z,narrowList:!0})}),c&&(0,d.jsx)(l.$T,{noticeText:c?.message||(0,t.__)("Something went wrong.","newspack-plugin"),isError:!0}),(0,d.jsx)(l.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-center",children:(0,d.jsx)(l.$n,{isPrimary:!0,onClick:()=>(async()=>{p(!1),s(!0),g(0);try{w(await r()({path:"/newspack/v1/wizard/newspack-audience/audience-management/activate",method:"post",data:{skip_activation:j}}))}catch(e){p(e)}})(),children:(0,t.__)("Enable Audience Management","newspack-plugin")})})]}),(0,d.jsx)("div",{className:"newspack-buttons-card",children:(0,d.jsx)(l.$n,{isSecondary:!0,disabled:n,href:`${v}campaign`,children:(0,t.__)("Back","newspack-plugin")})})]})})})),D=(0,l.c_)((()=>{const[e,n]=(0,a.useState)(!1),[s,c]=(0,a.useState)(!1),[p,u]=(0,a.useState)({});(0,a.useEffect)((()=>{g()}),[]);const g=()=>{c(!1),n(!0),r()({path:"/newspack/v1/wizard/newspack-audience/content-gating"}).then((e=>{u(e)})).catch(c).finally((()=>n(!1)))},_=e=>{c(!1),n(!0),r()({path:"/newspack/v1/wizard/newspack-audience/content-gating",method:"POST",data:e}).then((e=>{u(e)})).catch(c).finally((()=>n(!1)))};return(0,d.jsxs)(o.A,{title:(0,t.__)("Content Gating","newspack-plugin"),description:(0,d.jsxs)(d.Fragment,{children:[(0,t.__)("WooCommerce Memberships integration to improve the reader experience with content gating. ","newspack-plugin"),(0,d.jsx)(i.ExternalLink,{href:"https://help.newspack.com/engagement/audience-management-system/content-gating/",children:(0,t.__)("Learn more","newspack-plugin")})]}),children:[s&&(0,d.jsx)(l.$T,{noticeText:s?.message||(0,t.__)("Something went wrong.","newspack-plugin"),isError:!0}),(0,d.jsx)(l.Lz,{title:(0,t.__)("Content Gate","newspack-plugin"),titleLink:p.edit_gate_url,href:p.edit_gate_url,description:(()=>{let e=(0,t.__)("Configure the gate rendered on content with restricted access.","newspack-plugin");return"publish"===p?.gate_status?e+=" "+(0,t.__)("The gate is currently published.","newspack-plugin"):"draft"!==p?.gate_status&&"trash"!==p?.gate_status||(e+=" "+(0,t.__)("The gate is currently a draft.","newspack-plugin")),e})(),actionText:(0,t.__)("Configure","newspack-plugin")}),p?.plans&&1<p.plans.length&&(0,d.jsx)(l.Lz,{title:(0,t.__)("Require membership in all plans","newspack-plugin"),description:(0,t.__)("When enabled, readers must belong to all membership plans that apply to a restricted content item before they are granted access. Otherwise, they will be able to unlock access to that item with membership in any single plan that applies to it.","newspack-plugin"),toggleOnChange:e=>_({require_all_plans:e}),toggleChecked:p.require_all_plans,disabled:e}),(0,d.jsx)(l.Lz,{title:(0,t.__)("Display memberships on the subscriptions tab","newspack-plugin"),description:(0,t.__)("Display memberships that don't have active subscriptions on the My Account Subscriptions tab, so readers can see information like expiration dates.","newspack-plugin"),toggleOnChange:e=>_({show_on_subscription_tab:e}),toggleChecked:p.show_on_subscription_tab,disabled:e})]})}));var I=s(3731),q=s(8721);const R=()=>{const e=(0,A.l)("newspack-audience/payment"),{saveWizardSettings:n,updateWizardSettings:s}=(0,C.useDispatch)(P.S);return(0,d.jsxs)(q.A,{children:[(0,d.jsx)(l.Zp,{noBorder:!0,children:(0,d.jsx)(l.Yq,{label:(0,t.__)("Select Reader Revenue Platform","newspack"),value:e.platform_data?.platform,options:[{label:(0,t.__)("Other","newspack"),value:I.Zs},{label:(0,t.__)("Newspack","newspack"),value:I.L0},{label:(0,t.__)("News Revenue Hub","newspack"),value:I.FF}],onChange:e=>{n({slug:"newspack-audience/payment",payloadPath:["platform_data"],updatePayload:{path:["platform_data","platform"],value:e}})}})}),I.L0===e.platform_data?.platform&&!e.plugin_status&&(0,d.jsx)(l.I2,{plugins:["woocommerce","woocommerce-subscriptions"],onStatus:({complete:e})=>{e&&s({slug:"newspack-audience/payment",path:["plugin_status"],value:!0})},withoutFooterButton:!0})]})},B=({stripe:e})=>{const n=(0,C.useSelect)((e=>e(P.S).isLoading())),s=(0,C.useSelect)((e=>e(P.S).isQuietLoading())),{updateWizardSettings:a}=(0,C.useDispatch)(P.S),{saveWizardSettings:c}=(0,C.useDispatch)(P.S),r=e?.testMode,o=r?e?.is_connected_api_test:e?.is_connected_api_live,p=r?e?.is_connected_oauth_test:e?.is_connected_oauth_live;return(0,d.jsx)(l.Lz,{isMedium:!0,title:(0,t.__)("Stripe","newspack-plugin"),description:()=>(0,d.jsxs)(d.Fragment,{children:[(0,t.__)("Enable the Stripe payment gateway for WooCommerce. ","newspack-plugin"),(0,d.jsx)(i.ExternalLink,{href:"https://woocommerce.com/document/stripe/",children:(0,t.__)("Learn more","newspack-plugin")})]}),hasWhiteHeader:!0,toggleChecked:!!e.enabled,toggleOnChange:()=>{var n;n=!e.enabled,a({slug:"newspack-audience/payment",path:["payment_gateways","stripe","enabled"],value:n}),c({slug:"newspack-audience/payment",section:"stripe",payloadPath:["payment_gateways","stripe"]})},badge:e?.enabled?n||s?(0,t.__)("Loading…","newspack-plugin"):o?p?r?(0,t.__)("Connected - test mode","newspack-plugin"):(0,t.__)("Connected","newspack-plugin"):(0,t.__)("Needs attention","newspack-plugin"):(0,t.__)("Not connected","newspack-plugin"):null,badgeLevel:!e?.enabled||n||s?"info":o?p?"success":"warning":"error",actionContent:!e?.enabled||n||s?null:p?(0,d.jsx)(l.$n,{variant:"secondary",href:"/wp-admin/admin.php?page=wc-settings&tab=checkout&section=stripe&panel=settings",target:"_blank",rel:"noreferrer",children:(0,t.__)("Configure","newspack-plugin")}):(0,d.jsx)(l.$n,{variant:"primary",href:"/wp-admin/admin.php?page=wc-settings&tab=checkout&section=stripe&panel=payment-methods",target:"_blank",rel:"noreferrer",children:(0,t.__)("Connect","newspack-plugin")})})},H=({gateway:e})=>{const n=(0,C.useSelect)((e=>e(P.S).isLoading())),s=(0,C.useSelect)((e=>e(P.S).isQuietLoading())),{updateWizardSettings:a}=(0,C.useDispatch)(P.S),{saveWizardSettings:c}=(0,C.useDispatch)(P.S),r=e?.test_mode,o=e?.is_connected;return(0,d.jsx)(l.Lz,{isMedium:!0,title:e.name,description:()=>(0,d.jsxs)(d.Fragment,{children:[(0,t.sprintf)(
// Translators: %s is the payment gateway name.
// Translators: %s is the payment gateway name.
(0,t.__)("Enable %s. ","newspack-plugin"),e.name),e.url&&(0,d.jsx)(i.ExternalLink,{href:e.url,children:(0,t.__)("Learn more","newspack-plugin")})]}),hasWhiteHeader:!0,toggleChecked:!!e.enabled,toggleOnChange:()=>{var n;n=!e.enabled,a({slug:"newspack-audience/payment",path:["payment_gateways",e.slug,"enabled"],value:n}),c({slug:"newspack-audience/payment",section:"gateway",payloadPath:["payment_gateways",e.slug]})},badge:e?.enabled?n||s?(0,t.__)("Loading…","newspack-plugin"):o?r?(0,t.__)("Connected - test mode","newspack-plugin"):(0,t.__)("Connected","newspack-plugin"):(0,t.__)("Not connected","newspack-plugin"):null,badgeLevel:!e?.enabled||n||s?"info":o?"success":"error",actionContent:!e?.enabled||n||s?null:o?(0,d.jsx)(l.$n,{variant:"secondary",href:e.settings,target:"_blank",rel:"noreferrer",children:(0,t.__)("Configure","newspack-plugin")}):(0,d.jsx)(l.$n,{variant:"primary",href:e.connect,target:"_blank",rel:"noreferrer",children:(0,t.__)("Connect","newspack-plugin")})})},V=()=>{const{payment_gateways:e={},is_ssl:n,errors:s=[],plugin_status:a,platform_data:c={}}=(0,A.l)("newspack-audience/payment");return!1===a||"wc"!==c?.platform?null:(0,d.jsxs)(q.A,{title:(0,t.__)("Payment Gateways","newspack-plugin"),description:()=>(0,d.jsxs)(d.Fragment,{children:[(0,t.__)("Configure Newspack-supported payment gateways for WooCommerce. Payment gateways allow you to accept various payment methods from your readers. ","newspack-plugin"),(0,d.jsx)(i.ExternalLink,{href:"https://woocommerce.com/document/premium-payment-gateway-extensions/",children:(0,t.__)("Learn more","newspack-plugin")})]}),children:[s.length>0&&s.map(((e,n)=>(0,d.jsx)(l.$T,{isError:!0,noticeText:(0,d.jsx)("span",{children:e.message})},n))),!1===n&&(0,d.jsx)(l.$T,{isWarning:!0,noticeText:(0,d.jsxs)(d.Fragment,{children:[(0,t.__)("Missing or invalid SSL configuration detected. To collect payments, the site must be secured with SSL. ","newspack-plugin"),(0,d.jsx)(i.ExternalLink,{href:"https://stripe.com/docs/security/guide",children:(0,t.__)("Learn more","newspack-plugin")})]})}),Object.keys(e).map((n=>"stripe"===n?(0,d.jsx)(B,{stripe:e[n]},e[n]):(0,d.jsx)(H,{gateway:e[n]},n)))]})},W=()=>{const[e,n]=(0,a.useState)(null),s=(0,A.l)("newspack-audience/payment"),{updateWizardSettings:i,saveWizardSettings:c}=(0,C.useDispatch)(P.S);(0,a.useEffect)((()=>{s?.platform_data?.donor_landing_page&&n(s.platform_data.donor_landing_page)}),[]);const r=(e,n)=>i({slug:"newspack-audience/payment",path:["platform_data",e],value:n}),o=s?.platform_data||{};return(0,d.jsxs)(q.A,{title:(0,t.__)("News Revenue Hub Settings","newspack-plugin"),description:(0,t.__)("Configure your site’s connection to News Revenue Hub.","newspack-plugin"),children:[(0,d.jsx)("div",{children:(0,d.jsxs)(l.xA,{columns:3,children:[(0,d.jsx)(l.xt,{label:(0,t.__)("Organization ID","newspack-plugin"),placeholder:"exampleid",value:o?.nrh_organization_id||"",onChange:e=>r("nrh_organization_id",e)}),(0,d.jsx)(l.xt,{label:(0,t.__)("Custom domain (optional)","newspack-plugin"),help:(0,t.__)("Enter the raw domain without protocol or slashes."),placeholder:"donate.example.com",value:o?.nrh_custom_domain||"",onChange:e=>r("nrh_custom_domain",e)}),(0,d.jsx)(l.xt,{label:(0,t.__)("Salesforce Campaign ID (optional)","newspack-plugin"),placeholder:"exampleid",value:o?.nrh_salesforce_campaign_id||"",onChange:e=>r("nrh_salesforce_campaign_id",e)})]})}),o.hasOwnProperty("donor_landing_page")&&(0,d.jsxs)("div",{children:[(0,d.jsx)("hr",{}),(0,d.jsx)("h3",{children:(0,t.__)("Donor Landing Page","newspack-plugin")}),(0,d.jsx)("p",{className:"components-base-control__help",children:(0,t.__)("Set a page on your site as a donor landing page. Once a reader donates and lands on this page, they will be considered a donor.","newspack")}),(0,d.jsx)(l.IW,{label:(0,t.__)("Search for a New Donor Landing Page","newspack-plugin"),help:(0,t.__)("Begin typing page title, click autocomplete result to select.","newspack"),onChange:e=>{if(!e||!e.length)return n(null),r("donor_landing_page",null);const s=e[0];return n(s),r("donor_landing_page",s)},postTypes:[{slug:"page",label:"Page"}],postTypeLabel:(0,t.__)("page","newspack-plugin"),postTypeLabelPlural:(0,t.__)("pages","newspack-plugin"),selectedItems:e?[e]:[]})]}),(0,d.jsx)("div",{className:"newspack-buttons-card",children:(0,d.jsx)(l.$n,{isPrimary:!0,onClick:()=>c({slug:"newspack-audience/payment",payloadPath:["platform_data"]}),children:(0,t.__)("Save Settings")})})]})},G=()=>{const e=(0,A.l)("newspack-audience/billing-fields"),{updateWizardSettings:n,saveWizardSettings:s}=(0,C.useDispatch)(P.S),a=(0,C.useSelect)((e=>{var n;return null!==(n=e(P.S).isQuietLoading())&&void 0!==n&&n}),[]);if(!e)return null;const c=e=>n({slug:"newspack-audience/billing-fields",path:["billing_fields"],value:e}),r=e.available_billing_fields,o=e.order_notes_field;if(!r||!Object.keys(r).length)return null;const p=e.billing_fields.length?e.billing_fields:Object.keys(r);return(0,d.jsxs)(q.A,{title:(0,t.__)("Billing Fields","newspack-plugin"),description:(0,t.__)("Configure the billing fields shown in the modal checkout form. Fields marked with (*) are required if shown. Note that for shippable products, address fields will always be shown.","newspack-plugin"),className:a?"is-fetching":"",children:[(0,d.jsxs)(l.xA,{columns:3,rowGap:16,children:[Object.keys(r).map((e=>(0,d.jsx)(i.CheckboxControl,{label:r[e].label+(r[e].required?" *":""),checked:p.includes(e),disabled:"billing_email"===e,onChange:()=>{let n=[...p];n=p.includes(e)?n.filter((n=>n!==e)):[...n,e],c(n)}},e))),o&&(0,d.jsx)(i.CheckboxControl,{label:o.label,checked:p.includes("order_comments"),onChange:()=>{let e=[...p];e=p.includes("order_comments")?e.filter((e=>"order_comments"!==e)):[...e,"order_comments"],c(e)}})]}),(0,d.jsx)("div",{className:"newspack-buttons-card",children:(0,d.jsx)(l.$n,{variant:"primary",onClick:()=>s({slug:"newspack-audience/billing-fields"}),disabled:a,children:a?(0,t.__)("Saving…","newspack-plugin"):(0,t.__)("Save Settings","newspack-plugin")})})]})},U="newspack-audience/checkout-configuration",Z=function(){var e;const n=(0,A.l)(U),{updateWizardSettings:s,saveWizardSettings:a}=(0,C.useDispatch)(P.S),c=(0,C.useSelect)((e=>{var n;return null!==(n=e(P.S).isQuietLoading())&&void 0!==n&&n}),[]),r=(e,n)=>s({slug:U,path:[n],value:e});return(0,d.jsxs)(q.A,{title:(0,t.__)("Checkout Configuration","newspack-plugin"),className:c?"is-fetching":"",children:[(0,d.jsx)(i.ToggleControl,{label:(0,t.__)("Require sign in or create account before checkout","newspack-plugin"),help:(0,t.__)("Prompt users who are not logged in to sign in or register a new account before proceeding to checkout. When disabled, an account will automatically be created with the email address used at checkout.","newspack-plugin"),checked:null!==(e=n.woocommerce_registration_required)&&void 0!==e&&e,onChange:e=>r(e,"woocommerce_registration_required"),disabled:c}),(0,d.jsxs)(l.xA,{children:[(0,d.jsx)(i.TextareaControl,{label:(0,t.__)("Post-checkout success message","newspack-plugin"),help:(0,t.__)("The success message to display to readers after completing checkout.","newspack-plugin"),value:n.woocommerce_post_checkout_success_text,onChange:e=>r(e,"woocommerce_post_checkout_success_text")}),!n.woocommerce_registration_required&&(0,d.jsx)(i.TextareaControl,{label:(0,t.__)("Post-checkout registration success message","newspack-plugin"),help:(0,t.__)("The success message to display to new readers that have an account automatically created after completing checkout.","newspack-plugin"),value:n.woocommerce_post_checkout_registration_success_text,onChange:e=>r(e,"woocommerce_post_checkout_registration_success_text")})]}),(0,d.jsx)(l.xA,{children:(0,d.jsx)(i.TextareaControl,{label:(0,t.__)("Checkout privacy policy text","newspack-plugin"),help:(0,t.__)("The privacy policy text to display at time of checkout for existing users. This will not show up unless a privacy page is set.","newspack-plugin"),value:n.woocommerce_checkout_privacy_policy_text,onChange:e=>r(e,"woocommerce_checkout_privacy_policy_text")})}),(0,d.jsx)("div",{className:"newspack-buttons-card",children:(0,d.jsx)(l.$n,{variant:"primary",onClick:function(){a({slug:U})},disabled:c,children:c?(0,t.__)("Saving…","newspack-plugin"):(0,t.__)("Save Settings","newspack-plugin")})})]})},Y="newspack-audience/subscription-settings",Q=function(){var e,n;const s=(0,A.l)(Y),{updateWizardSettings:a,saveWizardSettings:c}=(0,C.useDispatch)(P.S),r=(0,C.useSelect)((e=>{var n;return null!==(n=e(P.S).isQuietLoading())&&void 0!==n&&n}),[]),o=(e,n)=>{"woocommerce_enable_subscription_confirmation"===n&&e&&a({slug:Y,path:["woocommerce_enable_terms_confirmation"],value:!1}),"woocommerce_enable_terms_confirmation"===n&&e&&a({slug:Y,path:["woocommerce_enable_subscription_confirmation"],value:!1}),a({slug:Y,path:[n],value:e})};return(0,d.jsxs)(q.A,{title:(0,t.__)("Subscription","newspack-plugin"),description:(0,t.__)("Manage the settings for subscription transparency and compliance.","newspack-plugin"),className:r?"is-fetching":"",children:[(0,d.jsxs)(l.xA,{columns:1,children:[(0,d.jsxs)(l.xA,{columns:1,gutter:8,children:[(0,d.jsx)(i.ToggleControl,{label:(0,t.__)("Enable subscription confirmation checkbox","newspack-plugin"),help:(0,t.__)("Display a separate checkbox at checkout to confirm the user understands this is a recurring subscription and they can cancel anytime.","newspack-plugin"),checked:null!==(e=s.woocommerce_enable_subscription_confirmation)&&void 0!==e&&e,onChange:e=>o(e,"woocommerce_enable_subscription_confirmation"),disabled:r}),s.woocommerce_enable_subscription_confirmation&&(0,d.jsx)(i.TextareaControl,{label:(0,t.__)("Label","newspack-plugin"),value:s.woocommerce_subscription_confirmation_text,onChange:e=>o(e,"woocommerce_subscription_confirmation_text")})]}),(0,d.jsxs)(l.xA,{columns:1,gutter:8,children:[(0,d.jsx)(i.ToggleControl,{label:(0,t.__)("Enable Terms & Conditions confirmation checkbox","newspack-plugin"),help:(0,t.__)("Display the 'I have read and accept the Terms & Conditions' checkbox at checkout. Ensure the Terms & Conditions include subscription details to comply with the FTC guidelines.","newspack-plugin"),checked:null!==(n=s.woocommerce_enable_terms_confirmation)&&void 0!==n&&n,onChange:e=>o(e,"woocommerce_enable_terms_confirmation"),disabled:r}),s.woocommerce_enable_terms_confirmation&&(0,d.jsxs)(l.xA,{children:[(0,d.jsx)(i.TextareaControl,{label:(0,t.__)("Label","newspack-plugin"),value:s.woocommerce_terms_confirmation_text,help:(0,t.__)("Text wrapped in {{ }} will be linked to the page set in the URL field.","newspack-plugin"),onChange:e=>o(e,"woocommerce_terms_confirmation_text")}),(0,d.jsx)(i.TextControl,{label:(0,t.__)("URL","newspack-plugin"),value:s.woocommerce_terms_confirmation_url,onChange:e=>o(e,"woocommerce_terms_confirmation_url")})]})]})]}),(0,d.jsx)("div",{className:"newspack-buttons-card",children:(0,d.jsx)(l.$n,{variant:"primary",onClick:function(){s.woocommerce_subscription_confirmation_text||a({slug:Y,path:["woocommerce_subscription_confirmation_text"],value:(0,t.__)("I understand this is a recurring subscription and that I can cancel anytime through the My Account Page.","newspack-plugin")}),s.woocommerce_terms_confirmation_text||a({slug:Y,path:["woocommerce_terms_confirmation_text"],value:(0,t.__)("I have read and accept the {{Terms & Conditions}}.","newspack-plugin")}),!s.woocommerce_enable_terms_confirmation||s.woocommerce_terms_confirmation_url?c({slug:Y}):alert((0,t.__)("Please provide a URL for the Terms & Conditions page.","newspack-plugin"))},disabled:r,children:r?(0,t.__)("Saving…","newspack-plugin"):(0,t.__)("Save Settings","newspack-plugin")})})]})},J=(0,l.c_)((function(){const e=(0,A.l)("newspack-audience/payment");return(0,d.jsxs)(o.A,{title:(0,t.__)("Checkout & Payment","newspack-plugin"),description:(0,t.__)("Reader revenue configuration for donations and subscriptions.","newspack-plugin"),children:[(0,d.jsx)(R,{}),"wc"===e?.platform_data?.platform&&(0,d.jsx)(V,{}),"wc"===e?.platform_data?.platform&&(0,d.jsx)(G,{}),"nrh"===e?.platform_data?.platform&&(0,d.jsx)(W,{}),(0,d.jsx)(Z,{}),"wc"===e?.platform_data?.platform&&(0,d.jsx)(Q,{})]})})),{HashRouter:X,Redirect:K,Route:ee,Switch:ne}=F.A,se=(0,l.Aq)((0,a.forwardRef)((function({confirmAction:e,pluginRequirements:n,wizardApiFetch:s},i){const[c,r]=(0,a.useState)(!1),[l,o]=(0,a.useState)({}),[p,u]=(0,a.useState)(null),[g,_]=(0,a.useState)(!1),[h,m]=(0,a.useState)([]),w=()=>(_(!1),r(!0),s({path:"/newspack/v1/wizard/newspack-audience/audience-management"}).then((({config:e,prerequisites_status:n,can_esp_sync:s})=>{u(n),o(e),m(s.errors)})).catch(_).finally((()=>r(!1)))),k=(e,n)=>{o({...l,[e]:n})};(0,a.useEffect)((()=>{window.scrollTo(0,0),w()}),[]);let x=[{label:l.enabled?(0,t.__)("Configuration","newspack-plugin"):(0,t.__)("Setup","newspack-plugin"),path:"/"},l.enabled&&newspackAudience.has_memberships&&{label:(0,t.__)("Content Gating","newspack-plugin"),path:"/content-gating"},{label:(0,t.__)("Checkout & Payment","newspack-plugin"),path:"/payment"}];x=x.filter((e=>e));const f={headerText:(0,t.__)("Audience Management","newspack-plugin"),tabbedNavigation:x,wizardApiFetch:s,inFlight:c,error:g,fetchConfig:w,updateConfig:k,saveConfig:e=>{_(!1),r(!0),s({path:"/newspack/v1/wizard/newspack-audience/audience-management",method:"post",quiet:!0,data:e}).then((({config:e,prerequisites_status:n,can_esp_sync:s})=>{u(n),o(e),m(s.errors)})).catch(_).finally((()=>r(!1)))},skipPrerequisite:(n,a=null)=>{e({message:(0,t.__)("Are you sure you want to skip this step? You can always come back later.","newspack-plugin"),confirmText:(0,t.__)("Skip","newspack-plugin"),callback:()=>{_(!1),r(!0),s({path:"/newspack/v1/wizard/newspack-audience/audience-management/skip",method:"post",quiet:!0,data:n}).then((({config:e,prerequisites_status:n,can_esp_sync:s})=>{u(n),o(e),m(s.errors),a&&a()})).catch(_).finally((()=>r(!1)))}})},setInFlight:r,setError:_,getSharedProps:(e,n="checkbox")=>{const s={onChange:n=>k(e,n)};switch("enabled"!==e&&(s.disabled=c),n){case"checkbox":s.checked=Boolean(l[e]);break;case"text":s.value=l[e]||""}return s},espSyncErrors:h,prerequisites:p,config:l};return(0,d.jsx)("div",{ref:i,children:(0,d.jsx)(X,{hashType:"slash",children:(0,d.jsxs)(ne,{children:[n,(0,d.jsx)(ee,{path:"/",exact:!0,render:()=>(0,d.jsx)(T,{...f})}),(0,d.jsx)(ee,{path:"/content-gating",render:()=>(0,d.jsx)(D,{...f})}),(0,d.jsx)(ee,{path:"/payment",render:()=>(0,d.jsx)(J,{...f})}),(0,d.jsx)(ee,{path:"/campaign",render:()=>(0,d.jsx)(E,{...f})}),(0,d.jsx)(ee,{path:"/complete",render:()=>(0,d.jsx)(O,{...f})}),(0,d.jsx)(K,{to:"/"})]})})})})))},7172:(e,n,s)=>{"use strict";s.r(n),s.d(n,{default:()=>p});var t=s(7723),a=s(6087),i=s(5135),c=s(5829),r=s(8721),l=s(790);const o=window.newspackAudienceSubscriptions.tabs,p=(0,i.Aq)((0,a.forwardRef)((function(e,n){const s=o.map((e=>({label:e.title,path:e.path,render:()=>(0,l.jsx)(c.A,{title:e.title,children:(0,l.jsx)(r.A,{children:(0,l.jsxs)(i.Zp,{isNarrow:!0,children:[(0,l.jsx)("h2",{children:e.header}),(0,l.jsx)("p",{children:e.description}),(0,l.jsx)(i.$n,{variant:"primary",href:e.href,children:e.btn_text})]})})})})));return(0,l.jsx)(i.sQ,{headerText:(0,t.__)("Audience Management / Subscriptions","newspack-plugin"),sections:s,requiredPlugins:["woocommerce","woocommerce-memberships"],ref:n})})))},8721:(e,n,s)=>{"use strict";s.d(n,{A:()=>i});var t=s(5135),a=s(790);function i({title:e,description:n,children:s=null,scrollToAnchor:i=null,className:c}){const r="newspack-wizard__section"+(c?` ${c}`:"");return(0,a.jsxs)("div",{className:r,children:[e&&(0,a.jsx)(t.X3,{id:i,heading:3,title:e,description:n}),s]})}},5829:(e,n,s)=>{"use strict";s.d(n,{A:()=>c});var t=s(7143),a=s(3276),i=s(790);const c=function({title:e,children:n,isFetching:s,description:c,...r}){const l=(0,t.useSelect)((e=>e(a.S).isLoading()),[]),o=r.className||"";return(0,i.jsxs)("div",{className:`${l||s?"is-fetching ":""}${o} newspack-wizard__sections`,children:[(0,i.jsx)("h1",{children:e}),c&&(0,i.jsx)("p",{className:"newspack-wizard__sections__description",children:c}),n]})}},514:(e,n,s)=>{var t=s(4932);e.exports=function(e,n){return t(n,(function(n){return e[n]}))}},3673:e=>{e.exports=function(e){for(var n=-1,s=null==e?0:e.length,t=0,a=[];++n<s;){var i=e[n];i&&(a[t++]=i)}return a}},5880:(e,n,s)=>{var t=s(514),a=s(5950);e.exports=function(e){return null==e?[]:t(e,a(e))}}}]);