(()=>{"use strict";function e(e="log",...t){"true"===localStorage.getItem("newspack-reader-activation-debug")&&console["error"===e?"error":"log"](...t)}const t="np_gate_interaction",n={...newspack_memberships_gate.metadata,referrer:window.location.pathname};function o(e){return!!e&&e.offsetWidth>0&&e.offsetHeight>0}function a(e,t){return t&&(n.gate_has_donation_block=o(t.querySelector(".wp-block-newspack-blocks-donate"))?"yes":"no",n.gate_has_registration_block=o(t.querySelector(".newspack-registration"))?"yes":"no",n.gate_has_checkout_button=o(t.querySelector(".wp-block-newspack-blocks-checkout-button"))?"yes":"no",n.gate_has_registration_link=o(t.querySelector('a[href="#register_modal"]'))?"yes":"no",n.gate_has_signin_link=o(t.querySelector('a[href="#signin_modal"]'))?"yes":"no"),{...n,...e}}function i(e){"function"==typeof window.gtag&&(!function(e){[...document.querySelectorAll(".newspack-reader-auth form"),...e.querySelectorAll(".newspack-registration form"),...e.querySelectorAll(".wp-block-newspack-blocks-checkout-button form"),...e.querySelectorAll(".wp-block-newspack-blocks-donate form")].forEach((n=>{if(!n.querySelector('input[name="memberships_content_gate"]')){const o=document.createElement("input");o.type="hidden",o.name="memberships_content_gate",o.value=newspack_memberships_gate.metadata?.gate_post_id||"1",n.appendChild(o),n.addEventListener("submit",(n=>function(e,n){if("function"!=typeof window.gtag)return;const o={action:"form_submission"},i=new FormData(e.target),c={};for(const e of i.entries())c[e[0]]=e[1];if(c["reader-activation-auth-form"]&&c.action&&(o.action_type="register"===c.action?"registration":"signin"),c.newspack_reader_registration&&(o.action_type="registration"),c.newspack_donate&&(o.action_type="donation",c.donation_currency&&(o.donation_currency=c.donation_currency),c.donation_frequency&&(o.donation_frequency=c.donation_frequency,c[`donation_value_${c.donation_frequency}`]&&(o.donation_amount=c[`donation_value_${c.donation_frequency}`],"other"===o.donation_amount&&c[`donation_value_${c.donation_frequency}_other`]&&(o.donation_amount=c[`donation_value_${c.donation_frequency}_other`])))),c.newspack_checkout){o.action_type="checkout_button";const t=e.target.getAttribute("data-checkout")?JSON.parse(e.target.getAttribute("data-checkout")):null;t&&Object.assign(o,t)}window.gtag("event",t,a(o,n))}(n,e)))}}))}(e),window.gtag("event",t,a({action:"seen"},e)))}var c;c=function(){const n=document.querySelector(".newspack-memberships__gate");if(n)if(e("log","[Gate] initReloadHandler called"),window.newspackRAS=window.newspackRAS||[],window.newspackRAS.push((function(n){e("log","[Gate] RAS initialized");let o=!1;const i=function(i){if(e("log","[Gate] refreshPage called with event:",i),e("log","[Gate] Event detail:",i?.detail),e("log","[Gate] Event detail action:",i?.detail?.action),e("log","[Gate] Pending checkout:",window?.newspackReaderActivation?.getPendingCheckout()),i?.detail?.action&&"reader_registered"===i.detail.action&&!window?.newspackReaderActivation?.getPendingCheckout()&&(e("log","[Gate] reader_registered action detected"),o=!0),i?.detail?.overlays&&i.detail.removed){const n=window?.newspackReaderActivation?.getActivities();e("log","[Gate] Overlay removed, activities:",n);const i=n?.[n.length-1]||{},c=["checkout_completed","reader_registered","reader_logged_in","newsletter_signup"];n.length&&c.includes(i.action)?(e("log","[Gate] Valid action detected:",i.action),o=!0,document.body.classList.add("newspack-memberships__gate-passed")):(o=!1,function(){if("function"!=typeof window.gtag)return;const e=a({action:"dismissed"});window.gtag("event",t,e)}())}i?.detail?.action&&"reader_logged_in"===i.detail.action&&(e("log","[Gate] reader_logged_in action detected"),o=!0),setTimeout((()=>{const t=n.overlays.get(),a=window?.newspackReaderActivation?.getActivities();e("log","[Gate] Checking reload conditions - overlays:",t,"reload:",o),e("log","[Gate] Current activities:",a),!t.length&&o&&(e("log","[Gate] Reloading page!"),window.location.reload())}),5)};n.on("overlay",i),n.on("activity",i)})),n.classList.contains("newspack-memberships__overlay-gate"))!function(e){let t=document.querySelector(".entry-content");t||(t=document.querySelector("#content")),e.style.removeProperty("display");let n=!1;const o=()=>{let o=!1;(t?.getBoundingClientRect().top||0)-window.innerHeight/2<0&&(o=!0,n||i(e),n=!0),e.setAttribute("data-visible",o)};document.addEventListener("scroll",o),o()}(n);else{const e=()=>{(n?.getBoundingClientRect().top||0)-window.innerHeight/2<0&&"function"==typeof window.gtag&&(i(n),document.removeEventListener("scroll",e))};document.addEventListener("scroll",e),e()}},"undefined"!=typeof document&&("complete"!==document.readyState&&"interactive"!==document.readyState?document.addEventListener("DOMContentLoaded",c):c())})();