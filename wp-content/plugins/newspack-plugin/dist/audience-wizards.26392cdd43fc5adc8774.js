(globalThis.webpackChunknewspack=globalThis.webpackChunknewspack||[]).push([[2662],{31:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>B}),t(8209);var s=t(7723),a=t(6087),i=t(1311),c=t(1455),r=t.n(c),l=t(7143),o=t(8558),p=t(5186),u=t(3076),d=t(2005),g=t(6837),_=t(6427);const h="newspack-audience-content-gates";var m=t(8351),w=t(790);const k=()=>{};function x({choices:e=[],onHover:n=k,onSelect:t,value:s}){return(0,w.jsx)(w.Fragment,{children:e.map(e=>{const a=s.includes(e.value);return(0,w.jsx)(_.MenuItem,{role:"menuitemradio",disabled:e.disabled,icon:a?m.A:null,info:e.info,isSelected:a,className:"components-menu-items-choice",onClick:()=>{t(e.value)},onMouseEnter:()=>n(e.value),onMouseLeave:()=>n(null),"aria-label":e["aria-label"],children:e.label},e.value)})})}var b=t(8537),f=t(3832);function v({slug:e,value:n,onChange:t}){const i=(0,a.useMemo)(()=>window.newspackAudienceContentGates.available_content_rules[e],[e]),[c,l]=(0,a.useState)([]),[o,p]=(0,a.useState)([]),u=(0,a.useMemo)(()=>{let n="";switch(e){case"post_tag":n="tags";break;case"category":n="categories";break;default:n=e}return n},[e]),d=(0,a.useCallback)((e="")=>{r()({path:(0,f.addQueryArgs)("wp/v2/"+u,{search:e,per_page:10,_fields:"id,name"})}).then(e=>{e&&0!==e.length?p(e.map(e=>({value:e.id.toString(),label:(0,b.decodeEntities)(e.name)||(0,s.__)("(no name)","newspack-plugin")}))):p([])}).catch(e=>{console.warn("Error fetching suggestions for taxonomy: "+u,e)})},[u]);(0,a.useEffect)(()=>{n&&0!==n.length&&r()({path:(0,f.addQueryArgs)("wp/v2/"+u,{include:n.join(",")})}).then(e=>{l(e.map(e=>({value:e.id.toString(),label:(0,b.decodeEntities)(e.name)||(0,s.__)("(no name)","newspack-plugin")})))}).catch(e=>{console.warn("Error fetching saved items for taxonomy: "+u,e)})},[n,u]),(0,a.useEffect)(()=>{d()},[d]);const g=(0,a.useMemo)(()=>(e=>{let n;return t=>{clearTimeout(n),n=setTimeout(()=>e(t),100)}})(d),[d]),h=(0,a.useMemo)(()=>{const e=[...c,...o].filter(e=>n.includes(e.value)).map(e=>`${e.value}: ${e.label}`);return[...new Set(e)]},[n,c,o]),m=(0,a.useCallback)(e=>{const n=[...c,...o],s=e.map(e=>{if("string"==typeof e){const[t]=e.split(":");return n.find(e=>e.value===t)}return n.find(n=>n.value===e.value)});t(s.filter(e=>void 0!==e).map(e=>e.value))},[c,o,t]);return i&&Array.isArray(n)?(0,w.jsx)(_.FormTokenField,{label:i.name,suggestions:o.map(e=>`${e.value}: ${e.label}`),onInputChange:e=>{g(e)},value:h,onChange:m,__experimentalExpandOnFocus:!0,__next40pxDefaultSize:!0}):null}function j({slug:e,value:n,exclusion:t,onChange:a,onChangeExclusion:c}){const r=window.newspackAudienceContentGates.available_content_rules[e];return r&&Array.isArray(n)?(0,w.jsxs)("div",{className:"newspack-content-gates__content-rule-control",children:[r.options&&r.options.length>0?(0,w.jsx)(i.Q5,{label:r.name,value:r.options.filter(e=>n.includes(e.value)).map(e=>e.label),onChange:e=>{var n;return a(null!==(n=r.options?.filter(n=>e.includes(n.label)).map(e=>e.value))&&void 0!==n?n:[])},suggestions:r.options.map(e=>e.label),__experimentalExpandOnFocus:!0,__next40pxDefaultSize:!0}):(0,w.jsx)(v,{slug:e,value:n,onChange:a}),(0,w.jsx)(_.CheckboxControl,{label:(0,s.__)("Exclusion rule","newspack-plugin"),help:(0,s.__)("Apply this rule to everything EXCEPT the items matching the above.","newspack-plugin"),checked:null!=t&&t,onChange:e=>c?.(e)})]}):null}const C=window.newspackAudienceContentGates.available_content_rules||{};function y({rules:e,onChange:n}){const t=(0,a.useMemo)(()=>Object.keys(C).map(e=>{const n=C[e];return{label:n.name,value:e,info:n.description||""}}),[]),c=(0,a.useCallback)(t=>{const s=e.find(e=>e.slug===t);n(s?e.filter(e=>e.slug!==t):[...e,{slug:t,value:C[t].default}])},[e,n]),r=(0,a.useCallback)(t=>s=>{n(e.map(e=>e.slug===t?{...e,value:s}:e))},[n,e]),l=(0,a.useCallback)(t=>s=>{n(e.map(e=>e.slug===t?{...e,exclusion:s}:e))},[n,e]);return(0,w.jsx)(i.Lz,{title:(0,s.__)("Content Rules","newspack-plugin"),description:(0,s.__)("Configure which content is restricted by this content gate.","newspack-plugin"),hasWhiteHeader:!0,noBorder:!0,noMargin:!0,actionContent:(0,w.jsx)("div",{style:{background:"var(--newspack-ui-color-neutral-5)"},children:(0,w.jsx)(_.DropdownMenu,{icon:!1,text:(0,s.__)("Manage Rules","newspack-plugin"),label:(0,s.__)("Manage Rules","newspack-plugin"),children:()=>(0,w.jsx)(x,{choices:t,onSelect:c,value:e.map(e=>e.slug)})})}),children:(0,w.jsx)(i.xA,{columns:2,gutter:32,noMargin:!0,children:e.map(e=>(0,w.jsx)(j,{slug:e.slug,value:e.value,exclusion:e.exclusion,onChange:r(e.slug),onChangeExclusion:l(e.slug)},e.slug))})})}function S(e,n){const t=window.newspackAudienceContentGates;if(!t||"string"!=typeof t.edit_gate_layout_url||!t.edit_gate_layout_url)return console.error("newspackAudienceContentGates.edit_gate_layout_url is not defined on window."),"";let s=t.edit_gate_layout_url;return e&&(s=(0,f.addQueryArgs)(s,{gate_id:e})),n&&(s=(0,f.addQueryArgs)(s,{gate_mode:n})),s}function A({metering:e,onChange:n}){const t="number"==typeof e.count?e.count:parseInt(String(e.count),10),a=!isNaN(t)&&0===t;return(0,w.jsxs)(i.Lz,{title:(0,s.__)("Metering","newspack-plugin"),description:(0,s.__)("Configure how many times a reader can view restricted content before being gated.","newspack-plugin"),hasWhiteHeader:!0,noBorder:!0,noMargin:!0,children:[(0,w.jsxs)(i.Zp,{noBorder:!0,children:[(0,w.jsx)(_.CheckboxControl,{label:(0,s.__)("Meter content views for this gate","newspack-plugin"),checked:e.enabled,onChange:()=>n({...e,enabled:!e.enabled})}),e.enabled&&a&&(0,w.jsx)(i.$T,{isWarning:!0,noticeText:(0,s.__)("Metering is enabled but the number of views is set to 0. Content will be gated for all readers.","newspack-plugin")})]}),e.enabled&&(0,w.jsxs)(i.xA,{columns:2,gutter:32,noMargin:!0,children:[(0,w.jsx)(_.__experimentalNumberControl,{label:(0,s.__)("Number of views","newspack-plugin"),help:(0,s.__)("Number of times a reader can view gated content. If set to 0, readers will always be gated.","newspack-plugin"),min:0,value:t,onChange:t=>n({...e,count:void 0!==t?Number(t):0})}),(0,w.jsx)(i.Yq,{label:(0,s.__)("Period","newspack-plugin"),help:(0,s.__)('The period during which the metering views will be counted. For example, if the metering period is set to "Weekly", the metering views will be reset every week.',"newspack-plugin"),value:e.period,onChange:t=>n({...e,period:t}),options:[{value:"week",label:(0,s.__)("Weekly","newspack-plugin")},{value:"month",label:(0,s.__)("Monthly","newspack-plugin")}]})]})]})}function P({gateId:e,registration:n,onChange:t,cardProps:c={}}){const r=(0,a.useCallback)(e=>{t({active:n.active,metering:n.metering,require_verification:n.require_verification,...e})},[n,t]);return(0,w.jsx)(i.Lz,{title:(0,s.__)("Registered Access","newspack-plugin"),description:(0,s.__)("Readers must log in to view this content.","newspack-plugin"),toggleChecked:n.active,toggleOnChange:e=>r({active:e}),actionText:e?(0,s.__)("Edit Layout","newspack-plugin"):void 0,href:e?S(e,"registration"):void 0,...c,children:n.active&&(0,w.jsxs)(i.Zp,{noBorder:!0,children:[(0,w.jsx)(_.CheckboxControl,{label:(0,s.__)("Require readers to verify their email address.","newspack-plugin"),checked:n.require_verification,onChange:()=>r({require_verification:!n.require_verification})}),(0,w.jsx)("hr",{}),(0,w.jsx)(A,{metering:n.metering,onChange:e=>r({metering:e})})]})})}const T=()=>{};function L({slug:e,value:n,onChange:t}){const s=window.newspackAudienceContentGates.available_access_rules[e];return s?s.is_boolean?(0,w.jsx)(_.CheckboxControl,{label:s.name,checked:!0,onChange:T,disabled:!0,help:s.description}):s.options&&s.options.length>0?(0,w.jsx)(i.Q5,{label:s.name,value:s.options.filter(e=>n.includes(e.value)).map(e=>e.label),onChange:e=>{var n;return t(null!==(n=s.options?.filter(n=>e.includes(n.label)).map(e=>e.value))&&void 0!==n?n:[])},suggestions:s.options.map(e=>e.label),__experimentalExpandOnFocus:!0,__next40pxDefaultSize:!0}):(0,w.jsx)(_.TextControl,{label:s.name,value:n,onChange:t,help:s.description,__next40pxDefaultSize:!0}):null}const E=window.newspackAudienceContentGates.available_access_rules||{};function N({rules:e,onChange:n}){const t=(0,a.useMemo)(()=>Object.keys(E).map(e=>{const n=E[e];return{label:n.name,value:e,info:n.description}}),[]),c=(0,a.useCallback)(t=>{const s=e.find(e=>e.slug===t);n(s?e.filter(e=>e.slug!==t):[...e,{slug:t,value:E[t].default}])},[e,n]),r=(0,a.useCallback)(t=>s=>{n(e.map(e=>e.slug===t?{...e,value:s}:e))},[n,e]);return(0,w.jsx)(i.Lz,{title:(0,s.__)("Access Rules","newspack-plugin"),description:(0,s.__)("Configure how readers can bypass this content gate.","newspack-plugin"),hasWhiteHeader:!0,noBorder:!0,noMargin:!0,actionContent:(0,w.jsx)("div",{style:{background:"var(--newspack-ui-color-neutral-5)"},children:(0,w.jsx)(_.DropdownMenu,{icon:!1,text:(0,s.__)("Manage Rules","newspack-plugin"),label:(0,s.__)("Manage Rules","newspack-plugin"),children:()=>(0,w.jsx)(x,{choices:t,onSelect:c,value:e.map(e=>e.slug)})})}),children:(0,w.jsx)(i.xA,{columns:2,gutter:32,noMargin:!0,children:e.map(e=>(0,w.jsx)(L,{slug:e.slug,value:e.value,onChange:r(e.slug)},e.slug))})})}function $({gateId:e,customAccess:n,onChange:t,cardProps:c={}}){const r=(0,a.useCallback)(e=>{t({active:n.active,metering:n.metering,access_rules:n.access_rules,...e})},[n,t]);return(0,w.jsx)(i.Lz,{title:(0,s.__)("Paid Access","newspack-plugin"),description:(0,s.__)("Readers must pay to view this content.","newspack-plugin"),toggleChecked:n.active,toggleOnChange:e=>r({active:e}),actionText:e?(0,s.__)("Edit Layout","newspack-plugin"):void 0,href:e?S(e,"custom_access"):void 0,...c,children:n.active&&(0,w.jsxs)(i.Zp,{noBorder:!0,children:[(0,w.jsx)(N,{rules:n.access_rules,onChange:e=>r({access_rules:e})}),(0,w.jsx)("hr",{}),(0,w.jsx)(A,{metering:n.metering,onChange:e=>r({metering:e})})]})})}function F({gate:e,onDelete:n,onSave:t}){const{wizardApiFetch:i}=(0,d.L)(h),[c,r]=(0,a.useState)(e.content_rules),[l,o]=(0,a.useState)(e.registration),[p,u]=(0,a.useState)(e.custom_access),[g,m]=(0,a.useState)(e.status),[k,x]=(0,a.useState)(!1),b=(0,a.useMemo)(()=>c.length>0&&(l.active||p.active&&p.access_rules.length>0),[c,l,p]),f=(0,a.useCallback)(()=>{const n={...e,content_rules:c,registration:l,custom_access:p,status:g};i({path:`/newspack/v1/wizard/${h}/${e.id}`,method:"POST",data:{gate:n}},{onSuccess(e){t(e)},onError(e){console.error(e)},onFinally(){x(!1)}})},[c,l,p,g]);(0,a.useEffect)(()=>{k&&f()},[k,g,f]);const v=()=>{x(!0),m("draft")};return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(y,{rules:c,onChange:r}),(0,w.jsx)(P,{gateId:e.id,registration:l,onChange:o}),(0,w.jsx)($,{gateId:e.id,customAccess:p,onChange:u}),(0,w.jsxs)("div",{className:"newspack-buttons-card",children:["draft"===e.status&&(0,w.jsx)(_.Button,{disabled:!b,variant:"primary",onClick:()=>{confirm((0,s.__)("Are you sure you want to publish this content gate?","newspack-plugin"))&&(x(!0),m("publish"))},children:(0,s.__)("Publish","newspack-plugin")}),"trash"!==e.status&&(0,w.jsx)(_.Button,{variant:"publish"===e.status?"primary":"secondary",onClick:f,children:"publish"===e.status?(0,s.__)("Update","newspack-plugin"):(0,s.__)("Save draft","newspack-plugin")}),"publish"===e.status&&(0,w.jsx)(_.Button,{isDestructive:!0,variant:"secondary",onClick:v,children:(0,s.__)("Unpublish","newspack-plugin")}),"trash"===e.status&&(0,w.jsx)(_.Button,{variant:"secondary",onClick:v,children:(0,s.__)("Restore","newspack-plugin")}),"publish"!==e.status&&(0,w.jsx)(_.Button,{variant:"tertiary",isDestructive:!0,onClick:()=>n(e.id),children:"trash"===e.status?(0,s.__)("Delete permanently","newspack-plugin"):(0,s.__)("Delete","newspack-plugin")})]})]})}const M=e=>{switch(e){case"publish":return(0,s.__)("Active","newspack-plugin");case"draft":return(0,s.__)("Draft","newspack-plugin");case"pending":return(0,s.__)("Pending Review","newspack-plugin");case"future":return(0,s.__)("Scheduled","newspack-plugin");case"private":return(0,s.__)("Private","newspack-plugin");case"trash":return(0,s.__)("Trash","newspack-plugin");default:return}},z=e=>{switch(e){case"publish":return"success";case"trash":return"error";default:return"info"}},O=()=>{const e=(0,p.l)("newspack-audience-content-gates"),{updateWizardSettings:n}=(0,l.useDispatch)(u.S),{wizardApiFetch:t,isFetching:c,errorMessage:_,resetError:m}=(0,d.L)(h),[k,x]=(0,a.useState)(!1),[b,f]=(0,a.useState)(""),[v,j]=(0,a.useState)(!1),[C,y]=(0,a.useState)(null),S=(0,a.useRef)(null),A=e?.gates||[],P=e=>{n({slug:h,path:["gates"],value:e})};(0,a.useEffect)(()=>{j(!!c)},[c]),(0,a.useEffect)(()=>{_&&y(_)},[_]);const T=()=>{y(null),m()},L=()=>{v||(T(),j(!0),t({path:`/newspack/v1/wizard/${h}`,method:"POST",data:{title:b}},{onSuccess(e){const n=[...A.map(e=>(e.isExpanded=!1,e)),{...e,isExpanded:!0}];P(n),x(!1),f("")},onFinally(){j(!1)}}))},E=e=>{const n=A.find(n=>n.id===e)?.status;("trash"!==n||confirm((0,s.__)("Are you sure you want to permanently delete this content gate?","newspack-plugin")))&&(T(),t({path:`/newspack/v1/wizard/${h}/${e}`,method:"DELETE"},{onSuccess(){if("trash"===n){const n=A.filter(n=>n.id!==e);P(n)}else{const n=A.map(n=>(n.id===e&&(n.status="trash"),n));P(n)}}}))},N=e=>{if(v)return;const n=A.map(n=>n.id===e.id?e:n);P(n)};return(0,w.jsxs)("div",{className:"newspack-content-gates__gates",children:[C&&(0,w.jsx)(i.$T,{isError:!0,noticeText:C}),(0,w.jsxs)(i.Zp,{noBorder:!0,headerActions:!0,children:[(0,w.jsx)(i.X3,{heading:1,title:(0,s.__)("Content Gates","newspack-plugin"),noMargin:!0}),(0,w.jsx)(i.$n,{variant:"secondary",onClick:()=>x(!0),children:(0,s.__)("Add Content Gate","newspack-plugin")}),k&&(0,w.jsxs)(i.aF,{isNarrow:!0,title:(0,s.__)("Add Content Gate","newspack-plugin"),onRequestClose:()=>x(!1),children:[(0,w.jsx)(i.xt,{disabled:v,label:(0,s.__)("Name","newspack-plugin"),placeholder:(0,s.__)("Enter a name for the content gate","newspack-plugin"),onChange:e=>f(e),onKeyUp:e=>{o.ENTER===e.keyCode&&""!==b&&(e.preventDefault(),L())}}),(0,w.jsxs)(i.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,w.jsx)(i.$n,{variant:"primary",onClick:L,disabled:v,children:(0,s.__)("Add Content Gate","newspack-plugin")}),(0,w.jsx)(i.$n,{disabled:v,isDestructive:!0,variant:"secondary",onClick:()=>x(!1),children:(0,s.__)("Cancel","newspack-plugin")})]})]})]}),0===A.length&&(0,w.jsx)(i.Zp,{noBorder:!0,children:(0,w.jsx)("p",{children:(0,s.__)("No content gates configured. Add a content gate to configure access rules.","newspack-plugin")})}),(0,w.jsx)("div",{ref:S,children:A.map((e,n)=>(0,w.jsx)(g.A,{className:"newspack-content-gates__gate",draggable:A.length>1,expandable:!0,isExpanded:e.isExpanded||1===A.length,id:e.id,title:e.title,isMedium:A.length>1,toggleChecked:!0,dragIndex:n,dragWrapperRef:S,onDragCallback:t=>{const s=[...A];s.splice(n,1),s.splice(t,0,e),s.forEach((e,n)=>e.priority=n),JSON.stringify(s)!==JSON.stringify(A)&&(e=>{if(v)return;const n=[...A];P(e),j(!0),T(),r()({path:`/newspack/v1/wizard/${h}/priority`,method:"POST",data:{gates:e.map(e=>({id:e.id,priority:e.priority}))}}).catch(e=>{y(e.message),P(n)}).finally(()=>j(!1))})(s)},disabled:v,badge:M(e.status),badgeLevel:z(e.status),children:(0,w.jsx)(F,{gate:e,onDelete:E,onSave:N})},e.id))})]})};var D=t(1147);const I=()=>{const e=(0,p.l)(h),{updateWizardSettings:n}=(0,l.useDispatch)(u.S),{wizardApiFetch:t,errorMessage:s,resetError:a}=(0,d.L)(h),c=e=>{n({slug:h,path:["config"],value:e})};return(0,w.jsxs)(w.Fragment,{children:[s&&(0,w.jsx)(i.$T,{isError:!0,noticeText:s}),(0,w.jsx)(D.A,{config:e?.config||{},setConfig:c,updateConfig:n=>{a(),t({path:"/newspack/v1/wizard/newspack-audience-content-gates/content-gifting",method:"POST",quiet:!0,data:n.content_gifting},{onSuccess(n){c({...e?.config,content_gifting:n})}})},noBorder:!0})]})};var q=t(4081);const R=()=>{const e=(0,p.l)(h),{updateWizardSettings:n}=(0,l.useDispatch)(u.S),{wizardApiFetch:t,errorMessage:s,resetError:a}=(0,d.L)(h),c=e=>{n({slug:h,path:["config"],value:e})};return(0,w.jsxs)(w.Fragment,{children:[s&&(0,w.jsx)(i.$T,{isError:!0,noticeText:s}),(0,w.jsx)(q.A,{config:e?.config||{},setConfig:c,updateConfig:n=>{a(),t({path:"/newspack/v1/wizard/newspack-audience-content-gates/countdown-banner",method:"POST",quiet:!0,data:n.countdown_banner},{onSuccess(n){c({...e?.config,countdown_banner:n})}})},noBorder:!0})]})},B=(0,i.Aq)((0,a.forwardRef)((e,n)=>(0,w.jsx)(i.sQ,{apiSlug:h,title:(0,s.__)("Content Gating","newspack-plugin"),description:(0,s.__)("Configure content gating logic and appearance.","newspack-plugin"),headerText:(0,s.__)("Audience Management / Content Gates","newspack-plugin"),ref:n,sections:[{label:(0,s.__)("Content Gates","newspack-plugin"),path:"/content-gates",render:O},{label:(0,s.__)("Content Gifting","newspack-plugin"),path:"/content-gifting",render:I},{label:(0,s.__)("Metered Countdown","newspack-plugin"),path:"/metered-countdown",render:R}]})))},514:(e,n,t)=>{var s=t(4932);e.exports=function(e,n){return s(n,function(n){return e[n]})}},1075:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var s=t(4058);class a extends s.A{constructor(e,n,t,s=""){super(e,t,s),this.name="WizardApiError",this.statusCode=n,Object.setPrototypeOf(this,a.prototype)}toJSON(){return{name:this.name,message:this.message,statusCode:this.statusCode,errorCode:this.errorCode,details:this.details,stackTrace:this.stack}}}const i=a},1147:(e,n,t)=>{"use strict";t.d(n,{A:()=>r});var s=t(7723),a=t(6427),i=t(1311),c=t(790);function r({config:e,setConfig:n,updateConfig:t,noBorder:r=!1}){const l=Object.values(newspackAudience?.content_gifting?.can_use_gifting?.errors||{}).flat(),o=newspackAudience?.available_products||[],p=newspackAudience?.content_gifting?.has_metering;return(0,c.jsx)(i.Lz,{title:(0,s.__)("Content Gifting","newspack-plugin"),heading:r?1:2,description:(0,s.__)("Allow members to gift articles up to the configured limit.","newspack-plugin"),toggleOnChange:e=>t({content_gifting:{enabled:e}}),toggleChecked:e.content_gifting?.enabled,hasGreyHeader:!r&&e.content_gifting?.enabled,togglePosition:"trailing",noBorder:r,children:e.content_gifting?.enabled&&(0,c.jsxs)(c.Fragment,{children:[l.length>0&&(0,c.jsx)(i.$T,{noticeText:l.join(", "),isError:!0}),(0,c.jsxs)(i.xA,{columns:2,rowGap:16,children:[(0,c.jsx)(a.__experimentalHeading,{level:4,style:{gridColumn:"1 / -1"},children:(0,s.__)("General Settings","newspack-plugin")}),(0,c.jsx)(a.RangeControl,{label:(0,s.__)("Gifting limit","newspack-plugin"),help:(0,s.__)("Maximum number of articles that can be gifted per user for the configured interval.","newspack-plugin"),min:1,max:20,value:e.content_gifting.limit,onChange:t=>n({...e,content_gifting:{...e.content_gifting,limit:t}}),__next40pxDefaultSize:!0}),(0,c.jsx)(i.Yq,{label:(0,s.__)("Gifting limit interval","newspack-plugin"),help:(0,s.__)("Interval at which the gifting limit is reset.","newspack-plugin"),value:e.content_gifting.interval,onChange:t=>n({...e,content_gifting:{...e.content_gifting,interval:t}}),options:[{value:"day",label:(0,s.__)("Day","newspack-plugin")},{value:"week",label:(0,s.__)("Week","newspack-plugin")},{value:"month",label:(0,s.__)("Month","newspack-plugin")}],__next40pxDefaultSize:!0}),(0,c.jsx)(a.RangeControl,{label:(0,s.__)("Article link expiration time","newspack-plugin"),help:(0,s.__)("Time after which the article link expires.","newspack-plugin"),min:1,max:60,value:e.content_gifting.expiration_time||5,onChange:t=>n({...e,content_gifting:{...e.content_gifting,expiration_time:t}}),__next40pxDefaultSize:!0}),(0,c.jsx)(i.Yq,{label:(0,s.__)("Article link expiration time unit","newspack-plugin"),help:(0,s.__)("Unit of time for the article link expiration time.","newspack-plugin"),value:e.content_gifting.expiration_time_unit||"days",onChange:t=>n({...e,content_gifting:{...e.content_gifting,expiration_time_unit:t}}),options:[{value:"hours",label:(0,s.__)("Hours","newspack-plugin")},{value:"days",label:(0,s.__)("Days","newspack-plugin")}],__next40pxDefaultSize:!0})]}),(0,c.jsx)(i.xA,{columns:1,children:(0,c.jsx)("hr",{})}),(0,c.jsxs)(i.xA,{columns:2,rowGap:16,children:[(0,c.jsx)(a.__experimentalHeading,{level:4,style:{gridColumn:"1 / -1"},children:(0,s.__)("Recipient Banner","newspack-plugin")}),(0,c.jsx)(i.xt,{label:(0,s.__)("Message","newspack-plugin"),help:(0,s.__)("Text displayed in the banner shown to recipients of gifted articles.","newspack-plugin"),value:e.content_gifting.cta_label,onChange:t=>n({...e,content_gifting:{...e.content_gifting,cta_label:t}}),__next40pxDefaultSize:!0}),(0,c.jsx)(i.xt,{label:(0,s.__)("Subscribe button label","newspack-plugin"),help:(0,s.__)("Text displayed on the subscribe button in the banner.","newspack-plugin"),value:e.content_gifting.button_label,onChange:t=>n({...e,content_gifting:{...e.content_gifting,button_label:t}}),__next40pxDefaultSize:!0})]}),(0,c.jsxs)(i.xA,{columns:3,rowGap:16,children:[(0,c.jsxs)(a.__experimentalToggleGroupControl,{label:(0,s.__)("Style","newspack-plugin"),value:e.content_gifting.style||"light",onChange:t=>n({...e,content_gifting:{...e.content_gifting,style:t}}),isBlock:!0,__next40pxDefaultSize:!0,children:[(0,c.jsx)(a.__experimentalToggleGroupControlOption,{label:(0,s.__)("Light","newspack-plugin"),value:"light"}),(0,c.jsx)(a.__experimentalToggleGroupControlOption,{label:(0,s.__)("Dark","newspack-plugin"),value:"dark"})]}),(0,c.jsxs)(a.__experimentalToggleGroupControl,{label:(0,s.__)("Subscribe button action","newspack-plugin"),help:(0,s.__)("Whether the subscribe button should start a product checkout or redirect to a landing page.","newspack-plugin"),value:e.content_gifting.cta_type||"product",onChange:t=>n({...e,content_gifting:{...e.content_gifting,cta_type:t}}),isBlock:!0,__next40pxDefaultSize:!0,children:[(0,c.jsx)(a.__experimentalToggleGroupControlOption,{label:(0,s.__)("Product","newspack-plugin"),value:"product"}),(0,c.jsx)(a.__experimentalToggleGroupControlOption,{label:(0,s.__)("Landing page","newspack-plugin"),value:"url"})]}),"product"===e.content_gifting.cta_type&&(0,c.jsx)(i.Yq,{label:(0,s.__)("Subscribe button product","newspack-plugin"),help:(0,s.__)("Product linked to the subscribe button.","newspack-plugin"),options:[{label:(0,s.__)("Select a product","newspack-plugin"),value:0,disabled:!0},...o],value:e.content_gifting.cta_product_id,suggestions:o.map(e=>e.label),onChange:t=>n({...e,content_gifting:{...e.content_gifting,cta_product_id:t}}),__next40pxDefaultSize:!0}),"url"===e.content_gifting.cta_type&&(0,c.jsx)(i.xt,{label:(0,s.__)("Subscribe button URL","newspack-plugin"),help:(0,s.__)("URL for the landing page to redirect to.","newspack-plugin"),value:e.content_gifting.cta_url,onChange:t=>n({...e,content_gifting:{...e.content_gifting,cta_url:t}}),__next40pxDefaultSize:!0}),(0,c.jsx)("div",{style:{gridColumn:"1 / -1"},children:(0,c.jsx)(a.BaseControl,{id:"newspack-content-gifting-cta-preview",label:(0,s.__)("Preview","newspack-plugin"),children:(0,c.jsx)("div",{className:"newspack-content-gifting__cta-preview",inert:"true",children:(0,c.jsx)("div",{className:"newspack-ui",children:(0,c.jsx)("div",{className:`banner newspack-content-gifting__cta is-style-${e.content_gifting.style||"light"}`,children:(0,c.jsxs)("div",{className:"wrapper newspack-content-gifting__cta__content",children:[(0,c.jsxs)("div",{className:"newspack-ui__font--s",children:[e.content_gifting.cta_label||(0,s.__)("This article has been gifted to you by someone who values great journalism.","newspack-plugin")," ",(0,c.jsx)("div",{className:"newspack-ui__font--xs newspack-content-gifting__cta__content__links",children:p?(0,c.jsx)("a",{href:"#register_modal",children:(0,s.__)("Create an account","newspack-plugin")}):(0,c.jsx)("a",{href:"#signin_modal",children:(0,s.__)("Sign in to an existing account","newspack-plugin")})})]}),("product"===e.content_gifting.cta_type&&e.content_gifting.cta_product_id||"url"===e.content_gifting.cta_type&&e.content_gifting.cta_url)&&(0,c.jsx)("button",{className:"newspack-ui__button newspack-ui__button--x-small "+("dark"===(e.content_gifting.style||"light")?"newspack-ui__button--primary-light":"newspack-ui__button--accent"),children:e.content_gifting.button_label||(0,s.__)("Subscribe now","newspack-plugin")})]})})})})})})]}),(0,c.jsx)("div",{className:"newspack-buttons-card",style:{margin:"32px 0 0 0"},children:(0,c.jsx)(i.$n,{isPrimary:!0,onClick:()=>t({content_gifting:e.content_gifting}),children:(0,s.__)("Save Settings","newspack-plugin")})})]})})}},1493:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>Oe}),t(8209);var s=t(6087),a=t(7723),i=t(3832),c=t(5373),r=t(1311),l=t(2247),o=t(8558),p=t(8169),u=t(6427),d=t(790);const g=({dismiss:e,hasPrompts:n,hasPublished:t,isArchive:s,onActivate:i,onArchive:c,onDeactivate:l,onDelete:p,onDuplicate:g,onRename:_,onUnarchive:h})=>(0,d.jsxs)(r.AM,{position:"bottom right",onFocusOutside:()=>e(),onKeyDown:n=>o.ESCAPE===n.keyCode&&e(),children:[(0,d.jsx)(u.MenuItem,{onClick:()=>e(),className:"screen-reader-text",children:(0,a.__)("Close Popover","newspack-plugin")}),n&&(0,d.jsx)(u.MenuItem,{onClick:()=>{e(),i()},className:"newspack-button",children:(0,a.__)("Activate all prompts","newspack-plugin")}),t&&(0,d.jsx)(u.MenuItem,{onClick:()=>{e(),l()},className:"newspack-button",children:(0,a.__)("Deactivate all prompts","newspack-plugin")}),(0,d.jsx)(u.MenuItem,{onClick:()=>{e(),g()},className:"newspack-button",children:(0,a.__)("Duplicate","newspack-plugin")}),(0,d.jsx)(u.MenuItem,{onClick:()=>{e(),_()},className:"newspack-button",children:(0,a.__)("Rename","newspack-plugin")}),!s&&(0,d.jsx)(u.MenuItem,{onClick:()=>{e(),c()},className:"newspack-button",children:(0,a.__)("Archive","newspack-plugin")}),s&&(0,d.jsx)(u.MenuItem,{onClick:()=>{e(),h()},className:"newspack-button",children:(0,a.__)("Unarchive","newspack-plugin")}),(0,d.jsx)(u.MenuItem,{onClick:()=>{e(),p()},className:"newspack-button",children:(0,a.__)("Delete","newspack-plugin")})]});var _=t(8722),h=t(5573),m=(0,d.jsx)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,d.jsx)(h.Path,{d:"M18.5 10.5H10v8h8a.5.5 0 00.5-.5v-7.5zm-10 0h-3V18a.5.5 0 00.5.5h2.5v-8zM6 4h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2z"})}),w=(0,d.jsx)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,d.jsx)(h.Path,{d:"M18 5.5H6a.5.5 0 00-.5.5v3h13V6a.5.5 0 00-.5-.5zm.5 5H10v8h8a.5.5 0 00.5-.5v-7.5zm-10 0h-3V18a.5.5 0 00.5.5h2.5v-8zM6 4h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2z"})}),k=(0,d.jsx)(h.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,d.jsx)(h.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v3.5h-15V5c0-.3.2-.5.5-.5zm8 5.5h6.5v3.5H13V10zm-1.5 3.5h-7V10h7v3.5zm-7 5.5v-4h7v4.5H5c-.3 0-.5-.2-.5-.5zm14.5.5h-6V15h6.5v4c0 .3-.2.5-.5.5z"})});const x=e=>{const[n,t]=(0,s.useState)(null),[a,c]=(0,s.useState)(!1),[l,o]=(0,s.useState)(Math.floor(9999*Math.random())),p=window?.newspackAudienceCampaigns?.preview_post,u=window?.newspackAudienceCampaigns?.frontend_url||"/",{campaign:g=!1,onLoad:_=()=>{},segment:h="",showUnpublished:m=!1,url:w=p||u}=e;(0,s.useEffect)(()=>{a||t(k(w))},[a]);const k=e=>{const n=h.length?[`segment:${h}`]:["segment:everyone"];return m&&n.push("show_unpublished:true"),g?n.push(`campaign:${g}`):n.push("all"),n.push("session_id:"+l),(0,i.addQueryArgs)(e,{view_as:n.join(";")})};return(0,d.jsx)(r.LQ,{...e,onLoad:e=>{e&&([...e.contentWindow.document.querySelectorAll("a")].forEach(e=>{const n=e.getAttribute("href");0===n.indexOf(u)&&e.setAttribute("href",k(n))}),c(!0),_(e))},onClose:()=>{o(Math.floor(9999*Math.random())),c(!1)},url:n})};var b=t(1455),f=t.n(b),v=t(8537),j=t(9214);const C=({deletePopup:e,restorePopup:n,onFocusOutside:t,prompt:s,previewPopup:i,publishPopup:c,setIsDuplicatePromptModalVisible:l,unpublishPopup:p})=>{const{id:g,edit_link:_,status:h}=s,m="publish"===h,w="trash"===h;return(0,d.jsxs)(r.AM,{position:"bottom left",onFocusOutside:t,onKeyDown:e=>o.ESCAPE===e.keyCode&&t(),className:"newspack-popover__campaigns__primary-popover",children:[(0,d.jsx)(u.MenuItem,{onClick:()=>t(),className:"screen-reader-text",children:(0,a.__)("Close Popover","newspack-plugin")}),w?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(u.MenuItem,{onClick:()=>n(g),className:"newspack-button",children:(0,a.__)("Restore","newspack-plugin")}),(0,d.jsx)(u.MenuItem,{onClick:()=>e(g),className:"newspack-button",children:(0,a.__)("Delete permanently","newspack-plugin")})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(u.MenuItem,{onClick:()=>{t(),i(s)},className:"newspack-button",children:(0,a.__)("Preview","newspack-plugin")}),(0,d.jsx)(u.MenuItem,{href:(0,v.decodeEntities)(_),className:"newspack-button",isLink:!0,children:(0,a.__)("Edit","newspack-plugin")}),(0,d.jsx)(u.MenuItem,{onClick:()=>l(!0),className:"newspack-button",children:(0,a.__)("Duplicate","newspack-plugin")}),(0,d.jsx)(u.MenuItem,{onClick:()=>{t(),(m?p:c)(g)},className:"newspack-button",children:m?(0,a.__)("Deactivate","newspack-plugin"):(0,a.__)("Activate","newspack-plugin")}),(0,d.jsx)(u.MenuItem,{onClick:()=>e(g),className:"newspack-button",children:(0,a.__)("Delete","newspack-plugin")})]}),(0,d.jsxs)("div",{className:"newspack-popover__campaigns__info",children:[(0,a.__)("ID:","newspack-plugin")," ",g]})]})};var y=t(2619),S=t(104),A=t.n(S),P=t(3673),T=t.n(P);const L=window.newspackAudienceCampaigns?.criteria||[],E=e=>-1<(window.newspackAudienceCampaigns?.overlay_placements||[]).indexOf(e.options.placement),N=e=>"above_header"===e.options.placement,$=e=>{const n=window.newspackAudienceCampaigns?.custom_placements||{};return-1<Object.keys(n).indexOf(e.options.placement)},F={top:(0,a.__)("Top Overlay","newspack-plugin"),top_left:(0,a.__)("Top Left Overlay","newspack-plugin"),top_right:(0,a.__)("Top Right Overlay","newspack-plugin"),center:(0,a.__)("Center Overlay","newspack-plugin"),center_left:(0,a.__)("Center Left Overlay","newspack-plugin"),center_right:(0,a.__)("Center Right Overlay","newspack-plugin"),bottom:(0,a.__)("Bottom Overlay","newspack-plugin"),bottom_left:(0,a.__)("Bottom Left Overlay","newspack-plugin"),bottom_right:(0,a.__)("Bottom Right Overlay","newspack-plugin"),inline:(0,a.__)("Inline","newspack-plugin"),archives:(0,a.__)("In archive pages","newspack-plugin"),above_header:(0,a.__)("Above Header","newspack-plugin"),manual:(0,a.__)("Manual Only","newspack-plugin")},M=({options:{frequency:e,placement:n}})=>{const t=window.newspackAudienceCampaigns?.custom_placements||{};return"manual"===e||t.hasOwnProperty(n)?(0,a.__)("Custom Placement","newspack-plugin"):F[n]},z=e=>{const n=window.newspackAudienceCampaigns?.custom_placements,t=window.newspackAudienceCampaigns?.overlay_placements,s=Object.keys(F).filter(n=>E(e)?-1<t.indexOf(n):-1===t.indexOf(n)).map(e=>({label:F[e],value:e}));return!E(e)&&n?s.concat(Object.keys(n).map(e=>({label:n[e],value:e}))):s},O={once:(0,a.__)("Once a month","newspack-plugin"),weekly:(0,a.__)("Once a week","newspack-plugin"),daily:(0,a.__)("Once a day","newspack-plugin"),always:(0,a.__)("Every pageview","newspack-plugin"),custom:(0,a.__)("Custom frequency (edit prompt to manage)","newspack-plugin")},D=(e,n=!1)=>"publish"!==e||n?"newspack-card__is-disabled":"newspack-card__is-supported",I=e=>{const{categories:n,tags:t,campaign_groups:s,status:i}=e,c=[];if(s.length>0){const e=s.map(({name:e})=>e).join(", ");c.push((1===s.length?(0,a.__)("Campaign: ","newspack-plugin"):(0,a.__)("Campaigns: ","newspack-plugin"))+e)}return n.length>0&&c.push((0,a.__)("Categories: ","newspack-plugin")+n.map(e=>e.name).join(", ")),t.length>0&&c.push((0,a.__)("Tags: ","newspack-plugin")+t.map(e=>e.name).join(", ")),"pending"===i&&c.push((0,a.__)("Pending review","newspack-plugin")),"future"===i&&c.push((0,a.__)("Scheduled","newspack-plugin")),c.push((0,a.__)("Frequency: ","newspack-plugin")+Z(e)),c.length?c.join(" | "):null},q=e=>{const n=[];if(e.configuration.is_disabled&&n.push((0,a.__)("Segment disabled","newspack-plugin")),e.criteria)for(const t of L){const s=e.criteria.find(({criteria_id:e})=>e===t.id);if(s?.value){let e=s.value;if(t.options){const n=t.options.find(({value:e})=>e===s.value);n&&(e=n.label)}if(Array.isArray(e))e=e.join(", ");else if("object"==typeof e){const n=[];for(const t in e)e[t]&&n.push(`${t}: ${e[t]}`);e=n.join(", ")}const i=(0,y.applyFilters)("newspack.wizards.campaigns.segmentDescription.criteriaMessage",(0,a.sprintf)("%1$s: %2$s",t.name,e),e,t,s);i&&n.push(i)}}return()=>(0,d.jsx)(s.Fragment,{children:n.map((e,t)=>(0,d.jsxs)(s.Fragment,{children:[e," ",n.length!==t+1?" | ":null]},t))})},R=A()(async e=>{const n=await Promise.all(e.map(async e=>{try{return(await f()({path:(0,i.addQueryArgs)("/wp/v2/categories/"+e,{_fields:"name"})})).name}catch(e){return""}}));return T()(n)}),B=({ids:e})=>{const[n,t]=(0,s.useState)([]);return(0,s.useEffect)(()=>{R(e).then(t)},[e]),n.length?(0,d.jsxs)("span",{children:[(0,a.__)("Favorite Categories:","newspack-plugin")," ",n.length?n.join(", "):""]}):null};(0,y.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.favoriteCategories",(e,n,t,s)=>"favorite_categories"===t.id?s.value?.length?(0,d.jsx)(B,{ids:s.value}):null:e);const G=A()(async e=>{try{const n=await f()({path:e});return(Array.isArray(n)?n:Object.values(n)).map(e=>({id:isNaN(parseInt(e.id))?e.id.toString():parseInt(e.id),label:e.title||e.name}))}catch(e){return[]}}),H=({label:e,ids:n,path:t,deletedItemLabel:a})=>{const[i,c]=(0,s.useState)([]);if((0,s.useEffect)(()=>{G(t).then(c)},[n]),!i.length)return null;const r=n.map(e=>{const n=i.find(n=>n.id===e);return n?n.label:a});return(0,d.jsxs)("span",{children:[e," ",r.length?r.join(", "):""]})};(0,y.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.newsletterSubscribedLists",(e,n,t,s)=>["subscribed_lists","not_subscribed_lists"].includes(t.id)?s.value?.length?(0,d.jsx)(H,{label:"subscribed_lists"===t.id?(0,a.__)("Subscribed to:","newspack-plugin"):(0,a.__)("Not subscribed to:","newspack-plugin"),ids:s.value,path:"/newspack-newsletters/v1/lists_config",deletedItemLabel:(0,a.__)("Deleted list","newspack-plugin")}):null:e),(0,y.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.activeSubscriptions",(e,n,t,s)=>["active_subscriptions","not_active_subscriptions"].includes(t.id)?s.value?.length?(0,d.jsx)(H,{label:"active_subscriptions"===t.id?(0,a.__)("Has active subscription(s):","newspack-plugin"):(0,a.__)("Does not have active subscription(s):","newspack-plugin"),ids:s.value,path:`${newspackAudienceCampaigns.api}/subscription-products`,deletedItemLabel:(0,a.__)("Deleted subscription","newspack-plugin")}):null:e),(0,y.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.activeMemberships",(e,n,t,s)=>["active_memberships","not_active_memberships"].includes(t.id)?s.value?.length?(0,d.jsx)(H,{label:"active_memberships"===t.id?(0,a.__)("Has active membership(s):","newspack-plugin"):(0,a.__)("Does not have active membership(s):","newspack-plugin"),ids:s.value,path:"/wc/v3/memberships/plans?per_page=100",deletedItemLabel:(0,a.__)("Deleted membership","newspack-plugin")}):null:e);const W=e=>E(e)||N(e)?(0,a.sprintf)(
// Translators: %s is prompt type (above-header or overlay).
// Translators: %s is prompt type (above-header or overlay).
(0,a.__)("If multiple %s are rendered on the same pageview, only the most recent one will be displayed.","newspack-plugin"),N(e)?(0,a.__)("above-header prompts","newspack-plugin"):(0,a.__)("overlays","newspack-plugin")):$(e)?(0,a.__)("If multiple prompts are rendered in the same custom placement, only the most recent one will be displayed.","newspack-plugin"):"",V=(e,n)=>{const t=[];if("publish"===n.status&&(N(n)||E(n)||$(n))){const t=n.categories,s=e.filter(e=>{const s=e.categories,a=0===t.length&&0===s.length||t.some(e=>s.some(n=>e.term_id===n.term_id));return"publish"===e.status&&e.id!==n.id&&(i=e,n.options.placement===i.options.placement)&&((e,n)=>{const t=e.map(e=>e.term_id),s=n.map(e=>e.term_id);return!t.length&&!s.length||t.some(e=>-1<s.indexOf(e))})(n.segments,e.segments)&&a;var i}),i=(0,y.applyFilters)("newspack.wizards.campaigns.conflictingPrompts",s,n,e);return 0<i.length?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("strong",{children:(0,a.sprintf)(
// Translators: %s: 'Conflicts' or 'Conflict' depending on number of conflicts.
// Translators: %s: 'Conflicts' or 'Conflict' depending on number of conflicts.
(0,a.__)("%s detected:","newspack-plugin"),1<i.length?(0,a.__)("Conflicts","newspack-plugin"):(0,a.__)("Conflict","newspack-plugin"))}),(0,d.jsx)("ul",{children:i.map(e=>(0,d.jsx)("li",{children:(0,d.jsxs)("p",{"data-testid":`conflict-warning-${n.id}`,children:[(0,d.jsx)("strong",{children:(0,a.sprintf)("%s: ",e.title)}),(0,d.jsx)("span",{children:W(n)})]})},e.id))})]}):null}return t.length?t.join(" "):null},Z=({options:{frequency:e}})=>O[e],{SettingsCard:U}=r.wB,Y=({prompt:e,disabled:n,onClose:t,updatePopup:i})=>{const[c,l]=r.JL.useObjectState(e),{excluded_categories:o=[],excluded_tags:p=[]}=c.options||{},[u,g]=(0,s.useState)(0<o.length||0<p.length||!1);return(0,d.jsxs)(r.aF,{title:e.title,onRequestClose:t,isWide:!0,children:[(0,d.jsx)(r.$n,{onClick:()=>t(),className:"screen-reader-text",children:(0,a.__)("Close Modal","newspack-plugin")}),(0,d.jsxs)(r.xA,{gutter:64,columns:1,children:[(0,d.jsx)(U,{title:(0,a.__)("Campaigns","newspack-plugin"),description:(0,a.__)("Assign a prompt to one or more campaigns for easier management","newspack-plugin"),columns:1,className:"newspack-settings__campaigns",noBorder:!0,children:(0,d.jsx)(r.vn,{disabled:n,value:c.campaign_groups||[],onChange:e=>l({campaign_groups:e}),label:(0,a.__)("Campaigns","newspack-plugin"),taxonomy:"newspack_popups_taxonomy",hideLabelFromVision:!0})}),(0,d.jsxs)(U,{title:(0,a.__)("Settings","newspack-plugin"),description:(0,a.__)("When and how should the prompt be displayed","newspack-plugin"),columns:E(e)?3:2,className:"newspack-settings__settings",rowGap:16,noBorder:!0,children:[(0,d.jsx)(r.Yq,{label:(0,a.__)("Frequency","newspack-plugin"),disabled:n,onChange:e=>{l({options:{frequency:e}})},options:Object.keys(O).map(e=>({label:O[e],value:e})),value:c.options.frequency}),(0,d.jsx)(r.Yq,{label:E(e)?(0,a.__)("Position","newspack-plugin"):(0,a.__)("Placement","newspack-plugin"),disabled:n,onChange:e=>{l({options:{placement:e}})},options:z(e),value:c.options.placement}),E(e)&&(0,d.jsx)(r.Yq,{label:(0,a.__)("Size","newspack-plugin"),disabled:n,onChange:e=>{l({options:{overlay_size:e}})},options:window.newspackAudienceCampaigns?.overlay_sizes,value:c.options.overlay_size})]}),(0,d.jsxs)(U,{title:(0,a.__)("Targeting","newspack-plugin"),description:()=>(0,d.jsxs)(d.Fragment,{children:[(0,a.__)("Under which conditions should the prompt be displayed","newspack-plugin"),(0,d.jsx)("br",{}),(0,a.__)("If multiple conditions are set, all will have to be satisfied in order to display the prompt","newspack-plugin")]}),className:"newspack-settings__targeting",columns:1,rowGap:16,noBorder:!0,children:[(0,d.jsxs)(r.xA,{columns:3,rowGap:16,children:[(0,d.jsx)(r.vn,{disabled:n,value:c.segments||[],onChange:e=>l({segments:e}),label:(0,a.__)("Segments","newspack-plugin"),taxonomy:"popup_segment"}),(0,d.jsx)(r.vn,{label:(0,a.__)("Post categories","newspack-plugin"),disabled:n,hideHelpFromVision:!0,value:c.categories||[],onChange:e=>l({categories:e}),description:(0,a.__)("Prompt will only appear on posts with the specified categories.","newspack-plugin")}),(0,d.jsx)(r.vn,{label:(0,a.__)("Post tags","newspack-plugin"),disabled:n,hideHelpFromVision:!0,taxonomy:"tags",value:c.tags||[],onChange:e=>l({tags:e}),description:(0,a.__)("Prompt will only appear on posts with the specified tags.","newspack-plugin")})]}),(0,d.jsx)("div",{children:(0,d.jsx)(r.$n,{isLink:!0,onClick:()=>g(!u),children:(0,a.sprintf)(
// translators: %s: whether to show or hide advanced settings fields.
// translators: %s: whether to show or hide advanced settings fields.
(0,a.__)("%s Advanced Settings","newspack-plugin"),u?(0,a.__)("Hide","newspack-plugin"):(0,a.__)("Show","newspack-plugin"))})}),u&&(0,d.jsxs)(r.xA,{columns:3,rowGap:16,children:[(0,d.jsx)(r.vn,{label:(0,a.__)("Category Exclusions","newspack-plugin"),disabled:n,hideHelpFromVision:!0,value:o||[],onChange:e=>l({options:{excluded_categories:e.map(e=>e.id)}}),description:(0,a.__)("Prompt will not appear on posts with the specified categories.","newspack-plugin")}),(0,d.jsx)(r.vn,{label:(0,a.__)("Tag Exclusions","newspack-plugin"),disabled:n,hideHelpFromVision:!0,taxonomy:"tags",value:p||[],onChange:e=>l({options:{excluded_tags:e.map(e=>e.id)}}),description:(0,a.__)("Prompt will not appear on posts with the specified tags.","newspack-plugin")})]})]})]}),(0,d.jsxs)(r.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,d.jsx)(r.$n,{onClick:t,variant:"secondary",children:(0,a.__)("Cancel","newspack-plugin")}),(0,d.jsx)(r.$n,{onClick:()=>{i(c).then(t)},variant:"primary",children:(0,a.__)("Save","newspack-plugin")})]})]})},Q=e=>{const[n,t]=(0,s.useState)(!1),[i,c]=(0,s.useState)(!1),[l,o]=(0,s.useState)(!1),[u,g]=(0,s.useState)(null),{className:_,description:h,duplicated:m,duplicatePopup:w,inFlight:k,resetDuplicated:x,prompt:b={},segments:y,warning:S}=e,{campaign_groups:A,id:P,edit_link:T,title:L}=b;(0,s.useEffect)(()=>{l&&!u&&E()},[l]);const E=async()=>{const e=parseInt(b?.duplicate_of||b.id);try{const n=await f()({path:`${newspackAudienceCampaigns.api}/${e}/${b.id}/duplicate`});g(n)}catch(e){g(L+(0,a.__)(" copy","newspack-plugin"))}};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.Lz,{isSmall:!0,badge:M(b),className:_,title:L.length?(0,v.decodeEntities)(L):(0,a.__)("(no title)","newspack-plugin"),titleLink:(0,v.decodeEntities)(T),description:h,notification:S,notificationLevel:"error",actionText:(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("div",{className:"newspack-audience-campaigns__buttons",children:[(0,d.jsx)(r.$n,{className:n&&"popover-active",onClick:()=>t(!n),icon:j.A,label:(0,a.__)("Prompt settings","newspack-plugin"),tooltipPosition:"bottom center"}),(0,d.jsx)(r.$n,{className:i&&"popover-active",onClick:()=>c(!i),icon:p.A,label:(0,a.__)("More options","newspack-plugin"),tooltipPosition:"bottom center"}),i&&(0,d.jsx)(C,{onFocusOutside:()=>c(!1),prompt:b,setIsDuplicatePromptModalVisible:o,...e})]})})},P),n&&(0,d.jsx)(Y,{prompt:b,disabled:k,onClose:()=>t(!1),segments:y,updatePopup:e.updatePopup}),l&&(0,d.jsx)(r.aF,{className:"newspack-popups__duplicate-modal",title:
// Translators: %s: The title of the item.
// Translators: %s: The title of the item.
(0,a.sprintf)((0,a.__)("Duplicate “%s”","newspack-plugin"),L),onRequestClose:()=>{o(!1),g(null),x()},children:m?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.$T,{isSuccess:!0,noticeText:(0,a.sprintf)(
// Translators: %s: The title of the item.
// Translators: %s: The title of the item.
(0,a.__)("Duplicate of “%s” created as a draft.","newspack-plugin"),L)}),!A&&(0,d.jsx)(r.$T,{isWarning:!0,noticeText:(0,a.__)("This prompt is currently not assigned to any campaign.","newspack-plugin")}),(0,d.jsxs)(r.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,d.jsx)(r.$n,{isSecondary:!0,onClick:()=>{o(!1),g(null),x()},children:(0,a.__)("Close","newspack-plugin")}),(0,d.jsx)(r.$n,{isPrimary:!0,href:`/wp-admin/post.php?post=${m}&action=edit`,children:(0,a.__)("Edit","newspack-plugin")})]})]}):(0,d.jsxs)(d.Fragment,{children:[!A&&(0,d.jsx)(r.$T,{isWarning:!0,noticeText:(0,a.__)("This prompt will not be assigned to any campaign.","newspack-plugin")}),(0,d.jsx)(r.xt,{disabled:k||null===u,label:(0,a.__)("Title","newspack-plugin"),value:u,onChange:e=>g(e)}),(0,d.jsxs)(r.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,d.jsx)(r.$n,{disabled:k,isSecondary:!0,onClick:()=>{o(!1),g(null),x()},children:(0,a.__)("Cancel","newspack-plugin")}),(0,d.jsx)(r.$n,{disabled:k||null===u,isPrimary:!0,onClick:()=>{const e=u.trim()||E();w(P,e)},children:(0,a.__)("Duplicate","newspack-plugin")})]})]})})]})},J=(0,d.jsx)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,d.jsx)(h.Path,{d:"M8 10H16V14H8V10ZM20 6V18C20 18.5304 19.7893 19.0391 19.4142 19.4142C19.0391 19.7893 18.5304 20 18 20H6C5.46957 20 4.96086 19.7893 4.58579 19.4142C4.21071 19.0391 4 18.5304 4 18V6C4 5.46957 4.21071 4.96086 4.58579 4.58579C4.96086 4.21071 5.46957 4 6 4H18C18.5304 4 19.0391 4.21071 19.4142 4.58579C19.7893 4.96086 20 5.46957 20 6ZM18.5 6C18.5 5.86739 18.4473 5.74021 18.3536 5.64645C18.2598 5.55268 18.1326 5.5 18 5.5H6C5.86739 5.5 5.74021 5.55268 5.64645 5.64645C5.55268 5.74021 5.5 5.86739 5.5 6V18C5.5 18.1326 5.55268 18.2598 5.64645 18.3536C5.74021 18.4473 5.86739 18.5 6 18.5H18C18.1326 18.5 18.2598 18.4473 18.3536 18.3536C18.4473 18.2598 18.5 18.1326 18.5 18V6Z"})}),K=(0,d.jsx)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,d.jsx)(h.Path,{d:"M7 7H17V10H7V7ZM20 6V18C20 18.5304 19.7893 19.0391 19.4142 19.4142C19.0391 19.7893 18.5304 20 18 20H6C5.46957 20 4.96086 19.7893 4.58579 19.4142C4.21071 19.0391 4 18.5304 4 18V6C4 5.46957 4.21071 4.96086 4.58579 4.58579C4.96086 4.21071 5.46957 4 6 4H18C18.5304 4 19.0391 4.21071 19.4142 4.58579C19.7893 4.96086 20 5.46957 20 6ZM18.5 6C18.5 5.86739 18.4473 5.74021 18.3536 5.64645C18.2598 5.55268 18.1326 5.5 18 5.5H6C5.86739 5.5 5.74021 5.55268 5.64645 5.64645C5.55268 5.74021 5.5 5.86739 5.5 6V18C5.5 18.1326 5.55268 18.2598 5.64645 18.3536C5.74021 18.4473 5.86739 18.5 6 18.5H18C18.1326 18.5 18.2598 18.4473 18.3536 18.3536C18.4473 18.2598 18.5 18.1326 18.5 18V6Z"})}),X=(0,d.jsx)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,d.jsx)(h.Path,{d:"M7 14H17V17H7V14ZM20 6V18C20 18.5304 19.7893 19.0391 19.4142 19.4142C19.0391 19.7893 18.5304 20 18 20H6C5.46957 20 4.96086 19.7893 4.58579 19.4142C4.21071 19.0391 4 18.5304 4 18V6C4 5.46957 4.21071 4.96086 4.58579 4.58579C4.96086 4.21071 5.46957 4 6 4H18C18.5304 4 19.0391 4.21071 19.4142 4.58579C19.7893 4.96086 20 5.46957 20 6ZM18.5 6C18.5 5.86739 18.4473 5.74021 18.3536 5.64645C18.2598 5.55268 18.1326 5.5 18 5.5H6C5.86739 5.5 5.74021 5.55268 5.64645 5.64645C5.55268 5.74021 5.5 5.86739 5.5 6V18C5.5 18.1326 5.55268 18.2598 5.64645 18.3536C5.74021 18.4473 5.86739 18.5 6 18.5H18C18.1326 18.5 18.2598 18.4473 18.3536 18.3536C18.4473 18.2598 18.5 18.1326 18.5 18V6Z"})}),ee=(0,d.jsx)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,d.jsx)(h.Path,{d:"M4 10.5h16V9H4v1.5ZM4 15h9v-1.5H4V15Z"})}),ne=(e,n,t)=>{const s=[];return e&&s.push(`placement=${e}`),+n>0&&s.push(`group=${n}`),t&&s.push(`segment=${t}`),"/wp-admin/post-new.php?post_type=newspack_popups_cpt&"+s.join("&")},te=e=>{const{campaignData:n,campaignId:t,segment:i}=e,[c,l]=(0,s.useState)(!1),{label:o,id:p,prompts:u}=i,g="unassigned"!==t?parseInt(t):-1;let h;h="unassigned"===t?(0,a.__)("No unassigned prompts in this segment.","newspack-plugin"):n?(0,a.__)("No prompts in this segment for","newspack-plugin")+" "+n.name+".":(0,a.__)("No active prompts in this segment.","newspack-plugin");const b=q(i);return(0,d.jsxs)(r.Zp,{isSmall:!0,className:"newspack-campaigns__segment-group__card",children:[(0,d.jsxs)("div",{className:"newspack-campaigns__segment-group__card__segment",children:[(0,d.jsxs)("div",{className:"newspack-campaigns__segment-group__card__segment-title",children:[(0,d.jsx)("h3",{children:p?(0,d.jsx)(r.$n,{href:`#/segments/${p}`,label:(0,a.__)("Edit Segment","newspack-plugin"),isLink:!0,showTooltip:!0,tooltipPosition:"bottom center",children:/* translators: %s: segment label */ /* translators: %s: segment label */
(0,a.sprintf)((0,a.__)("Segment: %s","newspack-plugin"),o)}):o}),(0,d.jsx)("span",{className:"newspack-campaigns__segment-group__description",children:p?b():(0,a.__)("All readers, regardless of segment","newspack-plugin")})]}),(0,d.jsxs)("div",{className:"newspack-campaigns__segment-group__card__segment-actions",children:[(0,d.jsx)(x,{campaign:!!t&&g,segment:p,showUnpublished:!!t,renderButton:({showPreview:e})=>(0,d.jsx)(r.$n,{isSmall:!0,variant:"tertiary",onClick:()=>e(),children:(0,a.__)("Preview Segment","newspack-plugin")}),title:/* translators: %s: segment label */ /* translators: %s: segment label */
(0,a.sprintf)((0,a.__)("Segment: %s","newspack-plugin"),o)}),"unassigned"!==t&&(0,d.jsxs)(s.Fragment,{children:[(0,d.jsx)(r.$n,{isSmall:!0,variant:"secondary",onClick:()=>l(!c),children:(0,a.__)("Add New Prompt","newspack-plugin")}),c&&(0,d.jsx)(r.aF,{title:(0,a.__)("Add New Prompt","newspack-plugin"),onRequestClose:()=>l(!1),shouldCloseOnEsc:!1,shouldCloseOnClickOutside:!1,isWide:!0,children:(0,d.jsxs)(r.xA,{gutter:32,columns:3,children:[(0,d.jsx)(r.dr,{href:ne("overlay-center",t,p),title:(0,a.__)("Center Overlay","newspack-plugin"),desc:(0,a.__)("Fixed at the center of the screen","newspack-plugin"),icon:J}),(0,d.jsx)(r.dr,{href:ne("overlay-top",t,p),title:(0,a.__)("Top Overlay","newspack-plugin"),desc:(0,a.__)("Fixed at the top of the screen","newspack-plugin"),icon:K}),(0,d.jsx)(r.dr,{href:ne("overlay-bottom",t,p),title:(0,a.__)("Bottom Overlay","newspack-plugin"),desc:(0,a.__)("Fixed at the bottom of the screen","newspack-plugin"),icon:X}),(0,d.jsx)(r.dr,{href:ne(null,t,p),title:(0,a.__)("Inline","newspack-plugin"),desc:(0,a.__)("Embedded in content","newspack-plugin"),icon:ee}),(0,d.jsx)(r.dr,{href:ne("archives",t,p),title:(0,a.__)("In Archive Pages","newspack-plugin"),desc:(0,a.__)("Embedded once or many times in archive pages","newspack-plugin"),icon:_.A}),(0,d.jsx)(r.dr,{href:ne("above-header",t,p),title:(0,a.__)("Above Header","newspack-plugin"),desc:(0,a.__)("Embedded at the very top of the page","newspack-plugin"),icon:m}),(0,d.jsx)(r.dr,{href:ne("custom",t,p),title:(0,a.__)("Custom Placement","newspack-plugin"),desc:(0,a.__)("Only appears when placed in content","newspack-plugin"),icon:w}),(0,d.jsx)(r.dr,{href:ne("manual",t,p),title:(0,a.__)("Manual Only","newspack-plugin"),desc:(0,a.__)("Only appears where Single Prompt block is inserted","newspack-plugin"),icon:k})]})})]})]})]}),(0,d.jsx)(r.Zp,{noBorder:!0,className:"newspack-campaigns__segment-group__action-cards",children:u.map(n=>(0,d.jsx)(Q,{className:D(n.status,i.configuration.is_disabled),description:I(n),warning:V(u,n),prompt:n,...e},n.id))}),u.length<1?(0,d.jsx)("p",{className:"newspack-campaigns__segment-group__empty-segment-text",children:h}):""]})},se=(0,s.createContext)({prompts:[]});var ae=t(6942),ie=t.n(ae),ce=t(7309),re=t.n(ce);const{useHistory:le}=r.Ix,oe="active",pe=e=>2===e?(0,a.__)("Rename Campaign","newspack-plugin"):1===e?(0,a.__)("Duplicate Campaign","newspack-plugin"):(0,a.__)("Add New Campaign","newspack-plugin"),ue=e=>2===e?(0,a.__)("Rename","newspack-plugin"):1===e?(0,a.__)("Duplicate","newspack-plugin"):(0,a.__)("Add","newspack-plugin"),de=(e,n)=>{if("trash"===n)return e.filter(({status:e})=>"trash"===e);const t=e.filter(({status:e})=>"trash"!==e);return oe===n?t.filter(({status:e})=>"publish"===e):"all"===n?t.filter(({status:e})=>"trash"!==e):"unassigned"===n?t.filter(({campaign_groups:e})=>!e||!e.length):t.filter(({campaign_groups:e})=>e&&e.find(e=>+e.term_id===+n))},ge=(e,n)=>{const t=[];return t.push(...e.map(({name:e,id:t,configuration:s,criteria:a})=>({label:e,id:t,configuration:s,criteria:a,prompts:n.filter(({segments:e})=>!!e&&!!e.find(e=>e.term_id===parseInt(t)))}))),t.push({label:(0,a.__)("Everyone","newspack-plugin"),id:"",prompts:n.filter(({segments:e})=>0===e.length),configuration:{}}),t},_e=(0,r.c_)(e=>{const{campaignId:n=oe,campaigns:t=[],manageCampaignGroup:i,segments:c,createCampaignGroup:l,duplicateCampaignGroup:u,deleteCampaignGroup:_,archiveCampaignGroup:h,renameCampaignGroup:m}=e,w=(0,s.useRef)(null),[k,x]=(0,s.useState)(),[b,f]=(0,s.useState)(),[v,j]=(0,s.useState)(),[C,y]=(0,s.useState)(),S=(0,s.useContext)(se),A=de(S,n),P=de(S,"unassigned").length;(0,s.useEffect)(()=>{b&&w.current.querySelector("input").focus()},[b]);const T=le(),L=e=>{3===v?l(e):2===v?m(n,e):1===v&&u(n,e),f(!1)},E=t.filter(({status:e})=>"archive"!==e),N=t.filter(({status:e})=>"archive"===e),$=((e,n)=>n.reduce((n,t)=>+e>0&&+e===+t.term_id?t:n,null))(n,t),F=[{key:oe,name:(0,a.__)("Active Prompts","newspack-plugin")},{key:"all",name:(0,a.__)("All Prompts","newspack-plugin")},{key:"trash",name:(0,a.__)("Trash","newspack-plugin")},...P?[{key:"unassigned",name:(0,a.__)("Unassigned Prompts","newspack-plugin")}]:[],...E.length?[{key:"header-campaigns",name:(0,a.__)("Campaigns","newspack-plugin"),className:"is-header"}]:[],...E.map(({term_id:e,name:n})=>({key:String(e),name:n,className:"newspack-campaigns__campaign-group__select-control-group-item"})),...N.length?[{key:"header-archived-campaigns",name:(0,a.__)("Archived Campaigns","newspack-plugin"),className:"is-header"}]:[],...N.map(({term_id:e,name:n})=>({key:String(e),name:n+" "+(0,a.__)("(archived)","newspack-plugin"),className:"newspack-campaigns__campaign-group__select-control-group-item"}))];return(0,d.jsxs)(s.Fragment,{children:[(0,d.jsxs)(r.Zp,{headerActions:!0,noBorder:!0,children:[(0,d.jsxs)("div",{className:"newspack-campaigns__campaign-group__filter-group-actions",children:[(0,d.jsx)(r.Jv,{label:(0,a.__)("Campaigns","newspack-plugin"),options:F.map(e=>({...e,className:ie()(e.className,{"is-selected":e.key===n})})),onChange:({selectedItem:{key:e}})=>oe===e?T.push("/campaigns"):T.push(`/campaigns/${e}`),value:re()(F,["key",n||oe]),hideLabelFromVision:!0}),$&&(0,d.jsxs)("div",{className:"newspack-campaigns__campaign-group__filter-group-actions__button",children:[(0,d.jsx)(r.$n,{className:k&&"popover-active",onClick:()=>x(!k),icon:p.A,label:(0,a.__)("Actions","newspack-plugin"),tooltipPosition:"bottom center"}),k&&(0,d.jsx)(g,{dismiss:()=>x(!1),isArchive:$&&"archive"===$.status,onActivate:()=>i(A),onArchive:()=>h(n,!0),onDeactivate:()=>i(A,"DELETE"),onDelete:()=>_(n),onDuplicate:()=>{f(!0),y(""),j(1)},onRename:()=>{y($.name),f(!0),j(2)},onUnarchive:()=>h(n,!1),hasPrompts:A.length>0,hasPublished:A.some(({status:e})=>"publish"===e)})]})]}),(0,d.jsxs)("div",{className:"newspack-campaigns__campaign-group__add-new-button",children:[(0,d.jsx)(r.$n,{isPrimary:!0,onClick:()=>{f(!b),y(""),j(3)},children:(0,a.__)("Add New Campaign","newspack-plugin")}),b&&(0,d.jsxs)(r.aF,{title:pe(v),onRequestClose:()=>{f(!1)},children:[(0,d.jsx)("div",{ref:w,children:(0,d.jsx)(r.xt,{placeholder:(0,a.__)("Campaign Name","newspack-plugin"),onChange:y,label:(0,a.__)("Campaign Name","newspack-plugin"),hideLabelFromVision:!0,value:C,onKeyDown:e=>{o.ENTER===e.keyCode&&""!==C&&(e.preventDefault(),L(C))}})}),(0,d.jsxs)(r.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,d.jsx)(r.$n,{variant:"secondary",onClick:()=>{f(!1)},children:(0,a.__)("Cancel","newspack-plugin")}),(0,d.jsx)(r.$n,{variant:"primary",disabled:!C,onClick:()=>L(C),children:ue(v)})]})]})]})]}),ge(c,A).map((t,s)=>oe===n&&t.configuration.is_disabled?null:(0,d.jsx)(te,{segment:t,campaignId:n,campaignData:$,...e},s))]})}),he=(0,r.c_)(()=>(0,d.jsx)(r.x5,{pluginSlug:"newspack-audience-campaigns",isWizard:!0,title:null})),{NavLink:me,useHistory:we}=r.Ix,ke=()=>(0,d.jsx)(me,{to:"segments/new",children:(0,d.jsx)(r.$n,{variant:"primary",children:(0,a.__)("Add New Segment","newspack-plugin")})}),xe=({inFlight:e,segment:n,segments:t,deleteSegment:i,index:c,sortSegments:l,wrapperRef:g,toggleSegmentStatus:_})=>{const[h,m]=(0,s.useState)(!1),w=()=>m(!1),k=we();return(0,d.jsx)(r.Lz,{isSmall:!0,id:`segment-${n.id}`,title:n.name,titleLink:`#/segments/${n.id}`,description:q(n),toggleChecked:!n.configuration.is_disabled,toggleOnChange:()=>_(n),badge:n.is_criteria_duplicated?(0,a.__)("Duplicate","newspack-plugin"):void 0,draggable:!0,dragIndex:c,dragWrapperRef:g,onDragCallback:s=>{if(e)return;const a=[...t];a.splice(c,1),a.splice(s,0,n),a.forEach((e,n)=>e.priority=n),JSON.stringify(a)!==JSON.stringify(t)&&l(a)},actionText:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.$n,{onClick:()=>m(!h),label:(0,a.__)("More options","newspack-plugin"),icon:p.A,className:h&&"popover-active"}),h&&(0,d.jsxs)(r.AM,{position:"bottom left",onKeyDown:e=>o.ESCAPE===e.keyCode&&w,onFocusOutside:w,children:[(0,d.jsx)(u.MenuItem,{onClick:()=>w(),className:"screen-reader-text",children:(0,a.__)("Close Popover","newspack-plugin")}),(0,d.jsx)(u.MenuItem,{onClick:()=>k.push(`/segments/${n.id}`),className:"newspack-button",children:(0,a.__)("Edit","newspack-plugin")}),(0,d.jsx)(u.MenuItem,{onClick:()=>i(n),className:"newspack-button",children:(0,a.__)("Delete","newspack-plugin")})]})]})})},be=({wizardApiFetch:e,segments:n,setSegments:t,isLoading:i})=>{const[c,l]=(0,s.useState)(null),[o,p]=(0,s.useState)(!1),[u,g]=(0,s.useState)(null),_=(0,s.useRef)();(0,s.useEffect)(()=>{window.scrollTo(0,0)},[]);const h=n=>{p(!0),g(null),e({path:`${newspackAudienceCampaigns.api}/segmentation/${n.id}`,method:"POST",quiet:!0,data:{name:n.name,configuration:{...n.configuration,is_disabled:!n.configuration.is_disabled},criteria:n.criteria}}).then(e=>{p(!1),t(e)}).catch(()=>{p(!1)})},m=n=>{p(!0),g(null),e({path:`${newspackAudienceCampaigns.api}/segmentation/${n.id}`,method:"DELETE",quiet:!0}).then(e=>{p(!1),t(e)}).catch(()=>{p(!1)})},w=s=>{g(null),l(s),p(!0),e({path:`${newspackAudienceCampaigns.api}/segmentation-sort`,method:"POST",data:{segmentIds:s.map(e=>e.id)},quiet:!0}).then(e=>{p(!1),l(null),t(e)}).catch(e=>{p(!1),g(e.message||(0,a.__)("There was an error sorting segments. Please try again.","newspack-plugin")),t(n)})};if(null===n)return null;const k=c||n;return n.length?(0,d.jsxs)(s.Fragment,{children:[u&&(0,d.jsx)(r.$T,{noticeText:u,isError:!0}),(0,d.jsxs)(r.Zp,{headerActions:!0,noBorder:!0,children:[(0,d.jsx)("h2",{children:(0,a.__)("Audience segments","newspack-plugin")}),(0,d.jsx)(ke,{})]}),(0,d.jsx)("div",{className:"newspack-campaigns-wizard-segments__list"+(o?" is-loading":""),ref:_,children:k.map((e,t)=>(0,d.jsx)(xe,{deleteSegment:m,inFlight:o||i>0,segment:e,segments:n,sortSegments:w,index:t,wrapperRef:_,totalSegments:n.length,toggleSegmentStatus:h},e.id))})]}):(0,d.jsxs)(s.Fragment,{children:[(0,d.jsxs)(r.Zp,{headerActions:!0,noBorder:!0,children:[(0,d.jsx)("h2",{children:(0,a.__)("You have no saved audience segments.","newspack-plugin")}),(0,d.jsx)(ke,{})]}),(0,d.jsx)("p",{children:(0,a.__)("Create audience segments to target visitors by engagement, activity, and more.","newspack-plugin")})]})};var fe=t(7958);function ve({label:e,help:n,placeholder:t,value:s,onChange:a,path:i,deletedItemLabel:c}){const r=e=>({value:/^\d+$/.test(e.id.toString())?parseInt(e.id):e.id.toString(),label:e.title||e.name||c});return(0,d.jsx)(fe.A,{label:e,help:n,placeholder:t,tokens:s||[],fetchSuggestions:async()=>{const e=await f()({path:i});return(Array.isArray(e)?e:Object.values(e)).map(r)},fetchSavedInfo:async e=>{const n=await f()({path:i}),t=Array.isArray(n)?n:Object.values(n);return e.map(e=>{const n=t.find(n=>(/^\d+$/.test(n.id.toString())?parseInt(n.id):n.id.toString())===e);return n?r(n):!(!c||!e)&&r({id:e})}).filter(Boolean)},onChange:a})}const{useHistory:je}=r.Ix,{SettingsCard:Ce,SettingsSection:ye,MinMaxSetting:Se}=r.wB,Ae={is_disabled:!1};(0,y.addFilter)("newspack.criteria.input","newspack.favoriteCategories",function(e,n,t,s){return"favorite_categories"===n.id?(0,d.jsx)(r.vn,{value:t||[],onChange:e=>{s(e.map(e=>e.id))},label:n.name,hideLabelFromVision:!0}):e}),(0,y.addFilter)("newspack.criteria.input","newspack.newsletterSubscribedLists",function(e,n,t,s){return["subscribed_lists","not_subscribed_lists"].includes(n.id)?(0,d.jsx)(ve,{placeholder:(0,a.__)("Start typing to search for lists…","newspack-plugin"),path:"/newspack-newsletters/v1/lists_config",value:t,onChange:s,deletedItemLabel:(0,a.__)("Deleted list","newspack-plugin")}):e}),(0,y.addFilter)("newspack.criteria.input","newspack.activeSubscriptions",function(e,n,t,s){return["active_subscriptions","not_active_subscriptions"].includes(n.id)?(0,d.jsx)(ve,{placeholder:(0,a.__)("Start typing to search for products…","newspack-plugin"),path:`${newspackAudienceCampaigns.api}/subscription-products`,value:t,onChange:s,deletedItemLabel:(0,a.__)("Deleted subscription","newspack-plugin")}):e}),(0,y.addFilter)("newspack.criteria.input","newspack.activeMemberships",function(e,n,t,s){return["active_memberships","not_active_memberships"].includes(n.id)?(0,d.jsx)(ve,{placeholder:(0,a.__)("Start typing to search for membership plans…","newspack-plugin"),path:"/wc/v3/memberships/plans?per_page=100",value:t,onChange:s,deletedItemLabel:(0,a.__)("Deleted plan","newspack-plugin")}):e}),(0,y.addFilter)("newspack.criteria.input","newspack.devices",function(e,n,t,s){if("devices"===n.id){const e=Array.isArray(t)?t:[];return(0,d.jsx)("div",{className:"newspack-device-segments",children:(0,d.jsx)(r.xA,{columns:1,rowGap:16,children:n.options.map(n=>(0,d.jsx)(u.CheckboxControl,{label:n.label,checked:e.includes(n.value),onChange:t=>{s(t?[...e,n.value]:e.filter(e=>e!==n.value))}},n.value))})})}return e});const Pe=({segmentId:e,setSegments:n,wizardApiFetch:t})=>{const i=window.newspackAudienceCampaigns?.criteria||[],[c,l]=r.JL.useObjectState(Ae),[o,p]=(0,s.useState)(""),[g,_]=(0,s.useState)([]),[h,m]=(0,s.useState)([]),[w,k]=(0,s.useState)(""),x=je(),[b,f]=(0,s.useState)("[]"),v=h!==JSON.stringify(g)||w!==o||JSON.stringify(b.is_disabled)!==JSON.stringify(c.is_disabled),j=r.JL.usePrompt(v,(0,a.__)("There are unsaved changes to this segment. Discard changes?","newspack-plugin")),C="new"===e;(0,s.useEffect)(()=>{C||t({path:`${newspackAudienceCampaigns.api}/segmentation`}).then(n=>{const t=re()(n,({id:n})=>n===e);if(t){const e={...Ae,...t.configuration};l(e),f(e),p(t.name),k(t.name),_([...t.criteria]),m(JSON.stringify(t.criteria))}})},[C]);const S=e=>{const n=(e=>{const n=g.find(n=>n.criteria_id===e);return n?n.value:""})(e.id),t=(s=e.id,e=>{const n=[...g],t=n.find(e=>e.criteria_id===s);t?!e||Array.isArray(e)&&0===e.length?n.splice(n.indexOf(t),1):Array.isArray(e)||"object"!=typeof e?t.value=e:t.value={...t.value,...e}:e&&n.push({criteria_id:s,value:e}),_(n)});var s;return(0,y.applyFilters)("newspack.criteria.input","range"===e.matching_function?(0,d.jsx)(Se,{"data-testid":`newspack-criteria-${e.id}`,min:n?.min,max:n?.max,onChangeMin:e=>t({min:e}),onChangeMax:e=>t({max:e})}):e.options?.length?(0,d.jsx)(r.Yq,{"data-testid":`newspack-criteria-${e.id}`,isWide:!0,onChange:t,value:n,options:e.options}):(0,d.jsx)(r.xt,{"data-testid":`newspack-criteria-${e.id}`,isWide:!0,placeholder:e.placeholder,help:e.help,value:n,onChange:t}),e,n,t)};return(0,d.jsxs)(s.Fragment,{children:[(0,d.jsx)(r.xt,{placeholder:(0,a.__)("Untitled Segment","newspack-plugin"),value:o,onChange:p,label:(0,a.__)("Title","newspack-plugin"),className:"newspack-campaigns-wizard-segments__title"}),(0,d.jsx)(Ce,{title:(0,a.__)("Segment Status","newspack-plugin"),description:(0,a.__)("If not enabled, the segment will be ignored for reader segmentation.","newspack-plugin"),noBorder:!0,children:(0,d.jsx)(u.ToggleControl,{label:(0,a.__)("Segment enabled","newspack-plugin"),checked:!c.is_disabled,onChange:()=>l({is_disabled:!c.is_disabled})})}),(0,d.jsx)(Ce,{title:(0,a.__)("Reader Engagement","newspack-plugin"),description:(0,a.__)("Target readers based on their browsing behavior.","newspack-plugin"),noBorder:!0,children:i.filter(e=>"reader_engagement"===e.category).map(e=>(0,d.jsx)(ye,{title:e.name,description:e.description,children:S(e)},e.id))}),(0,d.jsx)(Ce,{title:(0,a.__)("Registration","newspack-plugin"),description:(0,a.__)("Target readers based on their user account registration status.","newspack-plugin"),columns:3,noBorder:!0,children:i.filter(e=>"reader_activity"===e.category).map(e=>(0,d.jsx)(ye,{title:e.name,description:e.description,children:S(e)},e.id))}),(0,d.jsx)(Ce,{title:(0,a.__)("Newsletters","newspack-plugin"),description:(0,a.__)("Target readers based on their newsletter subscription status.","newspack-plugin"),columns:3,noBorder:!0,children:i.filter(e=>"newsletter"===e.category).map(e=>(0,d.jsx)(ye,{title:e.name,description:e.description,children:S(e)},e.id))}),(0,d.jsx)(Ce,{title:(0,a.__)("Reader Revenue","newspack-plugin"),description:(0,a.__)("Target readers based on their revenue activity.","newspack-plugin"),columns:3,noBorder:!0,children:i.filter(e=>"reader_revenue"===e.category).map(e=>(0,d.jsx)(ye,{title:e.name,description:e.description,children:S(e)},e.id))}),(0,d.jsx)(Ce,{title:(0,a.__)("Referrer Sources","newspack-plugin"),description:(0,a.__)("Target readers based on where they’re coming from.","newspack-plugin"),notification:(0,a.__)("Segments using these options will apply only to the first page visited after coming from an external source.","newspack-plugin"),columns:2,noBorder:!0,children:i.filter(e=>"referrer_sources"===e.category).map(e=>(0,d.jsx)(ye,{title:e.name,description:e.description,children:S(e)},e.id))}),(0,d.jsxs)("div",{className:"newspack-buttons-card",children:[(0,d.jsx)(r.$n,{disabled:!(()=>{const e={...c},n={...Ae};return delete e.is_disabled,delete n.is_disabled,o.length>0&&g.length})()||!C&&!v,isPrimary:!0,onClick:()=>{j();const s=C?`${newspackAudienceCampaigns.api}/segmentation`:`${newspackAudienceCampaigns.api}/segmentation/${e}`;t({path:s,method:"POST",data:{name:o,criteria:g,configuration:c},quiet:!0}).then(n).then(x.push("/segments"))},children:(0,a.__)("Save","newspack-plugin")}),(0,d.jsx)(r.$n,{isSecondary:!0,href:"#/segments",children:(0,a.__)("Cancel","newspack-plugin")})]})]})},Te=(0,r.c_)(({wizardApiFetch:e,match:n,...t})=>{const s=n.params.id;return s?(0,d.jsx)(Pe,{segmentId:s,wizardApiFetch:e,...t}):(0,d.jsx)(be,{wizardApiFetch:e,...t})}),{HashRouter:Le,Redirect:Ee,Route:Ne,Switch:$e}=l.A,Fe=(0,a.__)("Audience Management / Campaigns","newspack-plugin"),Me=[{label:(0,a.__)("Campaigns","newpack-plugin"),path:"/campaigns",exact:!0},{label:(0,a.__)("Segments","newpack-plugin"),path:"/segments",exact:!1},{label:(0,a.__)("Settings","newpack-plugin"),path:"/settings",exact:!0}];class ze extends s.Component{constructor(e){super(e),this.state={campaigns:[],prompts:[],segments:[],settings:[],previewUrl:null,previewTitle:null,duplicated:null,inFlight:!1}}onWizardReady=()=>{this.refetch()};refetch=()=>{const{setError:e,wizardApiFetch:n}=this.props;n({path:newspackAudienceCampaigns.api}).then(this.updateAfterAPI).catch(n=>e(n))};updatePopup=({id:e,...n})=>{const{setError:t,wizardApiFetch:s}=this.props;return this.setState({inFlight:!0}),s({path:`${newspackAudienceCampaigns.api}/${e}`,method:"POST",data:{config:n},quiet:!0}).then(this.updateAfterAPI).catch(e=>t(e))};deletePopup=e=>{const{setError:n,wizardApiFetch:t}=this.props;return t({path:`${newspackAudienceCampaigns.api}/${e}`,method:"DELETE",quiet:!0}).then(this.updateAfterAPI).catch(e=>n(e))};restorePopup=e=>{const{setError:n,wizardApiFetch:t}=this.props;return t({path:`${newspackAudienceCampaigns.api}/${e}/restore`,method:"POST",quiet:!0}).then(this.updateAfterAPI).catch(e=>n(e))};publishPopup=e=>{const{setError:n,wizardApiFetch:t}=this.props;return t({path:`${newspackAudienceCampaigns.api}/${e}/publish`,method:"POST",quiet:!0}).then(this.updateAfterAPI).catch(e=>n(e))};unpublishPopup=e=>{const{setError:n,wizardApiFetch:t}=this.props;return t({path:`${newspackAudienceCampaigns.api}/${e}/publish`,method:"DELETE",quiet:!0}).then(this.updateAfterAPI).catch(e=>n(e))};duplicatePopup=(e,n)=>{const{setError:t,wizardApiFetch:s}=this.props;return this.setState({inFlight:!0}),s({path:(0,i.addQueryArgs)(`${newspackAudienceCampaigns.api}/${e}/duplicate`,{title:n}),method:"POST",quiet:!0}).then(this.updateAfterAPI).catch(()=>{t({code:"duplicate_prompt_error",message:(0,a.__)("Error duplicating prompt. Please try again later.","newspack-plugin")})})};previewUrlForPopup=({options:e,id:n})=>{const{placement:t,trigger_type:s}=e,a=window.newspackAudienceCampaigns?.preview_query_keys||{},i={};Object.keys(e).forEach(n=>{a.hasOwnProperty(n)&&(i[a[n]]=e[n])});let r="/";return"archives"===t&&window.newspackAudienceCampaigns?.preview_archive?r=window.newspackAudienceCampaigns.preview_archive:("inline"===t||"scroll"===s)&&window&&window.newspackAudienceCampaigns?.preview_post&&(r=window.newspackAudienceCampaigns?.preview_post),`${r}?${(0,c.stringify)({...i,pid:n})}`};updateAfterAPI=({campaigns:e,prompts:n,segments:t,settings:s,duplicated:a=null})=>this.setState({campaigns:e,prompts:n,segments:t,settings:s,duplicated:a,inFlight:!1});manageCampaignGroup=(e,n="POST")=>{const{setError:t,wizardApiFetch:s}=this.props;return s({path:`${newspackAudienceCampaigns.api}/batch-publish/`,data:{ids:e.map(e=>e.id)},method:n,quiet:!0}).then(this.updateAfterAPI).catch(e=>t(e))};render(){const{pluginRequirements:e,setError:n,isLoading:t,wizardApiFetch:s,startLoading:i,doneLoading:c}=this.props,{campaigns:l,inFlight:o,prompts:p,segments:u,settings:g,previewUrl:_,previewTitle:h,duplicated:m}=this.state;return(0,d.jsx)(r.LQ,{url:_,title:h?/* translators: %s: prompt title */ /* translators: %s: prompt title */(0,a.sprintf)((0,a.__)("Prompt: %s","newspack-plugin"),h):null,onClose:()=>this.setState({previewUrl:null,previewTitle:null}),renderButton:({showPreview:a})=>{const r={headerText:Fe,tabbedNavigation:Me,setError:n,isLoading:t,startLoading:i,doneLoading:c,wizardApiFetch:s,prompts:p,segments:u,settings:g,duplicated:m,inFlight:o},_={...r,manageCampaignGroup:this.manageCampaignGroup,updatePopup:this.updatePopup,deletePopup:this.deletePopup,restorePopup:this.restorePopup,duplicatePopup:this.duplicatePopup,previewPopup:e=>this.setState({previewUrl:this.previewUrlForPopup(e),previewTitle:e.title},()=>a()),publishPopup:this.publishPopup,resetDuplicated:()=>this.setState({duplicated:null}),unpublishPopup:this.unpublishPopup,refetch:this.refetch};return(0,d.jsx)(Le,{hashType:"slash",children:(0,d.jsxs)($e,{children:[e,(0,d.jsx)(Ne,{path:"/campaigns/:id?",render:e=>{const t=e.match.params.id;return(0,d.jsx)(se.Provider,{value:p,children:(0,d.jsx)(_e,{..._,archiveCampaignGroup:(e,t)=>s({path:`${newspackAudienceCampaigns.api}/archive-campaign/${e}`,method:t?"POST":"DELETE",quiet:!0}).then(this.updateAfterAPI).catch(e=>n(e)),campaignId:t,createCampaignGroup:t=>s({path:`${newspackAudienceCampaigns.api}/create-campaign/`,method:"POST",data:{name:t},quiet:!0}).then(n=>{this.setState({campaigns:n.campaigns,prompts:n.prompts,segments:n.segments,settings:n.settings}),e.history.push(`/campaigns/${n.term_id}`)}).catch(e=>n(e)),deleteCampaignGroup:t=>s({path:`${newspackAudienceCampaigns.api}/delete-campaign/${t}`,method:"DELETE",quiet:!0}).then(n=>{this.setState({campaigns:n.campaigns,prompts:n.prompts,segments:n.segments,settings:n.settings}),e.history.push("/campaigns/")}).catch(e=>n(e)),duplicateCampaignGroup:(t,a)=>s({path:`${newspackAudienceCampaigns.api}/duplicate-campaign/${t}`,method:"POST",data:{name:a},quiet:!0}).then(n=>{this.setState({campaigns:n.campaigns,prompts:n.prompts,segments:n.segments,settings:n.settings}),e.history.push(`/campaigns/${n.term_id}`)}).catch(e=>n(e)),renameCampaignGroup:(e,t)=>s({path:`${newspackAudienceCampaigns.api}/rename-campaign/${e}`,method:"POST",data:{name:t},quiet:!0}).then(this.updateAfterAPI).catch(e=>n(e)),campaigns:l})})}}),(0,d.jsx)(Ne,{path:"/segments/:id?",render:e=>(0,d.jsx)(Te,{...e,...r,setSegments:e=>this.setState({segments:e})})}),(0,d.jsx)(Ne,{path:"/settings",render:()=>(0,d.jsx)(he,{...r})}),(0,d.jsx)(Ee,{to:"/campaigns"})]})})}})}}const Oe=(0,r.Aq)(ze)},2005:(e,n,t)=>{"use strict";t.d(n,{L:()=>d});var s=t(7143),a=t(8537),i=t(6087),c=t(3076),r=t(7153);function l(e){var n;return null!==(n=e.split("?").at(0))&&void 0!==n?n:e}let o={};const p=e=>{const n={message:"An unknown API error occurred.",statusCode:500,errorCode:"api_unknown_error",details:""};if(!e)return null;if("string"==typeof e)n.message=e;else if(e instanceof Error||"message"in e){var t,s,a;n.message=null!==(t=e.message)&&void 0!==t?t:n.message,n.statusCode=null!==(s=e.data?.status)&&void 0!==s?s:n.statusCode,n.errorCode=null!==(a=e.code)&&void 0!==a?a:n.errorCode,n.details=""}return new r.Ss(n.message,n.statusCode,n.errorCode,n.details)},u=e=>({on(n,t=null){const s=e?.[n];s&&"function"==typeof s&&s(t)}});function d(e){var n;const[t,r]=(0,i.useState)(!1),{wizardApiFetch:d,updateWizardSettings:g}=(0,s.useDispatch)(c.S),_=(0,s.useSelect)(n=>n(c.S).getWizardData(e),[e]),[h,m]=(0,i.useState)(null!==(n=_.error)&&void 0!==n?n:null),w=(0,i.useRef)([]);function k(){m(null)}return(0,i.useEffect)(()=>{g({slug:e,path:["error"],value:h})},[h,g,e]),{wizardApiFetch:(0,i.useCallback)(async(n,t)=>{const{on:s}=u(null!=t?t:{}),a=function(n){return(t,s,a=n)=>{const i=a?l(a):a;g({slug:e,path:[i,...Array.isArray(t)?t:[t]].filter(e=>"string"==typeof e),value:s})}}(n.path),{path:i,method:c="GET"}=n,h=l(null!=i?i:""),{isCached:k="GET"===c,updateCacheKey:x=null,updateCacheMethods:b=[],...f}=n,{error:v,[h]:{[c]:j=null}={}}=_;function C(e){if(k&&a(c,e),x&&x.constructor===Object){const[n,t]=Object.entries(x)[0],s=_[n][t];let i;i=s&&s.constructor===Object?{...s,...e}:e,a(Object.entries(x)[0],i,null)}for(const n of b)a(n,e);return s("onSuccess",e),e}function y(e){const n=p(e);throw m(n),s("onError",n),n}function S(){const{[h]:e,...n}=o;o=n,w.current=w.current.filter(e=>e!==h),r(w.current.length>0),s("onFinally")}return o[h]?(r(!0),o[h].then(C).catch(y).finally(S)):k&&(v||j)?(m(v),s("onSuccess",j),j):(r(!0),s("onStart"),w.current.push(h),o[h]=d({isQuietFetch:!0,isLocalError:!0,...f}).then(C).catch(y).finally(S),o[e])},[d,_,g,t,e]),isFetching:t,errorMessage:h?(0,a.decodeEntities)(h.message):null,error:h,cache:n=>({get:(e="GET")=>_[n][e],set(t,s="GET"){g({slug:e,path:[n,s],value:t})}}),setError(e){null===e?k():m(p(e))},resetError:k}}},2066:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>f}),t(8209);var s=t(5880),a=t.n(s),i=t(7723),c=t(6087),r=t(1311),l=t(5186),o=t(7143),p=t(6427),u=t(790);class d extends c.Component{render(){const{currencySymbol:e,error:n,label:t,min:s,value:a,onChange:i}=this.props;return(0,u.jsxs)("div",{className:"newspack-donations-wizard__money-input-container",children:[(0,u.jsx)("p",{className:"input-label",children:t}),(0,u.jsxs)("div",{className:"newspack-donations-wizard__money-input",children:[(0,u.jsx)("div",{className:"currency",children:e}),(0,u.jsx)(r.xt,{type:"number",hideLabelFromVision:!0,label:t,min:s,value:a,onChange:i})]}),n&&(0,u.jsx)("p",{className:"newspack-donations-wizard__money-input-error",children:n})]})}}const g=d;var _=t(3076),h=t(5829),m=t(3731);const w={once:{tieredLabel:(0,i.__)("One-time donations"),staticLabel:(0,i.__)("Suggested one-time donation amount")},month:{tieredLabel:(0,i.__)("Monthly donations"),staticLabel:(0,i.__)("Suggested donation amount per month")},year:{tieredLabel:(0,i.__)("Annual donations"),staticLabel:(0,i.__)("Suggested donation amount per year")}},k=Object.keys(w),x=()=>{const e=(0,l.l)(m.tF),{updateWizardSettings:n}=(0,o.useDispatch)(_.S);if(!e.donation_data||"errors"in e.donation_data)return null;const{amounts:t,currencySymbol:s,tiered:a,disabledFrequencies:c,minimumDonation:d,trashed:h}=e.donation_data,x=e=>t=>n({slug:m.tF,path:["donation_data",...e],value:t}),b=k.map(e=>({key:e,...w[e]})),f=parseFloat(d),v=window.newspackAudienceDonations?.can_use_name_your_price;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(r.Zp,{headerActions:!0,noBorder:!0,children:[(0,u.jsx)(r.X3,{title:(0,i.__)("Suggested Donations","newspack-plugin"),description:(0,i.__)("Set suggested donation amounts. These will be the default settings for the Donate block.","newspack-plugin"),noMargin:!0}),v&&(0,u.jsx)(r.Yq,{label:(0,i.__)("Donation Type","newspack-plugin"),onChange:()=>x(["tiered"])(!a),buttonOptions:[{value:!0,label:(0,i.__)("Tiered","newspack-plugin")},{value:!1,label:(0,i.__)("Untiered","newspack-plugin")}],buttonSmall:!0,value:a,hideLabelFromVision:!0})]}),Array.isArray(h)&&0<h.length&&(0,u.jsx)(r.$T,{isError:!0,children:(0,u.jsx)("span",{dangerouslySetInnerHTML:{__html:(0,i.sprintf)(
// Translators: %1$s is a link to the trashed products. %2$s is a comma-separated list of trashed product names.
// Translators: %1$s is a link to the trashed products. %2$s is a comma-separated list of trashed product names.
(0,i.__)('One or more donation products is in trash. Please <a href="%1$s">restore the product(s)</a> to continue using donation features: %2$s',"newspack-plugin"),"/wp-admin/edit.php?post_status=trash&post_type=product",h.join(", "))}})}),a?(0,u.jsx)(r.xA,{columns:1,children:b.map(e=>{const n=c[e.key],a=Object.values(c).filter(Boolean).length===k.length-1;return(0,u.jsx)(r.Zp,{noBorder:!0,children:(0,u.jsxs)(r.xA,{columns:1,gutter:8,children:[(0,u.jsx)(p.ToggleControl,{checked:!n,onChange:()=>x(["disabledFrequencies",e.key])(!n),label:e.tieredLabel,disabled:!n&&a}),!n&&(0,u.jsxs)(r.xA,{columns:3,rowGap:16,children:[(0,u.jsx)(g,{currencySymbol:s,label:(0,i.__)("Low-tier"),error:t[e.key][0]<f?(0,i.__)("Warning: suggested donations should be at least the minimum donation amount.","newspack-plugin"):null,value:t[e.key][0],min:f,onChange:x(["amounts",e.key,0])}),(0,u.jsx)(g,{currencySymbol:s,label:(0,i.__)("Mid-tier"),error:t[e.key][1]<f?(0,i.__)("Warning: suggested donations should be at least the minimum donation amount.","newspack-plugin"):null,value:t[e.key][1],min:f,onChange:x(["amounts",e.key,1])}),(0,u.jsx)(g,{currencySymbol:s,label:(0,i.__)("High-tier"),error:t[e.key][2]<f?(0,i.__)("Warning: suggested donations should be at least the minimum donation amount.","newspack-plugin"):null,value:t[e.key][2],min:f,onChange:x(["amounts",e.key,2])})]})]})},e.key)})}):(0,u.jsx)(r.xA,{columns:1,children:(0,u.jsx)(r.Zp,{noBorder:!0,children:(0,u.jsx)(r.xA,{columns:3,rowGap:16,children:b.map(e=>{const n=c[e.key],a=Object.values(c).filter(Boolean).length===k.length-1;return(0,u.jsxs)(r.xA,{columns:1,gutter:16,children:[(0,u.jsx)(p.ToggleControl,{checked:!n,onChange:()=>x(["disabledFrequencies",e.key])(!n),label:e.tieredLabel,disabled:!n&&a}),!n&&(0,u.jsx)(g,{currencySymbol:s,label:e.staticLabel,value:t[e.key][3],min:f,error:t[e.key][3]<f?(0,i.__)("Warning: suggested donations should be at least the minimum donation amount.","newspack-plugin"):null,onChange:x(["amounts",e.key,3])},e.key)]},e.key)})})})}),(0,u.jsx)(r.xA,{columns:3,children:(0,u.jsx)(r.xt,{label:(0,i.__)("Minimum donation","newspack-plugin"),help:(0,i.__)("Set minimum donation amount. Setting a reasonable minimum donation amount can help protect your site from bot attacks.","newspack-plugin"),type:"number",min:1,value:f,onChange:e=>x(["minimumDonation"])(e)})})]})},b=()=>{const e=(0,l.l)(m.tF),{saveWizardSettings:n}=(0,o.useDispatch)(_.S),t=Object.values(e.product_validation||{}),s=t.some(e=>e.issues.length>0);return(0,u.jsxs)(h.A,{title:(0,i.__)("Configuration","newspack-plugin"),children:[s?(0,u.jsx)(r.$T,{isWarning:!0,noticeText:(0,i.__)("Some donation products are invalid. Please correct the following issues:","newspack-plugin"),style:{marginBottom:"16px"},children:(0,u.jsx)("ul",{style:{marginTop:"8px",marginBottom:"0"},children:t.map(e=>e.issues&&e.issues.length>0?(0,u.jsxs)("li",{style:{marginBottom:"8px"},children:[(0,u.jsxs)("strong",{children:[e.product_name||(0,i.sprintf)(
// translators: %d: Product ID.
// translators: %d: Product ID.
(0,i.__)("Product ID %d","newspack-plugin"),e.product_id),e.frequency&&` (${e.frequency})`,":"]})," ",(0,u.jsx)(p.ExternalLink,{href:`/wp-admin/post.php?post=${e.product_id}&action=edit`,children:(0,i.__)("edit","newspack-plugin")}),(0,u.jsx)("ul",{style:{marginTop:"4px",marginLeft:"20px"},children:e.issues.map((e,n)=>(0,u.jsx)("li",{children:e},n))})]},e.product_id):null)})}):null,e.donation_page&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(r.Zp,{noBorder:!0,headerActions:!0,children:[(0,u.jsx)(r.X3,{title:(0,i.__)("Donations Landing Page","newspack-plugin"),noMargin:!0}),(0,u.jsx)(r.$n,{variant:"secondary",isSmall:!0,href:e.donation_page.editUrl,onClick:void 0,children:(0,i.__)("Edit Page")})]}),"publish"===e.donation_page.status?(0,u.jsx)(r.$T,{isSuccess:!0,noticeText:(0,i.__)("Your donations landing page is published.","newspack-plugin"),style:{marginBottom:"64px"}}):(0,u.jsx)(r.$T,{isWarning:!0,noticeText:(0,i.__)("Your donations landing page is not yet published.","newspack-plugin"),style:{marginBottom:"64px"}})]}),(0,u.jsx)(x,{}),(0,u.jsx)("div",{className:"newspack-buttons-card",children:(0,u.jsx)(r.$n,{variant:"primary",onClick:()=>n({slug:m.tF,payloadPath:["donation_data"],auxData:{saveDonationProduct:!0}}),children:(0,i.__)("Save Settings","newspack-plugin")})})]})},f=(0,r.Aq)((0,c.forwardRef)((e,n)=>{const{platform_data:t,donation_data:s}=(0,l.l)(m.tF),c=t?.platform,o=[{label:(0,i.__)("Configuration","newspack-plugin"),path:"/configuration",render:b,isHidden:c===m.Zs}];return(0,u.jsx)(r.sQ,{headerText:(0,i.__)("Audience Management / Donations","newspack-plugin"),sections:o,apiSlug:m.tF,renderAboveSections:()=>a()(s?.errors).map((e,n)=>(0,u.jsx)(r.$T,{isError:!0,noticeText:e},n)),requiredPlugins:["newspack-blocks"],ref:n})}))},3673:e=>{e.exports=function(e){for(var n=-1,t=null==e?0:e.length,s=0,a=[];++n<t;){var i=e[n];i&&(a[s++]=i)}return a}},3731:(e,n,t)=>{"use strict";t.d(n,{FF:()=>s,L0:()=>a,Zs:()=>i,tF:()=>c});const s="nrh",a="wc",i="other",c="newspack-audience-donations"},4058:(e,n,t)=>{"use strict";t.d(n,{A:()=>a});class s extends Error{constructor(e,n,t=""){super(e),this.name="WizardError",this.errorCode=n,this.details=t,Object.setPrototypeOf&&Object.setPrototypeOf(this,new.target.prototype)}toJSON(){return{name:this.name,message:this.message,errorCode:this.errorCode,details:this.details,stackTrace:this.stack}}}const a=s},4081:(e,n,t)=>{"use strict";t.d(n,{A:()=>r});var s=t(7723),a=t(6427),i=t(1311),c=t(790);function r({config:e,setConfig:n,updateConfig:t,noBorder:r=!1}){const l=newspackAudience?.available_products||[];return(0,c.jsx)(i.Lz,{title:(0,s.__)("Metered Countdown","newspack-plugin"),heading:r?1:2,description:(0,s.__)("Show a countdown banner before content is restricted by a metered content gate.","newspack-plugin"),toggleOnChange:e=>t({countdown_banner:{enabled:e}}),toggleChecked:e.countdown_banner?.enabled,hasGreyHeader:!r&&e.countdown_banner?.enabled,togglePosition:"trailing",noBorder:r,children:e.countdown_banner?.enabled&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(i.xA,{columns:2,rowGap:16,children:[(0,c.jsx)(i.xt,{label:(0,s.__)("Message","newspack-plugin"),help:(0,s.__)("Text displayed in the countdown banner.","newspack-plugin"),value:e.countdown_banner.cta_label,onChange:t=>n({...e,countdown_banner:{...e.countdown_banner,cta_label:t}}),__next40pxDefaultSize:!0}),(0,c.jsx)(i.xt,{label:(0,s.__)("Subscribe button label","newspack-plugin"),help:(0,s.__)("Text displayed on the subscribe button in the banner.","newspack-plugin"),value:e.countdown_banner.button_label,onChange:t=>n({...e,countdown_banner:{...e.countdown_banner,button_label:t}}),__next40pxDefaultSize:!0})]}),(0,c.jsxs)(i.xA,{columns:3,rowGap:16,children:[(0,c.jsxs)(a.__experimentalToggleGroupControl,{label:(0,s.__)("Style","newspack-plugin"),value:e.countdown_banner.style||"light",onChange:t=>n({...e,countdown_banner:{...e.countdown_banner,style:t}}),isBlock:!0,__next40pxDefaultSize:!0,children:[(0,c.jsx)(a.__experimentalToggleGroupControlOption,{label:(0,s.__)("Light","newspack-plugin"),value:"light"}),(0,c.jsx)(a.__experimentalToggleGroupControlOption,{label:(0,s.__)("Dark","newspack-plugin"),value:"dark"})]}),(0,c.jsxs)(a.__experimentalToggleGroupControl,{label:(0,s.__)("Subscribe button action","newspack-plugin"),help:(0,s.__)("Whether the subscribe button should start a product checkout or redirect to a landing page.","newspack-plugin"),value:e.countdown_banner.cta_type||"product",onChange:t=>n({...e,countdown_banner:{...e.countdown_banner,cta_type:t}}),isBlock:!0,__next40pxDefaultSize:!0,children:[(0,c.jsx)(a.__experimentalToggleGroupControlOption,{label:(0,s.__)("Product","newspack-plugin"),value:"product"}),(0,c.jsx)(a.__experimentalToggleGroupControlOption,{label:(0,s.__)("Landing page","newspack-plugin"),value:"url"})]}),"product"===e.countdown_banner.cta_type&&(0,c.jsx)(i.Yq,{label:(0,s.__)("Subscribe button product","newspack-plugin"),help:(0,s.__)("Product linked to the subscribe button.","newspack-plugin"),options:[{label:(0,s.__)("Select a product","newspack-plugin"),value:0,disabled:!0},...l],value:e.countdown_banner.cta_product_id,suggestions:l.map(e=>e.label),onChange:t=>n({...e,countdown_banner:{...e.countdown_banner,cta_product_id:t}}),__next40pxDefaultSize:!0}),"url"===e.countdown_banner.cta_type&&(0,c.jsx)(i.xt,{label:(0,s.__)("Subscribe button URL","newspack-plugin"),help:(0,s.__)("URL for the landing page to redirect to.","newspack-plugin"),value:e.countdown_banner.cta_url,onChange:t=>n({...e,countdown_banner:{...e.countdown_banner,cta_url:t}}),__next40pxDefaultSize:!0}),(0,c.jsx)("div",{style:{gridColumn:"1 / -1"},children:(0,c.jsx)(a.BaseControl,{id:"newspack-countdown-banner-cta-preview",label:(0,s.__)("Preview","newspack-plugin"),children:(0,c.jsx)("div",{className:"newspack-countdown-banner__cta-preview",inert:"true",children:(0,c.jsx)("div",{className:"newspack-ui",children:(0,c.jsx)("div",{className:`banner newspack-countdown-banner__cta is-style-${e.countdown_banner.style||"light"}`,children:(0,c.jsxs)("div",{className:"wrapper newspack-countdown-banner__cta__content",children:[(0,c.jsxs)("div",{className:"newspack-countdown-banner__cta__content__wrapper",children:[(0,c.jsx)("span",{className:"newspack-countdown-banner__cta__content__countdown newspack-ui__font--s",children:(0,c.jsx)("strong",{children:(0,s.__)("1/10 free articles this month","newspack-plugin")})}),(0,c.jsxs)("span",{className:"newspack-countdown-banner__cta__content__message newspack-ui__font--xs",children:[e.countdown_banner.cta_label||(0,s.__)("Subscribe now and get unlimited access.","newspack-plugin")," ",(0,c.jsx)("a",{href:"#signin_modal",children:(0,s.__)("Sign in to an existing account","newspack-plugin")}),"."]})]}),("product"===e.countdown_banner.cta_type&&e.countdown_banner.cta_product_id||"url"===e.countdown_banner.cta_type&&e.countdown_banner.cta_url)&&(0,c.jsx)("button",{className:"newspack-ui__button newspack-ui__button--x-small "+("dark"===(e.countdown_banner.style||"light")?"newspack-ui__button--primary-light":"newspack-ui__button--accent"),children:e.countdown_banner.button_label||(0,s.__)("Subscribe now","newspack-plugin")})]})})})})})})]}),(0,c.jsx)("div",{className:"newspack-buttons-card",style:{margin:"32px 0 0 0"},children:(0,c.jsx)(i.$n,{isPrimary:!0,onClick:()=>t({countdown_banner:e.countdown_banner}),children:(0,s.__)("Save Settings","newspack-plugin")})})]})})}},5813:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>ie});var s=t(7723),a=t(6087),i=t(6427),c=t(1455),r=t.n(c),l=t(1311),o=t(5829),p=t(1093),u=t(790);function d({slug:e,config:n,getSharedProps:t,inFlight:a,prerequisite:c,saveConfig:r,skipPrerequisite:o}){const{href:d}=c,g=Boolean(c.is_skipped),_=Boolean(g||c.active),h=Object.keys(c.fields||{});let m=(0,s.__)("Pending","newspack-plugin");return _&&(m=(0,s.__)("Ready","newspack-plugin")),g&&!c.active&&(m=(0,s.__)("Skipped","newspack-plugin")),c.is_unavailable&&(m=(0,s.__)("Unavailable","newspack-plugin")),(0,u.jsx)(l.Lz,{className:"newspack-ras-wizard__prerequisite",isMedium:!0,expandable:!c.is_unavailable,collapse:_,title:c.label,description:(0,s.sprintf)(/* translators: %s: Prerequisite status */ /* translators: %s: Prerequisite status */
(0,s.__)("Status: %s","newspack-plugin"),m),checkbox:_&&!g?"checked":"unchecked",notificationLevel:"info",notification:_&&c.fields&&c.warning&&Object.keys(c.fields).filter(e=>""===n[e]).length?c.warning:null,children:c.is_unavailable?null:(0,u.jsxs)(u.Fragment,{children:[c.description&&(0,u.jsxs)("p",{children:[c.description,c.help_url&&(0,u.jsxs)(u.Fragment,{children:[" ",(0,u.jsx)(i.ExternalLink,{href:c.help_url,children:(0,s.__)("Learn more","newspack-plugin")})]})]}),(c.fields||c.action_text)&&(0,u.jsx)(l.xA,{columns:2,gutter:16,children:(0,u.jsxs)("div",{className:"button-group",children:[c.fields&&(0,u.jsxs)(u.Fragment,{children:[h.map(e=>{if(c.fields&&c.fields[e])return(0,u.jsx)(l.xt,{label:c.fields[e].label,help:c.fields[e].description,...t(e,"text")},e)}),(0,u.jsx)(l.$n,{variant:"primary",onClick:()=>{const e={};h.forEach(t=>{n[t]&&(e[t]=n[t])}),r(e)},disabled:a,children:a?(0,s.__)("Saving…","newspack-plugin"):(0,s.sprintf)(
// translators: %s: save or update settings.
// translators: %s: save or update settings.
(0,s.__)("%s settings","newspack-plugin"),_?(0,s.__)("Update","newspack-plugin"):(0,s.__)("Save","newspack-plugin"))})]}),d&&c.action_text&&(0,u.jsxs)(u.Fragment,{children:[(!c.hasOwnProperty("action_enabled")||c.action_enabled)&&(0,u.jsx)(l.$n,{variant:"primary",onClick:()=>{c.instructions&&window.localStorage.setItem(p.J,JSON.stringify({message:(0,s.sprintf)(
// translators: %1$s: specific instructions for satisfying the prerequisite. %2$s: opening <a> tag for the link to the Audience Configuration page. %3$s: closing </a> tag.
// translators: %1$s: specific instructions for satisfying the prerequisite. %2$s: opening <a> tag for the link to the Audience Configuration page. %3$s: closing </a> tag.
(0,s.__)("%1$s%2$sReturn to the Audience Configuration page to complete the settings and activate%3$s.","newspack-plugin"),c.instructions+" ",window.newspackAudience?.reader_activation_url?`<a href="${window.newspackAudience.reader_activation_url}">`:"",window.newspackAudience?.reader_activation_url?"</a>":""),url:d})),window.location.href=d},children:(_?(0,s.__)("Update ","newspack-plugin"):c.fields?(0,s.__)("Save ","newspack-plugin"):(0,s.__)("Configure ","newspack-plugin"))+c.action_text}),c.hasOwnProperty("action_enabled")&&!c.action_enabled&&(0,u.jsx)(l.$n,{variant:"secondary",disabled:!0,children:c.disabled_text||c.action_text})]}),c.skippable&&!c.active&&!g&&(0,u.jsx)(l.$n,{variant:"secondary",isDestructive:!0,onClick:()=>{o({prerequisite:e,skip:!0})},children:(0,s.__)("Skip","newspack-plugin")})]})})]})})}function g({title:e,value:n,onChange:t}){const[i,c]=(0,a.useState)(!1),[o,p]=(0,a.useState)([]),[d,g]=(0,a.useState)(!1);(0,a.useEffect)(()=>{g(!1),c(!0),r()({path:"/newspack-newsletters/v1/lists"}).then(e=>{const n=_?e.filter(e=>"remote"===e.type&&!["group-","tag-"].some(n=>e.id.includes(n))):e;p(n)}).catch(g).finally(()=>c(!1))},[]);const _="Mailchimp"===e,h=_?(0,s.__)("Audience ID","newspack-plugin"):(0,s.__)("Master List","newspack-plugin"),m=_?(0,s.__)("Choose an audience to receive reader activity data.","newspack-plugin"):(0,s.__)("Choose a master list to which all registered readers will be added.","newspack-plugin"),w=e=>n=>t&&t(e,n);return(0,u.jsxs)(u.Fragment,{children:[d&&(0,u.jsx)(l.$T,{noticeText:d?.message||(0,s.__)("Something went wrong.","newspack-plugin"),isError:!0}),(0,u.jsx)(l.X3,{title:(0,s.sprintf)(/** Translators: %s is the email service provider title */ /** Translators: %s is the email service provider title */(0,s.__)("%s settings","newspack-plugin"),e),description:(0,s.sprintf)(/** Translators: %s is the email service provider title */ /** Translators: %s is the email service provider title */(0,s.__)("Settings for the %s integration.","newspack-plugin"),e)}),""===n.masterList&&(0,u.jsx)(l.$T,{noticeText:(0,s.sprintf)(
// Translators: 1 is the term used to refer to lists for a given email service provider and 2 is the email service provider title
// Translators: 1 is the term used to refer to lists for a given email service provider and 2 is the email service provider title
(0,s.__)("No %1$s selected. You will not be able to send reader activity data to %2$s.","newspack-plugin"),h,e),isError:!0}),(0,u.jsx)(l.Yq,{label:h,help:m,disabled:i,value:_?n.audienceId:n.masterList,onChange:w(_?"audienceId":"masterList"),options:[{value:"",label:(0,s.__)("None","newspack-plugin")},...o.map(e=>({label:e.name,value:e.id}))]}),"readerDefaultStatus"in n&&n.audienceId&&(0,u.jsx)(l.Yq,{label:(0,s.__)("Default reader status","newspack-plugin"),help:(0,s.sprintf)(
// Translators: %s is the email service provider title.
// Translators: %s is the email service provider title.
(0,s.__)("Choose which %s status readers should have by default if they are not subscribed to any newsletters","newspack-plugin"),e),disabled:i,value:n.readerDefaultStatus,onChange:w("readerDefaultStatus"),options:[{value:"transactional",label:(0,s.__)("Transactional/Non-Subscribed","newspack-plugin")},{value:"subscribed",label:(0,s.__)("Subscribed","newspack-plugin")}]})]})}const _=({availableFields:e,getSharedProps:n,selectedFields:t,updateConfig:a})=>(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(l.X3,{title:(0,s.__)("Metadata field settings","newspack-plugin"),description:(0,s.__)("Select which data to sync for each contact.","newspack-plugin")}),(0,u.jsx)(l.xt,{label:(0,s.__)("Metadata field prefix","newspack-plugin"),help:(0,s.__)("A string to prefix metadata fields attached to each contact synced to the ESP. Required to ensure that metadata field names are unique. Default: NP_","newspack-plugin"),...n("metadata_prefix","text")}),(0,u.jsx)(l.xA,{columns:3,rowGap:16,children:e.map((e,n)=>(0,u.jsx)(i.CheckboxControl,{className:"newspack-checkbox-control",label:e.replace(": ",""),checked:t.includes(e),onChange:n=>{const s=[...t];a("metadata_fields",n?[...s,e]:s.filter(n=>n!==e))}},n))})]});var h=t(5573),m=(0,u.jsx)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(h.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})}),w=t(7677),k=t(3756),x=t(2485),b=t(7093),f=t(6732);function v({lists:e,selected:n=[],onChange:t=()=>{}}){if(!Array.isArray(e)&&e.errors)return(0,u.jsx)(i.Notice,{status:"error",isDismissible:!1,children:Object.values(e.errors).join(", ")});const a=()=>e.filter(e=>e.active&&!n.find(({id:n})=>n===e.id));return(0,u.jsxs)("div",{className:"newspack__newsletter-list-control",children:[(0,u.jsx)("div",{className:"newspack__newsletter-list-control__selected",children:n.map(a=>{const c=(r=a.id,e.find(e=>e.id===r));var r;return c?(0,u.jsx)(b.A,{title:c.name,description:()=>(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(i.CheckboxControl,{label:(0,s.__)("Checked by default","newspack-plugin"),checked:a.checked,onChange:()=>{const e=n.findIndex(({id:e})=>e===a.id),s=[...n];s[e].checked=!s[e].checked,t(s)}})}),isSmall:!0,hasWhiteHeader:!0,actionText:(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(f.A,{onClick:()=>t(n.filter(({id:e})=>e!==a.id)),label:(0,s.__)("Remove","newspack-plugin"),icon:m,isDestructive:!0})}),children:n.length>1&&(0,u.jsxs)("span",{className:"newspack__newsletter-list-control__sort-handle",children:[(0,u.jsx)("button",{onClick:()=>{const e=n.findIndex(({id:e})=>e===a.id);if(0===e)return;const s=[...n];s.splice(e,1),s.splice(e-1,0,a),t(s)},className:0===n.findIndex(({id:e})=>e===a.id)?"disabled":"",children:(0,u.jsx)(w.A,{icon:k.A})}),(0,u.jsx)("button",{onClick:()=>{const e=n.findIndex(({id:e})=>e===a.id),s=[...n];s.splice(e,1),s.splice(e+1,0,a),t(s)},className:n.findIndex(({id:e})=>e===a.id)===n.length-1?"disabled":"",children:(0,u.jsx)(w.A,{icon:x.A})})]})},`selected-${a.id}`):null})}),a().length>0&&(0,u.jsxs)("p",{className:"newspack__newsletter-list-control__lists",children:[n.length>0?(0,u.jsx)("strong",{children:(0,s.__)("Add more lists:","newspack-plugin")}):(0,u.jsx)("strong",{children:(0,s.__)("Select lists:","newspack-plugin")})," ",a().map(e=>(0,u.jsx)(f.A,{variant:"secondary",onClick:()=>t([...n,{id:e.id,checked:!0}]),children:e.name},e.id))]})]})}var j=t(5373),C=t(7143),y=t(3832),S=t(5186),A=t(3076);const P=()=>{const{salesforce_redirect_url:e}=window?.newspackAudience||{},n=(0,S.l)("newspack-audience/salesforce"),[t,c]=(0,a.useState)(n.refresh_token),[r,o]=(0,a.useState)(null),[p,d]=(0,a.useState)(!1),{saveWizardSettings:g,wizardApiFetch:_}=(0,C.useDispatch)(A.S);return(0,a.useEffect)(()=>{const n=(0,j.parse)(window.location.search).code;n&&(window.history.replaceState({},"",e),(async n=>{try{const t=await _({path:"/newspack/salesforce/v1/tokens",method:"POST",data:{code:n,redirect_uri:e}}),{access_token:s,client_id:a,client_secret:i,instance_url:r,refresh_token:l}=t;s&&l&&g({slug:"newspack-audience/salesforce",payloadPath:["salesforce_settings"],updatePayload:{path:["salesforce_settings"],value:{access_token:s,client_id:a,client_secret:i,instance_url:r,refresh_token:l}}}),c(!0)}catch(e){o((0,s.__)("We couldn’t establish a connection to Salesforce. Please verify your Consumer Key and Secret and try connecting again.","newspack-plugin"))}})(n))},[]),(0,a.useEffect)(()=>{t?(async()=>{const e=await _({path:"/newspack/salesforce/v1/connection-status",method:"POST",isQuietFetch:!0});e.error&&o(e.error)})():o(null)},[t]),(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(l.x5,{afterUpdate:n=>{let t,s;if((n?.salesforce||[]).forEach(e=>{"newspack_salesforce_client_id"===e.key?t=e.value:"newspack_salesforce_client_secret"===e.key&&(s=e.value)}),t&&s&&e){const n=(0,y.addQueryArgs)("https://login.salesforce.com/services/oauth2/authorize",{response_type:"code",client_id:encodeURIComponent(t),client_secret:encodeURIComponent(s),redirect_uri:encodeURI(e)});window.location.assign(n)}else c(!1)},pluginSlug:"newspack/salesforce",title:(0,s.__)("Salesforce Settings","newspack-plugin"),description:()=>(0,u.jsxs)(u.Fragment,{children:[r&&(0,u.jsx)(l.$T,{noticeText:r,isWarning:!0}),t&&!r&&(0,u.jsx)(l.$T,{noticeText:(0,s.__)("Your site is connected to Salesforce.","newspack-plugin"),isSuccess:!0}),(0,s.__)("Establish a connection to sync WooCommerce order data to Salesforce. To connect with Salesforce, create or choose a Connected App for this site in your Salesforce dashboard. Make sure to paste the full URL for this page (","newspack-plugin"),(0,u.jsxs)(i.ClipboardButton,{text:e,onCopy:()=>d(!0),onFinishCopy:()=>d(!1),className:"newspack-button is-link",children:[p?(0,s.__)("copied to clipboard!","newspack-plugin"):(0,s.__)("copy to clipboard","newspack-plugin")," "]}),(0,s.__)(") into the “Callback URL” field in the Connected App’s settings. ","newspack-plugin"),(0,u.jsx)(i.ExternalLink,{href:"https://help.salesforce.com/articleView?id=connected_app_create.htm",children:(0,s.__)("Learn how to create a Connected App","newspack-plugin")})]})})})},T=(0,l.c_)(({config:e,fetchConfig:n,updateConfig:t,getSharedProps:c,saveConfig:h,skipPrerequisite:m,prerequisites:w,espSyncErrors:k,error:x,inFlight:b})=>{const[f,j]=(0,a.useState)(!1),[C,y]=(0,a.useState)([]),[S,A]=(0,a.useState)("");return(0,a.useEffect)(()=>{window.scrollTo(0,0),window.localStorage.removeItem(p.J)},[]),(0,a.useEffect)(()=>{r()({path:"/newspack/v1/wizard/newspack-newsletters/settings"}).then(e=>{var n;A(null!==(n=e?.settings?.newspack_newsletters_service_provider?.value)&&void 0!==n?n:"")})},[]),(0,a.useEffect)(()=>{const e=!C.length&&w&&Object.keys(w).every(e=>w[e]?.active||w[e]?.is_skipped);j(e),w&&y(Object.keys(w).reduce((e,n)=>{const t=w[n];if(t.plugins)for(const n in t.plugins)t.plugins[n]||e.push(n);return e},[]))},[w]),(0,u.jsxs)(o.A,{title:(0,s.__)("Audience Management","newspack-plugin"),description:(0,u.jsxs)(u.Fragment,{children:[(0,s.__)("Newspack's Audience Management system is a set of features that aim to increase reader loyalty, promote engagement, and drive revenue. ","newspack-plugin"),(0,u.jsx)(i.ExternalLink,{href:"https://help.newspack.com/engagement/audience-management-system",children:(0,s.__)("Learn more","newspack-plugin")})]}),children:[x&&(0,u.jsx)(l.$T,{noticeText:x?.message||(0,s.__)("Something went wrong.","newspack-plugin"),isError:!0}),0<C.length&&(0,u.jsx)(l.$T,{noticeText:(0,s.__)("The following plugins are required.","newspack-plugin"),isWarning:!0}),0===C.length&&w&&!f&&(0,u.jsx)(l.$T,{noticeText:(0,s.__)("Complete these settings to enable Audience Management.","newspack-plugin"),isWarning:!0}),w&&f&&e.enabled&&(0,u.jsx)(l.$T,{noticeText:(0,s.__)("Audience Management is enabled.","newspack-plugin"),isSuccess:!0}),!w&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(l.E$,{isLeft:!0}),(0,s.__)("Fetching status…","newspack-plugin")]}),0<C.length&&w&&(0,u.jsx)(l.I2,{plugins:C,withoutFooterButton:!0,onStatus:({complete:e})=>e&&n()}),!C.length&&w&&Object.keys(w).map(t=>(0,u.jsx)(d,{slug:t,config:e,getSharedProps:c,inFlight:b,prerequisite:w[t],fetchConfig:n,saveConfig:h,skipPrerequisite:m},t)),e.enabled&&(0,u.jsxs)(l.Zp,{noBorder:!0,children:[(0,u.jsx)("hr",{}),(0,u.jsx)(l.Lz,{title:(0,s.__)("Present newsletter signup after checkout and registration","newspack-plugin"),description:(0,s.__)("Ask readers to sign up for newsletters after creating an account or completing a purchase.","newspack-plugin"),hasGreyHeader:e.use_custom_lists,isMedium:!0,toggleChecked:e.use_custom_lists,toggleOnChange:e=>t("use_custom_lists",e),children:e.use_custom_lists&&(0,u.jsxs)(l.xA,{columns:4,children:[(0,u.jsx)(v,{lists:newspackAudience.available_newsletter_lists,selected:e.newsletter_lists,onChange:e=>t("newsletter_lists",e)}),(0,u.jsx)(i.RangeControl,{min:1,max:10,initialPosition:2,label:(0,s.__)("Initial list size","newspack-plugin"),help:(0,s.__)('Number of newsletters initially visible during signup. Additional newsletters will be hidden behind a "See all" button.',"newspack-plugin"),value:e.newsletter_list_initial_size||"",onChange:e=>t("newsletter_list_initial_size",parseInt(e))})]})}),(0,u.jsx)(l.Lz,{title:(0,s.__)("Use My Account login screen for OAuth clients","newspack-plugin"),description:(0,s.__)("Allow OAuth clients to redirect to the My Account login screen instead of the default WordPress login screen. Might require additional configuration.","newspack-plugin"),isMedium:!0,toggleChecked:e.oauth_redirect_to_ras,toggleOnChange:e=>t("oauth_redirect_to_ras",e)}),(0,u.jsx)("hr",{}),(0,u.jsx)(l.X3,{title:(0,s.__)("Email Service Provider (ESP) Advanced Settings","newspack-plugin"),description:(0,s.__)("Settings for Newspack Newsletters integration.","newspack-plugin")}),(0,u.jsx)(l.xt,{label:(0,s.__)("Newsletter subscription text on registration","newspack-plugin"),help:(0,s.__)("The text to display while subscribing to newsletters from the sign-in modal.","newspack-plugin"),...c("newsletters_label","text")}),(0,u.jsx)(l.Lz,{description:(0,s.__)("Configure options for syncing reader data to the connected ESP.","newspack-plugin"),hasGreyHeader:e.sync_esp,isMedium:!0,title:(0,s.__)("Sync contacts to ESP","newspack-plugin"),toggleChecked:e.sync_esp,toggleOnChange:e=>t("sync_esp",e),children:e.sync_esp&&(0,u.jsxs)(u.Fragment,{children:[0<Object.keys(k).length&&(0,u.jsx)(l.$T,{noticeText:Object.values(k).join(" "),isError:!0}),"mailchimp"===S&&(0,u.jsx)(g,{title:"Mailchimp",value:{audienceId:e.mailchimp_audience_id,readerDefaultStatus:e.mailchimp_reader_default_status},onChange:(e,n)=>{"audienceId"===e&&t("mailchimp_audience_id",n),"readerDefaultStatus"===e&&t("mailchimp_reader_default_status",n)}}),"active_campaign"===S&&(0,u.jsx)(g,{title:"ActiveCampaign",value:{masterList:e.active_campaign_master_list},onChange:(e,n)=>{"masterList"===e&&t("active_campaign_master_list",n)}}),"constant_contact"===S&&(0,u.jsx)(g,{title:"Constant Contact",value:{masterList:e.constant_contact_list_id},onChange:(e,n)=>{"masterList"===e&&t("constant_contact_list_id",n)}}),(0,u.jsx)(l.X3,{title:(0,s.__)("Sync user account deletion","newspack-plugin"),description:(0,s.__)("If enabled, the contact will be deleted from the ESP when a user account is deleted. If disabled, the contact will be unsubscribed from all lists, but not deleted.","newspack-plugin")}),(0,u.jsx)(i.CheckboxControl,{label:(0,s.__)("Sync user account deletion","newspack-plugin"),checked:e.sync_esp_delete,onChange:e=>t("sync_esp_delete",e)}),(0,u.jsx)(_,{availableFields:newspackAudience.esp_metadata_fields||[],selectedFields:e.metadata_fields,updateConfig:t,getSharedProps:c})]})}),(0,u.jsx)("div",{className:"newspack-buttons-card",children:(0,u.jsx)(l.$n,{isPrimary:!0,onClick:()=>{if(e.sync_esp){if("mailchimp"===S&&""===e.mailchimp_audience_id)return void alert((0,s.__)("Please select a Mailchimp Audience ID.","newspack-plugin"));if("active_campaign"===S&&""===e.active_campaign_master_list)return void alert((0,s.__)("Please select an ActiveCampaign Master List.","newspack-plugin"));if("constant_contact"===S&&""===e.constant_contact_list_id)return void alert((0,s.__)("Please select a Constant Contact Master List.","newspack-plugin"))}h({newsletters_label:e.newsletters_label,mailchimp_audience_id:e.mailchimp_audience_id,mailchimp_reader_default_status:e.mailchimp_reader_default_status,active_campaign_master_list:e.active_campaign_master_list,constant_contact_list_id:e.constant_contact_list_id,use_custom_lists:e.use_custom_lists,newsletter_lists:e.newsletter_lists,newsletter_list_initial_size:e.newsletter_list_initial_size,oauth_redirect_to_ras:e.oauth_redirect_to_ras,sync_esp:e.sync_esp,sync_esp_delete:e.sync_esp_delete,metadata_fields:e.metadata_fields,metadata_prefix:e.metadata_prefix,woocommerce_registration_required:e.woocommerce_registration_required,woocommerce_checkout_privacy_policy_text:e.woocommerce_checkout_privacy_policy_text,woocommerce_enable_subscription_confirmation:e.woocommerce_enable_subscription_confirmation,woocommerce_subscription_confirmation_text:e.woocommerce_subscription_confirmation_text,woocommerce_enable_terms_confirmation:e.woocommerce_enable_terms_confirmation,woocommerce_terms_confirmation_text:e.woocommerce_terms_confirmation_text,woocommerce_terms_confirmation_url:e.woocommerce_terms_confirmation_url,woocommerce_post_checkout_success_text:e.woocommerce_post_checkout_success_text,woocommerce_post_checkout_registration_success_text:e.woocommerce_post_checkout_registration_success_text})},disabled:b,children:(0,s.__)("Save Settings","newspack-plugin")})})]}),newspackAudience.can_use_salesforce&&(0,u.jsxs)(l.Zp,{noBorder:!0,children:[(0,u.jsx)("hr",{}),(0,u.jsx)(P,{})]})]})});var L=(0,u.jsx)(h.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,u.jsx)(h.Path,{d:"M3.99961 13C4.67043 13.3354 4.6703 13.3357 4.67017 13.3359L4.67298 13.3305C4.67621 13.3242 4.68184 13.3135 4.68988 13.2985C4.70595 13.2686 4.7316 13.2218 4.76695 13.1608C4.8377 13.0385 4.94692 12.8592 5.09541 12.6419C5.39312 12.2062 5.84436 11.624 6.45435 11.0431C7.67308 9.88241 9.49719 8.75 11.9996 8.75C14.502 8.75 16.3261 9.88241 17.5449 11.0431C18.1549 11.624 18.6061 12.2062 18.9038 12.6419C19.0523 12.8592 19.1615 13.0385 19.2323 13.1608C19.2676 13.2218 19.2933 13.2686 19.3093 13.2985C19.3174 13.3135 19.323 13.3242 19.3262 13.3305L19.3291 13.3359C19.3289 13.3357 19.3288 13.3354 19.9996 13C20.6704 12.6646 20.6703 12.6643 20.6701 12.664L20.6697 12.6632L20.6688 12.6614L20.6662 12.6563L20.6583 12.6408C20.6517 12.6282 20.6427 12.6108 20.631 12.5892C20.6078 12.5459 20.5744 12.4852 20.5306 12.4096C20.4432 12.2584 20.3141 12.0471 20.1423 11.7956C19.7994 11.2938 19.2819 10.626 18.5794 9.9569C17.1731 8.61759 14.9972 7.25 11.9996 7.25C9.00203 7.25 6.82614 8.61759 5.41987 9.9569C4.71736 10.626 4.19984 11.2938 3.85694 11.7956C3.68511 12.0471 3.55605 12.2584 3.4686 12.4096C3.42484 12.4852 3.39142 12.5459 3.36818 12.5892C3.35656 12.6108 3.34748 12.6282 3.34092 12.6408L3.33297 12.6563L3.33041 12.6614L3.32948 12.6632L3.32911 12.664C3.32894 12.6643 3.32879 12.6646 3.99961 13ZM11.9996 16C13.9326 16 15.4996 14.433 15.4996 12.5C15.4996 10.567 13.9326 9 11.9996 9C10.0666 9 8.49961 10.567 8.49961 12.5C8.49961 14.433 10.0666 16 11.9996 16Z"})});function E({inFlight:e,prompt:n,setInFlight:t,setPrompts:c}){const[o,p]=(0,a.useState)({}),[d,g]=(0,a.useState)(!1),[_,h]=(0,a.useState)(!1),[m,w]=(0,a.useState)(!1),[k,x]=(0,a.useState)(null),[b,f]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(Array.isArray(n?.user_input_fields)){const e={...o};n.user_input_fields.forEach(n=>{e[n.name]=n.value||n.default}),p(e)}n.featured_image_id&&(t(!0),r()({path:`/wp/v2/media/${n.featured_image_id}`}).then(e=>{(e?.source_url||e?.url)&&x({url:e.source_url||e.url})}).catch(g).finally(()=>{t(!1)}))},[n]),(0,a.useEffect)(()=>{setTimeout(()=>w(!1),5e3)},[m]);const v=l.JL.usePrompt(_,(0,s.__)("You have unsaved changes. Discard changes?","newspack-plugin")),C=n.help_info||null;return(0,u.jsx)(l.Lz,{isMedium:!0,expandable:!0,collapse:n.ready&&!b,title:n.title,description:(0,s.sprintf)(
// translators: %s: status of the prompt.
// translators: %s: status of the prompt.
(0,s.__)("Status: %s","newspack-plugin"),_?(0,s.__)("Unsaved changes","newspack-plugin"):n.ready?(0,s.__)("Ready","newspack-plugin"):(0,s.__)("Pending","newspack-plugin")),checkbox:n.ready&&!_?"checked":"unchecked",children:(0,u.jsxs)(l.xA,{columns:2,gutter:64,className:"newspack-ras-campaign__grid",children:[(0,u.jsxs)("div",{className:"newspack-ras-campaign__fields",children:[n.user_input_fields.map(n=>(0,u.jsxs)(a.Fragment,{children:["array"===n.type&&Array.isArray(n.options)&&(0,u.jsx)(i.BaseControl,{id:`newspack-engagement-wizard__${n.name}`,label:n.label,children:n.options.map(t=>(0,u.jsx)(i.BaseControl,{id:`newspack-engagement-wizard__${t.id}`,className:"newspack-checkbox-control",help:t.description,children:(0,u.jsx)(i.CheckboxControl,{disabled:e,label:t.label,value:t.id,checked:o[n.name]?.indexOf(t.id)>-1,onChange:e=>{const s={...o};!e&&s[n.name].indexOf(t.id)>-1&&(s[n.name].value=s[n.name].splice(s[n.name].indexOf(t.id),1)),e&&-1===s[n.name].indexOf(t.id)&&s[n.name].push(t.id),p(s),h(!0)}})},t.id))}),"string"===n.type&&n.max_length&&Array.isArray(o)&&150<n.max_length&&(0,u.jsx)(i.TextareaControl,{className:"newspack-textarea-control",label:n.label,disabled:e,help:`${o[n.name]?.length||0} / ${n.max_length}`,onChange:e=>{if(e.length>n.max_length)return;const t={...o};t[n.name]=e,p(t),h(!0)},placeholder:"string"==typeof n.default?n.default:"",rows:10,value:"string"==typeof o[n.name]?o[n.name]:""}),"string"===n.type&&n.max_length&&150>=n.max_length&&(0,u.jsx)(l.xt,{label:n.label,disabled:e,help:`${o[n.name]?.length||0} / ${n.max_length}`,onChange:e=>{if(e.length>n.max_length)return;const t={...o};t[n.name]=e,p(t),h(!0)},placeholder:n.default,value:o[n.name]||""}),"int"===n.type&&"featured_image_id"===n.name&&(0,u.jsx)(i.BaseControl,{id:`newspack-engagement-wizard__${n.name}`,label:n.label,children:(0,u.jsx)(l.BR,{buttonLabel:(0,s.__)("Select file","newspack-plugin"),disabled:e,image:k,onChange:e=>{const t={...o};t[n.name]=e?.id||0,t[n.name],o[n.name],p(t),h(!0),x(e?.url?e:null)}})})]},n.name)),d&&(0,u.jsx)(l.$T,{noticeText:d?.message||(0,s.__)("Something went wrong.","newspack-plugin"),isError:!0}),m&&(0,u.jsx)(l.$T,{noticeText:m,isSuccess:!0}),(0,u.jsxs)("div",{className:"newspack-buttons-card",children:[(0,u.jsx)(l.$n,{isPrimary:!0,onClick:()=>{var e,a;f(!1),e=n.slug,a=o,new Promise((n,i)=>{v&&v(),g(!1),w(!1),t(!0),r()({path:"/newspack-popups/v1/audience-management/campaign",method:"post",data:{slug:e,data:a}}).then(e=>{c(e),w((0,s.__)("Prompt saved.","newspack-plugin")),h(!1),n()}).catch(e=>{g(e),i(e)}).finally(()=>{t(!1)})})},disabled:e,children:e?(0,s.__)("Saving…","newspack-plugin"):(0,s.sprintf)(
// translators: %s: save or update settings.
// translators: %s: save or update settings.
(0,s.__)("%s prompt settings","newspack-plugin"),n.ready?(0,s.__)("Update","newspack-plugin"):(0,s.__)("Save","newspack-plugin"))}),(0,u.jsx)(l.LQ,{url:(({options:e,slug:n})=>{const{placement:t,trigger_type:s}=e,a=window.newspackAudience.preview_query_keys,i={preset:n,values:o};Object.keys(e).forEach(n=>{a.hasOwnProperty(n)&&(i[a[n]]=e[n])});let c="/";return"archives"===t&&window.newspackAudience?.preview_archive?c=window.newspackAudience.preview_archive:("inline"===t||"scroll"===s)&&window&&window.newspackAudience?.preview_post&&(c=window.newspackAudience?.preview_post),`${c}?${(0,j.stringify)({...i})}`})(n),renderButton:({showPreview:n})=>(0,u.jsx)(l.$n,{disabled:e,icon:L,isSecondary:!0,onClick:async()=>n(),children:(0,s.__)("Preview prompt","newspack-plugin")})})]})]}),C&&(0,u.jsxs)("div",{className:"newspack-ras-campaign__help",children:[C.screenshot&&(0,u.jsx)("img",{src:C.screenshot,alt:n.title}),C.description&&(0,u.jsxs)("p",{children:[(0,u.jsx)("span",{dangerouslySetInnerHTML:{__html:C.description}})," ",C.url&&(0,u.jsx)(i.ExternalLink,{href:"https://none.com",children:(0,s.__)("Learn more","newspack-plugin")})]}),C.recommendations&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("h4",{className:"newspack-ras-campaign__recommendation-heading",children:(0,s.__)("We recommend","newspack-plugin")}),(0,u.jsx)("ul",{children:C.recommendations.map((e,n)=>(0,u.jsx)("li",{children:(0,u.jsx)("span",{dangerouslySetInnerHTML:{__html:e}})},n))})]})]})]})})}var N=t(2247);const{useHistory:$}=N.A,F=(0,l.c_)(({error:e,setError:n,skipPrerequisite:t})=>{const{reader_activation_url:i}=newspackAudience,[c,p]=(0,a.useState)(!1),[d,g]=(0,a.useState)(null),[_,h]=(0,a.useState)(!1),m=$();return(0,a.useEffect)(()=>{window.scrollTo(0,0),n(!1),p(!0),r()({path:"/newspack-popups/v1/audience-management/campaign"}).then(e=>{g(e)}).catch(n).finally(()=>p(!1))},[]),(0,a.useEffect)(()=>{Array.isArray(d)&&0<d.length&&h(d.every(e=>e.ready))},[d]),(0,u.jsxs)(o.A,{title:(0,s.__)("Set Up Audience Management Campaign","newspack-plugin"),description:(0,s.__)("Preview and customize the prompts, or use our suggested defaults.","newspack-plugin"),children:[e&&(0,u.jsx)(l.$T,{noticeText:e?.message||(0,s.__)("Something went wrong.","newspack-plugin"),isError:!0}),!d&&!e&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(l.E$,{isLeft:!0}),(0,s.__)("Retrieving prompts…","newspack-plugin")]}),d&&d.map(e=>(0,u.jsx)(E,{prompt:e,inFlight:c,setInFlight:p,setPrompts:g},e.slug)),(0,u.jsxs)("div",{className:"newspack-buttons-card",children:[(0,u.jsx)(l.$n,{variant:"secondary",isDestructive:!0,disabled:c,onClick:()=>{t({prerequisite:"ras_campaign",skip:!0},()=>m.push("/complete"))},children:(0,s.__)("Skip","newspack-plugin")}),(0,u.jsx)(l.$n,{isPrimary:!0,disabled:c||!_,href:`${i}complete`,children:(0,s.__)("Continue","newspack-plugin")}),(0,u.jsx)(l.$n,{isSecondary:!0,disabled:c,href:i,children:(0,s.__)("Back","newspack-plugin")})]})]})}),M=[{text:(0,s.__)("Your <strong>current segments and prompts</strong> will be deactivated and archived.","newspack-plugin"),isSkipped:'<span class="is-skipped">[skipped]</span>'},{text:(0,s.__)("<strong>Reader registration</strong> will be activated to enable better targeting for driving engagement and conversations.","newspack-plugin")},{text:(0,s.__)("The <strong>Audience Management campaign</strong> will be activated with default segments and settings.","newspack-plugin"),isSkipped:'<span class="is-skipped">[skipped]</span>'}],z={campaignsSegments:(0,s.__)("Setting up new segments…","newspack-plugin"),readerRegistration:(0,s.__)("Activating reader registration…","newspack-plugin"),campaignsPrompts:(0,s.__)("Activating Audience Management Campaign…","newspack-plugin")},O=(0,l.c_)(({fetchConfig:e})=>{const[n,t]=(0,a.useState)(!1),[c,p]=(0,a.useState)(!1),[d,g]=(0,a.useState)(null),[_,h]=(0,a.useState)(!1),[m,w]=(0,a.useState)(!1),k=(0,a.useRef)(),[x,b]=(0,a.useState)(Object.values(z)),{reader_activation_url:f,is_skipped_campaign_setup:v=""}=newspackAudience,j="1"===v;(0,a.useEffect)(()=>{j&&b([z.readerRegistration])},[j]);for(const e in M){var C;if(!M[e].text)continue;const n=j?` ${null!==(C=M[e].isSkipped)&&void 0!==C?C:""}`:"";var y;M[e]=`${M[e].text}${n}`,j&&(M[e]+=` ${null!==(y=M[e].isSkipped)&&void 0!==y?y:""}`)}return(0,a.useEffect)(()=>{k.current&&clearTimeout(k.current),c&&t(!1),!c&&n&&0<=d&&d<x.length&&(h(x[d]),k.current=setTimeout(()=>{g(e=>e+1)},1e3+1e3*Math.random())),d>=x.length&&m&&(g(x.length+1),h((0,s.__)("Done!","newspack-plugin")),setTimeout(()=>{e().finally(()=>{t(!1),window.location.replace(f)})},3e3))},[m,d]),(0,u.jsx)("div",{className:"newspack-ras-campaign__completed",children:(0,u.jsxs)(o.A,{title:(0,s.__)("Enable Audience Management","newspack-plugin"),description:(0,u.jsxs)(u.Fragment,{children:[(0,s.__)("An easy way to let your readers register for your site, sign up for newsletters, or become donors and paid members. ","newspack-plugin"),(0,u.jsx)(i.ExternalLink,{href:"https://help.newspack.com",children:(0,s.__)("Learn more","newspack-plugin")})]}),children:[n&&(0,u.jsx)(l.Zp,{className:"newspack-ras-campaign__completed-card",children:(0,u.jsx)(l.z2,{completed:d,displayFraction:!1,total:x.length+1,label:_})}),!n&&(0,u.jsxs)(l.Zp,{className:"newspack-ras-campaign__completed-card",children:[(0,u.jsx)("h2",{children:(0,s.__)("You're all set to enable Audience Management!","newspack-plugin")}),(0,u.jsx)("p",{children:(0,s.__)("This is what will happen next:","newspack-plugin")}),(0,u.jsx)(l.Zp,{noBorder:!0,className:"justify-center",children:(0,u.jsx)(l._y,{stepsListItems:M,narrowList:!0})}),c&&(0,u.jsx)(l.$T,{noticeText:c?.message||(0,s.__)("Something went wrong.","newspack-plugin"),isError:!0}),(0,u.jsx)(l.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-center",children:(0,u.jsx)(l.$n,{isPrimary:!0,onClick:()=>(async()=>{p(!1),t(!0),g(0);try{w(await r()({path:"/newspack/v1/wizard/newspack-audience/audience-management/activate",method:"post",data:{skip_activation:j}}))}catch(e){p(e)}})(),children:(0,s.__)("Enable Audience Management","newspack-plugin")})})]}),(0,u.jsx)("div",{className:"newspack-buttons-card",children:(0,u.jsx)(l.$n,{isSecondary:!0,disabled:n,href:`${f}campaign`,children:(0,s.__)("Back","newspack-plugin")})})]})})});var D=t(4081),I=t(1147);const q=(0,l.c_)(({wizardApiFetch:e})=>{const[n,t]=(0,a.useState)(!1),[c,r]=(0,a.useState)({});(0,a.useEffect)(()=>{p()},[]);const p=()=>{t(!1),e({path:"/newspack/v1/wizard/newspack-audience/content-gating"}).then(e=>{r(e)}).catch(t)},d=n=>{t(!1),e({path:"/newspack/v1/wizard/newspack-audience/content-gating",method:"POST",quiet:!0,data:n}).then(e=>{r(e)}).catch(t)};return(0,u.jsxs)(o.A,{title:(0,s.__)("Content Gating","newspack-plugin"),description:(0,u.jsxs)(u.Fragment,{children:[(0,s.__)("WooCommerce Memberships integration to improve the reader experience with content gating. ","newspack-plugin"),(0,u.jsx)(i.ExternalLink,{href:"https://help.newspack.com/engagement/audience-management-system/content-gating/",children:(0,s.__)("Learn more","newspack-plugin")})]}),children:[n&&(0,u.jsx)(l.$T,{noticeText:n?.message||(0,s.__)("Something went wrong.","newspack-plugin"),isError:!0}),(0,u.jsx)(l.Lz,{title:(0,s.__)("Content Gate","newspack-plugin"),titleLink:c.edit_gate_url,href:c.edit_gate_url,description:(()=>{let e=(0,s.__)("Configure the gate rendered on content with restricted access.","newspack-plugin");return"publish"===c?.gate_status?e+=" "+(0,s.__)("The gate is currently published.","newspack-plugin"):"draft"!==c?.gate_status&&"trash"!==c?.gate_status||(e+=" "+(0,s.__)("The gate is currently a draft.","newspack-plugin")),e})(),actionText:(0,s.__)("Configure","newspack-plugin")}),(0,u.jsx)(I.A,{config:c,setConfig:r,updateConfig:d}),(0,u.jsx)(D.A,{config:c,setConfig:r,updateConfig:d}),c?.plans&&1<c.plans.length&&(0,u.jsx)(l.Lz,{title:(0,s.__)("Require membership in all plans","newspack-plugin"),description:(0,s.__)("When enabled, readers must belong to all membership plans that apply to a restricted content item before they are granted access. Otherwise, they will be able to unlock access to that item with membership in any single plan that applies to it.","newspack-plugin"),toggleOnChange:e=>d({require_all_plans:e}),toggleChecked:c.require_all_plans,togglePosition:"trailing"}),c.has_memberships&&(0,u.jsx)(l.Lz,{title:(0,s.__)("Display memberships on the subscriptions tab","newspack-plugin"),description:(0,s.__)("Display memberships that don't have active subscriptions on the My Account Subscriptions tab, so readers can see information like expiration dates.","newspack-plugin"),toggleOnChange:e=>d({show_on_subscription_tab:e}),toggleChecked:c.show_on_subscription_tab,togglePosition:"trailing"})]})});var R=t(3731),B=t(8721);const G=()=>{const e=(0,S.l)("newspack-audience/payment"),{saveWizardSettings:n,updateWizardSettings:t}=(0,C.useDispatch)(A.S);return(0,u.jsxs)(B.A,{children:[(0,u.jsx)(l.Zp,{noBorder:!0,children:(0,u.jsx)(l.Yq,{label:(0,s.__)("Select Reader Revenue Platform","newspack"),value:e.platform_data?.platform,options:[{label:(0,s.__)("Other","newspack"),value:R.Zs},{label:(0,s.__)("Newspack","newspack"),value:R.L0},{label:(0,s.__)("News Revenue Hub","newspack"),value:R.FF}],onChange:e=>{n({slug:"newspack-audience/payment",payloadPath:["platform_data"],updatePayload:{path:["platform_data","platform"],value:e}})}})}),R.L0===e.platform_data?.platform&&!e.plugin_status&&(0,u.jsx)(l.I2,{plugins:["woocommerce","woocommerce-subscriptions"],onStatus:({complete:e})=>{e&&t({slug:"newspack-audience/payment",path:["plugin_status"],value:!0})},withoutFooterButton:!0})]})},H=({stripe:e})=>{const n=(0,C.useSelect)(e=>e(A.S).isLoading()),t=(0,C.useSelect)(e=>e(A.S).isQuietLoading()),{updateWizardSettings:a}=(0,C.useDispatch)(A.S),{saveWizardSettings:c}=(0,C.useDispatch)(A.S),r=e?.testMode,o=r?e?.is_connected_api_test:e?.is_connected_api_live,p=r?e?.is_connected_oauth_test:e?.is_connected_oauth_live;return(0,u.jsx)(l.Lz,{isMedium:!0,title:(0,s.__)("Stripe","newspack-plugin"),description:()=>(0,u.jsxs)(u.Fragment,{children:[(0,s.__)("Enable the Stripe payment gateway for WooCommerce. ","newspack-plugin"),(0,u.jsx)(i.ExternalLink,{href:"https://woocommerce.com/document/stripe/",children:(0,s.__)("Learn more","newspack-plugin")})]}),hasWhiteHeader:!0,toggleChecked:!!e.enabled,toggleOnChange:()=>{var n;n=!e.enabled,a({slug:"newspack-audience/payment",path:["payment_gateways","stripe","enabled"],value:n}),c({slug:"newspack-audience/payment",section:"stripe",payloadPath:["payment_gateways","stripe"]})},badge:e?.enabled?n||t?(0,s.__)("Loading…","newspack-plugin"):o?p?r?(0,s.__)("Connected - test mode","newspack-plugin"):(0,s.__)("Connected","newspack-plugin"):(0,s.__)("Needs attention","newspack-plugin"):(0,s.__)("Not connected","newspack-plugin"):null,badgeLevel:!e?.enabled||n||t?"info":o?p?"success":"warning":"error",actionContent:!e?.enabled||n||t?null:p?(0,u.jsx)(l.$n,{variant:"secondary",href:"/wp-admin/admin.php?page=wc-settings&tab=checkout&section=stripe&panel=settings",target:"_blank",rel:"noreferrer",children:(0,s.__)("Configure","newspack-plugin")}):(0,u.jsx)(l.$n,{variant:"primary",href:"/wp-admin/admin.php?page=wc-settings&tab=checkout&section=stripe&panel=payment-methods",target:"_blank",rel:"noreferrer",children:(0,s.__)("Connect","newspack-plugin")})})},W=({gateway:e})=>{const n=(0,C.useSelect)(e=>e(A.S).isLoading()),t=(0,C.useSelect)(e=>e(A.S).isQuietLoading()),{updateWizardSettings:a}=(0,C.useDispatch)(A.S),{saveWizardSettings:c}=(0,C.useDispatch)(A.S),r=e?.test_mode,o=e?.is_connected;return(0,u.jsx)(l.Lz,{isMedium:!0,title:e.name,description:()=>(0,u.jsxs)(u.Fragment,{children:[(0,s.sprintf)(
// Translators: %s is the payment gateway name.
// Translators: %s is the payment gateway name.
(0,s.__)("Enable %s. ","newspack-plugin"),e.name),e.url&&(0,u.jsx)(i.ExternalLink,{href:e.url,children:(0,s.__)("Learn more","newspack-plugin")})]}),hasWhiteHeader:!0,toggleChecked:!!e.enabled,toggleOnChange:()=>{var n;n=!e.enabled,a({slug:"newspack-audience/payment",path:["payment_gateways",e.slug,"enabled"],value:n}),c({slug:"newspack-audience/payment",section:"gateway",payloadPath:["payment_gateways",e.slug]})},badge:e?.enabled?n||t?(0,s.__)("Loading…","newspack-plugin"):o?r?(0,s.__)("Connected - test mode","newspack-plugin"):(0,s.__)("Connected","newspack-plugin"):(0,s.__)("Not connected","newspack-plugin"):null,badgeLevel:!e?.enabled||n||t?"info":o?"success":"error",actionContent:!e?.enabled||n||t?null:o?(0,u.jsx)(l.$n,{variant:"secondary",href:e.settings,target:"_blank",rel:"noreferrer",children:(0,s.__)("Configure","newspack-plugin")}):(0,u.jsx)(l.$n,{variant:"primary",href:e.connect,target:"_blank",rel:"noreferrer",children:(0,s.__)("Connect","newspack-plugin")})})},V=()=>{const{payment_gateways:e={},is_ssl:n,errors:t=[],plugin_status:a,platform_data:c={}}=(0,S.l)("newspack-audience/payment");return!1===a||"wc"!==c?.platform?null:(0,u.jsxs)(B.A,{title:(0,s.__)("Payment Gateways","newspack-plugin"),description:()=>(0,u.jsxs)(u.Fragment,{children:[(0,s.__)("Configure Newspack-supported payment gateways for WooCommerce. Payment gateways allow you to accept various payment methods from your readers. ","newspack-plugin"),(0,u.jsx)(i.ExternalLink,{href:"https://woocommerce.com/document/premium-payment-gateway-extensions/",children:(0,s.__)("Learn more","newspack-plugin")})]}),children:[t.length>0&&t.map((e,n)=>(0,u.jsx)(l.$T,{isError:!0,noticeText:(0,u.jsx)("span",{children:e.message})},n)),!1===n&&(0,u.jsx)(l.$T,{isWarning:!0,noticeText:(0,u.jsxs)(u.Fragment,{children:[(0,s.__)("Missing or invalid SSL configuration detected. To collect payments, the site must be secured with SSL. ","newspack-plugin"),(0,u.jsx)(i.ExternalLink,{href:"https://stripe.com/docs/security/guide",children:(0,s.__)("Learn more","newspack-plugin")})]})}),Object.keys(e).map(n=>"stripe"===n?(0,u.jsx)(H,{stripe:e[n]},e[n]):(0,u.jsx)(W,{gateway:e[n]},n))]})},Z=()=>{const[e,n]=(0,a.useState)(null),t=(0,S.l)("newspack-audience/payment"),{updateWizardSettings:i,saveWizardSettings:c}=(0,C.useDispatch)(A.S);(0,a.useEffect)(()=>{t?.platform_data?.donor_landing_page&&n(t.platform_data.donor_landing_page)},[]);const r=(e,n)=>i({slug:"newspack-audience/payment",path:["platform_data",e],value:n}),o=t?.platform_data||{};return(0,u.jsxs)(B.A,{title:(0,s.__)("News Revenue Hub Settings","newspack-plugin"),description:(0,s.__)("Configure your site’s connection to News Revenue Hub.","newspack-plugin"),children:[(0,u.jsx)("div",{children:(0,u.jsxs)(l.xA,{columns:3,children:[(0,u.jsx)(l.xt,{label:(0,s.__)("Organization ID","newspack-plugin"),placeholder:"exampleid",value:o?.nrh_organization_id||"",onChange:e=>r("nrh_organization_id",e)}),(0,u.jsx)(l.xt,{label:(0,s.__)("Custom domain (optional)","newspack-plugin"),help:(0,s.__)("Enter the raw domain without protocol or slashes."),placeholder:"donate.example.com",value:o?.nrh_custom_domain||"",onChange:e=>r("nrh_custom_domain",e)}),(0,u.jsx)(l.xt,{label:(0,s.__)("Salesforce Campaign ID (optional)","newspack-plugin"),placeholder:"exampleid",value:o?.nrh_salesforce_campaign_id||"",onChange:e=>r("nrh_salesforce_campaign_id",e)})]})}),o.hasOwnProperty("donor_landing_page")&&(0,u.jsxs)("div",{children:[(0,u.jsx)("h3",{children:(0,s.__)("Donor Landing Page","newspack-plugin")}),(0,u.jsx)("p",{className:"components-base-control__help",children:(0,s.__)("Set a page on your site as a donor landing page. Once a reader donates and lands on this page, they will be considered a donor.","newspack")}),(0,u.jsx)(l.IW,{label:(0,s.__)("Search for a New Donor Landing Page","newspack-plugin"),help:(0,s.__)("Begin typing page title, click autocomplete result to select.","newspack"),onChange:e=>{if(!e||!e.length)return n(null),r("donor_landing_page",null);const t=e[0];return n(t),r("donor_landing_page",t)},postTypes:[{slug:"page",label:"Page"}],postTypeLabel:(0,s.__)("page","newspack-plugin"),postTypeLabelPlural:(0,s.__)("pages","newspack-plugin"),selectedItems:e?[e]:[]})]}),(0,u.jsx)("div",{className:"newspack-buttons-card",children:(0,u.jsx)(l.$n,{isPrimary:!0,onClick:()=>c({slug:"newspack-audience/payment",payloadPath:["platform_data"]}),children:(0,s.__)("Save Settings")})}),(0,u.jsx)("hr",{})]})},U=()=>{const e=(0,S.l)("newspack-audience/billing-fields"),{updateWizardSettings:n,saveWizardSettings:t}=(0,C.useDispatch)(A.S),a=(0,C.useSelect)(e=>{var n;return null!==(n=e(A.S).isQuietLoading())&&void 0!==n&&n},[]);if(!e)return null;const c=e=>n({slug:"newspack-audience/billing-fields",path:["billing_fields"],value:e}),r=e.available_billing_fields,o=e.order_notes_field;if(!r||!Object.keys(r).length)return null;const p=e.billing_fields.length?e.billing_fields:Object.keys(r);return(0,u.jsxs)(B.A,{title:(0,s.__)("Billing Fields","newspack-plugin"),description:(0,s.__)("Configure the billing fields shown in the modal checkout form. Fields marked with (*) are required if shown. Note that for shippable products, address fields will always be shown.","newspack-plugin"),className:a?"is-fetching":"",children:[(0,u.jsxs)(l.xA,{columns:3,rowGap:16,children:[Object.keys(r).map(e=>(0,u.jsx)(i.CheckboxControl,{label:r[e].label+(r[e].required?" *":""),checked:p.includes(e),disabled:"billing_email"===e,onChange:()=>{let n=[...p];n=p.includes(e)?n.filter(n=>n!==e):[...n,e],c(n)}},e)),o&&(0,u.jsx)(i.CheckboxControl,{label:o.label,checked:p.includes("order_comments"),onChange:()=>{let e=[...p];e=p.includes("order_comments")?e.filter(e=>"order_comments"!==e):[...e,"order_comments"],c(e)}})]}),(0,u.jsx)("div",{className:"newspack-buttons-card",children:(0,u.jsx)(l.$n,{variant:"primary",onClick:()=>t({slug:"newspack-audience/billing-fields"}),disabled:a,children:a?(0,s.__)("Saving…","newspack-plugin"):(0,s.__)("Save Settings","newspack-plugin")})})]})},Y="newspack-audience/checkout-configuration",Q=function(){var e;const n=(0,S.l)(Y),{updateWizardSettings:t,saveWizardSettings:a}=(0,C.useDispatch)(A.S),c=(0,C.useSelect)(e=>{var n;return null!==(n=e(A.S).isQuietLoading())&&void 0!==n&&n},[]),r=(e,n)=>t({slug:Y,path:[n],value:e});return(0,u.jsxs)(B.A,{title:(0,s.__)("Checkout Configuration","newspack-plugin"),className:c?"is-fetching":"",children:[(0,u.jsx)(i.ToggleControl,{label:(0,s.__)("Require sign in or create account before checkout","newspack-plugin"),help:(0,s.__)("Prompt users who are not logged in to sign in or register a new account before proceeding to checkout. When disabled, an account will automatically be created with the email address used at checkout.","newspack-plugin"),checked:null!==(e=n.woocommerce_registration_required)&&void 0!==e&&e,onChange:e=>r(e,"woocommerce_registration_required"),disabled:c}),(0,u.jsxs)(l.xA,{children:[(0,u.jsx)(i.TextareaControl,{label:(0,s.__)("Post-checkout success message","newspack-plugin"),help:(0,s.__)("The success message to display to readers after completing checkout.","newspack-plugin"),value:n.woocommerce_post_checkout_success_text,onChange:e=>r(e,"woocommerce_post_checkout_success_text")}),!n.woocommerce_registration_required&&(0,u.jsx)(i.TextareaControl,{label:(0,s.__)("Post-checkout registration success message","newspack-plugin"),help:(0,s.__)("The success message to display to new readers that have an account automatically created after completing checkout.","newspack-plugin"),value:n.woocommerce_post_checkout_registration_success_text,onChange:e=>r(e,"woocommerce_post_checkout_registration_success_text")})]}),(0,u.jsx)(l.xA,{children:(0,u.jsx)(i.TextareaControl,{label:(0,s.__)("Checkout privacy policy text","newspack-plugin"),help:(0,s.__)("The privacy policy text to display at time of checkout for existing users. This will not show up unless a privacy page is set.","newspack-plugin"),value:n.woocommerce_checkout_privacy_policy_text,onChange:e=>r(e,"woocommerce_checkout_privacy_policy_text")})}),(0,u.jsx)("div",{className:"newspack-buttons-card",children:(0,u.jsx)(l.$n,{variant:"primary",onClick:function(){a({slug:Y})},disabled:c,children:c?(0,s.__)("Saving…","newspack-plugin"):(0,s.__)("Save Settings","newspack-plugin")})})]})},J=()=>{const e=(0,S.l)("newspack-audience/cover-fees"),{updateWizardSettings:n}=(0,C.useDispatch)(A.S),t=(0,C.useSelect)(e=>{var n;return null!==(n=e(A.S).isQuietLoading())&&void 0!==n&&n},[]),a=(e,t)=>n({slug:"newspack-audience/cover-fees",path:[e],value:t}),{saveWizardSettings:c}=(0,C.useDispatch)(A.S),r=()=>c({slug:"newspack-audience/cover-fees"});return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(B.A,{title:(0,s.__)("Collect transaction fees","newspack-plugin"),description:(0,s.__)("Allow readers to optionally cover transaction fees imposed by payment processors when making donations or subscribing.","newspack-plugin"),className:t?"is-fetching":"",children:[(0,u.jsx)(i.ToggleControl,{label:(0,s.__)("Collect transaction fees","newspack-plugin"),checked:e.allow_covering_fees,disabled:t,onChange:()=>{a("allow_covering_fees",!e.allow_covering_fees),r()}}),(0,u.jsxs)(l.xA,{rowGap:16,children:[(0,u.jsx)(l.xt,{type:"number",step:"0.1",value:e.fee_multiplier,label:(0,s.__)("Fee multiplier","newspack-plugin"),onChange:e=>a("fee_multiplier",e),disabled:t}),(0,u.jsx)(l.xt,{type:"number",step:"0.1",value:e.fee_static,label:(0,s.__)("Fee static portion","newspack-plugin"),onChange:e=>a("fee_static",e),disabled:t}),(0,u.jsx)(l.xt,{value:e.allow_covering_fees_label,label:(0,s.__)("Custom message","newspack-plugin"),placeholder:(0,s.__)("A message to explain the transaction fee option (optional).","newspack-plugin"),onChange:e=>a("allow_covering_fees_label",e),disabled:t})]}),(0,u.jsxs)(l.xA,{rowGap:16,children:[(0,u.jsx)(i.CheckboxControl,{label:(0,s.__)("Cover fees by default","newspack-plugin"),checked:e.allow_covering_fees_default,onChange:()=>a("allow_covering_fees_default",!e.allow_covering_fees_default),help:(0,s.__)("If enabled, the option to cover the transaction fee will be checked by default.","newspack-plugin"),disabled:t}),(0,u.jsx)(i.CheckboxControl,{label:(0,s.__)("Donations only","newspack-plugin"),checked:e.allow_covering_fees_donations_only,onChange:()=>a("allow_covering_fees_donations_only",!e.allow_covering_fees_donations_only),help:(0,s.__)("If enabled, the option to cover the transaction fee will only be available for donations.","newspack-plugin"),disabled:t})]}),(0,u.jsx)("div",{className:"newspack-buttons-card",children:(0,u.jsx)(l.$n,{isPrimary:!0,onClick:r,disabled:t,children:(0,s.__)("Save Settings","newspack-plugin")})})]})})},K="newspack-audience/subscription-settings",X=function(){var e,n;const t=(0,S.l)(K),{updateWizardSettings:a,saveWizardSettings:c}=(0,C.useDispatch)(A.S),r=(0,C.useSelect)(e=>{var n;return null!==(n=e(A.S).isQuietLoading())&&void 0!==n&&n},[]),o=(e,n)=>{"woocommerce_enable_subscription_confirmation"===n&&e&&a({slug:K,path:["woocommerce_enable_terms_confirmation"],value:!1}),"woocommerce_enable_terms_confirmation"===n&&e&&a({slug:K,path:["woocommerce_enable_subscription_confirmation"],value:!1}),a({slug:K,path:[n],value:e})};return(0,u.jsxs)(B.A,{title:(0,s.__)("Subscription","newspack-plugin"),description:(0,s.__)("Manage the settings for subscription transparency and compliance.","newspack-plugin"),className:r?"is-fetching":"",children:[(0,u.jsxs)(l.xA,{columns:1,children:[(0,u.jsxs)(l.xA,{columns:1,gutter:8,children:[(0,u.jsx)(i.ToggleControl,{label:(0,s.__)("Enable subscription confirmation checkbox","newspack-plugin"),help:(0,s.__)("Display a separate checkbox at checkout to confirm the user understands this is a recurring subscription and they can cancel anytime.","newspack-plugin"),checked:null!==(e=t.woocommerce_enable_subscription_confirmation)&&void 0!==e&&e,onChange:e=>o(e,"woocommerce_enable_subscription_confirmation"),disabled:r}),t.woocommerce_enable_subscription_confirmation&&(0,u.jsx)(i.TextareaControl,{label:(0,s.__)("Label","newspack-plugin"),value:t.woocommerce_subscription_confirmation_text,onChange:e=>o(e,"woocommerce_subscription_confirmation_text")})]}),(0,u.jsxs)(l.xA,{columns:1,gutter:8,children:[(0,u.jsx)(i.ToggleControl,{label:(0,s.__)("Enable Terms & Conditions confirmation checkbox","newspack-plugin"),help:(0,s.__)("Display the 'I have read and accept the Terms & Conditions' checkbox at checkout. Ensure the Terms & Conditions include subscription details to comply with the FTC guidelines.","newspack-plugin"),checked:null!==(n=t.woocommerce_enable_terms_confirmation)&&void 0!==n&&n,onChange:e=>o(e,"woocommerce_enable_terms_confirmation"),disabled:r}),t.woocommerce_enable_terms_confirmation&&(0,u.jsxs)(l.xA,{children:[(0,u.jsx)(i.TextareaControl,{label:(0,s.__)("Label","newspack-plugin"),value:t.woocommerce_terms_confirmation_text,help:(0,s.__)("Text wrapped in {{ }} will be linked to the page set in the URL field.","newspack-plugin"),onChange:e=>o(e,"woocommerce_terms_confirmation_text")}),(0,u.jsx)(i.TextControl,{label:(0,s.__)("URL","newspack-plugin"),value:t.woocommerce_terms_confirmation_url,onChange:e=>o(e,"woocommerce_terms_confirmation_url")})]})]})]}),(0,u.jsx)("div",{className:"newspack-buttons-card",children:(0,u.jsx)(l.$n,{variant:"primary",onClick:function(){t.woocommerce_subscription_confirmation_text||a({slug:K,path:["woocommerce_subscription_confirmation_text"],value:(0,s.__)("I understand this is a recurring subscription and that I can cancel anytime through the My Account Page.","newspack-plugin")}),t.woocommerce_terms_confirmation_text||a({slug:K,path:["woocommerce_terms_confirmation_text"],value:(0,s.__)("I have read and accept the {{Terms & Conditions}}.","newspack-plugin")}),!t.woocommerce_enable_terms_confirmation||t.woocommerce_terms_confirmation_url?c({slug:K}):alert((0,s.__)("Please provide a URL for the Terms & Conditions page.","newspack-plugin"))},disabled:r,children:r?(0,s.__)("Saving…","newspack-plugin"):(0,s.__)("Save Settings","newspack-plugin")})})]})},ee=(0,l.c_)(function({wizardApiFetch:e}){const n=(0,S.l)("newspack-audience/payment");return(0,u.jsxs)(o.A,{title:(0,s.__)("Checkout & Payment","newspack-plugin"),description:(0,s.__)("Reader revenue configuration for donations and subscriptions.","newspack-plugin"),children:[(0,u.jsx)(G,{}),"wc"===n?.platform_data?.platform&&(0,u.jsx)(V,{}),"wc"===n?.platform_data?.platform&&(0,u.jsx)(U,{}),"nrh"===n?.platform_data?.platform&&(0,u.jsx)(Z,{}),(0,u.jsx)(Q,{}),"wc"===n?.platform_data?.platform&&(0,u.jsx)(J,{wizardApiFetch:e}),"wc"===n?.platform_data?.platform&&(0,u.jsx)(X,{})]})}),{HashRouter:ne,Redirect:te,Route:se,Switch:ae}=N.A,ie=(0,l.Aq)((0,a.forwardRef)(function({confirmAction:e,pluginRequirements:n,wizardApiFetch:t},i){const[c,r]=(0,a.useState)(!1),[l,o]=(0,a.useState)({}),[p,d]=(0,a.useState)(null),[g,_]=(0,a.useState)(!1),[h,m]=(0,a.useState)([]),w=()=>(_(!1),r(!0),t({path:"/newspack/v1/wizard/newspack-audience/audience-management"}).then(({config:e,prerequisites_status:n,can_esp_sync:t})=>{d(n),o(e),m(t.errors)}).catch(_).finally(()=>r(!1))),k=(e,n)=>{o({...l,[e]:n})};(0,a.useEffect)(()=>{window.scrollTo(0,0),w()},[]);let x=[{label:l.enabled?(0,s.__)("Configuration","newspack-plugin"):(0,s.__)("Setup","newspack-plugin"),path:"/"},l.enabled&&newspackAudience.has_memberships&&{label:(0,s.__)("Content Gating","newspack-plugin"),path:"/content-gating"},{label:(0,s.__)("Checkout & Payment","newspack-plugin"),path:"/payment"}];x=x.filter(e=>e);const b={headerText:(0,s.__)("Audience Management","newspack-plugin"),tabbedNavigation:x,wizardApiFetch:t,inFlight:c,error:g,fetchConfig:w,updateConfig:k,saveConfig:e=>{_(!1),r(!0),t({path:"/newspack/v1/wizard/newspack-audience/audience-management",method:"post",quiet:!0,data:e}).then(({config:e,prerequisites_status:n,can_esp_sync:t})=>{d(n),o(e),m(t.errors)}).catch(_).finally(()=>r(!1))},skipPrerequisite:(n,a=null)=>{e({message:(0,s.__)("Are you sure you want to skip this step? You can always come back later.","newspack-plugin"),confirmText:(0,s.__)("Skip","newspack-plugin"),callback:()=>{_(!1),r(!0),t({path:"/newspack/v1/wizard/newspack-audience/audience-management/skip",method:"post",quiet:!0,data:n}).then(({config:e,prerequisites_status:n,can_esp_sync:t})=>{d(n),o(e),m(t.errors),a&&a()}).catch(_).finally(()=>r(!1))}})},setInFlight:r,setError:_,getSharedProps:(e,n="checkbox")=>{const t={onChange:n=>k(e,n)};switch("enabled"!==e&&(t.disabled=c),n){case"checkbox":t.checked=Boolean(l[e]);break;case"text":t.value=l[e]||""}return t},espSyncErrors:h,prerequisites:p,config:l};return(0,u.jsx)("div",{ref:i,children:(0,u.jsx)(ne,{hashType:"slash",children:(0,u.jsxs)(ae,{children:[n,(0,u.jsx)(se,{path:"/",exact:!0,render:()=>(0,u.jsx)(T,{...b})}),(0,u.jsx)(se,{path:"/content-gating",render:()=>(0,u.jsx)(q,{...b})}),(0,u.jsx)(se,{path:"/payment",render:()=>(0,u.jsx)(ee,{...b})}),(0,u.jsx)(se,{path:"/campaign",render:()=>(0,u.jsx)(F,{...b})}),(0,u.jsx)(se,{path:"/complete",render:()=>(0,u.jsx)(O,{...b})}),(0,u.jsx)(te,{to:"/"})]})})})}))},5829:(e,n,t)=>{"use strict";t.d(n,{A:()=>c});var s=t(7143),a=t(3076),i=t(790);const c=function({title:e,children:n,isFetching:t,description:c,...r}){const l=(0,s.useSelect)(e=>e(a.S).isLoading(),[]),o=r.className||"";return(0,i.jsxs)("div",{className:`${l||t?"is-fetching ":""}${o} newspack-wizard__sections`,children:[(0,i.jsx)("h1",{children:e}),c&&(0,i.jsx)("p",{className:"newspack-wizard__sections__description",children:c}),n]})}},5880:(e,n,t)=>{var s=t(514),a=t(5950);e.exports=function(e){return null==e?[]:s(e,a(e))}},6837:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var s=t(1311),a=t(790);const i=({description:e,error:n,isChecked:t,notificationLevel:i="error",children:c,...r})=>{let l;return void 0!==t&&(l=t?"checked":"unchecked"),(0,a.jsx)(s.Lz,{description:e,checkbox:l,notification:n,notificationLevel:i,...r,children:c})}},7153:(e,n,t)=>{"use strict";t.d(n,{M1:()=>c,Ss:()=>i.A,u:()=>a.A});var s=t(7723),a=t(4058),i=t(1075);const c={MAILCHIMP_API_KEY_INVALID:(0,s.__)("Invalid Mailchimp API Key.","newspack-plugin"),GOOGLEOAUTH_REFRESH_TOKEN_EXPIRED:(0,s.__)("Missing Google refresh token. Please re-authenticate site.","newspack-plugin"),GOOGLE:{OAUTH_POPUP_BLOCKED:(0,s.__)("Popup blocked by browser. Disable any popup blocking settings and try again.","newspack-plugin"),URL_INVALID:(0,s.__)("URL is invalid. Please try again or contact support if the issue persists.","newspack-plugin")}}},7172:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>d});var s=t(7723),a=t(1455),i=t.n(a),c=t(6087),r=t(6427),l=t(1311),o=t(5829),p=t(8721),u=t(790);const d=(0,l.Aq)((0,c.forwardRef)(function(e,n){const[t,a]=(0,c.useState)(!1),[d,g]=(0,c.useState)(window.newspackAudienceSubscriptions.primary_product);(0,c.useEffect)(()=>{g(window.newspackAudienceSubscriptions.primary_product)},[window.newspackAudienceSubscriptions.primary_product]);const _=e=>{a(!0),i()({path:"/newspack/v1/wizard/newspack-audience-subscriptions/primary-product",method:"POST",data:{primary_product:e}}).then(()=>{g(e)}).finally(()=>{a(!1)})};return(0,u.jsx)(l.sQ,{headerText:(0,s.__)("Audience Management / Subscriptions","newspack-plugin"),sections:[{label:(0,s.__)("Configuration","newspack-plugin"),path:"/configuration",render:()=>(0,u.jsx)(o.A,{title:(0,s.__)("Configuration","newspack-plugin"),children:(0,u.jsxs)(p.A,{children:[(0,u.jsxs)(l.Zp,{children:[(0,u.jsx)("h2",{children:(0,s.__)("Subscription Upgrade Link","newspack-plugin")}),d&&(0,u.jsxs)(l.$T,{isDismissible:!1,children:[(0,s.__)("Share the following URL to trigger the subscription upgrade:","newspack-plugin")," ",(0,u.jsx)("a",{href:window.newspackAudienceSubscriptions.upgrade_subscription_url,target:"_blank",rel:"noreferrer noopener",children:window.newspackAudienceSubscriptions.upgrade_subscription_url})]}),(0,u.jsx)(l.Yq,{label:(0,s.__)("Primary Subscription Product","newspack-plugin"),help:(0,s.__)("Select a grouped or variable subscription product to allow readers to change their active subscriptions amongst all of its linked products and variations.","newspack-plugin"),options:[{value:"",label:(0,s.__)("Select a product…","newspack-plugin")},...window.newspackAudienceSubscriptions.eligible_products.map(e=>({value:e.id,label:e.title}))],value:d,onChange:_,disabled:t}),d?(0,u.jsxs)(r.__experimentalHStack,{children:[(0,u.jsxs)("p",{children:[(0,u.jsx)(l.$n,{variant:"link",onClick:()=>_(""),children:(0,s.__)("Reset primary product","newspack-plugin")})," "]}),(0,u.jsx)("p",{children:(0,u.jsx)(r.ExternalLink,{href:`/wp-admin/post.php?post=${d}&action=edit`,children:(0,s.sprintf)(/* translators: %s: product title */ /* translators: %s: product title */
(0,s.__)("Edit %s","newspack-plugin"),window.newspackAudienceSubscriptions.eligible_products.find(e=>parseInt(e.id)===parseInt(d))?.title||(0,s.__)("the product","newspack-plugin"))})})]}):null]}),(0,u.jsxs)(l.Zp,{children:[(0,u.jsx)("h2",{children:(0,s.__)("Manage Subscriptions settings in Woo Memberships","newspack-plugin")}),(0,u.jsx)("p",{children:(0,s.__)("You can manage the details of your subscription offerings in the Woo Memberships plugin.","newspack-plugin")}),(0,u.jsx)(l.$n,{variant:"primary",href:window.newspackAudienceSubscriptions.memberships_url,children:(0,s.__)("Manage Subscriptions","newspack-plugin")})]})]})})}],requiredPlugins:["woocommerce","woocommerce-memberships"],ref:n})}))},8169:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var s=t(790),a=t(5573),i=(0,s.jsx)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,s.jsx)(a.Path,{d:"M13 19h-2v-2h2v2zm0-6h-2v-2h2v2zm0-6h-2V5h2v2z"})})},8721:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var s=t(1311),a=t(790);function i({title:e,description:n,children:t=null,scrollToAnchor:i=null,className:c}){const r="newspack-wizard__section"+(c?` ${c}`:"");return(0,a.jsxs)("div",{className:r,children:[e&&(0,a.jsx)(s.X3,{id:i,heading:3,title:e,description:n}),t]})}},8722:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var s=t(790),a=t(5573),i=(0,s.jsx)(a.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)(a.Path,{d:"M18 5.5H6a.5.5 0 0 0-.5.5v12a.5.5 0 0 0 .5.5h12a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5ZM6 4h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Zm1 5h1.5v1.5H7V9Zm1.5 4.5H7V15h1.5v-1.5ZM10 9h7v1.5h-7V9Zm7 4.5h-7V15h7v-1.5Z"})})},9214:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});var s=t(790),a=t(5573),i=(0,s.jsxs)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:[(0,s.jsx)(a.Path,{d:"m19 7.5h-7.628c-.3089-.87389-1.1423-1.5-2.122-1.5-.97966 0-1.81309.62611-2.12197 1.5h-2.12803v1.5h2.12803c.30888.87389 1.14231 1.5 2.12197 1.5.9797 0 1.8131-.62611 2.122-1.5h7.628z"}),(0,s.jsx)(a.Path,{d:"m19 15h-2.128c-.3089-.8739-1.1423-1.5-2.122-1.5s-1.8131.6261-2.122 1.5h-7.628v1.5h7.628c.3089.8739 1.1423 1.5 2.122 1.5s1.8131-.6261 2.122-1.5h2.128z"})]})}}]);