(()=>{"use strict";var e,n={5516:(e,n,t)=>{t(8209);var s=t(6087),i=t(7723),a=t(1727),c=t(216),r=t(1455),o=t.n(r),l=t(790);async function p(e,n=""){const t=n?`/newspack/v1/plugins/${e}/${n}`:`/newspack/v1/plugins/${e}`,s=n?"POST":"GET",i=await o()({path:t,method:s});return{status:i.Status,configured:i.Configured}}const d={jetpack:{pluginSlug:"jetpack",editLink:"admin.php?page=jetpack#/settings",title:"Jetpack",init:()=>p("jetpack"),activate:()=>p("jetpack","activate"),install:()=>p("jetpack","install")},"google-site-kit":{pluginSlug:"google-site-kit",editLink:"admin.php?page=googlesitekit-splash",title:(0,i.__)("Site Kit by Google","newspack-plugin"),statusDescription:{notConfigured:(0,i.__)("Not connected for this user","newspack-plugin")},init:()=>p("google-site-kit"),activate:()=>p("google-site-kit","activate"),install:()=>p("google-site-kit","install")},everlit:{pluginSlug:"everlit",editLink:"admin.php?page=everlit_settings",title:(0,i.__)("Everlit","newspack-plugin"),subTitle:(0,i.__)("AI-Generated Audio Stories","newspack-plugin"),hidden:"1"!==window.newspack_connections_data.can_use_everlit,description:(0,l.jsxs)(l.Fragment,{children:[(0,i.__)("Complete setup and licensing agreement to unlock 5 free audio stories per month.","newspack-plugin")," ",(0,l.jsx)("a",{href:"https://everlit.audio/",target:"_blank",rel:"noreferrer",children:(0,i.__)("Learn more","newspack-plugin")})]}),statusDescription:{uninstalled:(0,i.__)("Not installed.","newspack-plugin"),inactive:(0,i.__)("Inactive.","newspack-plugin"),notConfigured:(0,i.__)("Pending.","newspack-plugin")},init:()=>p("everlit"),activate:()=>p("everlit","activate"),install:()=>p("everlit","install")}},u=({isLoading:e,isSetup:n,isActive:t,onActivate:s,onInstall:c,isInstalled:r,...o})=>"page-reload"===o.status?(0,l.jsx)("span",{className:"gray",children:(0,i.__)("Page reloading…","newspack-plugin")}):e?(0,l.jsx)(a.E$,{}):r?t?n?void 0:(0,l.jsx)("a",{href:o.editLink,children:(0,i.__)("Complete Setup","newspack-plugin")}):(0,l.jsx)(a.$n,{isLink:!0,onClick:s,children:/* translators: %s: Plugin name */ /* translators: %s: Plugin name */
(0,i.sprintf)((0,i.__)("Activate %s","newspack-plugin"),o.title)}):(0,l.jsx)(a.$n,{isLink:!0,onClick:c,children:/* translators: %s: Plugin name */ /* translators: %s: Plugin name */
(0,i.sprintf)((0,i.__)("Install %s","newspack-plugin"),o.title)}),h=({plugin:e,setError:n})=>{const[t,c]=a.JL.useObjectState(e),{title:r,subTitle:o}=t,p="active"===t.status,d="uninstalled"!==t.status,h=t.configured,_=p&&h,g=!t.status;return(0,s.useEffect)((()=>{e.init().then((e=>c(e))).catch(n)}),[]),(0,l.jsx)(a.Lz,{title:`${r}${o?`: ${o}`:""}`,description:()=>{var n;if(g)return(0,i.__)("Loading…","newspack-plugin");const s=null!==(n=e.description)&&void 0!==n?n:"";let a="";var c;if(d)if(p)if(h)a=(0,i.__)("Connected","newspack-plugin");else{var r;a=null!==(r=t.statusDescription?.notConfigured)&&void 0!==r?r:(0,i.__)("Not connected.","newspack-plugin")}else{var o;a=null!==(o=t.statusDescription?.inactive)&&void 0!==o?o:(0,i.__)("Inactive.","newspack-plugin")}else a=null!==(c=t.statusDescription?.uninstalled)&&void 0!==c?c:(0,i.__)("Uninstalled.","newspack-plugin");return(0,l.jsxs)(l.Fragment,{children:[(0,i.__)("Status:","newspack-plugin")," ",a," ",_?"":s]})},actionText:_?null:u({isSetup:_,isActive:p,isLoading:g,isInstalled:d,onActivate:()=>{c({status:""}),t.activate().then((()=>c({status:"page-reload"}))).finally((()=>{window.location.reload()}))},onInstall:()=>{c({status:""}),t.install().then((e=>c(e)))},...t}),disabled:g,checkbox:!_||g?"unchecked":"checked",isMedium:!0})},_=({setError:e})=>(0,l.jsx)(l.Fragment,{children:Object.entries(d).map((([n,t])=>!Boolean(t.hidden)&&(0,l.jsx)(h,{plugin:t,setError:e},n)))});var g=t(8689),k=t(8558),w=t(6427);const x=({setError:e})=>{const[n,t]=(0,s.useState)({}),[c,r]=(0,s.useState)(!1),[p,d]=(0,s.useState)(),[u,h]=(0,s.useState)(!1),_=(0,s.useRef)(null),g=Boolean(n&&n.username),x=n=>e(n.message||(0,i.__)("Something went wrong.","newspack-plugin")),m=()=>{r(!1),d()};(0,s.useEffect)((()=>{h(!0),o()({path:"/newspack/v1/oauth/mailchimp"}).then((e=>{t(e)})).catch(x).finally((()=>h(!1)))}),[]),(0,s.useEffect)((()=>{c&&_.current.querySelector("input").focus()}),[c]);const v=()=>{e(),h(!0),o()({path:"/newspack/v1/oauth/mailchimp",method:"POST",data:{api_key:p}}).then((e=>{t(e)})).catch((n=>{e(n.message||(0,i.__)("Something went wrong during verification of your Mailchimp API key.","newspack-plugin"))})).finally((()=>{h(!1),m()}))};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.Lz,{title:"Mailchimp",description:`${(0,i.__)("Status:","newspack-plugin")} ${u?(0,i.__)("Loading…","newspack-plugin"):g?(0,i.sprintf)((0,i.__)("Connected as %s","newspack-plugin"),n.username):(0,i.__)("Not connected","newspack-plugin")}`,checkbox:g?"checked":"unchecked",actionText:(0,l.jsx)(a.$n,{isLink:!0,isDestructive:g,onClick:g?()=>{h(!0),o()({path:"/newspack/v1/oauth/mailchimp",method:"DELETE"}).then((()=>{t({}),h(!1)})).catch(x)}:()=>r(!0),disabled:u,children:g?(0,i.__)("Disconnect","newspack-plugin"):(0,i.__)("Connect","newspack-plugin")}),isMedium:!0}),c&&(0,l.jsxs)(a.aF,{title:(0,i.__)("Add Mailchimp API Key","newspack-plugin"),onRequestClose:m,children:[(0,l.jsx)("div",{ref:_,children:(0,l.jsxs)(a.xA,{columns:1,gutter:8,children:[(0,l.jsx)(a.xt,{placeholder:"123457103961b1f4dc0b2b2fd59c137b-us1",label:(0,i.__)("Mailchimp API Key","newspack-plugin"),hideLabelFromVision:!0,value:p,onChange:d,onKeyDown:e=>{k.ENTER===e.keyCode&&""!==p&&(e.preventDefault(),v())}}),(0,l.jsx)("p",{children:(0,l.jsx)(w.ExternalLink,{href:"https://mailchimp.com/help/about-api-keys/#Find_or_generate_your_API_key",children:(0,i.__)("Find or generate your API key","newspack-plugin")})})]})}),(0,l.jsxs)(a.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,l.jsx)(a.$n,{isSecondary:!0,onClick:m,children:(0,i.__)("Cancel","newspack-plugin")}),(0,l.jsx)(a.$n,{isPrimary:!0,disabled:!p,onClick:v,children:u?(0,i.__)("Connecting…","newspack-plugin"):g?(0,i.__)("Connected","newspack-plugin"):(0,i.__)("Connect","newspack-plugin")})]})]})]})};var m=t(6942),v=t.n(m),j=t(8156),b=t.n(j);const f=[{service:"stripe",label:(0,i.__)("Stripe","newspack-plugin")}],y=({setError:e})=>{const[n,t]=(0,s.useState)(),[c,r]=(0,s.useState)(!1),[p,d]=(0,s.useState)(null),u=n=>e(n.message||(0,i.__)("Something went wrong.","newspack-plugin")),h=c||!(void 0!==n)||!p;return(0,s.useEffect)((()=>{r(!0),o()({path:"/newspack/v1/oauth/fivetran"}).then((e=>{t(e.connections_statuses),d(e.has_accepted_tos)})).catch(u).finally((()=>r(!1)))}),[]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{children:[(0,i.__)("In order to use the this features, you must read and accept","newspack-plugin")," ",(0,l.jsx)("a",{href:"https://newspack.com/terms-of-service/",children:(0,i.__)("Newspack Terms of Service","newspack-plugin")}),":"]}),(0,l.jsx)(w.CheckboxControl,{className:v()("mt1",{"o-50":null===p}),checked:p,disabled:null===p,onChange:e=>{o()({path:"/newspack/v1/oauth/fivetran-tos",method:"POST",data:{has_accepted:e}}),d(e)},label:(0,i.__)("I've read and accept Newspack Terms of Service","newspack-plugin")}),f.map((e=>{const t=((e,n)=>{const t=void 0!==n,s=b()(n,[e.service,"setup_state"]),a=b()(n,[e.service,"sync_state"]),c=b()(n,[e.service,"schema_status"]),r=c&&"ready"!==c||"paused"===a;let o="-";return s?"ready"===c?o=`${s}, ${a}`:r&&(o=`${s}, ${a}. ${(0,i.__)("Sync is in progress – please check back in a while.","newspack-plugin")}`):t&&(o=(0,i.__)("Not connected","newspack-plugin")),{label:o,isConnected:"connected"===s,isPending:r}})(e,n);return(0,l.jsx)(a.Lz,{title:e.label,description:`${(0,i.__)("Status:","newspack-plugin")} ${t.label}`,isPending:t.isPending,actionText:(0,l.jsx)(w.Button,{disabled:h,onClick:()=>(({service:e})=>{r(!0),o()({path:`/newspack/v1/oauth/fivetran/${e}`,method:"POST",data:{service:e}}).then((({url:e})=>window.location=e)).catch(u)})(e),isLink:!0,children:t.isConnected?(0,i.__)("Re-connect","newspack-plugin"):(0,i.__)("Connect","newspack-plugin")}),checkbox:t.isConnected?"checked":"unchecked",isMedium:!0},e.service)}))]})},C=()=>{const[e,n]=(0,s.useState)(null),[t,c]=(0,s.useState)(!1),[r,p]=(0,s.useState)({}),[d,u]=(0,s.useState)({});(0,s.useEffect)((()=>{(async()=>{c(!0);try{const e=await o()({path:"/newspack-manager/v1/jetpack-sso"});p(e),u(e)}catch(e){n(e.message||(0,i.__)("Error fetching settings.","newspack-plugin"))}finally{c(!1)}})()}),[]);const h=async e=>{n(null),c(!0);try{const n=await o()({path:"/newspack-manager/v1/jetpack-sso",method:"POST",data:e});p(n),u(n)}catch(e){n(e?.message||(0,i.__)("Error updating settings.","newspack-plugin"))}finally{c(!1)}};return newspack_connections_data.can_use_jetpack_sso?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.X3,{id:"jetpack-sso",title:(0,i.__)("Jetpack SSO","newspack-plugin")}),(0,l.jsx)(a.Lz,{isMedium:!0,title:(0,i.__)("Force two-factor authentication","newspack-plugin"),description:()=>(0,l.jsx)(l.Fragment,{children:(0,i.__)("Improve security by requiring two-factor authentication via WordPress.com for users with higher capabilities.","newspack-plugin")}),hasGreyHeader:!!r.force_2fa,toggleChecked:!!r.force_2fa,toggleOnChange:()=>h({force_2fa:!r.force_2fa}),actionContent:r.force_2fa&&(0,l.jsx)(a.$n,{variant:"primary",disabled:t||!Object.keys(d).length,onClick:()=>h(d),children:(0,i.__)("Save Settings","newspack-plugin")}),disabled:t,children:r.force_2fa&&(0,l.jsxs)(l.Fragment,{children:[e&&(0,l.jsx)(a.$T,{isError:!0,noticeText:e}),r.jetpack_sso_force_2fa&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.$T,{isError:!0,noticeText:(0,i.__)("Two-factor authentication is currently enforced for all users via Jetpack configuration.","newspack-plugin")}),(0,l.jsx)("p",{children:(0,i.__)("Customize which capabilties to enforce 2FA by untoggling the “Require accounts to use WordPress.com Two-Step Authentication” option in Jetpack settings.","newspack-plugin")})]}),(0,l.jsx)(a.xA,{columns:1,children:(0,l.jsx)(w.BaseControl,{id:"force-2fa-cap",label:(0,i.__)("Select the user capability to enforce two-factor authentication","newspack-plugin"),children:(0,l.jsx)(a.Yq,{label:(0,i.__)("Capability","newspack-plugin"),hideLabelFromVision:!0,value:d?.force_2fa_cap||"",onChange:e=>u({...d,force_2fa_cap:e}),options:Object.keys(r.available_caps||{}).map((e=>({label:r.available_caps[e],value:e})))})})}),(0,l.jsx)(a.xA,{columns:1,children:(0,l.jsx)(w.CheckboxControl,{checked:d?.obfuscate_account||!1,onChange:e=>u({...d,obfuscate_account:e}),label:(0,i.__)("Obfuscate restricted accounts by throwing WP’s “user not found” errors on login form attempts.","newspack-plugin")})})]})})]}):null},S=()=>{const[e,n]=(0,s.useState)(null),[t,c]=(0,s.useState)(!1),[r,p]=(0,s.useState)({}),[d,u]=(0,s.useState)({});(0,s.useEffect)((()=>{(async()=>{c(!0);try{const e=await o()({path:"/newspack/v1/recaptcha"});p(e),u(e)}catch(e){n(e.message||(0,i.__)("Error fetching settings.","newspack-plugin"))}finally{c(!1)}})()}),[]),(0,s.useEffect)((()=>{d?.version!==r?.version?(u({...d,site_key:"",site_secret:""}),n((0,i.__)("Your site key and secret must match the selected reCAPTCHA version. Please enter new credentials.","newspack-plugin"))):(u({...d,site_key:r?.site_key||"",site_secret:r?.site_secret||""}),n(null))}),[d?.version]);const h=async e=>{n(null),c(!0);try{const n=await o()({path:"/newspack/v1/recaptcha",method:"POST",data:e});p(n),u(n)}catch(e){n(e?.message||(0,i.__)("Error updating settings.","newspack-plugin"))}finally{c(!1)}},_="v3"===d?.version,g=r.site_key&&r.site_secret;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.X3,{id:"recaptcha",title:(0,i.__)("reCAPTCHA","newspack-plugin")}),(0,l.jsx)(a.Lz,{isMedium:!0,title:(0,i.__)("Use reCAPTCHA","newspack-plugin"),description:()=>(0,l.jsxs)(l.Fragment,{children:[(0,i.__)("Enabling reCAPTCHA can help protect your site against bot attacks and credit card testing.","newspack-plugin")," ",(0,l.jsx)(w.ExternalLink,{href:"https://www.google.com/recaptcha/admin/create",children:(0,i.__)("Get started","newspack-plugin")})]}),hasGreyHeader:!!r.use_captcha,toggleChecked:!!r.use_captcha,toggleOnChange:()=>h({use_captcha:!r.use_captcha}),actionContent:r.use_captcha&&(0,l.jsx)(a.$n,{variant:"primary",disabled:t||!Object.keys(d).length,onClick:()=>h(d),children:(0,i.__)("Save Settings","newspack-plugin")}),disabled:t,children:r.use_captcha&&(0,l.jsxs)(l.Fragment,{children:[e&&(0,l.jsx)(a.$T,{isError:!0,noticeText:e}),!g&&(0,l.jsx)(a.$T,{noticeText:(0,i.__)("You must enter a valid site key and secret to use reCAPTCHA.","newspack-plugin")}),(0,l.jsx)(a.xA,{noMargin:!0,rowGap:16,children:(0,l.jsx)(w.BaseControl,{id:"recaptcha-version",label:(0,i.__)("reCAPTCHA Version","newspack-plugin"),help:(0,l.jsx)(w.ExternalLink,{href:"https://developers.google.com/recaptcha/docs/versions",children:(0,i.__)("Learn more about reCAPTCHA versions","newspack-plugin")}),children:(0,l.jsx)(a.Yq,{label:(0,i.__)("reCAPTCHA Version","newspack-plugin"),hideLabelFromVision:!0,value:d?.version||"v3",onChange:e=>u({...d,version:e}),options:[{value:"v3",label:(0,i.__)("Score based (v3)","newspack-plugin")},{value:"v2_invisible",label:(0,i.__)("Challenge (v2) - invisible reCAPTCHA badge","newspack-plugin")}]})})}),(0,l.jsxs)(a.xA,{noMargin:!0,rowGap:16,children:[(0,l.jsx)(a.xt,{value:d?.site_key||"",label:(0,i.__)("Site Key","newspack-plugin"),onChange:e=>u({...d,site_key:e}),disabled:t,autoComplete:"off"}),(0,l.jsx)(a.xt,{type:"password",value:d?.site_secret||"",label:(0,i.__)("Site Secret","newspack-plugin"),onChange:e=>u({...d,site_secret:e}),disabled:t,autoComplete:"off"}),_&&(0,l.jsx)(a.xt,{type:"number",step:"0.05",min:"0",max:"1",value:parseFloat(d?.threshold||""),label:(0,i.__)("Threshold","newspack-plugin"),onChange:e=>u({...d,threshold:e}),disabled:t,help:(0,l.jsx)(w.ExternalLink,{href:"https://developers.google.com/recaptcha/docs/v3#interpreting_the_score",children:(0,i.__)("Learn more about the threshold value","newspack-plugin")})})]})]})})]})};var E=t(6154),T=t.n(E),A=t(6786),$=t(8351),P=t(5573);const L=(0,l.jsx)(P.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,l.jsx)(P.Path,{d:"M13 11.8l6.1-6.3-1-1-6.1 6.2-6.1-6.2-1 1 6.1 6.3-6.5 6.7 1 1 6.5-6.6 6.5 6.6 1-1z"})});var N=t(9214),F=t(8169),O=t(7677);const I=e=>{let n=e.slice(8);return e.length>45&&(n=`${e.slice(8,38)}...${e.slice(-10)}`),n},q=e=>{const{label:n,url:t}=e;return n||I(t)},R=e=>{const{label:n,url:t}=e;return(0,l.jsxs)(l.Fragment,{children:[n&&(0,l.jsx)("span",{className:"newspack-webhooks__endpoint__label",children:n}),(0,l.jsx)("span",{className:"newspack-webhooks__endpoint__url",children:I(t)})]})},M=e=>e.requests.some((e=>e.errors.length)),D=({disabled:e,position:n="bottom left",isSystem:t,onEdit:c=(()=>{}),onDelete:r=(()=>{}),onView:o=(()=>{})})=>{const[p,d]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{d(!1)}),[e]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.$n,{className:p&&"popover-active",onClick:()=>d(!p),icon:F.A,disabled:e,label:(0,i.__)("Endpoint Actions","newspack-plugin"),tooltipPosition:n}),p&&(0,l.jsxs)(a.AM,{position:n,onFocusOutside:()=>d(!1),onKeyDown:e=>k.ESCAPE===e.keyCode&&d(!1),children:[(0,l.jsx)(w.MenuItem,{onClick:()=>d(!1),className:"screen-reader-text",children:(0,i.__)("Close Endpoint Actions","newspack-plugin")}),(0,l.jsx)(w.MenuItem,{onClick:o,className:"newspack-button",children:(0,i.__)("View Requests","newspack-plugin")}),!t&&(0,l.jsx)(w.MenuItem,{onClick:c,className:"newspack-button",children:(0,i.__)("Edit","newspack-plugin")}),!t&&(0,l.jsx)(w.MenuItem,{onClick:r,className:"newspack-button",isDestructive:!0,children:(0,i.__)("Remove","newspack-plugin")})]})]})},B=({disabled:e,onConfirm:n,onClose:t,title:s,description:c})=>(0,l.jsxs)(a.aF,{title:s,onRequestClose:t,children:[(0,l.jsx)("p",{children:c}),(0,l.jsxs)(a.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,l.jsx)(a.$n,{isSecondary:!0,onClick:t,disabled:e,children:(0,i.__)("Cancel","newspack-plugin")}),(0,l.jsx)(a.$n,{isPrimary:!0,onClick:n,disabled:e,children:(0,i.__)("Confirm","newspack-plugin")})]})]}),H=()=>{const[e,n]=(0,s.useState)(!1),[t,c]=(0,s.useState)(!1),[r,p]=(0,s.useState)([]),[d,u]=(0,s.useState)([]),[h,_]=(0,s.useState)(!1),[g,k]=(0,s.useState)(!1),[x,m]=(0,s.useState)(!1),[v,j]=(0,s.useState)(!1),[b,f]=(0,s.useState)(!1),y=(0,s.useRef)(null),[C,S]=(0,s.useState)(!1),[E,P]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{o()({path:"/newspack/v1/data-events/actions"}).then((e=>{p(e)})).catch((e=>{c(e)}))}),[]),(0,s.useEffect)((()=>{n(!0),o()({path:"/newspack/v1/webhooks/endpoints"}).then((e=>{u(e)})).catch((e=>{c(e)})).finally((()=>{n(!1)}))}),[]),(0,s.useEffect)((()=>{S(!1),f(!1),P(!1)}),[v]),(0,s.useEffect)((()=>{b&&y?.current?.querySelector(".components-modal__content")?.scrollTo({top:0,left:0,behavior:"smooth"})}),[b]),(0,l.jsxs)(a.Zp,{noBorder:!0,className:"mt64",children:[!1!==t&&(0,l.jsx)(a.$T,{isError:!0,noticeText:t.message}),(0,l.jsxs)("div",{className:"flex justify-between items-end",children:[(0,l.jsx)(a.X3,{title:(0,i.__)("Webhook Endpoints","newspack-plugin"),description:(0,i.__)("Register webhook endpoints to integrate reader activity data to third-party services or private APIs","newspack-plugin"),noMargin:!0}),(0,l.jsx)(a.$n,{variant:"primary",onClick:()=>j({}),disabled:e,children:(0,i.__)("Add New Endpoint","newspack-plugin")})]}),d.length>0&&(0,l.jsx)(l.Fragment,{children:d.map((e=>(0,l.jsx)(a.Lz,{isMedium:!0,className:"newspack-webhooks__endpoint mt16",toggleChecked:!e.disabled,toggleOnChange:()=>k(e),title:R(e),disabled:e.system,description:()=>e.disabled&&e.disabled_error?(0,i.__)("This endpoint is disabled due to excessive request errors","newspack-plugin")+": "+e.disabled_error:(0,l.jsxs)(l.Fragment,{children:[(0,i.__)("Actions:","newspack-plugin")," ",e.actions.map((e=>(0,l.jsx)("span",{className:"newspack-webhooks__endpoint__action",children:e},e)))]}),actionText:(0,l.jsx)(D,{onEdit:()=>j(e),onDelete:()=>_(e),onView:()=>m(e),isSystem:e.system})},e.id)))}),!1!==h&&(0,l.jsx)(B,{title:(0,i.__)("Remove Endpoint","newspack-plugin"),description:(0,i.sprintf)(/* translators: %s: endpoint title */ /* translators: %s: endpoint title */
(0,i.__)("Are you sure you want to remove the endpoint %s?","newspack-plugin"),`"${I(h.url)}"`),onClose:()=>_(!1),onConfirm:()=>{return e=h,n(!0),void o()({path:`/newspack/v1/webhooks/endpoints/${e.id}`,method:"DELETE"}).then((e=>{u(e)})).catch((e=>{c(e)})).finally((()=>{n(!1),_(!1)}));var e},disabled:e}),!1!==g&&(0,l.jsx)(B,{title:g.disabled?(0,i.__)("Enable Endpoint","newspack-plugin"):(0,i.__)("Disable Endpoint","newspack-plugin"),description:g.disabled?(0,i.sprintf)(/* translators: %s: endpoint title */ /* translators: %s: endpoint title */
(0,i.__)("Are you sure you want to enable the endpoint %s?","newspack-plugin"),`"${I(g.url)}"`):(0,i.sprintf)(/* translators: %s: endpoint title */ /* translators: %s: endpoint title */
(0,i.__)("Are you sure you want to disable the endpoint %s?","newspack-plugin"),`"${I(g.url)}"`),endpoint:g,onClose:()=>k(!1),onConfirm:()=>{return e=g,n(!0),void o()({path:`/newspack/v1/webhooks/endpoints/${e.id}`,method:"POST",data:{disabled:!e.disabled}}).then((e=>{u(e)})).catch((e=>{c(e)})).finally((()=>{n(!1),k(!1)}));var e},disabled:e}),!1!==x&&(0,l.jsxs)(a.aF,{title:(0,i.__)("Latest Requests","newspack-plugin"),onRequestClose:()=>m(!1),children:[(0,l.jsx)("p",{children:(0,i.sprintf)(
// translators: %s is the endpoint title (shortened URL).
// translators: %s is the endpoint title (shortened URL).
(0,i.__)("Most recent requests for %s","newspack-plugin"),q(x))}),x.requests.length>0?(0,l.jsxs)("table",{className:"newspack-webhooks__requests "+(M(x)?"has-error":""),children:[(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{}),(0,l.jsx)("th",{colSpan:"2",children:(0,i.__)("Action","newspack-plugin")}),M(x)&&(0,l.jsx)("th",{colSpan:"2",children:(0,i.__)("Error","newspack-plugin")})]}),x.requests.map((e=>{return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:`status status--${e.status}`,children:(0,l.jsx)(O.A,{icon:(n=e.status,{pending:A.A,finished:$.A,killed:L}[n]||N.A)})}),(0,l.jsx)("td",{className:"action-name",children:e.action_name}),(0,l.jsx)("td",{className:"scheduled",children:"pending"===e.status?(0,i.sprintf)(
// translators: %s is a human-readable time difference.
// translators: %s is a human-readable time difference.
(0,i.__)("sending in %s","newspack-plugin"),T()(1e3*parseInt(e.scheduled)).fromNow(!0)):(0,i.sprintf)(
// translators: %s is a human-readable time difference.
// translators: %s is a human-readable time difference.
(0,i.__)("processed %s","newspack-plugin"),T()(1e3*parseInt(e.scheduled)).fromNow())}),M(x)&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("td",{className:"error",children:e.errors&&e.errors.length>0?e.errors[e.errors.length-1]:"--"}),(0,l.jsx)("td",{children:(0,l.jsx)("span",{className:"error-count",children:(0,i.sprintf)(
// translators: %s is the number of errors.
// translators: %s is the number of errors.
(0,i.__)("Attempt #%s","newspack-plugin"),e.errors.length)})})]})]},e.id);var n}))]}):(0,l.jsx)(a.$T,{noticeText:(0,i.__)("This endpoint hasn't received any requests yet.","newspack-plugin")})]}),!1!==v&&(0,l.jsxs)(a.aF,{ref:y,title:(0,i.__)("Webhook Endpoint","newspack-plugin"),onRequestClose:()=>{j(!1),f(!1)},children:[!1!==b&&(0,l.jsx)(a.$T,{isError:!0,noticeText:b.message}),!0===v.disabled&&(0,l.jsx)(a.$T,{noticeText:(0,i.__)("This webhook endpoint is currently disabled.","newspack-plugin"),className:"mt0"}),v.disabled&&v.disabled_error&&(0,l.jsx)(a.$T,{isError:!0,noticeText:(0,i.__)("Request Error: ","newspack-plugin")+v.disabled_error,className:"mt0"}),E&&(0,l.jsx)(a.$T,{isError:!0,noticeText:(0,i.__)("Test Error: ","newspack-plugin")+E.message,className:"mt0"}),(0,l.jsxs)(a.xA,{columns:1,gutter:16,className:"mt0",children:[(0,l.jsx)(a.xt,{label:(0,i.__)("URL","newspack-plugin"),help:(0,i.__)("The URL to send requests to. It's required for the URL to be under a valid TLS/SSL certificate. You can use the test button below to verify the endpoint response.","newspack-plugin"),className:"code",value:v.url,onChange:e=>j({...v,url:e}),disabled:e}),(0,l.jsx)(a.xt,{label:(0,i.__)("Authentication token (optional)","newspack-plugin"),help:(0,i.__)("If your endpoint requires a token authentication, enter it here. It will be sent as a Bearer token in the Authorization header.","newspack-plugin"),value:v.bearer_token,onChange:e=>j({...v,bearer_token:e}),disabled:e}),(0,l.jsxs)(a.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[C&&(0,l.jsxs)("div",{className:"newspack-webhooks__test-response status--"+(C.success?"success":"error"),children:[(0,l.jsx)("span",{className:"message",children:C.message}),(0,l.jsx)("span",{className:"code",children:C.code})]}),(0,l.jsx)(a.$n,{isSecondary:!0,onClick:()=>{return e=v.url,t=v.bearer_token,n(!0),P(!1),S(!1),void o()({path:"/newspack/v1/webhooks/endpoints/test",method:"POST",data:{url:e,bearer_token:t}}).then((e=>{S(e)})).catch((e=>{P(e)})).finally((()=>{n(!1)}));var e,t},disabled:e||!v.url,children:(0,i.__)("Send a test request","newspack-plugin")})]})]}),(0,l.jsx)("hr",{}),(0,l.jsx)(a.xt,{label:(0,i.__)("Label (optional)","newspack-plugin"),help:(0,i.__)("A label to help you identify this endpoint. It will not be sent to the endpoint.","newspack-plugin"),value:v.label,onChange:e=>j({...v,label:e}),disabled:e}),(0,l.jsxs)(a.xA,{columns:1,gutter:16,children:[(0,l.jsx)("h3",{children:(0,i.__)("Actions","newspack-plugin")}),r.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{children:(0,i.__)("Select which actions should trigger this endpoint:","newspack-plugin")}),(0,l.jsx)(a.xA,{columns:2,gutter:16,children:r.map(((n,t)=>(0,l.jsx)(w.CheckboxControl,{disabled:e,label:n,checked:v.actions&&v.actions.includes(n)||!1,onChange:()=>{const e=v.actions||[];e.includes(n)?e.splice(e.indexOf(n),1):e.push(n),j({...v,actions:e})}},t)))})]}),(0,l.jsx)(a.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:(0,l.jsx)(a.$n,{isPrimary:!0,onClick:()=>{var e;(e=>{const n=[];return e.url||n.push((0,i.__)("URL is required.","newspack-plugin")),e.actions&&e.actions.length||n.push((0,i.__)("At least one action is required.","newspack-plugin")),n.length?f({message:n.join(" ")}):f(!1),n})(e=v).length||(n(!0),o()({path:`/newspack/v1/webhooks/endpoints/${e.id||""}`,method:"POST",data:e}).then((e=>{u(e),j(!1)})).catch((e=>{f(e)})).finally((()=>{n(!1)})))},disabled:e,children:(0,i.__)("Save","newspack-plugin")})})]})]})]})},{HashRouter:z,Redirect:G,Route:V,Switch:J}=c.A,X=(0,a.c_)((()=>{const[e,n]=(0,s.useState)(),t=e=>t=>n(t?e+t:null);return(0,l.jsxs)(l.Fragment,{children:[e&&(0,l.jsx)(a.$T,{isError:!0,noticeText:e}),(0,l.jsx)(a.X3,{title:(0,i.__)("Plugins","newspack-plugin")}),(0,l.jsx)(_,{}),(0,l.jsx)(a.X3,{title:(0,i.__)("APIs","newspack-plugin")}),newspack_connections_data.can_connect_google&&(0,l.jsx)(g.A,{setError:t((0,i.__)("Google: ","newspack-plugin"))}),(0,l.jsx)(x,{setError:t((0,i.__)("Mailchimp: ","newspack-plugin"))}),newspack_connections_data.can_connect_fivetran&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.X3,{title:"Fivetran"}),(0,l.jsx)(y,{setError:t((0,i.__)("Fivetran: ","newspack-plugin"))})]}),(0,l.jsx)(C,{setError:t((0,i.__)("Jetpack SSO: ","newspack-plugin"))}),(0,l.jsx)(S,{setError:t((0,i.__)("reCAPTCHA: ","newspack-plugin"))}),newspack_connections_data.can_use_webhooks&&(0,l.jsx)(H,{})]})}));(0,s.render)((0,s.createElement)((0,a.Aq)((({pluginRequirements:e,wizardApiFetch:n,startLoading:t,doneLoading:s})=>{const a={headerText:(0,i.__)("Connections","newspack-plugin"),subHeaderText:(0,i.__)("Connections to third-party services","newspack-plugin"),wizardApiFetch:n,startLoading:t,doneLoading:s};return(0,l.jsx)(z,{hashType:"slash",children:(0,l.jsxs)(J,{children:[e,(0,l.jsx)(V,{exact:!0,path:"/",render:()=>(0,l.jsx)(X,{...a})}),(0,l.jsx)(G,{to:"/"})]})})}))),document.getElementById("newspack-connections-wizard"))},1609:e=>{e.exports=window.React},790:e=>{e.exports=window.ReactJSXRuntime},6154:e=>{e.exports=window.moment},1455:e=>{e.exports=window.wp.apiFetch},6427:e=>{e.exports=window.wp.components},7143:e=>{e.exports=window.wp.data},6087:e=>{e.exports=window.wp.element},2619:e=>{e.exports=window.wp.hooks},8537:e=>{e.exports=window.wp.htmlEntities},7723:e=>{e.exports=window.wp.i18n},8558:e=>{e.exports=window.wp.keycodes},5573:e=>{e.exports=window.wp.primitives},3832:e=>{e.exports=window.wp.url}},t={};function s(e){var i=t[e];if(void 0!==i)return i.exports;var a=t[e]={id:e,loaded:!1,exports:{}};return n[e].call(a.exports,a,a.exports,s),a.loaded=!0,a.exports}s.m=n,e=[],s.O=(n,t,i,a)=>{if(!t){var c=1/0;for(p=0;p<e.length;p++){for(var[t,i,a]=e[p],r=!0,o=0;o<t.length;o++)(!1&a||c>=a)&&Object.keys(s.O).every((e=>s.O[e](t[o])))?t.splice(o--,1):(r=!1,a<c&&(c=a));if(r){e.splice(p--,1);var l=i();void 0!==l&&(n=l)}}return n}a=a||0;for(var p=e.length;p>0&&e[p-1][2]>a;p--)e[p]=e[p-1];e[p]=[t,i,a]},s.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return s.d(n,{a:n}),n},s.d=(e,n)=>{for(var t in n)s.o(n,t)&&!s.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),s.j=178,(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var n=s.g.document;if(!e&&n&&(n.currentScript&&(e=n.currentScript.src),!e)){var t=n.getElementsByTagName("script");if(t.length)for(var i=t.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=t[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={178:0};s.O.j=n=>0===e[n];var n=(n,t)=>{var i,a,[c,r,o]=t,l=0;if(c.some((n=>0!==e[n]))){for(i in r)s.o(r,i)&&(s.m[i]=r[i]);if(o)var p=o(s)}for(n&&n(t);l<c.length;l++)a=c[l],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(p)},t=globalThis.webpackChunknewspack=globalThis.webpackChunknewspack||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})();var i=s.O(void 0,[223],(()=>s(5516)));i=s.O(i)})();