!function(){"use strict";var e,t={898:function(e,t,n){n.r(t),n(5674);var a=n(2628),r=n.n(a),o=n(9307),s=n(5736),l=n(264),i=n(9818),c=n(5609),p=n(7405);const u="wc",d="stripe",m="other",h="newspack-reader-revenue-wizard",w=s.__,g={once:{tieredLabel:w("One-time donations"),staticLabel:w("Suggested one-time donation amount")},month:{tieredLabel:w("Monthly donations"),staticLabel:w("Suggested donation amount per month")},year:{tieredLabel:w("Annual donations"),staticLabel:w("Suggested donation amount per year")}},k=Object.keys(g),b=()=>{const e=l.en.useWizardData("reader-revenue"),{updateWizardSettings:t}=(0,i.useDispatch)(l.en.STORE_NAMESPACE);if(!e.donation_data||"errors"in e.donation_data)return null;const{amounts:n,currencySymbol:a,tiered:r,disabledFrequencies:s,minimumDonation:u}=e.donation_data,d=e=>n=>t({slug:"newspack-reader-revenue-wizard",path:["donation_data",...e],value:n}),m=k.map((e=>({key:e,...g[e]}))),h=parseFloat(u);return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(l.Zb,{headerActions:!0,noBorder:!0},(0,o.createElement)(l.M$,{title:w("Suggested Donations","newspack"),description:w("Set suggested donation amounts. These will be the default settings for the Donate block.","newspack"),noMargin:!0}),(0,o.createElement)(l.Yw,{label:w("Donation Type","newspack"),onChange:()=>d(["tiered"])(!r),buttonOptions:[{value:!0,label:w("Tiered","newspack")},{value:!1,label:w("Untiered","newspack")}],buttonSmall:!0,value:r,hideLabelFromVision:!0})),r?(0,o.createElement)(l.rj,{columns:1,gutter:16},m.map((e=>{const t=s[e.key],r=Object.values(s).filter(Boolean).length===k.length-1;return(0,o.createElement)(l.Zb,{isMedium:!0,key:e.key},(0,o.createElement)(l.rj,{columns:1,gutter:16},(0,o.createElement)(c.ToggleControl,{checked:!t,onChange:()=>d(["disabledFrequencies",e.key])(!t),label:e.tieredLabel,disabled:!t&&r}),!t&&(0,o.createElement)(l.rj,{columns:3,rowGap:16},(0,o.createElement)(p.P,{currencySymbol:a,label:w("Low-tier"),error:n[e.key][0]<h?w("Warning: suggested donations should be at least the minimum donation amount.","newspack"):null,value:n[e.key][0],min:h,onChange:d(["amounts",e.key,0])}),(0,o.createElement)(p.P,{currencySymbol:a,label:w("Mid-tier"),error:n[e.key][1]<h?w("Warning: suggested donations should be at least the minimum donation amount.","newspack"):null,value:n[e.key][1],min:h,onChange:d(["amounts",e.key,1])}),(0,o.createElement)(p.P,{currencySymbol:a,label:w("High-tier"),error:n[e.key][2]<h?w("Warning: suggested donations should be at least the minimum donation amount.","newspack"):null,value:n[e.key][2],min:h,onChange:d(["amounts",e.key,2])}))))}))):(0,o.createElement)(l.Zb,{isMedium:!0},(0,o.createElement)(l.rj,{columns:3,rowGap:16},m.map((e=>(0,o.createElement)(p.P,{currencySymbol:a,label:e.staticLabel,value:n[e.key][3],min:h,error:n[e.key][3]<h?w("Warning: suggested donations should be at least the minimum donation amount.","newspack"):null,onChange:d(["amounts",e.key,3]),key:e.key}))))),(0,o.createElement)(l.Zb,{headerActions:!0,noBorder:!0},(0,o.createElement)(l.M$,{title:w("Minimum Donation","newspack"),description:w("Set minimum donation amount. Setting a reasonable minimum donation amount can help protect your site from bot attacks.","newspack"),noMargin:!0}),(0,o.createElement)(l.w4,{label:w("Minimum donation","newspack"),type:"number",min:1,value:h,onChange:e=>d(["minimumDonation"])(e)})))},E=()=>{const e=l.en.useWizardData("reader-revenue"),{updateWizardSettings:t}=(0,i.useDispatch)(l.en.STORE_NAMESPACE);if(!e.donation_data||"errors"in e.donation_data)return null;const n=e.available_billing_fields;if(!n||!Object.keys(n).length)return null;const a=e.donation_data.billingFields.length?e.donation_data.billingFields:Object.keys(n);return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(l.Zb,{noBorder:!0,headerActions:!0},(0,o.createElement)(l.M$,{title:w("Billing Fields","newspack"),description:w("Configure which billing fields should be rendered on the donation form.","newspack"),noMargin:!0})),(0,o.createElement)(l.rj,{columns:3,rowGap:16},Object.keys(n).map((e=>(0,o.createElement)(c.CheckboxControl,{key:e,label:n[e].label,checked:a.includes(e),disabled:"billing_email"===e,onChange:()=>{let n=[...a];var r;n=a.includes(e)?n.filter((t=>t!==e)):[...n,e],(r=["billingFields"],e=>t({slug:"newspack-reader-revenue-wizard",path:["donation_data",...r],value:e}))(n)}})))))};var f=()=>{const e=l.en.useWizardData("reader-revenue"),{saveWizardSettings:t}=(0,i.useDispatch)(l.en.STORE_NAMESPACE);return(0,o.createElement)(o.Fragment,null,e.donation_page&&(0,o.createElement)(o.Fragment,null,(0,o.createElement)(l.Zb,{noBorder:!0,headerActions:!0},(0,o.createElement)("h2",null,w("Donations Landing Page","newspack")),(0,o.createElement)(l.zx,{variant:"secondary",isSmall:!0,href:e.donation_page.editUrl,onClick:void 0},w("Edit Page"))),"publish"===e.donation_page.status?(0,o.createElement)(l.qX,{isSuccess:!0,noticeText:w("Your donations landing page is set up and published.","newspack")}):(0,o.createElement)(l.qX,{isError:!0,noticeText:w("Your donations landing page has been created, but is not yet published. You can now edit it and publish when you're ready.","newspack")})),(0,o.createElement)(b,null),(0,o.createElement)(E,null),(0,o.createElement)("div",{className:"newspack-buttons-card"},(0,o.createElement)(l.zx,{variant:"primary",onClick:()=>t({slug:h,section:"donations",payloadPath:["donation_data"]}),href:void 0},w("Save Settings"))))};const _=s.__;var y=()=>{const e=l.en.useWizardData("reader-revenue"),{updateWizardSettings:t,saveWizardSettings:n}=(0,i.useDispatch)(l.en.STORE_NAMESPACE),a=e=>n=>t({slug:h,path:["location_data",e],value:n});return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(l.rj,{columns:1,gutter:16},(0,o.createElement)(l.rj,{columns:1,gutter:16},(0,o.createElement)(l.w4,{label:_("Address","newspack"),value:e.location_data?.address1||"",onChange:a("address1")}),(0,o.createElement)(l.w4,{label:_("Address line 2","newspack"),value:e.location_data?.address2||"",onChange:a("address2")})),(0,o.createElement)(l.rj,{rowGap:16},(0,o.createElement)(l.w4,{label:_("City","newspack"),value:e.location_data?.city||"",onChange:a("city")}),(0,o.createElement)(l.w4,{label:_("Postcode / Zip","newspack"),value:e.location_data?.postcode||"",onChange:a("postcode")}),(0,o.createElement)(l.Yw,{label:_("Country","newspack"),value:e.location_data?.countrystate||"",options:e.country_state_fields||[],onChange:a("countrystate")}),(0,o.createElement)(l.Yw,{label:_("Currency","newspack"),value:e.location_data?.currency||"",options:e.currency_fields||[],onChange:a("currency")}))),(0,o.createElement)("div",{className:"newspack-buttons-card"},(0,o.createElement)(l.zx,{isPrimary:!0,onClick:()=>n({slug:h,section:"location",payloadPath:["location_data"]})},_("Save Settings"))))};const v=s.__;var S=()=>{const[e,t]=(0,o.useState)(null),n=l.en.useWizardData("reader-revenue"),{updateWizardSettings:a,saveWizardSettings:r}=(0,i.useDispatch)(l.en.STORE_NAMESPACE);(0,o.useEffect)((()=>{n?.platform_data?.donor_landing_page&&t(n.platform_data.donor_landing_page)}),[]);const s=(e,t)=>a({slug:h,path:["platform_data",e],value:t}),c=n?.platform_data||{};return(0,o.createElement)(l.fM,{hasGreyHeader:!0,isMedium:!0,title:v("News Revenue Hub Settings","newspack"),description:v("Configure your site’s connection to News Revenue Hub.","newspack"),actionContent:(0,o.createElement)(l.zx,{isPrimary:!0,onClick:()=>r({slug:h,payloadPath:["platform_data"]})},v("Save Settings"))},(0,o.createElement)("div",null,(0,o.createElement)(l.rj,{columns:3},(0,o.createElement)(l.w4,{label:v("Organization ID","newspack"),placeholder:"exampleid",value:c?.nrh_organization_id||"",onChange:e=>s("nrh_organization_id",e)}),(0,o.createElement)(l.w4,{label:v("Custom domain (optional)","newspack"),help:v("Enter the raw domain without protocol or slashes."),placeholder:"donate.example.com",value:c?.nrh_custom_domain||"",onChange:e=>s("nrh_custom_domain",e)}),(0,o.createElement)(l.w4,{label:v("Salesforce Campaign ID (optional)","newspack"),placeholder:"exampleid",value:c?.nrh_salesforce_campaign_id||"",onChange:e=>s("nrh_salesforce_campaign_id",e)}))),c.hasOwnProperty("donor_landing_page")&&(0,o.createElement)("div",null,(0,o.createElement)("hr",null),(0,o.createElement)("h3",null,v("Donor Landing Page","newspack")),(0,o.createElement)("p",{className:"components-base-control__help"},v("Set a page on your site as a donor landing page. Once a reader donates and lands on this page, they will be considered a donor.","newspack")),(0,o.createElement)(l.ah,{label:v("Search for a New Donor Landing Page","newspack"),help:v("Begin typing page title, click autocomplete result to select.","newspack"),onChange:e=>{if(!e||!e.length)return t(null),s("donor_landing_page",null);const n=e[0];return t(n),s("donor_landing_page",n)},postTypes:[{slug:"page",label:"Page"}],postTypeLabel:v("page","newspack"),postTypeLabelPlural:v("pages","newspack"),selectedItems:e?[e]:[]})))};const C=s.__;var T=()=>{const e=l.en.useWizardData("reader-revenue"),{saveWizardSettings:t,updateWizardSettings:n}=(0,i.useDispatch)(l.en.STORE_NAMESPACE);return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(l.Zb,{noBorder:!0},(0,o.createElement)(l.Yw,{label:C("Select Reader Revenue Platform","newspack"),value:e.platform_data?.platform,options:[{label:C("Other","newspack"),value:m},{label:C("Newspack","newspack"),value:u},{label:C("News Revenue Hub","newspack"),value:"nrh"},{label:C("Stripe","newspack"),value:d,disabled:!1===e.stripe_data?.can_use_stripe_platform}],onChange:e=>{t({slug:"newspack-reader-revenue-wizard",payloadPath:["platform_data"],updatePayload:{path:["platform_data","platform"],value:e}})}})),u===e.platform_data?.platform&&!e.plugin_status&&(0,o.createElement)(l.xf,{plugins:["woocommerce","woocommerce-subscriptions","woocommerce-name-your-price","woocommerce-gateway-stripe"],onStatus:e=>{let{complete:t}=e;t&&n({slug:"newspack-reader-revenue-wizard",path:["plugin_status"],value:!0})},withoutFooterButton:!0}))},P=n(1609),x=n.n(P),A=n(6989),z=n.n(A);const O=s.__;var N=e=>{let{listId:t,onChange:n}=e;const[a,r]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{z()({path:"/newspack/v1/wizard/newspack-engagement-wizard/newsletters/lists"}).then(r).catch((e=>{r({error:e})}))}),[]),!1===a?(0,o.createElement)(l.Pi,null):a.error?(0,o.createElement)(l.qX,{isError:!0,noticeText:a.error.message}):(0,o.createElement)(o.Fragment,null,(0,o.createElement)(l.qX,{noticeText:(0,o.createElement)("span",null,O("You can configure Newsletters in the","newspack")," ",(0,o.createElement)("a",{href:"/wp-admin/admin.php?page=newspack-engagement-wizard#/newsletters"},O("Engagement Wizard","newspack")),".")}),(0,o.createElement)(c.SelectControl,{value:t,label:O("Chosen list","newspack"),options:[{value:"",label:O("-- Choose a list --","newspack")},...a.map((e=>({value:e.id,label:e.name})))],onChange:n}))};const M=s.__,{SettingsCard:D}=l.Zr,F=e=>{let{data:t,changeHandler:n}=e;return(0,o.createElement)(D,{title:M("Transaction Fees","newspack-plugin"),description:M("If you have a non-default or negotiated fee with Stripe, update its parameters here.","newspack-plugin"),columns:1,noBorder:!0},(0,o.createElement)(l.rj,{noMargin:!0,rowGap:16},(0,o.createElement)(l.w4,{type:"number",step:"0.1",value:t.fee_multiplier,label:M("Fee multiplier","newspack-plugin"),onChange:n("fee_multiplier")}),(0,o.createElement)(l.w4,{type:"number",step:"0.1",value:t.fee_static,label:M("Fee static portion","newspack-plugin"),onChange:n("fee_static")})))},W=()=>{const e=l.en.useWizardData("reader-revenue"),{testMode:t=!1,publishableKey:n="",secretKey:a="",testPublishableKey:r="",testSecretKey:s=""}=e.stripe_data||{},{updateWizardSettings:p}=(0,i.useDispatch)(l.en.STORE_NAMESPACE),u=e=>t=>p({slug:h,path:["stripe_data",e],value:t});return(0,o.createElement)(l.rj,{columns:1,gutter:16},(0,o.createElement)(l.rj,{columns:1,gutter:16},(0,o.createElement)("p",{className:"newspack-payment-setup-screen__api-keys-instruction"},M("Configure Stripe and enter your API keys","newspack-plugin")," – ",(0,o.createElement)(c.ExternalLink,{href:"https://stripe.com/docs/keys#api-keys"},M("learn how"))),(0,o.createElement)(c.CheckboxControl,{label:M("Use Stripe in test mode","newspack-plugin"),checked:t,onChange:u("testMode"),help:M("Test mode will not capture real payments. Use it for testing your purchase flow.","newspack-plugin")})),(0,o.createElement)(l.rj,{noMargin:!0,rowGap:16},t?(0,o.createElement)(o.Fragment,null,(0,o.createElement)(l.w4,{type:"password",value:r,label:M("Test Publishable Key","newspack-plugin"),onChange:u("testPublishableKey")}),(0,o.createElement)(l.w4,{type:"password",value:s,label:M("Test Secret Key","newspack-plugin"),onChange:u("testSecretKey")})):(0,o.createElement)(o.Fragment,null,(0,o.createElement)(l.w4,{type:"password",value:n,label:M("Publishable Key","newspack-plugin"),onChange:u("publishableKey")}),(0,o.createElement)(l.w4,{type:"password",value:a,label:M("Secret Key","newspack-plugin"),onChange:u("secretKey")}))))};var j=()=>{const{stripe_data:e={},platform_data:t,is_ssl:n,currency_fields:a=[],country_state_fields:r=[],errors:s=[]}=l.en.useWizardData("reader-revenue"),p=t?.platform===d,{updateWizardSettings:u}=(0,i.useDispatch)(l.en.STORE_NAMESPACE),m=e=>t=>u({slug:h,path:["stripe_data",e],value:t}),{saveWizardSettings:w}=(0,i.useDispatch)(l.en.STORE_NAMESPACE);return(0,o.createElement)(o.Fragment,null,s.length>0&&s.map(((e,t)=>(0,o.createElement)(l.qX,{isError:!0,key:t,noticeText:(0,o.createElement)("span",null,e.message)}))),!1===n&&(0,o.createElement)(l.qX,{isWarning:!0,noticeText:(0,o.createElement)("a",{href:"https://stripe.com/docs/security/guide"},M("This site does not use SSL. The page hosting the Stipe integration should be secured with SSL.","newspack-plugin"))}),p?(0,o.createElement)(o.Fragment,null,!x()(e.connection_error)&&(0,o.createElement)(l.qX,{isError:!0,noticeText:e.connection_error}),(0,o.createElement)(D,{title:M("Settings","newspack-plugin"),columns:1,gutter:16,noBorder:!0},!1===e.can_use_stripe_platform&&(0,o.createElement)(l.qX,{isError:!0,noticeText:M("The Stripe platform will not work properly on this site.","newspack-plugin")}),(0,o.createElement)(W,null),(0,o.createElement)(l.rj,{rowGap:16},(0,o.createElement)(l.Yw,{label:M("Country","newspack-plugin"),value:e.location_code,options:r,onChange:m("location_code")}),(0,o.createElement)(l.Yw,{label:M("Currency","newspack-plugin"),value:e.currency,options:a,onChange:m("currency")}))),(0,o.createElement)(D,{title:M("Newsletters","newspack-plugin"),description:M("Allow donors to sign up to your newsletter when donating.","newspack-plugin"),columns:1,gutter:16,noBorder:!0},(0,o.createElement)(N,{listId:e.newsletter_list_id,onChange:m("newsletter_list_id")})),(0,o.createElement)(F,{data:e,changeHandler:m})):(0,o.createElement)(o.Fragment,null,(0,o.createElement)(l.rj,null,(0,o.createElement)(c.ToggleControl,{label:M("Enable Stripe","newspack-plugin"),checked:e.enabled,onChange:m("enabled")})),e.enabled?(0,o.createElement)(o.Fragment,null,(0,o.createElement)(W,null),(0,o.createElement)(F,{data:e,changeHandler:m}),(0,o.createElement)(l.rj,{columns:2},(0,o.createElement)(c.CheckboxControl,{label:M("Allow donors to cover transaction fees","newspack-plugin"),checked:e.allow_covering_fees,onChange:m("allow_covering_fees"),help:M("If checked, the donors will be able to cover Stripe's transaction fees.","newspack-plugin")}),(0,o.createElement)(c.CheckboxControl,{label:M("Enable covering fees by default","newspack-plugin"),checked:e.allow_covering_fees_default,onChange:m("allow_covering_fees_default"),help:M("If checked, the option to cover transaction fees will be checked by default.","newspack-plugin")})),(0,o.createElement)(l.w4,{value:e.allow_covering_fees_label,label:M("Custom message","newspack-plugin"),placeholder:M("A message to explain the transaction fee option (optional).","newspack-plugin"),onChange:m("allow_covering_fees_label")})):(0,o.createElement)(l.rj,null,(0,o.createElement)("p",{className:"newspack-payment-setup-screen__info"},M("Other gateways can be enabled and set up in the ","newspack-plugin"),(0,o.createElement)(c.ExternalLink,{href:"/wp-admin/admin.php?page=wc-settings&tab=checkout"},M("WooCommerce payment gateway settings","newspack-plugin"))))),(0,o.createElement)("div",{className:"newspack-buttons-card"},(0,o.createElement)(l.zx,{isPrimary:!0,onClick:()=>w({slug:h,section:"stripe",payloadPath:["stripe_data"]})},M("Save Settings","newspack-plugin"))),p&&(0,o.createElement)(l.fM,{title:M("Webhooks","newspack-plugin"),titleLink:"#/stripe-webhooks",href:"#/stripe-webhooks",description:M("Manage the webhooks Stripe uses to communicate with your site.","newspack-plugin"),actionText:M("Edit","newspack-plugin")}))},L=n(4184),R=n.n(L);const q=s.__,B=e=>{let{title:t,webhooks:n,onUpdate:a,withBorder:r,className:s}=e;const{wizardApiFetch:p}=(0,i.useDispatch)(l.en.STORE_NAMESPACE),u=(0,i.useSelect)((e=>e(l.en.STORE_NAMESPACE).isQuietLoading())),d=(e,t,n)=>{const r={path:`/newspack/v1/stripe/webhook/${e.id}`,method:t,data:n,isQuietFetch:!0};n&&(r.data=n),p(r).then(a(t))};return(0,o.createElement)("div",{className:R()(s,"newspack-webhooks-list",{"newspack-webhooks-list--border":r})},"function"==typeof t&&(0,o.createElement)("div",{className:"newspack-webhooks-list__title"},t()),(0,o.createElement)("ul",null,n.map((e=>(0,o.createElement)("li",{key:e.id},(0,o.createElement)("span",null,(0,o.createElement)(c.ToggleControl,{checked:"enabled"===e.status,disabled:u,onChange:()=>d(e,"POST",{status:"enabled"===e.status?"disabled":"enabled"})}),(0,o.createElement)("code",{className:"mr3"},e.url)),(0,o.createElement)(l.zx,{isDestructive:!0,isLink:!0,disabled:u,onClick:()=>{l.P6.confirmAction(q("Are you sure you want to remove this webhook?","newspack"))&&d(e,"DELETE")}},q("Delete","newspack")))))))};var H=()=>{const[e,t]=(0,o.useState)([]),{wizardApiFetch:n}=(0,i.useDispatch)(l.en.STORE_NAMESPACE);(0,o.useEffect)((()=>{n({path:"/newspack/v1/stripe/webhooks"}).then(t)}),[]);const[a,r]=e.reduce(((e,t)=>(t.matches_url?e[0].push(t):e[1].push(t),e)),[[],[]]),s=a.filter((e=>"enabled"===e.status)),p=n=>a=>{let r=e;switch(n){case"POST":r=e.map((e=>a.id===e.id?a:e));break;case"DELETE":r=e.filter((e=>a.id!==e.id))}t(r)};return(0,o.createElement)("div",{className:"newspack-payment-setup-screen__webhooks"},s.length>1&&(0,o.createElement)(l.qX,{isError:!0,noticeText:q("There are too many webhoooks for this site. Please delete or disable the extra ones.","newspack")}),0===s.length&&(0,o.createElement)(l.qX,{isError:!0,noticeText:q("There are no active webhoooks for this site.","newspack")}),(0,o.createElement)(l.fM,{title:q("Webhooks","newspack"),className:"newspack-settings__no-border",description:q("Manage the webhooks Stripe uses to communicate with your site.","newspack")}),(0,o.createElement)(B,{withBorder:!0,className:"mb4",title:()=>(0,o.createElement)("div",{className:"flex justify-between items-center"},(0,o.createElement)("h4",{className:"b f6 ma0"},q("Webhooks connected to this site","newspack")),(0,o.createElement)(l.zx,{variant:"secondary",isSmall:!0,onClick:()=>{l.P6.confirmAction(q("Are you sure you want to reset all webhooks connected to this site?","newspack"))&&n({path:"/newspack/v1/stripe/reset-webhook",method:"DELETE",isQuietFetch:!0}).then(t)}},q("Reset","newspack"))),webhooks:a,onUpdate:p}),r.length?(0,o.createElement)(l.UQ,{title:q("Webhooks not connected to this site","newspack")},(0,o.createElement)(B,{webhooks:r,onUpdate:p})):null,(0,o.createElement)("div",{className:"newspack-buttons-card"},(0,o.createElement)(l.zx,{href:"#/stripe-setup",isPrimary:!0},q("Back to Stripe Settings","newspack")),(0,o.createElement)(c.ExternalLink,{href:"https://dashboard.stripe.com/webhooks"},q("Stripe Dashboard","newspack"))))},X=n(7462);const I=s.__,U=r()(newspack_reader_revenue.emails),K=newspack_reader_revenue.email_cpt;var Y=()=>{const[e,t]=(0,o.useState)(null),[n,a]=(0,o.useState)(!1),[r,s]=(0,o.useState)(!1),[i,c]=(0,o.useState)(U);return!1===e?(0,o.createElement)(o.Fragment,null,(0,o.createElement)(l.qX,{isError:!0},I("Newspack uses Newspack Newsletters to handle editing email-type content. Please activate this plugin to proceed.","newspack")),(0,o.createElement)(l.qX,{isError:!0},I("Until this feature is configured, default receipts will be used.","newspack")),(0,o.createElement)(l.xf,{style:e?{display:"none"}:{},plugins:["newspack-newsletters"],onStatus:e=>t(e.complete),onInstalled:()=>window.location.reload(),withoutFooterButton:!0})):(0,o.createElement)(o.Fragment,null,i.map((e=>{const t="publish"===e.status;return(0,o.createElement)(l.fM,(0,X.Z)({key:e.post_id,disabled:r,title:e.label,titleLink:e.edit_link,href:e.edit_link,description:e.description,actionText:I("Edit","newspack"),toggleChecked:t,toggleOnChange:t=>{return n=e.post_id,r=t?"publish":"draft",a(!1),s(!0),void z()({path:`/wp/v2/${K}/${n}`,method:"post",data:{status:r}}).then((()=>{c(i.map((e=>e.post_id===n?{...e,status:r}:e)))})).catch(a).finally((()=>s(!1)));var n,r}},t?{}:{notification:I("This email is not active. The default receipt will be used.","newspack"),notificationLevel:"info"}),n&&(0,o.createElement)(l.qX,{noticeText:n?.message||I("Something went wrong.","newspack"),isError:!0}))})))},G=n(129),Z=n(6483);const $=s.__;var Q=()=>{const{salesforce_redirect_url:e}=window?.newspack_reader_revenue||{},[t,n]=(0,o.useState)(!1),{salesforce_settings:a={}}=l.en.useWizardData("reader-revenue"),[r,s]=(0,o.useState)(a.refresh_token),[p,u]=(0,o.useState)(null),{saveWizardSettings:d,wizardApiFetch:m}=(0,i.useDispatch)(l.en.STORE_NAMESPACE);return(0,o.useEffect)((()=>{const t=(0,G.parse)(window.location.search).code;t&&(window.history.replaceState({},"",e),(async t=>{try{const n=await m({path:"/newspack/salesforce/v1/tokens",method:"POST",data:{code:t,redirect_uri:e}}),{access_token:a,client_id:r,client_secret:o,instance_url:l,refresh_token:i}=n;a&&i&&d({slug:h,section:"salesforce",payloadPath:["salesforce_settings"],updatePayload:{path:["salesforce_settings"],value:{access_token:a,client_id:r,client_secret:o,instance_url:l,refresh_token:i}}}),s(!0)}catch(e){u($("We couldn’t establish a connection to Salesforce. Please verify your Consumer Key and Secret and try connecting again.","newspack"))}})(t))}),[]),(0,o.useEffect)((()=>{r?(async()=>{const e=await m({path:"/newspack/salesforce/v1/connection-status",method:"POST",isQuietFetch:!0});e.error&&u(e.error)})():u(null)}),[r]),(0,o.createElement)(o.Fragment,null,(0,o.createElement)(l.d5,{afterUpdate:t=>{let n,a;if((t?.salesforce||[]).forEach((e=>{"newspack_salesforce_client_id"===e.key?n=e.value:"newspack_salesforce_client_secret"===e.key&&(a=e.value)})),n&&a&&e){const t=(0,Z.addQueryArgs)("https://login.salesforce.com/services/oauth2/authorize",{response_type:"code",client_id:encodeURIComponent(n),client_secret:encodeURIComponent(a),redirect_uri:encodeURI(e)});window.location.assign(t)}else s(!1)},pluginSlug:"newspack/salesforce",title:$("Salesforce Settings","newspack"),description:()=>(0,o.createElement)(o.Fragment,null,p&&(0,o.createElement)(l.qX,{noticeText:p,isWarning:!0}),r&&!p&&(0,o.createElement)(l.qX,{noticeText:$("Your site is connected to Salesforce.","newspack"),isSuccess:!0}),$("Establish a connection to sync WooCommerce order data to Salesforce. To connect with Salesforce, create or choose a Connected App for this site in your Salesforce dashboard. Make sure to paste the full URL for this page (","newspack"),(0,o.createElement)(c.ClipboardButton,{className:"newspack-button is-link",text:e,onCopy:()=>n(!0),onFinishCopy:()=>n(!1)},$(t?"copied to clipboard!":"copy to clipboard","newspack")),$(") into the “Callback URL” field in the Connected App’s settings. ","newspack"),(0,o.createElement)(c.ExternalLink,{href:"https://help.salesforce.com/articleView?id=connected_app_create.htm"},$("Learn how to create a Connected App","newspack")))}))};const V=s.__;(0,o.render)((0,o.createElement)((()=>{const{platform_data:e,plugin_status:t,donation_data:n}=l.en.useWizardData("reader-revenue"),a=e?.platform,s={label:V("Platform","newspack"),path:"/",render:T};let i=[{label:V("Donations","newspack"),path:"/donations",render:f,isHidden:a===m},{label:V(a===u?"Stripe Gateway":"Stripe Settings","newspack"),path:"/stripe-setup",activeTabPaths:["/stripe-setup","/stripe-webhooks"],render:j,isHidden:a!==u&&a!==d},{label:V("Stripe Webhooks","newspack"),path:"/stripe-webhooks",render:H,isHidden:a!==d,isHiddenInTabbedNavigation:!0},{label:V("Emails","newspack"),path:"/emails",render:Y,isHidden:a!==u&&a!==d},{label:V("Address","newspack"),path:"/location-setup",render:y,isHidden:a!==u},{label:V("Salesforce","newspack"),path:"/salesforce",render:Q,isHidden:a!==u},{label:V("News Revenue Hub Settings","newspack"),path:"/settings",render:S,isHidden:"nrh"!==a},s];return a!==u||t||(i=[s]),(0,o.createElement)(l.en,{headerText:V("Reader Revenue","newspack"),subHeaderText:V("Generate revenue from your customers","newspack"),sections:i,apiSlug:h,renderAboveSections:()=>r()(n?.errors).map(((e,t)=>(0,o.createElement)(l.qX,{key:t,isError:!0,noticeText:e}))),requiredPlugins:["newspack-blocks"]})})),document.getElementById("newspack-reader-revenue-wizard"))},9196:function(e){e.exports=window.React},6292:function(e){e.exports=window.moment},6989:function(e){e.exports=window.wp.apiFetch},5609:function(e){e.exports=window.wp.components},9818:function(e){e.exports=window.wp.data},9307:function(e){e.exports=window.wp.element},2694:function(e){e.exports=window.wp.hooks},2629:function(e){e.exports=window.wp.htmlEntities},5736:function(e){e.exports=window.wp.i18n},9630:function(e){e.exports=window.wp.keycodes},444:function(e){e.exports=window.wp.primitives},6483:function(e){e.exports=window.wp.url}},n={};function a(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(o.exports,o,o.exports,a),o.loaded=!0,o.exports}a.m=t,e=[],a.O=function(t,n,r,o){if(!n){var s=1/0;for(p=0;p<e.length;p++){n=e[p][0],r=e[p][1],o=e[p][2];for(var l=!0,i=0;i<n.length;i++)(!1&o||s>=o)&&Object.keys(a.O).every((function(e){return a.O[e](n[i])}))?n.splice(i--,1):(l=!1,o<s&&(s=o));if(l){e.splice(p--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var p=e.length;p>0&&e[p-1][2]>o;p--)e[p]=e[p-1];e[p]=[n,r,o]},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},a.j=359,function(){var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e}(),function(){var e={359:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,o,s=n[0],l=n[1],i=n[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(r in l)a.o(l,r)&&(a.m[r]=l[r]);if(i)var p=i(a)}for(t&&t(n);c<s.length;c++)o=s[c],a.o(e,o)&&e[o]&&e[o][0](),e[s[c]]=0;return a.O(p)},n=self.webpackChunkwebpack=self.webpackChunkwebpack||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var r=a.O(void 0,[351],(function(){return a(898)}));r=a.O(r);var o=window;for(var s in r)o[s]=r[s];r.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})}();