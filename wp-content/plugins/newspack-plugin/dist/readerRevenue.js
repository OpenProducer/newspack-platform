!function(){"use strict";var e,t={3437:function(e,t,n){n.r(t),n(5674);var a=n(2819),r=n(9307),o=n(5736),s=n(4009),l=n(9818),i=n(7405);const c="wc",u="stripe",d="newspack-reader-revenue-wizard",p=o.__,m=()=>{const e=s.en.useWizardData("reader-revenue"),{suggestedAmounts:t=[0,0,0],suggestedAmountUntiered:n=0,currencySymbol:a="$",tiered:o=!1}=e.donation_data||{},{updateWizardSettings:c}=(0,l.useDispatch)(s.en.STORE_NAMESPACE),u=e=>t=>c({slug:"newspack-reader-revenue-wizard",path:["donation_data",...e],value:t});return(0,r.createElement)(r.Fragment,null,(0,r.createElement)("h2",null,p("Suggested donations")),(0,r.createElement)("p",null,p("Set suggested monthly donation amounts. The one-time and annual suggested donation amount will be adjusted according to the monthly amount.")),(0,r.createElement)(s.hp,{label:p("Set exact monthly donation tiers"),checked:o,onChange:u(["tiered"])}),o?(0,r.createElement)(s.rj,{columns:3,gutter:8},(0,r.createElement)(i.P,{currencySymbol:a,label:p("Low-tier"),value:t[0],onChange:u(["suggestedAmounts",0])}),(0,r.createElement)(i.P,{currencySymbol:a,label:p("Mid-tier"),value:t[1],onChange:u(["suggestedAmounts",1])}),(0,r.createElement)(i.P,{currencySymbol:a,label:p("High-tier"),value:t[2],onChange:u(["suggestedAmounts",2])})):(0,r.createElement)(i.P,{currencySymbol:a,label:p("Suggested donation amount per month"),value:n,onChange:u(["suggestedAmountUntiered"])}))};var w=()=>{const e=s.en.useWizardData("reader-revenue"),{saveWizardSettings:t}=(0,l.useDispatch)(s.en.STORE_NAMESPACE);return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(s.rj,null,e.donation_page&&(0,r.createElement)(s.Zb,{noBorder:!0},(0,r.createElement)("h2",null,p("Donations landing page")),"publish"===e.donation_page.status?(0,r.createElement)(s.qX,{isSuccess:!0,noticeText:p("Your donations landing page is set up and published.")}):(0,r.createElement)(s.qX,{isError:!0,noticeText:p("Your donations landing page has been created, but is not yet published. You can now edit it and publish when you're ready.")}),(0,r.createElement)(s.zx,{isSecondary:!0,href:e.donation_page.editUrl},p("Edit Page"))),(0,r.createElement)(s.Zb,{noBorder:!0},(0,r.createElement)(m,null))),(0,r.createElement)("div",{className:"newspack-buttons-card"},(0,r.createElement)(s.zx,{isPrimary:!0,onClick:()=>t({slug:d,section:"donations",payloadPath:["donation_data"]})},p("Save Settings"))))};const h=o.__;var g=()=>{var e,t,n,a,o,i;const c=s.en.useWizardData("reader-revenue"),{updateWizardSettings:u,saveWizardSettings:p}=(0,l.useDispatch)(s.en.STORE_NAMESPACE),m=e=>t=>u({slug:d,path:["location_data",e],value:t});return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(s.Yw,{label:h("Where is your business based?"),value:(null===(e=c.location_data)||void 0===e?void 0:e.countrystate)||"",options:c.country_state_fields||[],onChange:m("countrystate")}),(0,r.createElement)(s.w4,{label:h("Address"),value:(null===(t=c.location_data)||void 0===t?void 0:t.address1)||"",onChange:m("address1")}),(0,r.createElement)(s.w4,{label:h("Address line 2"),value:(null===(n=c.location_data)||void 0===n?void 0:n.address2)||"",onChange:m("address2")}),(0,r.createElement)(s.w4,{label:h("City"),value:(null===(a=c.location_data)||void 0===a?void 0:a.city)||"",onChange:m("city")}),(0,r.createElement)(s.w4,{label:h("Postcode / Zip"),value:(null===(o=c.location_data)||void 0===o?void 0:o.postcode)||"",onChange:m("postcode")}),(0,r.createElement)(s.Yw,{label:"Which currency does your business use?",value:(null===(i=c.location_data)||void 0===i?void 0:i.currency)||"",options:c.currency_fields||[],onChange:m("currency")}),(0,r.createElement)("div",{className:"newspack-buttons-card"},(0,r.createElement)(s.zx,{isPrimary:!0,onClick:()=>p({slug:d,section:"location",payloadPath:["location_data"]})},h("Save Settings"))))};const E=o.__;var v=()=>{var e,t;const n=s.en.useWizardData("reader-revenue"),{updateWizardSettings:a,saveWizardSettings:o}=(0,l.useDispatch)(s.en.STORE_NAMESPACE),i=e=>t=>a({slug:d,path:["platform_data",e],value:t});return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(s.rj,null,(0,r.createElement)(s.w4,{label:E("NRH Organization ID (required)","newspack"),value:(null===(e=n.platform_data)||void 0===e?void 0:e.nrh_organization_id)||"",onChange:i("nrh_organization_id")}),(0,r.createElement)(s.w4,{label:E("NRH Salesforce Campaign ID","newspack"),value:(null===(t=n.platform_data)||void 0===t?void 0:t.nrh_salesforce_campaign_id)||"",onChange:i("nrh_salesforce_campaign_id")})),(0,r.createElement)("div",{className:"newspack-buttons-card"},(0,r.createElement)(s.zx,{isPrimary:!0,onClick:()=>o({slug:d,payloadPath:["platform_data"]})},E("Update"))))};const f=o.__;var _=()=>{var e,t,n;const a=s.en.useWizardData("reader-revenue"),{saveWizardSettings:o,updateWizardSettings:i}=(0,l.useDispatch)(s.en.STORE_NAMESPACE);return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(s.rj,null,(0,r.createElement)(s.Yw,{label:f("Select Reader Revenue Platform","newspack"),value:null===(e=a.platform_data)||void 0===e?void 0:e.platform,options:[{label:f("Newspack","newspack"),value:c},{label:f("News Revenue Hub","newspack"),value:"nrh"},{label:f("Stripe","newspack"),value:u,disabled:!1===(null===(t=a.stripe_data)||void 0===t?void 0:t.can_use_stripe_platform)}],onChange:e=>{o({slug:"newspack-reader-revenue-wizard",payloadPath:["platform_data"],updatePayload:{path:["platform_data","platform"],value:e}})}})),c===(null===(n=a.platform_data)||void 0===n?void 0:n.platform)&&!a.plugin_status&&(0,r.createElement)(s.xf,{plugins:["woocommerce","woocommerce-subscriptions","woocommerce-name-your-price","woocommerce-gateway-stripe"],onStatus:e=>{let{complete:t}=e;t&&i({slug:"newspack-reader-revenue-wizard",path:["plugin_status"],value:!0})},withoutFooterButton:!0}))},b=n(5609),y=n(6989),k=n.n(y);const S=o.__;var C=e=>{let{listId:t,onChange:n}=e;const[a,o]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{k()({path:"/newspack/v1/wizard/newspack-engagement-wizard/newsletters/lists"}).then(o).catch((e=>{o({error:e})}))}),[]),!1===a?(0,r.createElement)(s.Pi,null):a.error?(0,r.createElement)(s.qX,{isError:!0,noticeText:a.error.message}):(0,r.createElement)(r.Fragment,null,(0,r.createElement)(s.qX,{noticeText:(0,r.createElement)("span",null,S("You can configure Newsletters in the","newspack")," ",(0,r.createElement)("a",{href:"/wp-admin/admin.php?page=newspack-engagement-wizard#/newsletters"},S("Engagement Wizard","newspack")),".")}),(0,r.createElement)(s.Yw,{value:t,label:S("Chosen list","newspack"),options:[{value:"",label:S("-- Choose a list --","newspack")},...a.map((e=>({value:e.id,label:e.name})))],onChange:n}))};const x=o.__,{SettingsCard:P}=s.Zr,z=()=>{const e=s.en.useWizardData("reader-revenue"),{testMode:t=!1,publishableKey:n="",secretKey:a="",testPublishableKey:o="",testSecretKey:i=""}=e.stripe_data||{},{updateWizardSettings:c}=(0,l.useDispatch)(s.en.STORE_NAMESPACE),u=e=>t=>c({slug:d,path:["stripe_data",e],value:t});return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(s.Zb,{noBorder:!0},(0,r.createElement)("p",{className:"newspack-payment-setup-screen__api-keys-instruction"},x("Configure Stripe and enter your API keys","newspack")," – ",(0,r.createElement)(b.ExternalLink,{href:"https://stripe.com/docs/keys#api-keys"},x("learn how"))),(0,r.createElement)(s.Z8,{label:x("Use Stripe in test mode"),checked:t,onChange:u("testMode"),tooltip:"Test mode will not capture real payments. Use it for testing your purchase flow."})),(0,r.createElement)(s.rj,{noMargin:!0},t?(0,r.createElement)(r.Fragment,null,(0,r.createElement)(s.w4,{type:"password",value:o,label:x("Test Publishable Key"),onChange:u("testPublishableKey")}),(0,r.createElement)(s.w4,{type:"password",value:i,label:x("Test Secret Key"),onChange:u("testSecretKey")})):(0,r.createElement)(r.Fragment,null,(0,r.createElement)(s.w4,{type:"password",value:n,label:x("Publishable Key"),onChange:u("publishableKey")}),(0,r.createElement)(s.w4,{type:"password",value:a,label:x("Secret Key"),onChange:u("secretKey")}))))};var T=()=>{var e,t;const{stripe_data:n={},platform_data:o,is_ssl:i,currency_fields:c=[],country_state_fields:p=[]}=s.en.useWizardData("reader-revenue"),[m,w]=(0,r.useState)(!1),h=(null==o?void 0:o.platform)===u,{updateWizardSettings:g}=(0,l.useDispatch)(s.en.STORE_NAMESPACE),E=e=>t=>g({slug:d,path:["stripe_data",e],value:t}),{saveWizardSettings:v}=(0,l.useDispatch)(s.en.STORE_NAMESPACE);return(0,r.createElement)(r.Fragment,null,!1===i&&(0,r.createElement)(s.qX,{isWarning:!0,noticeText:(0,r.createElement)("a",{href:"https://stripe.com/docs/security/guide"},x("This site does not use SSL. The page hosting the Stipe integration should be secured with SSL.","newspack"))}),h?(0,r.createElement)(r.Fragment,null,!1!==n.connection_error&&(0,r.createElement)(s.qX,{isError:!0,noticeText:n.connection_error}),(0,r.createElement)(P,{title:x("Settings","newspack"),columns:1},!1===n.can_use_stripe_platform&&(0,r.createElement)(s.qX,{isError:!0,noticeText:x("The Stripe platform will not work properly on this site.","newspack")}),(0,r.createElement)(z,null),(0,r.createElement)(s.Yw,{label:x("Which currency does your business use?","newspack"),value:n.currency,options:c,onChange:E("currency")}),(0,r.createElement)(s.Yw,{label:x("Where is your business based?"),value:n.location_code,options:p,onChange:E("location_code")})),(0,r.createElement)(P,{title:x("Newsletters","newspack"),description:x("Allow donors to sign up to your newsletter when donating.","newspack"),columns:1},(0,r.createElement)(C,{listId:n.newsletter_list_id,onChange:E("newsletter_list_id")})),(0,r.createElement)(P,{title:x("Fee","newspack"),description:x("If you have a non-default or negotiated fee with Stripe, update its parameters here.","newspack"),columns:1},(0,r.createElement)(s.rj,{noMargin:!0},(0,r.createElement)(s.w4,{type:"number",step:"0.1",value:n.fee_multiplier,label:x("Fee multiplier"),onChange:E("fee_multiplier")}),(0,r.createElement)(s.w4,{type:"number",step:"0.1",value:n.fee_static,label:x("Fee static portion"),onChange:E("fee_static")}))),(0,r.createElement)(P,{title:x("Webhooks","newspack"),description:x("These need to be configured to allow Stripe to communicate with the site.","newspack"),columns:1},(0,r.createElement)("div",null,null!==(e=n.webhooks)&&void 0!==e&&e.errors?(0,r.createElement)(s.qX,{isError:!0,noticeText:(0,a.values)(null===(t=n.webhooks)||void 0===t?void 0:t.errors).join(", ")}):(0,r.createElement)(r.Fragment,null,n.webhooks.length?(0,r.createElement)("ul",null,n.webhooks.map(((e,t)=>(0,r.createElement)("li",{key:t},"- ",(0,r.createElement)("code",null,e.url))))):(0,r.createElement)("div",{className:"mb3"},x("No webhooks defined.","newspack")),(0,r.createElement)(s.zx,{isLink:!0,disabled:m,onClick:()=>{w(!0),k()({path:"/newspack/v1/stripe/create-webhooks"}).then((()=>{window.location.reload()}))},isSecondary:!0},x("Create webhooks","newspack")))))):(0,r.createElement)(r.Fragment,null,(0,r.createElement)(s.rj,null,(0,r.createElement)(s.hp,{label:x("Enable Stripe"),checked:n.enabled,onChange:E("enabled")})),n.enabled?(0,r.createElement)(z,null):(0,r.createElement)(s.rj,null,(0,r.createElement)("p",{className:"newspack-payment-setup-screen__info"},x("Other gateways can be enabled and set up in the "),(0,r.createElement)(b.ExternalLink,{href:"/wp-admin/admin.php?page=wc-settings&tab=checkout"},x("WooCommerce payment gateway settings"))))),(0,r.createElement)("div",{className:"newspack-buttons-card"},(0,r.createElement)(s.zx,{isPrimary:!0,onClick:()=>v({slug:d,section:"stripe",payloadPath:["stripe_data"]})},x("Save Settings"))))},A=n(7462);const W=o.__,N=(0,a.values)(newspack_reader_revenue.emails);var F=()=>{const[e,t]=(0,r.useState)(null);return!1===e?(0,r.createElement)(r.Fragment,null,(0,r.createElement)(s.qX,{isError:!0},W("Newspack uses Newspack Newsletters to handle editing email-type content. Please activate this plugin to proceed.","newspack")),(0,r.createElement)(s.qX,{isError:!0},W("Until this feature is configured, default Stripe receipts will be used.","newspack")),(0,r.createElement)(s.xf,{style:e?{display:"none"}:{},plugins:["newspack-newsletters"],onStatus:e=>t(e.complete),onInstalled:()=>window.location.reload(),withoutFooterButton:!0})):(0,r.createElement)(r.Fragment,null,N.map((e=>{const t="publish"===e.status;return(0,r.createElement)(s.fM,(0,A.Z)({key:e.post_id,title:e.label,titleLink:e.edit_link,href:e.edit_link,description:e.description,actionText:W("Edit","newspack")},t?{}:{notification:W("This email is not active – the default Stripe receipt will be used. Edit and publish the email to activate it.","newspack"),notificationLevel:"error"},{secondaryActionText:W("Send a test email","newspack")}))})))},O=n(129),R=n(6483);const D=o.__;var M=()=>{var e;const{salesforce_redirect_url:t}=(null===(e=window)||void 0===e?void 0:e.newspack_reader_revenue)||{},[n,a]=(0,r.useState)(!1),{salesforce_settings:o={}}=s.en.useWizardData("reader-revenue"),[i,c]=(0,r.useState)(o.refresh_token),[u,p]=(0,r.useState)(null),{saveWizardSettings:m,wizardApiFetch:w}=(0,l.useDispatch)(s.en.STORE_NAMESPACE);return(0,r.useEffect)((()=>{const e=(0,O.parse)(window.location.search).code;e&&(window.history.replaceState({},"",t),(async e=>{try{const n=await w({path:"/newspack/salesforce/v1/tokens",method:"POST",data:{code:e,redirect_uri:t}}),{access_token:a,client_id:r,client_secret:o,instance_url:s,refresh_token:l}=n;a&&l&&m({slug:d,section:"salesforce",payloadPath:["salesforce_settings"],updatePayload:{path:["salesforce_settings"],value:{access_token:a,client_id:r,client_secret:o,instance_url:s,refresh_token:l}}}),c(!0)}catch(e){p(D("We couldn’t establish a connection to Salesforce. Please verify your Consumer Key and Secret and try connecting again.","newspack"))}})(e))}),[]),(0,r.useEffect)((()=>{i?(async()=>{const e=await w({path:"/newspack/salesforce/v1/connection-status",method:"POST",isQuietFetch:!0});e.error&&p(e.error)})():p(null)}),[i]),(0,r.createElement)(r.Fragment,null,(0,r.createElement)(s.d5,{afterUpdate:e=>{let n,a;if(((null==e?void 0:e.salesforce)||[]).forEach((e=>{"newspack_salesforce_client_id"===e.key?n=e.value:"newspack_salesforce_client_secret"===e.key&&(a=e.value)})),n&&a&&t){const e=(0,R.addQueryArgs)("https://login.salesforce.com/services/oauth2/authorize",{response_type:"code",client_id:encodeURIComponent(n),client_secret:encodeURIComponent(a),redirect_uri:encodeURI(t)});window.location.assign(e)}else c(!1)},pluginSlug:"newspack/salesforce",title:D("Salesforce Settings","newspack"),description:()=>(0,r.createElement)(r.Fragment,null,u&&(0,r.createElement)(s.qX,{noticeText:u,isWarning:!0}),i&&!u&&(0,r.createElement)(s.qX,{noticeText:D("Your site is connected to Salesforce.","newspack"),isSuccess:!0}),D("Establish a connection to sync WooCommerce order data to Salesforce. To connect with Salesforce, create or choose a Connected App for this site in your Salesforce dashboard. Make sure to paste the full URL for this page (","newspack"),(0,r.createElement)(b.ClipboardButton,{className:"newspack-button is-link",text:t,onCopy:()=>a(!0),onFinishCopy:()=>a(!1)},D(n?"copied to clipboard!":"copy to clipboard","newspack")),D(") into the “Callback URL” field in the Connected App’s settings. ","newspack"),(0,r.createElement)(b.ExternalLink,{href:"https://help.salesforce.com/articleView?id=connected_app_create.htm"},D("Learn how to create a Connected App","newspack")))}))};const j=o.__;(0,r.render)((0,r.createElement)((()=>{const{platform_data:e,plugin_status:t,donation_data:n}=s.en.useWizardData("reader-revenue"),o=null==e?void 0:e.platform,l={label:j("Platform","newspack"),path:"/",render:_};let i=[{label:j("Donations","newspack"),path:"/donations",render:w},{label:j(o===c?"Stripe Gateway":"Stripe Settings","newspack"),path:"/stripe-setup",render:T,isHidden:o!==c&&o!==u},{label:j("Emails","newspack"),path:"/emails",render:F,isHidden:o!==u},{label:j("Address","newspack"),path:"/location-setup",render:g,isHidden:o!==c},{label:j("Salesforce","newspack"),path:"/salesforce",render:M,isHidden:o!==c},{label:j("NRH Settings","newspack"),path:"/settings",render:v,isHidden:"nrh"!==o},l];return o!==c||t||(i=[l]),(0,r.createElement)(s.en,{headerText:j("Reader Revenue","newspack"),subHeaderText:j("Generate revenue from your customers","newspack"),sections:i,apiSlug:d,renderAboveSections:()=>(0,a.values)(null==n?void 0:n.errors).map(((e,t)=>(0,r.createElement)(s.qX,{key:t,isError:!0,noticeText:e}))),requiredPlugins:["newspack-blocks"]})})),document.getElementById("newspack-reader-revenue-wizard"))},9196:function(e){e.exports=window.React},2819:function(e){e.exports=window.lodash},6292:function(e){e.exports=window.moment},6989:function(e){e.exports=window.wp.apiFetch},5609:function(e){e.exports=window.wp.components},9818:function(e){e.exports=window.wp.data},9307:function(e){e.exports=window.wp.element},2694:function(e){e.exports=window.wp.hooks},2629:function(e){e.exports=window.wp.htmlEntities},5736:function(e){e.exports=window.wp.i18n},9630:function(e){e.exports=window.wp.keycodes},444:function(e){e.exports=window.wp.primitives},6483:function(e){e.exports=window.wp.url}},n={};function a(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}};return t[e].call(o.exports,o,o.exports,a),o.exports}a.m=t,e=[],a.O=function(t,n,r,o){if(!n){var s=1/0;for(u=0;u<e.length;u++){n=e[u][0],r=e[u][1],o=e[u][2];for(var l=!0,i=0;i<n.length;i++)(!1&o||s>=o)&&Object.keys(a.O).every((function(e){return a.O[e](n[i])}))?n.splice(i--,1):(l=!1,o<s&&(s=o));if(l){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[n,r,o]},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.j=359,function(){var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e}(),function(){var e={359:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,o,s=n[0],l=n[1],i=n[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(r in l)a.o(l,r)&&(a.m[r]=l[r]);if(i)var u=i(a)}for(t&&t(n);c<s.length;c++)o=s[c],a.o(e,o)&&e[o]&&e[o][0](),e[s[c]]=0;return a.O(u)},n=self.webpackChunkwebpack=self.webpackChunkwebpack||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var r=a.O(void 0,[351],(function(){return a(3437)}));r=a.O(r);var o=window;for(var s in r)o[s]=r[s];r.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})}();