(()=>{var e,t={9693:e=>{e.exports=function(e){for(var t=-1,n=null==e?0:e.length,a=0,s=[];++t<n;){var i=e[t];i&&(s[a++]=i)}return s}},9661:(e,t,n)=>{"use strict";n.r(t);var a=n(7462),s=n(4942),i=(n(5674),n(9307)),r=n(5736),p=n(6483),c=n(129),l=n(1732),o=n(9674),u=n(9630),m=n(7259),d=n(5609);const g=r.__,w=({dismiss:e,hasPrompts:t,hasPublished:n,isArchive:a,onActivate:s,onArchive:r,onDeactivate:p,onDelete:c,onDuplicate:o,onRename:m,onUnarchive:w})=>(0,i.createElement)(l.J2,{position:"bottom right",onFocusOutside:()=>e(),onKeyDown:t=>u.ESCAPE===t.keyCode&&e()},(0,i.createElement)(d.MenuItem,{onClick:()=>e(),className:"screen-reader-text"},g("Close Popover","newspack-plugin")),t&&(0,i.createElement)(d.MenuItem,{onClick:()=>{e(),s()},className:"newspack-button"},g("Activate all prompts","newspack-plugin")),n&&(0,i.createElement)(d.MenuItem,{onClick:()=>{e(),p()},className:"newspack-button"},g("Deactivate all prompts","newspack-plugin")),(0,i.createElement)(d.MenuItem,{onClick:()=>{e(),o()},className:"newspack-button"},g("Duplicate","newspack-plugin")),(0,i.createElement)(d.MenuItem,{onClick:()=>{e(),m()},className:"newspack-button"},g("Rename","newspack-plugin")),!a&&(0,i.createElement)(d.MenuItem,{onClick:()=>{e(),r()},className:"newspack-button"},g("Archive","newspack-plugin")),a&&(0,i.createElement)(d.MenuItem,{onClick:()=>{e(),w()},className:"newspack-button"},g("Unarchive","newspack-plugin")),(0,i.createElement)(d.MenuItem,{onClick:()=>{e(),c()},className:"newspack-button"},g("Delete","newspack-plugin")));var h=n(444);const k=(0,i.createElement)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,i.createElement)(h.Path,{d:"M18.5 10.5H10v8h8a.5.5 0 00.5-.5v-7.5zm-10 0h-3V18a.5.5 0 00.5.5h2.5v-8zM6 4h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2z"}));var v=n(5332);const E=e=>{const[t,n]=(0,i.useState)(null),[s,r]=(0,i.useState)(!1),[c,o]=(0,i.useState)(Math.floor(9999*Math.random())),u=window?.newspack_popups_wizard_data?.preview_post,m=window?.newspack_popups_wizard_data?.frontend_url||"/",{campaign:d=!1,onLoad:g=(()=>{}),segment:w="",showUnpublished:h=!1,url:k=u||m}=e;(0,i.useEffect)((()=>{s||n(v(k))}),[s]);const v=e=>{const t=w.length?[`segment:${w}`]:["segment:everyone"];return h&&t.push("show_unpublished:true"),d?t.push(`campaign:${d}`):t.push("all"),t.push("session_id:"+c),(0,p.addQueryArgs)(e,{view_as:t.join(";")})};return(0,i.createElement)(l.BA,(0,a.Z)({},e,{onLoad:e=>{e&&([...e.contentWindow.document.querySelectorAll("a")].forEach((e=>{const t=e.getAttribute("href");0===t.indexOf(m)&&e.setAttribute("href",v(t))})),r(!0),g(e))},onClose:()=>{o(Math.floor(9999*Math.random())),r(!1)},url:t}))};var _=n(6989),b=n.n(_),f=n(2629),y=n(9522);const C=r.__,z=({deletePopup:e,restorePopup:t,onFocusOutside:n,prompt:a,previewPopup:s,publishPopup:r,setIsDuplicatePromptModalVisible:p,unpublishPopup:c})=>{const{id:o,edit_link:m,status:g}=a,w="publish"===g,h="trash"===g;return(0,i.createElement)(l.J2,{position:"bottom left",onFocusOutside:n,onKeyDown:e=>u.ESCAPE===e.keyCode&&n(),className:"newspack-popover__campaigns__primary-popover"},(0,i.createElement)(d.MenuItem,{onClick:()=>n(),className:"screen-reader-text"},C("Close Popover","newspack-plugin")),h?(0,i.createElement)(i.Fragment,null,(0,i.createElement)(d.MenuItem,{onClick:()=>t(o),className:"newspack-button"},C("Restore","newspack-plugin")),(0,i.createElement)(d.MenuItem,{onClick:()=>e(o),className:"newspack-button"},C("Delete permanently","newspack-plugin"))):(0,i.createElement)(i.Fragment,null,(0,i.createElement)(d.MenuItem,{onClick:()=>{n(),s(a)},className:"newspack-button"},C("Preview","newspack-plugin")),(0,i.createElement)(d.MenuItem,{href:(0,f.decodeEntities)(m),className:"newspack-button",isLink:!0},C("Edit","newspack-plugin")),(0,i.createElement)(d.MenuItem,{onClick:()=>p(!0),className:"newspack-button"},C("Duplicate","newspack-plugin")),(0,i.createElement)(d.MenuItem,{onClick:()=>{n(),(w?c:r)(o)},className:"newspack-button"},C(w?"Deactivate":"Activate","newspack-plugin")),(0,i.createElement)(d.MenuItem,{onClick:()=>e(o),className:"newspack-button"},C("Delete","newspack-plugin"))),(0,i.createElement)("div",{className:"newspack-popover__campaigns__info"},C("ID:","newspack-plugin")," ",o))};var S=n(2694),P=n(8306),x=n.n(P),A=n(9693),N=n.n(A);const O=r.__,F=window.newspack_popups_wizard_data?.criteria||[],M=e=>-1<(window.newspack_popups_wizard_data?.overlay_placements||[]).indexOf(e.options.placement),I=e=>"above_header"===e.options.placement,T=e=>{const t=window.newspack_popups_wizard_data?.custom_placements||{};return-1<Object.keys(t).indexOf(e.options.placement)},D={top:O("Top Overlay","newspack-plugin"),top_left:O("Top Left Overlay","newspack-plugin"),top_right:O("Top Right Overlay","newspack-plugin"),center:O("Center Overlay","newspack-plugin"),center_left:O("Center Left Overlay","newspack-plugin"),center_right:O("Center Right Overlay","newspack-plugin"),bottom:O("Bottom Overlay","newspack-plugin"),bottom_left:O("Bottom Left Overlay","newspack-plugin"),bottom_right:O("Bottom Right Overlay","newspack-plugin"),inline:O("Inline","newspack-plugin"),archives:O("In archive pages","newspack-plugin"),above_header:O("Above Header","newspack-plugin"),manual:O("Manual Only","newspack-plugin")},Z=({options:{frequency:e,placement:t}})=>{const n=window.newspack_popups_wizard_data?.custom_placements||{};return"manual"===e||n.hasOwnProperty(t)?O("Custom Placement","newspack-plugin"):D[t]},H=e=>{const t=window.newspack_popups_wizard_data?.custom_placements,n=window.newspack_popups_wizard_data?.overlay_placements,a=Object.keys(D).filter((t=>M(e)?-1<n.indexOf(t):-1===n.indexOf(t))).map((e=>({label:D[e],value:e})));return!M(e)&&t?a.concat(Object.keys(t).map((e=>({label:t[e],value:e})))):a},V={once:O("Once a month","newspack-plugin"),weekly:O("Once a week","newspack-plugin"),daily:O("Once a day","newspack-plugin"),always:O("Every pageview","newspack-plugin"),custom:O("Custom frequency (edit prompt to manage)","newspack-plugin")},$=(e,t=!1)=>"publish"!==e||t?"newspack-card__is-disabled":"newspack-card__is-supported",j=e=>{const{categories:t,tags:n,campaign_groups:a,status:s}=e,i=[];if(a.length>0){const e=a.map((({name:e})=>e)).join(", ");i.push((1===a.length?O("Campaign: ","newspack-plugin"):O("Campaigns: ","newspack-plugin"))+e)}return t.length>0&&i.push(O("Categories: ","newspack-plugin")+t.map((e=>e.name)).join(", ")),n.length>0&&i.push(O("Tags: ","newspack-plugin")+n.map((e=>e.name)).join(", ")),"pending"===s&&i.push(O("Pending review","newspack-plugin")),"future"===s&&i.push(O("Scheduled","newspack-plugin")),i.push(O("Frequency: ","newspack-plugin")+U(e)),i.length?i.join(" | "):null},R=e=>{const t=[];if(e.configuration.is_disabled&&t.push(O("Segment disabled","newspack-plugin")),e.criteria)for(const n of F){const a=e.criteria.find((({criteria_id:e})=>e===n.id));if(a?.value){let e=a.value;if(n.options){const t=n.options.find((({value:e})=>e===a.value));t&&(e=t.label)}if(Array.isArray(e))e=e.join(", ");else if("object"==typeof e){const t=[];for(const n in e)e[n]&&t.push(`${n}: ${e[n]}`);e=t.join(", ")}const s=(0,S.applyFilters)("newspack.wizards.campaigns.segmentDescription.criteriaMessage",(0,r.sprintf)("%1$s: %2$s",n.name,e),e,n,a);s&&t.push(s)}}return()=>(0,i.createElement)(i.Fragment,null,t.map(((e,n)=>(0,i.createElement)(i.Fragment,{key:n},e," ",t.length!==n+1?" | ":null))))},q=x()((async e=>{const t=await Promise.all(e.map((async e=>{try{return(await b()({path:(0,p.addQueryArgs)("/wp/v2/categories/"+e,{_fields:"name"})})).name}catch(e){return""}})));return N()(t)})),B=({ids:e})=>{const[t,n]=(0,i.useState)([]);return(0,i.useEffect)((()=>{q(e).then(n)}),[e]),t.length?(0,i.createElement)("span",null,O("Favorite Categories:","newspack-plugin")," ",t.length?t.join(", "):""):null};(0,S.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.favoriteCategories",((e,t,n,a)=>"favorite_categories"===n.id?a.value?.length?(0,i.createElement)(B,{ids:a.value}):null:e));const L=x()((async e=>{try{const t=await b()({path:e});return(Array.isArray(t)?t:Object.values(t)).map((e=>({id:isNaN(parseInt(e.id))?e.id.toString():parseInt(e.id),label:e.title||e.name})))}catch(e){return[]}})),G=({label:e,ids:t,path:n})=>{const[a,s]=(0,i.useState)([]);return(0,i.useEffect)((()=>{L(n).then(s)}),[t]),a.length?(0,i.createElement)("span",null,e," ",a.length?a.filter((e=>t.includes(e.id))).map((e=>e.label)).join(", "):""):null};(0,S.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.newsletterSubscribedLists",((e,t,n,a)=>["subscribed_lists","not_subscribed_lists"].includes(n.id)?a.value?.length?(0,i.createElement)(G,{label:"subscribed_lists"===n.id?O("Subscribed to:","newspack-plugin"):O("Not subscribed to:","newspack-plugin"),ids:a.value,path:"/newspack-newsletters/v1/lists_config"}):null:e)),(0,S.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.activeSubscriptions",((e,t,n,a)=>["active_subscriptions","not_active_subscriptions"].includes(n.id)?a.value?.length?(0,i.createElement)(G,{label:"active_subscriptions"===n.id?O("Has active subscription(s):","newspack-plugin"):O("Does not have active subscription(s):","newspack-plugin"),ids:a.value,path:"/newspack/v1/wizard/newspack-popups-wizard/subscription-products"}):null:e)),(0,S.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.activeMemberships",((e,t,n,a)=>["active_memberships","not_active_memberships"].includes(n.id)?a.value?.length?(0,i.createElement)(G,{label:"active_memberships"===n.id?O("Has active membership(s):","newspack-plugin"):O("Does not have active membership(s):","newspack-plugin"),ids:a.value,path:"/wc/v3/memberships/plans?per_page=100"}):null:e));const W=(e,t)=>{const n=[];if("publish"===t.status&&(I(t)||M(t)||T(t))){const n=t.categories,a=e.filter((e=>{const a=e.categories,s=0===n.length&&0===a.length||n.some((e=>a.some((t=>e.term_id===t.term_id))));return"publish"===e.status&&e.id!==t.id&&(i=e,t.options.placement===i.options.placement)&&((e,t)=>{const n=e.map((e=>e.term_id)),a=t.map((e=>e.term_id));return!n.length&&!a.length||n.some((e=>-1<a.indexOf(e)))})(t.segments,e.segments)&&s;var i})),s=(0,S.applyFilters)("newspack.wizards.campaigns.conflictingPrompts",a,t,e);return 0<s.length?(0,i.createElement)(i.Fragment,null,(0,i.createElement)("strong",null,(0,r.sprintf)(O("%s detected:","newspack-plugin"),1<s.length?O("Conflicts","newspack-plugin"):O("Conflict","newspack-plugin"))),(0,i.createElement)("ul",null,s.map((e=>(0,i.createElement)("li",{key:e.id},(0,i.createElement)("p",{"data-testid":`conflict-warning-${t.id}`},(0,i.createElement)("strong",null,(0,r.sprintf)("%s: ",e.title)),(0,i.createElement)("span",null,(e=>M(e)||I(e)?(0,r.sprintf)(O("If multiple %s are rendered on the same pageview, only the most recent one will be displayed.","newspack-plugin"),I(e)?O("above-header prompts","newspack-plugin"):O("overlays","newspack-plugin")):T(e)?O("If multiple prompts are rendered in the same custom placement, only the most recent one will be displayed.","newspack-plugin"):"")(t)))))))):null}return n.length?n.join(" "):null},U=({options:{frequency:e}})=>V[e],Y=r.__,{SettingsCard:J}=l.Zr,K=({prompt:e,disabled:t,onClose:n,updatePopup:a})=>{const[s,p]=l.PT.useObjectState(e),{excluded_categories:c=[],excluded_tags:o=[]}=s.options||{},[u,m]=(0,i.useState)(0<c.length||0<o.length||!1);return(0,i.createElement)(l.u_,{title:e.title,onRequestClose:n,isWide:!0},(0,i.createElement)(l.zx,{onClick:()=>n(),className:"screen-reader-text"},Y("Close Modal","newspack-plugin")),(0,i.createElement)(l.rj,{gutter:64,columns:1},(0,i.createElement)(J,{title:Y("Campaigns","newspack-plugin"),description:Y("Assign a prompt to one or more campaigns for easier management","newspack-plugin"),columns:1,className:"newspack-settings__campaigns",noBorder:!0},(0,i.createElement)(l.HZ,{disabled:t,value:s.campaign_groups||[],onChange:e=>p({campaign_groups:e}),label:Y("Campaigns","newspack-plugin"),taxonomy:"newspack_popups_taxonomy",hideLabelFromVision:!0})),(0,i.createElement)(J,{title:Y("Settings","newspack-plugin"),description:Y("When and how should the prompt be displayed","newspack-plugin"),columns:M(e)?3:2,className:"newspack-settings__settings",rowGap:16,noBorder:!0},(0,i.createElement)(l.Yw,{label:Y("Frequency","newspack-plugin"),disabled:t,onChange:e=>{p({options:{frequency:e}})},options:Object.keys(V).map((e=>({label:V[e],value:e}))),value:s.options.frequency}),(0,i.createElement)(l.Yw,{label:M(e)?Y("Position","newspack-plugin"):Y("Placement","newspack-plugin"),disabled:t,onChange:e=>{p({options:{placement:e}})},options:H(e),value:s.options.placement}),M(e)&&(0,i.createElement)(l.Yw,{label:Y("Size","newspack-plugin"),disabled:t,onChange:e=>{p({options:{overlay_size:e}})},options:window.newspack_popups_wizard_data?.overlay_sizes,value:s.options.overlay_size})),(0,i.createElement)(J,{title:Y("Targeting","newspack-plugin"),description:()=>(0,i.createElement)(i.Fragment,null,Y("Under which conditions should the prompt be displayed","newspack-plugin"),(0,i.createElement)("br",null),Y("If multiple conditions are set, all will have to be satisfied in order to display the prompt","newspack-plugin")),className:"newspack-settings__targeting",columns:1,rowGap:16,noBorder:!0},(0,i.createElement)(l.rj,{columns:3,rowGap:16},(0,i.createElement)(l.HZ,{disabled:t,value:s.segments||[],onChange:e=>p({segments:e}),label:Y("Segments","newspack-plugin"),taxonomy:"popup_segment"}),(0,i.createElement)(l.HZ,{label:Y("Post categories","newspack-plugin"),disabled:t,hideHelpFromVision:!0,value:s.categories||[],onChange:e=>p({categories:e}),description:Y("Prompt will only appear on posts with the specified categories.","newspack-plugin")}),(0,i.createElement)(l.HZ,{label:Y("Post tags","newspack-plugin"),disabled:t,hideHelpFromVision:!0,taxonomy:"tags",value:s.tags||[],onChange:e=>p({tags:e}),description:Y("Prompt will only appear on posts with the specified tags.","newspack-plugin")})),(0,i.createElement)("div",null,(0,i.createElement)(l.zx,{isLink:!0,onClick:()=>m(!u)},(0,r.sprintf)(Y("%s Advanced Settings","newspack-plugin"),Y(u?"Hide":"Show","newspack-plugin")))),u&&(0,i.createElement)(l.rj,{columns:3,rowGap:16},(0,i.createElement)(l.HZ,{label:Y("Category Exclusions","newspack-plugin"),disabled:t,hideHelpFromVision:!0,value:c||[],onChange:e=>p({options:{excluded_categories:e.map((e=>e.id))}}),description:Y("Prompt will not appear on posts with the specified categories.","newspack-plugin")}),(0,i.createElement)(l.HZ,{label:Y("Tag Exclusions","newspack-plugin"),disabled:t,hideHelpFromVision:!0,taxonomy:"tags",value:o||[],onChange:e=>p({options:{excluded_tags:e.map((e=>e.id))}}),description:Y("Prompt will not appear on posts with the specified tags.","newspack-plugin")})))),(0,i.createElement)(l.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,i.createElement)(l.zx,{onClick:n,variant:"secondary"},Y("Cancel","newspack-plugin")),(0,i.createElement)(l.zx,{onClick:()=>{a(s).then(n)},variant:"primary"},Y("Save","newspack-plugin"))))},X=r.__,Q=e=>{const[t,n]=(0,i.useState)(!1),[s,p]=(0,i.useState)(!1),[c,o]=(0,i.useState)(!1),[u,d]=(0,i.useState)(null),{className:g,description:w,duplicated:h,duplicatePopup:k,inFlight:v,resetDuplicated:E,prompt:_={},segments:C,warning:S}=e,{campaign_groups:P,id:x,edit_link:A,title:N}=_;(0,i.useEffect)((()=>{c&&!u&&O()}),[c]);const O=async()=>{const e=parseInt(_?.duplicate_of||_.id);try{const t=await b()({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/${_.id}/duplicate`});d(t)}catch(e){d(N+X(" copy","newspack-plugin"))}};return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(l.fM,{isSmall:!0,badge:Z(_),className:g,title:N.length?(0,f.decodeEntities)(N):X("(no title)","newspack-plugin"),titleLink:(0,f.decodeEntities)(A),key:x,description:w,notification:S,notificationLevel:"error",actionText:(0,i.createElement)(i.Fragment,null,(0,i.createElement)("div",{className:"newspack-popups-wizard__buttons"},(0,i.createElement)(l.zx,{className:t&&"popover-active",onClick:()=>n(!t),icon:y.Z,label:X("Prompt settings","newspack-plugin"),tooltipPosition:"bottom center"}),(0,i.createElement)(l.zx,{className:s&&"popover-active",onClick:()=>p(!s),icon:m.Z,label:X("More options","newspack-plugin"),tooltipPosition:"bottom center"}),s&&(0,i.createElement)(z,(0,a.Z)({onFocusOutside:()=>p(!1),prompt:_,setIsDuplicatePromptModalVisible:o},e))))}),t&&(0,i.createElement)(K,{prompt:_,disabled:v,onClose:()=>n(!1),segments:C,updatePopup:e.updatePopup}),c&&(0,i.createElement)(l.u_,{className:"newspack-popups__duplicate-modal",title:(0,r.sprintf)(X("Duplicate “%s”","newspack-plugin"),N),onRequestClose:()=>{o(!1),d(null),E()}},h?(0,i.createElement)(i.Fragment,null,(0,i.createElement)(l.qX,{isSuccess:!0,noticeText:(0,r.sprintf)(X("Duplicate of “%s” created as a draft.","newspack-plugin"),N)}),!P&&(0,i.createElement)(l.qX,{isWarning:!0,noticeText:X("This prompt is currently not assigned to any campaign.","newspack-plugin")}),(0,i.createElement)(l.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,i.createElement)(l.zx,{isSecondary:!0,onClick:()=>{o(!1),d(null),E()}},X("Close","newspack-plugin")),(0,i.createElement)(l.zx,{isPrimary:!0,href:`/wp-admin/post.php?post=${h}&action=edit`},X("Edit","newspack-plugin")))):(0,i.createElement)(i.Fragment,null,!P&&(0,i.createElement)(l.qX,{isWarning:!0,noticeText:X("This prompt will not be assigned to any campaign.","newspack-plugin")}),(0,i.createElement)(l.w4,{disabled:v||null===u,label:X("Title","newspack-plugin"),value:u,onChange:e=>d(e)}),(0,i.createElement)(l.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,i.createElement)(l.zx,{disabled:v,isSecondary:!0,onClick:()=>{o(!1),d(null),E()}},X("Cancel","newspack-plugin")),(0,i.createElement)(l.zx,{disabled:v||null===u,isPrimary:!0,onClick:()=>{const e=u.trim()||O();k(x,e)}},X("Duplicate","newspack-plugin"))))))},ee=(0,i.createElement)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,i.createElement)(d.Path,{d:"M4 9h16v2H4V9zm0 4h10v2H4v-2z"})),te=(0,i.createElement)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,i.createElement)(d.Path,{d:"M17 14H7v3h10v-3z"}),(0,i.createElement)(d.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})),ne=(0,i.createElement)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,i.createElement)(d.Path,{d:"M16 10H8v4h8v-4z"}),(0,i.createElement)(d.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})),ae=(0,i.createElement)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,i.createElement)(d.Path,{d:"M17 7H7v3h10V7z"}),(0,i.createElement)(d.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})),se=(0,i.createElement)(d.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,i.createElement)(d.Path,{d:"M18 4H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm.5 14c0 .3-.2.5-.5.5H6c-.3 0-.5-.2-.5-.5V6c0-.3.2-.5.5-.5h12c.3 0 .5.2.5.5v12zM7 11h2V9H7v2zm0 4h2v-2H7v2zm3-4h7V9h-7v2zm0 4h7v-2h-7v2z"})),ie=(0,i.createElement)(d.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,i.createElement)(d.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v3.5h-15V5c0-.3.2-.5.5-.5zm8 5.5h6.5v3.5H13V10zm-1.5 3.5h-7V10h7v3.5zm-7 5.5v-4h7v4.5H5c-.3 0-.5-.2-.5-.5zm14.5.5h-6V15h6.5v4c0 .3-.2.5-.5.5z"})),re=r.__,pe=(e,t,n)=>{const a=[];return e&&a.push(`placement=${e}`),+t>0&&a.push(`group=${t}`),n&&a.push(`segment=${n}`),"/wp-admin/post-new.php?post_type=newspack_popups_cpt&"+a.join("&")},ce=e=>{const{campaignData:t,campaignId:n,segment:s}=e,[r,p]=(0,i.useState)(!1),{label:c,id:o,prompts:u}=s,m="unassigned"!==n?parseInt(n):-1;let d;d="unassigned"===n?re("No unassigned prompts in this segment.","newspack-plugin"):t?re("No prompts in this segment for","newspack-plugin")+" "+t.name+".":re("No active prompts in this segment.","newspack-plugin");const g=R(s);return(0,i.createElement)(l.Zb,{isSmall:!0,className:"newspack-campaigns__segment-group__card"},(0,i.createElement)("div",{className:"newspack-campaigns__segment-group__card__segment"},(0,i.createElement)("div",{className:"newspack-campaigns__segment-group__card__segment-title"},(0,i.createElement)("h3",null,o?(0,i.createElement)(l.zx,{href:`#/segments/${o}`,label:re("Edit Segment ","newspack-plugin"),isLink:!0,showTooltip:!0,tooltipPosition:"bottom center"},re("Segment: ","newspack-plugin"),c):c),(0,i.createElement)("span",{className:"newspack-campaigns__segment-group__description"},o?g():re("All readers, regardless of segment","newspack-plugin"))),(0,i.createElement)("div",{className:"newspack-campaigns__segment-group__card__segment-actions"},(0,i.createElement)(E,{campaign:!!n&&m,segment:o,showUnpublished:!!n,renderButton:({showPreview:e})=>(0,i.createElement)(l.zx,{isSmall:!0,variant:"tertiary",onClick:()=>e()},re("Preview Segment","newspack-plugin"))}),"unassigned"!==n&&(0,i.createElement)(i.Fragment,null,(0,i.createElement)(l.zx,{isSmall:!0,variant:"secondary",onClick:()=>p(!r)},re("Add New Prompt","newspack-plugin")),r&&(0,i.createElement)(l.u_,{title:re("Add New Prompt","newspack-plugin"),onRequestClose:()=>p(!1),shouldCloseOnEsc:!1,shouldCloseOnClickOutside:!1,isWide:!0},(0,i.createElement)(l.rj,{gutter:32,columns:3},(0,i.createElement)(l.Wu,{href:pe("overlay-center",n,o),title:re("Center Overlay","newspack-plugin"),desc:re("Fixed at the center of the screen","newspack-plugin"),icon:ne}),(0,i.createElement)(l.Wu,{href:pe("overlay-top",n,o),title:re("Top Overlay","newspack-plugin"),desc:re("Fixed at the top of the screen","newspack-plugin"),icon:ae}),(0,i.createElement)(l.Wu,{href:pe("overlay-bottom",n,o),title:re("Bottom Overlay","newspack-plugin"),desc:re("Fixed at the bottom of the screen","newspack-plugin"),icon:te}),(0,i.createElement)(l.Wu,{href:pe(null,n,o),title:re("Inline","newspack-plugin"),desc:re("Embedded in content","newspack-plugin"),icon:ee}),(0,i.createElement)(l.Wu,{href:pe("archives",n,o),title:re("In Archive Pages","newspack-plugin"),desc:re("Embedded once or many times in archive pages","newspack-plugin"),icon:se}),(0,i.createElement)(l.Wu,{href:pe("above-header",n,o),title:re("Above Header","newspack-plugin"),desc:re("Embedded at the very top of the page","newspack-plugin"),icon:k}),(0,i.createElement)(l.Wu,{href:pe("custom",n,o),title:re("Custom Placement","newspack-plugin"),desc:re("Only appears when placed in content","newspack-plugin"),icon:v.Z}),(0,i.createElement)(l.Wu,{href:pe("manual",n,o),title:re("Manual Only","newspack-plugin"),desc:re("Only appears where Single Prompt block is inserted","newspack-plugin"),icon:ie})))))),(0,i.createElement)(l.Zb,{noBorder:!0,className:"newspack-campaigns__segment-group__action-cards"},u.map((t=>(0,i.createElement)(Q,(0,a.Z)({className:$(t.status,s.configuration.is_disabled),description:j(t),warning:W(u,t),key:t.id,prompt:t},e))))),u.length<1?(0,i.createElement)("p",null,d):"")},le=(0,i.createContext)({prompts:[]});var oe=n(3967),ue=n.n(oe),me=n(3311),de=n.n(me);const ge=r.__,{useHistory:we}=l.F0,he="active",ke=e=>ge(2===e?"Rename Campaign":1===e?"Duplicate Campaign":"Add New Campaign","newspack-plugin"),ve=(e,t)=>{if("trash"===t)return e.filter((({status:e})=>"trash"===e));const n=e.filter((({status:e})=>"trash"!==e));return he===t?n.filter((({status:e})=>"publish"===e)):"all"===t?n.filter((({status:e})=>"trash"!==e)):"unassigned"===t?n.filter((({campaign_groups:e})=>!e||!e.length)):n.filter((({campaign_groups:e})=>e&&e.find((e=>+e.term_id==+t))))},Ee=(0,l.a4)((e=>{const{campaignId:t=he,campaigns:n=[],manageCampaignGroup:s,segments:r,createCampaignGroup:p,duplicateCampaignGroup:c,deleteCampaignGroup:o,archiveCampaignGroup:d,renameCampaignGroup:g}=e,h=(0,i.useRef)(null),[k,v]=(0,i.useState)(),[E,_]=(0,i.useState)(),[b,f]=(0,i.useState)(),[y,C]=(0,i.useState)(),z=(0,i.useContext)(le),S=ve(z,t),P=ve(z,"unassigned").length;(0,i.useEffect)((()=>{E&&h.current.querySelector("input").focus()}),[E]);const x=we(),A=e=>{3===b?p(e):2===b?g(t,e):1===b&&c(t,e),_(!1)},N=n.filter((({status:e})=>"archive"!==e)),O=n.filter((({status:e})=>"archive"===e)),F=((e,t)=>t.reduce(((t,n)=>+e>0&&+e==+n.term_id?n:t),null))(t,n),M=[{key:he,name:ge("Active Prompts","newspack-plugin")},{key:"all",name:ge("All Prompts","newspack-plugin")},{key:"trash",name:ge("Trash","newspack-plugin")},...P?[{key:"unassigned",name:ge("Unassigned Prompts","newspack-plugin")}]:[],...N.length?[{key:"header-campaigns",name:ge("Campaigns","newspack-plugin"),className:"is-header"}]:[],...N.map((({term_id:e,name:t})=>({key:String(e),name:t,className:"newspack-campaigns__campaign-group__select-control-group-item"}))),...O.length?[{key:"header-archived-campaigns",name:ge("Archived Campaigns","newspack-plugin"),className:"is-header"}]:[],...O.map((({term_id:e,name:t})=>({key:String(e),name:t+" "+ge("(archived)","newspack-plugin"),className:"newspack-campaigns__campaign-group__select-control-group-item"})))];return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(l.Zb,{headerActions:!0,noBorder:!0},(0,i.createElement)("div",{className:"newspack-campaigns__campaign-group__filter-group-actions"},(0,i.createElement)(l.Yq,{label:ge("Campaigns","newspack-plugin"),options:M.map((e=>({...e,className:ue()(e.className,{"is-selected":e.key===t})}))),onChange:({selectedItem:{key:e}})=>he===e?x.push("/campaigns"):x.push(`/campaigns/${e}`),value:de()(M,["key",t||he]),hideLabelFromVision:!0}),F&&(0,i.createElement)("div",{className:"newspack-campaigns__campaign-group__filter-group-actions__button"},(0,i.createElement)(l.zx,{className:k&&"popover-active",onClick:()=>v(!k),icon:m.Z,label:ge("Actions","newspack-plugin"),tooltipPosition:"bottom center"}),k&&(0,i.createElement)(w,{dismiss:()=>v(!1),isArchive:F&&"archive"===F.status,onActivate:()=>s(S),onArchive:()=>d(t,!0),onDeactivate:()=>s(S,"DELETE"),onDelete:()=>o(t),onDuplicate:()=>{_(!0),C(""),f(1)},onRename:()=>{C(F.name),_(!0),f(2)},onUnarchive:()=>d(t,!1),hasPrompts:S.length>0,hasPublished:S.some((({status:e})=>"publish"===e))}))),(0,i.createElement)("div",{className:"newspack-campaigns__campaign-group__add-new-button"},(0,i.createElement)(l.zx,{isPrimary:!0,onClick:()=>{_(!E),C(""),f(3)}},ge("Add New Campaign","newspack-plugin")),E&&(0,i.createElement)(l.u_,{title:ke(b),onRequestClose:()=>{_(!1)}},(0,i.createElement)("div",{ref:h},(0,i.createElement)(l.w4,{placeholder:ge("Campaign Name","newspack-plugin"),onChange:C,label:ge("Campaign Name","newspack-plugin"),hideLabelFromVision:!0,value:y,onKeyDown:e=>{u.ENTER===e.keyCode&&""!==y&&(e.preventDefault(),A(y))}})),(0,i.createElement)(l.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,i.createElement)(l.zx,{variant:"secondary",onClick:()=>{_(!1)}},ge("Cancel","newspack-plugin")),(0,i.createElement)(l.zx,{variant:"primary",disabled:!y,onClick:()=>A(y)},(e=>ge(2===e?"Rename":1===e?"Duplicate":"Add","newspack-plugin"))(b)))))),((e,t)=>{const n=[];return n.push(...e.map((({name:e,id:n,configuration:a,criteria:s})=>({label:e,id:n,configuration:a,criteria:s,prompts:t.filter((({segments:e})=>!!e&&!!e.find((e=>e.term_id===parseInt(n)))))})))),n.push({label:ge("Everyone","newspack-plugin"),id:"",prompts:t.filter((({segments:e})=>0===e.length)),configuration:{}}),n})(r,S).map(((n,s)=>he===t&&n.configuration.is_disabled?null:(0,i.createElement)(ce,(0,a.Z)({key:s,segment:n,campaignId:t,campaignData:F},e)))))})),_e=r.__,be=(0,l.a4)((()=>(0,i.createElement)("div",{className:"newspack-campaigns-wizard-analytics__wrapper"},(0,i.createElement)(l.Zb,{isNarrow:!0},(0,i.createElement)("h2",null,_e("Coming soon","newspack-plugin")),(0,i.createElement)("p",null,(0,i.createElement)(i.Fragment,null,_e("We’re currently redesigning this dashboard to accommodate GA4 and give you deeper insights into Campaign performance. In the meantime, you can find Campaign event data within your GA account. Review this ","newspack-plugin"),(0,i.createElement)("a",{target:"_blank",rel:"noopener noreferrer",href:"https://help.newspack.com/analytics/"},_e("help page","newspack-plugin")),_e(" to see how Campaign data is being recorded in GA.","newspack-plugin"),",")),(0,i.createElement)(l.Zb,{buttonsCard:!0,noBorder:!0},(0,i.createElement)(l.zx,{target:"_blank",rel:"noopener noreferrer",href:"https://help.newspack.com/analytics/",isPrimary:!0},_e("View the help page","newspack-plugin"))))))),fe=(0,l.a4)((()=>(0,i.createElement)(l.d5,{pluginSlug:"newspack-popups-wizard",isWizard:!0,title:null})));var ye=n(1984);const Ce=(0,i.createElement)(h.SVG,{width:"18",height:"18",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18"},(0,i.createElement)(h.Path,{d:"M5 4h2V2H5v2zm6-2v2h2V2h-2zm-6 8h2V8H5v2zm6 0h2V8h-2v2zm-6 6h2v-2H5v2zm6 0h2v-2h-2v2z"}));var ze=n(6015),Se=n(3904);const Pe=r.__,{NavLink:xe,useHistory:Ae}=l.F0,Ne=()=>(0,i.createElement)(xe,{to:"segments/new"},(0,i.createElement)(l.zx,{variant:"primary"},Pe("Add New Segment","newspack-plugin"))),Oe=({inFlight:e,segment:t,segments:n,deleteSegment:a,dropTargetIndex:s,setDropTargetIndex:r,index:p,sortSegments:c,totalSegments:o,wrapperRef:g,toggleSegmentStatus:w})=>{const[h,k]=(0,i.useState)(!1),[v,E]=(0,i.useState)(!1),_=()=>k(!1),b=Ae(),f=0===p,y=p+1===o,C=p===s,z=y&&s>=o,S=a=>{if(e)return;const s=[...n],i=a>p?a-1:a;s.splice(p,1),s.splice(i,0,t),s.forEach(((e,t)=>e.priority=t)),JSON.stringify(s)!==JSON.stringify(n)&&c(s)},P=()=>{if(e)return;let t=p-1;0>t&&(t=0),S(t)},x=()=>{if(e)return;let t=p+2;o<t&&(t=o),S(t)};return(0,i.createElement)("div",{className:"newspack-campaigns__draggable"+(v?" is-dragging":"")+(C?" is-drop-target":"")+(z?" drop-target-after":""),id:`segment-${t.id}`},(0,i.createElement)(d.Draggable,{elementId:`segment-${t.id}`,transferData:{},onDragStart:()=>{v||e||E(!0)},onDragEnd:()=>{e||(null!==s&&S(s),r(null),E(!1))},onDragOver:t=>{if(e)return;const n=g.current.getBoundingClientRect(),a=t.pageY<=n.top+window.scrollY,s=t.pageY>=n.bottom+window.scrollY;if(a||s||t.target.classList.contains("newspack-action-card")){let e=Array.prototype.slice.call(g.current.querySelectorAll(".newspack-campaigns__draggable")).indexOf(t.target.parentElement);(0>e||e===p+1)&&(e=p),a&&(e=0),s&&(e=o),r(e)}}},(({onDraggableStart:e,onDraggableEnd:n})=>(0,i.createElement)(l.fM,{isSmall:!0,title:t.name,titleLink:`#/segments/${t.id}`,description:R(t),toggleChecked:!t.configuration.is_disabled,toggleOnChange:()=>w(t),badge:t.is_criteria_duplicated?Pe("Duplicate","newspack-plugin"):void 0,actionText:(0,i.createElement)(i.Fragment,null,(0,i.createElement)(l.zx,{onClick:()=>k(!h),label:Pe("More options","newspack-plugin"),icon:m.Z,className:h&&"popover-active"}),h&&(0,i.createElement)(l.J2,{position:"bottom left",onKeyDown:e=>u.ESCAPE===e.keyCode&&_,onFocusOutside:_},(0,i.createElement)(d.MenuItem,{onClick:()=>_(),className:"screen-reader-text"},Pe("Close Popover","newspack-plugin")),(0,i.createElement)(d.MenuItem,{onClick:()=>b.push(`/segments/${t.id}`),className:"newspack-button"},Pe("Edit","newspack-plugin")),(0,i.createElement)(d.MenuItem,{onClick:()=>a(t),className:"newspack-button"},Pe("Delete","newspack-plugin"))))},(0,i.createElement)("div",{className:"newspack-campaigns__segment-priority-controls"},(0,i.createElement)("div",{className:"drag-handle",draggable:!0,onDragStart:e,onDragEnd:n},(0,i.createElement)(ye.Z,{icon:Ce,height:18,width:18})),(0,i.createElement)("div",{className:"movers"},(0,i.createElement)(l.zx,{icon:ze.Z,onClick:P,disabled:f,label:Pe("Move segment position up","newspack-plugin")}),(0,i.createElement)(l.zx,{icon:Se.Z,onClick:x,disabled:y,label:Pe("Move segment position down","newspack-plugin")})))))))},Fe=({wizardApiFetch:e,segments:t,setSegments:n,isLoading:a})=>{const[s,r]=(0,i.useState)(null),[p,c]=(0,i.useState)(null),[o,u]=(0,i.useState)(!1),[m,d]=(0,i.useState)(null),g=(0,i.useRef)(),w=t=>{u(!0),d(null),e({path:`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${t.id}`,method:"POST",quiet:!0,data:{name:t.name,configuration:{...t.configuration,is_disabled:!t.configuration.is_disabled},criteria:t.criteria}}).then((e=>{u(!1),n(e)})).catch((()=>{u(!1)}))},h=t=>{u(!0),d(null),e({path:`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${t.id}`,method:"DELETE",quiet:!0}).then((e=>{u(!1),n(e)})).catch((()=>{u(!1)}))},k=a=>{d(null),c(a),u(!0),e({path:"/newspack/v1/wizard/newspack-popups-wizard/segmentation-sort",method:"POST",data:{segmentIds:a.map((e=>e.id))},quiet:!0}).then((e=>{u(!1),c(null),n(e)})).catch((e=>{u(!1),d(e.message||Pe("There was an error sorting segments. Please try again.","newspack-plugin")),n(t)}))};if(null===t)return null;const v=p||t;return t.length?(0,i.createElement)(i.Fragment,null,m&&(0,i.createElement)(l.qX,{noticeText:m,isError:!0}),(0,i.createElement)(l.Zb,{headerActions:!0,noBorder:!0},(0,i.createElement)("h2",null,Pe("Audience segments","newspack-plugin")),(0,i.createElement)(Ne,null)),(0,i.createElement)("div",{className:"newspack-campaigns-wizard-segments__list"+(o?" is-loading":""),ref:g},v.map(((e,n)=>(0,i.createElement)(Oe,{deleteSegment:h,key:e.id,inFlight:o||a>0,segment:e,segments:t,sortSegments:k,index:n,wrapperRef:g,dropTargetIndex:s,setDropTargetIndex:r,totalSegments:t.length,toggleSegmentStatus:w}))))):(0,i.createElement)(i.Fragment,null,(0,i.createElement)(l.Zb,{headerActions:!0,noBorder:!0},(0,i.createElement)("h2",null,Pe("You have no saved audience segments.","newspack-plugin")),(0,i.createElement)(Ne,null)),(0,i.createElement)("p",null,Pe("Create audience segments to target visitors by engagement, activity, and more.","newspack-plugin")))};var Me=n(288);function Ie({label:e,help:t,placeholder:n,value:a,onChange:s,path:r}){const p=e=>({value:isNaN(parseInt(e.id))?e.id.toString():parseInt(e.id),label:e.title||e.name});return(0,i.createElement)(Me.Z,{label:e,help:t,placeholder:n,tokens:a||[],fetchSuggestions:async()=>{const e=await b()({path:r});return(Array.isArray(e)?e:Object.values(e)).map(p)},fetchSavedInfo:async e=>{const t=await b()({path:r});return(Array.isArray(t)?t:Object.values(t)).filter((t=>e.includes(t.id))).map(p)},onChange:s})}const Te=r.__,{useHistory:De}=l.F0,{SettingsCard:Ze,SettingsSection:He,MinMaxSetting:Ve}=l.Zr,$e={is_disabled:!1};(0,S.addFilter)("newspack.criteria.input","newspack.favoriteCategories",(function(e,t,n,a){return"favorite_categories"===t.id?(0,i.createElement)(l.HZ,{value:n||[],onChange:e=>{a(e.map((e=>e.id)))},label:t.name,hideLabelFromVision:!0}):e})),(0,S.addFilter)("newspack.criteria.input","newspack.newsletterSubscribedLists",(function(e,t,n,a){return["subscribed_lists","not_subscribed_lists"].includes(t.id)?(0,i.createElement)(Ie,{placeholder:Te("Start typing to search for lists…","newspack-plugin"),path:"/newspack-newsletters/v1/lists_config",value:n,onChange:a}):e})),(0,S.addFilter)("newspack.criteria.input","newspack.activeSubscriptions",(function(e,t,n,a){return["active_subscriptions","not_active_subscriptions"].includes(t.id)?(0,i.createElement)(Ie,{placeholder:Te("Start typing to search for products…","newspack-plugin"),path:"/newspack/v1/wizard/newspack-popups-wizard/subscription-products",value:n,onChange:a}):e})),(0,S.addFilter)("newspack.criteria.input","newspack.activeMemberships",(function(e,t,n,a){return["active_memberships","not_active_memberships"].includes(t.id)?(0,i.createElement)(Ie,{placeholder:Te("Start typing to search for membership plans…","newspack-plugin"),path:"/wc/v3/memberships/plans?per_page=100",value:n,onChange:a}):e}));const je=({segmentId:e,setSegments:t,wizardApiFetch:n})=>{const a=window.newspack_popups_wizard_data?.criteria||[],[s,r]=l.PT.useObjectState($e),[p,c]=(0,i.useState)(""),[o,u]=(0,i.useState)([]),[m,g]=(0,i.useState)([]),[w,h]=(0,i.useState)(""),k=De(),[v,E]=(0,i.useState)("[]"),_=m!==JSON.stringify(o)||w!==p||JSON.stringify(v.is_disabled)!==JSON.stringify(s.is_disabled),b=l.PT.usePrompt(_,Te("There are unsaved changes to this segment. Discard changes?","newspack-plugin")),f="new"===e;(0,i.useEffect)((()=>{f||n({path:"/newspack/v1/wizard/newspack-popups-wizard/segmentation"}).then((t=>{const n=de()(t,(({id:t})=>t===e));if(n){const e={...$e,...n.configuration};r(e),E(e),c(n.name),h(n.name),u([...n.criteria]),g(JSON.stringify(n.criteria))}}))}),[f]);const y=e=>{const t=(e=>{const t=o.find((t=>t.criteria_id===e));return t?t.value:""})(e.id),n=(a=e.id,e=>{const t=[...o],n=t.find((e=>e.criteria_id===a));n?!e||Array.isArray(e)&&0===e.length?t.splice(t.indexOf(n),1):Array.isArray(e)||"object"!=typeof e?n.value=e:n.value={...n.value,...e}:e&&t.push({criteria_id:a,value:e}),u(t)});var a;return(0,S.applyFilters)("newspack.criteria.input","range"===e.matching_function?(0,i.createElement)(Ve,{"data-testid":`newspack-criteria-${e.id}`,min:t?.min,max:t?.max,onChangeMin:e=>n({min:e}),onChangeMax:e=>n({max:e})}):e.options?.length?(0,i.createElement)(l.Yw,{"data-testid":`newspack-criteria-${e.id}`,isWide:!0,onChange:n,value:t,options:e.options}):(0,i.createElement)(l.w4,{"data-testid":`newspack-criteria-${e.id}`,isWide:!0,placeholder:e.placeholder,help:e.help,value:t,onChange:n}),e,t,n)};return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(l.w4,{placeholder:Te("Untitled Segment","newspack-plugin"),value:p,onChange:c,label:Te("Title","newspack-plugin"),className:"newspack-campaigns-wizard-segments__title"}),(0,i.createElement)(Ze,{title:Te("Segment Status","newspack-plugin"),description:Te("If not enabled, the segment will be ignored for reader segmentation.","newspack-plugin"),noBorder:!0},(0,i.createElement)(d.ToggleControl,{label:Te("Segment enabled","newspack-plugin"),checked:!s.is_disabled,onChange:()=>r({is_disabled:!s.is_disabled})})),(0,i.createElement)(Ze,{title:Te("Reader Engagement","newspack-plugin"),description:Te("Target readers based on their browsing behavior.","newspack-plugin"),noBorder:!0},a.filter((e=>"reader_engagement"===e.category)).map((e=>(0,i.createElement)(He,{key:e.id,title:e.name,description:e.description},y(e))))),(0,i.createElement)(Ze,{title:Te("Registration","newspack-plugin"),description:Te("Target readers based on their user account registration status.","newspack-plugin"),columns:3,noBorder:!0},a.filter((e=>"reader_activity"===e.category)).map((e=>(0,i.createElement)(He,{key:e.id,title:e.name,description:e.description},y(e))))),(0,i.createElement)(Ze,{title:Te("Newsletters","newspack-plugin"),description:Te("Target readers based on their newsletter subscription status.","newspack-plugin"),columns:3,noBorder:!0},a.filter((e=>"newsletter"===e.category)).map((e=>(0,i.createElement)(He,{key:e.id,title:e.name,description:e.description},y(e))))),(0,i.createElement)(Ze,{title:Te("Reader Revenue","newspack-plugin"),description:Te("Target readers based on their revenue activity.","newspack-plugin"),columns:3,noBorder:!0},a.filter((e=>"reader_revenue"===e.category)).map((e=>(0,i.createElement)(He,{key:e.id,title:e.name,description:e.description},y(e))))),(0,i.createElement)(Ze,{title:Te("Referrer Sources","newspack-plugin"),description:Te("Target readers based on where they’re coming from.","newspack-plugin"),notification:Te("Segments using these options will apply only to the first page visited after coming from an external source.","newspack-plugin"),columns:2,noBorder:!0},a.filter((e=>"referrer_sources"===e.category)).map((e=>(0,i.createElement)(He,{key:e.id,title:e.name,description:e.description},y(e))))),(0,i.createElement)("div",{className:"newspack-buttons-card"},(0,i.createElement)(l.zx,{disabled:!(()=>{const e={...s},t={...$e};return delete e.is_disabled,delete t.is_disabled,p.length>0&&o.length})()||!f&&!_,isPrimary:!0,onClick:()=>{b(),n({path:f?"/newspack/v1/wizard/newspack-popups-wizard/segmentation":`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${e}`,method:"POST",data:{name:p,criteria:o,configuration:s},quiet:!0}).then(t).then(k.push("/segments"))}},Te("Save","newspack-plugin")),(0,i.createElement)(l.zx,{isSecondary:!0,href:"#/segments"},Te("Cancel","newspack-plugin"))))},Re=(0,l.a4)((({wizardApiFetch:e,match:t,...n})=>{const s=t.params.id;return s?(0,i.createElement)(je,(0,a.Z)({segmentId:s,wizardApiFetch:e},n)):(0,i.createElement)(Fe,(0,a.Z)({wizardApiFetch:e},n))})),qe=r.__,{HashRouter:Be,Redirect:Le,Route:Ge,Switch:We}=o.Z,Ue=qe("Campaigns","newspack-plugin"),Ye=qe("Reach your readers with configurable campaigns","newspack-plugin"),Je=[{label:qe("Campaigns","newpack-plugin"),path:"/campaigns",exact:!0},{label:qe("Segments","newpack-plugin"),path:"/segments",exact:!0},{label:qe("Analytics","newpack-plugin"),path:"/analytics",exact:!0},{label:qe("Settings","newpack-plugin"),path:"/settings",exact:!0}];class Ke extends i.Component{constructor(e){super(e),(0,s.Z)(this,"onWizardReady",(()=>{this.refetch()})),(0,s.Z)(this,"refetch",(()=>{const{setError:e,wizardApiFetch:t}=this.props;t({path:"/newspack/v1/wizard/newspack-popups-wizard/"}).then(this.updateAfterAPI).catch((t=>e(t)))})),(0,s.Z)(this,"updatePopup",(({id:e,...t})=>{const{setError:n,wizardApiFetch:a}=this.props;return this.setState({inFlight:!0}),a({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}`,method:"POST",data:{config:t},quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e)))})),(0,s.Z)(this,"deletePopup",(e=>{const{setError:t,wizardApiFetch:n}=this.props;return n({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}`,method:"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,s.Z)(this,"restorePopup",(e=>{const{setError:t,wizardApiFetch:n}=this.props;return n({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/restore`,method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,s.Z)(this,"publishPopup",(e=>{const{setError:t,wizardApiFetch:n}=this.props;return n({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/publish`,method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,s.Z)(this,"unpublishPopup",(e=>{const{setError:t,wizardApiFetch:n}=this.props;return n({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/publish`,method:"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,s.Z)(this,"duplicatePopup",((e,t)=>{const{setError:n,wizardApiFetch:a}=this.props;return this.setState({inFlight:!0}),a({path:(0,p.addQueryArgs)(`/newspack/v1/wizard/newspack-popups-wizard/${e}/duplicate`,{title:t}),method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((()=>{n({code:"duplicate_prompt_error",message:qe("Error duplicating prompt. Please try again later.","newspack-plugin")})}))})),(0,s.Z)(this,"previewUrlForPopup",(({options:e,id:t})=>{const{placement:n,trigger_type:a}=e,s=window.newspack_popups_wizard_data?.preview_query_keys||{},i={};Object.keys(e).forEach((t=>{s.hasOwnProperty(t)&&(i[s[t]]=e[t])}));let r="/";return"archives"===n&&window.newspack_popups_wizard_data?.preview_archive?r=window.newspack_popups_wizard_data.preview_archive:("inline"===n||"scroll"===a)&&window&&window.newspack_popups_wizard_data?.preview_post&&(r=window.newspack_popups_wizard_data?.preview_post),`${r}?${(0,c.stringify)({...i,pid:t})}`})),(0,s.Z)(this,"updateAfterAPI",(({campaigns:e,prompts:t,segments:n,settings:a,duplicated:s=null})=>this.setState({campaigns:e,prompts:t,segments:n,settings:a,duplicated:s,inFlight:!1}))),(0,s.Z)(this,"manageCampaignGroup",((e,t="POST")=>{const{setError:n,wizardApiFetch:a}=this.props;return a({path:"/newspack/v1/wizard/newspack-popups-wizard/batch-publish/",data:{ids:e.map((e=>e.id))},method:t,quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e)))})),this.state={campaigns:[],prompts:[],segments:[],settings:[],previewUrl:null,duplicated:null,inFlight:!1}}render(){const{pluginRequirements:e,setError:t,isLoading:n,wizardApiFetch:s,startLoading:r,doneLoading:p}=this.props,{campaigns:c,inFlight:o,prompts:u,segments:m,settings:d,previewUrl:g,duplicated:w}=this.state;return(0,i.createElement)(l.BA,{url:g,renderButton:({showPreview:l})=>{const g={headerText:Ue,subHeaderText:Ye,tabbedNavigation:Je,setError:t,isLoading:n,startLoading:r,doneLoading:p,wizardApiFetch:s,prompts:u,segments:m,settings:d,duplicated:w,inFlight:o},h={...g,manageCampaignGroup:this.manageCampaignGroup,updatePopup:this.updatePopup,deletePopup:this.deletePopup,restorePopup:this.restorePopup,duplicatePopup:this.duplicatePopup,previewPopup:e=>this.setState({previewUrl:this.previewUrlForPopup(e)},(()=>l())),publishPopup:this.publishPopup,resetDuplicated:()=>this.setState({duplicated:null}),unpublishPopup:this.unpublishPopup,refetch:this.refetch};return(0,i.createElement)(Be,{hashType:"slash"},(0,i.createElement)(We,null,e,(0,i.createElement)(Ge,{path:"/campaigns/:id?",render:e=>{const n=e.match.params.id;return(0,i.createElement)(le.Provider,{value:u},(0,i.createElement)(Ee,(0,a.Z)({},h,{archiveCampaignGroup:(e,n)=>s({path:`/newspack/v1/wizard/newspack-popups-wizard/archive-campaign/${e}`,method:n?"POST":"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e))),campaignId:n,createCampaignGroup:n=>s({path:"/newspack/v1/wizard/newspack-popups-wizard/create-campaign/",method:"POST",data:{name:n},quiet:!0}).then((t=>{this.setState({campaigns:t.campaigns,prompts:t.prompts,segments:t.segments,settings:t.settings}),e.history.push(`/campaigns/${t.term_id}`)})).catch((e=>t(e))),deleteCampaignGroup:n=>s({path:`/newspack/v1/wizard/newspack-popups-wizard/delete-campaign/${n}`,method:"DELETE",quiet:!0}).then((t=>{this.setState({campaigns:t.campaigns,prompts:t.prompts,segments:t.segments,settings:t.settings}),e.history.push("/campaigns/")})).catch((e=>t(e))),duplicateCampaignGroup:(n,a)=>s({path:`/newspack/v1/wizard/newspack-popups-wizard/duplicate-campaign/${n}`,method:"POST",data:{name:a},quiet:!0}).then((t=>{this.setState({campaigns:t.campaigns,prompts:t.prompts,segments:t.segments,settings:t.settings}),e.history.push(`/campaigns/${t.term_id}`)})).catch((e=>t(e))),renameCampaignGroup:(e,n)=>s({path:`/newspack/v1/wizard/newspack-popups-wizard/rename-campaign/${e}`,method:"POST",data:{name:n},quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e))),campaigns:c})))}}),(0,i.createElement)(Ge,{path:"/segments/:id?",render:e=>(0,i.createElement)(Re,(0,a.Z)({},e,g,{setSegments:e=>this.setState({segments:e})}))}),(0,i.createElement)(Ge,{path:"/analytics",render:()=>(0,i.createElement)(be,g)}),(0,i.createElement)(Ge,{path:"/settings",render:()=>(0,i.createElement)(fe,g)}),(0,i.createElement)(Le,{to:"/campaigns"})))}})}}(0,i.render)((0,i.createElement)((0,l.uF)(Ke,["newspack-popups"])),document.getElementById("newspack-popups-wizard"))},9196:e=>{"use strict";e.exports=window.React},6292:e=>{"use strict";e.exports=window.moment},6989:e=>{"use strict";e.exports=window.wp.apiFetch},5609:e=>{"use strict";e.exports=window.wp.components},9818:e=>{"use strict";e.exports=window.wp.data},9307:e=>{"use strict";e.exports=window.wp.element},2694:e=>{"use strict";e.exports=window.wp.hooks},2629:e=>{"use strict";e.exports=window.wp.htmlEntities},5736:e=>{"use strict";e.exports=window.wp.i18n},9630:e=>{"use strict";e.exports=window.wp.keycodes},444:e=>{"use strict";e.exports=window.wp.primitives},6483:e=>{"use strict";e.exports=window.wp.url}},n={};function a(e){var s=n[e];if(void 0!==s)return s.exports;var i=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.loaded=!0,i.exports}a.m=t,e=[],a.O=(t,n,s,i)=>{if(!n){var r=1/0;for(o=0;o<e.length;o++){for(var[n,s,i]=e[o],p=!0,c=0;c<n.length;c++)(!1&i||r>=i)&&Object.keys(a.O).every((e=>a.O[e](n[c])))?n.splice(c--,1):(p=!1,i<r&&(r=i));if(p){e.splice(o--,1);var l=s();void 0!==l&&(t=l)}}return t}i=i||0;for(var o=e.length;o>0&&e[o-1][2]>i;o--)e[o]=e[o-1];e[o]=[n,s,i]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.j=964,(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={964:0};a.O.j=t=>0===e[t];var t=(t,n)=>{var s,i,[r,p,c]=n,l=0;if(r.some((t=>0!==e[t]))){for(s in p)a.o(p,s)&&(a.m[s]=p[s]);if(c)var o=c(a)}for(t&&t(n);l<r.length;l++)i=r[l],a.o(e,i)&&e[i]&&e[i][0](),e[r[l]]=0;return a.O(o)},n=globalThis.webpackChunkwebpack=globalThis.webpackChunkwebpack||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=a.O(void 0,[351],(()=>a(9661)));s=a.O(s);var i=window;for(var r in s)i[r]=s[r];s.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})})();