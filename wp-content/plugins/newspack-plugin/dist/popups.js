(()=>{var e,n={4950:(e,n,s)=>{"use strict";s(8209);var t=s(6087),a=s(7723),i=s(3832),p=s(5373),r=s(1727),c=s(216),o=s(8558),l=s(8169),d=s(6427),u=s(790);const g=({dismiss:e,hasPrompts:n,hasPublished:s,isArchive:t,onActivate:i,onArchive:p,onDeactivate:c,onDelete:l,onDuplicate:g,onRename:h,onUnarchive:m})=>(0,u.jsxs)(r.AM,{position:"bottom right",onFocusOutside:()=>e(),onKeyDown:n=>o.ESCAPE===n.keyCode&&e(),children:[(0,u.jsx)(d.MenuItem,{onClick:()=>e(),className:"screen-reader-text",children:(0,a.__)("Close Popover","newspack-plugin")}),n&&(0,u.jsx)(d.MenuItem,{onClick:()=>{e(),i()},className:"newspack-button",children:(0,a.__)("Activate all prompts","newspack-plugin")}),s&&(0,u.jsx)(d.MenuItem,{onClick:()=>{e(),c()},className:"newspack-button",children:(0,a.__)("Deactivate all prompts","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>{e(),g()},className:"newspack-button",children:(0,a.__)("Duplicate","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>{e(),h()},className:"newspack-button",children:(0,a.__)("Rename","newspack-plugin")}),!t&&(0,u.jsx)(d.MenuItem,{onClick:()=>{e(),p()},className:"newspack-button",children:(0,a.__)("Archive","newspack-plugin")}),t&&(0,u.jsx)(d.MenuItem,{onClick:()=>{e(),m()},className:"newspack-button",children:(0,a.__)("Unarchive","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>{e(),l()},className:"newspack-button",children:(0,a.__)("Delete","newspack-plugin")})]});var h=s(5573);const m=(0,u.jsx)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(h.Path,{d:"M18.5 10.5H10v8h8a.5.5 0 00.5-.5v-7.5zm-10 0h-3V18a.5.5 0 00.5.5h2.5v-8zM6 4h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2z"})});var w=s(7209);const _=e=>{const[n,s]=(0,t.useState)(null),[a,p]=(0,t.useState)(!1),[c,o]=(0,t.useState)(Math.floor(9999*Math.random())),l=window?.newspack_popups_wizard_data?.preview_post,d=window?.newspack_popups_wizard_data?.frontend_url||"/",{campaign:g=!1,onLoad:h=(()=>{}),segment:m="",showUnpublished:w=!1,url:_=l||d}=e;(0,t.useEffect)((()=>{a||s(k(_))}),[a]);const k=e=>{const n=m.length?[`segment:${m}`]:["segment:everyone"];return w&&n.push("show_unpublished:true"),g?n.push(`campaign:${g}`):n.push("all"),n.push("session_id:"+c),(0,i.addQueryArgs)(e,{view_as:n.join(";")})};return(0,u.jsx)(r.LQ,{...e,onLoad:e=>{e&&([...e.contentWindow.document.querySelectorAll("a")].forEach((e=>{const n=e.getAttribute("href");0===n.indexOf(d)&&e.setAttribute("href",k(n))})),p(!0),h(e))},onClose:()=>{o(Math.floor(9999*Math.random())),p(!1)},url:n})};var k=s(1455),v=s.n(k),x=s(8537),b=s(9214);const j=({deletePopup:e,restorePopup:n,onFocusOutside:s,prompt:t,previewPopup:i,publishPopup:p,setIsDuplicatePromptModalVisible:c,unpublishPopup:l})=>{const{id:g,edit_link:h,status:m}=t,w="publish"===m,_="trash"===m;return(0,u.jsxs)(r.AM,{position:"bottom left",onFocusOutside:s,onKeyDown:e=>o.ESCAPE===e.keyCode&&s(),className:"newspack-popover__campaigns__primary-popover",children:[(0,u.jsx)(d.MenuItem,{onClick:()=>s(),className:"screen-reader-text",children:(0,a.__)("Close Popover","newspack-plugin")}),_?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(d.MenuItem,{onClick:()=>n(g),className:"newspack-button",children:(0,a.__)("Restore","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>e(g),className:"newspack-button",children:(0,a.__)("Delete permanently","newspack-plugin")})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(d.MenuItem,{onClick:()=>{s(),i(t)},className:"newspack-button",children:(0,a.__)("Preview","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{href:(0,x.decodeEntities)(h),className:"newspack-button",isLink:!0,children:(0,a.__)("Edit","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>c(!0),className:"newspack-button",children:(0,a.__)("Duplicate","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>{s(),(w?l:p)(g)},className:"newspack-button",children:w?(0,a.__)("Deactivate","newspack-plugin"):(0,a.__)("Activate","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>e(g),className:"newspack-button",children:(0,a.__)("Delete","newspack-plugin")})]}),(0,u.jsxs)("div",{className:"newspack-popover__campaigns__info",children:[(0,a.__)("ID:","newspack-plugin")," ",g]})]})};var f=s(2619),y=s(104),C=s.n(y),S=s(3673),z=s.n(S);const P=window.newspack_popups_wizard_data?.criteria||[],A=e=>-1<(window.newspack_popups_wizard_data?.overlay_placements||[]).indexOf(e.options.placement),N=e=>"above_header"===e.options.placement,O=e=>{const n=window.newspack_popups_wizard_data?.custom_placements||{};return-1<Object.keys(n).indexOf(e.options.placement)},F={top:(0,a.__)("Top Overlay","newspack-plugin"),top_left:(0,a.__)("Top Left Overlay","newspack-plugin"),top_right:(0,a.__)("Top Right Overlay","newspack-plugin"),center:(0,a.__)("Center Overlay","newspack-plugin"),center_left:(0,a.__)("Center Left Overlay","newspack-plugin"),center_right:(0,a.__)("Center Right Overlay","newspack-plugin"),bottom:(0,a.__)("Bottom Overlay","newspack-plugin"),bottom_left:(0,a.__)("Bottom Left Overlay","newspack-plugin"),bottom_right:(0,a.__)("Bottom Right Overlay","newspack-plugin"),inline:(0,a.__)("Inline","newspack-plugin"),archives:(0,a.__)("In archive pages","newspack-plugin"),above_header:(0,a.__)("Above Header","newspack-plugin"),manual:(0,a.__)("Manual Only","newspack-plugin")},E=({options:{frequency:e,placement:n}})=>{const s=window.newspack_popups_wizard_data?.custom_placements||{};return"manual"===e||s.hasOwnProperty(n)?(0,a.__)("Custom Placement","newspack-plugin"):F[n]},$=e=>{const n=window.newspack_popups_wizard_data?.custom_placements,s=window.newspack_popups_wizard_data?.overlay_placements,t=Object.keys(F).filter((n=>A(e)?-1<s.indexOf(n):-1===s.indexOf(n))).map((e=>({label:F[e],value:e})));return!A(e)&&n?t.concat(Object.keys(n).map((e=>({label:n[e],value:e})))):t},I={once:(0,a.__)("Once a month","newspack-plugin"),weekly:(0,a.__)("Once a week","newspack-plugin"),daily:(0,a.__)("Once a day","newspack-plugin"),always:(0,a.__)("Every pageview","newspack-plugin"),custom:(0,a.__)("Custom frequency (edit prompt to manage)","newspack-plugin")},M=(e,n=!1)=>"publish"!==e||n?"newspack-card__is-disabled":"newspack-card__is-supported",T=e=>{const{categories:n,tags:s,campaign_groups:t,status:i}=e,p=[];if(t.length>0){const e=t.map((({name:e})=>e)).join(", ");p.push((1===t.length?(0,a.__)("Campaign: ","newspack-plugin"):(0,a.__)("Campaigns: ","newspack-plugin"))+e)}return n.length>0&&p.push((0,a.__)("Categories: ","newspack-plugin")+n.map((e=>e.name)).join(", ")),s.length>0&&p.push((0,a.__)("Tags: ","newspack-plugin")+s.map((e=>e.name)).join(", ")),"pending"===i&&p.push((0,a.__)("Pending review","newspack-plugin")),"future"===i&&p.push((0,a.__)("Scheduled","newspack-plugin")),p.push((0,a.__)("Frequency: ","newspack-plugin")+G(e)),p.length?p.join(" | "):null},D=e=>{const n=[];if(e.configuration.is_disabled&&n.push((0,a.__)("Segment disabled","newspack-plugin")),e.criteria)for(const s of P){const t=e.criteria.find((({criteria_id:e})=>e===s.id));if(t?.value){let e=t.value;if(s.options){const n=s.options.find((({value:e})=>e===t.value));n&&(e=n.label)}if(Array.isArray(e))e=e.join(", ");else if("object"==typeof e){const n=[];for(const s in e)e[s]&&n.push(`${s}: ${e[s]}`);e=n.join(", ")}const i=(0,f.applyFilters)("newspack.wizards.campaigns.segmentDescription.criteriaMessage",(0,a.sprintf)("%1$s: %2$s",s.name,e),e,s,t);i&&n.push(i)}}return()=>(0,u.jsx)(t.Fragment,{children:n.map(((e,s)=>(0,u.jsxs)(t.Fragment,{children:[e," ",n.length!==s+1?" | ":null]},s)))})},R=C()((async e=>{const n=await Promise.all(e.map((async e=>{try{return(await v()({path:(0,i.addQueryArgs)("/wp/v2/categories/"+e,{_fields:"name"})})).name}catch(e){return""}})));return z()(n)})),V=({ids:e})=>{const[n,s]=(0,t.useState)([]);return(0,t.useEffect)((()=>{R(e).then(s)}),[e]),n.length?(0,u.jsxs)("span",{children:[(0,a.__)("Favorite Categories:","newspack-plugin")," ",n.length?n.join(", "):""]}):null};(0,f.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.favoriteCategories",((e,n,s,t)=>"favorite_categories"===s.id?t.value?.length?(0,u.jsx)(V,{ids:t.value}):null:e));const L=C()((async e=>{try{const n=await v()({path:e});return(Array.isArray(n)?n:Object.values(n)).map((e=>({id:isNaN(parseInt(e.id))?e.id.toString():parseInt(e.id),label:e.title||e.name})))}catch(e){return[]}})),q=({label:e,ids:n,path:s})=>{const[a,i]=(0,t.useState)([]);return(0,t.useEffect)((()=>{L(s).then(i)}),[n]),a.length?(0,u.jsxs)("span",{children:[e," ",a.length?a.filter((e=>n.includes(e.id))).map((e=>e.label)).join(", "):""]}):null};(0,f.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.newsletterSubscribedLists",((e,n,s,t)=>["subscribed_lists","not_subscribed_lists"].includes(s.id)?t.value?.length?(0,u.jsx)(q,{label:"subscribed_lists"===s.id?(0,a.__)("Subscribed to:","newspack-plugin"):(0,a.__)("Not subscribed to:","newspack-plugin"),ids:t.value,path:"/newspack-newsletters/v1/lists_config"}):null:e)),(0,f.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.activeSubscriptions",((e,n,s,t)=>["active_subscriptions","not_active_subscriptions"].includes(s.id)?t.value?.length?(0,u.jsx)(q,{label:"active_subscriptions"===s.id?(0,a.__)("Has active subscription(s):","newspack-plugin"):(0,a.__)("Does not have active subscription(s):","newspack-plugin"),ids:t.value,path:"/newspack/v1/wizard/newspack-popups-wizard/subscription-products"}):null:e)),(0,f.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.activeMemberships",((e,n,s,t)=>["active_memberships","not_active_memberships"].includes(s.id)?t.value?.length?(0,u.jsx)(q,{label:"active_memberships"===s.id?(0,a.__)("Has active membership(s):","newspack-plugin"):(0,a.__)("Does not have active membership(s):","newspack-plugin"),ids:t.value,path:"/wc/v3/memberships/plans?per_page=100"}):null:e));const B=e=>A(e)||N(e)?(0,a.sprintf)(
// Translators: %s is prompt type (above-header or overlay).
// Translators: %s is prompt type (above-header or overlay).
(0,a.__)("If multiple %s are rendered on the same pageview, only the most recent one will be displayed.","newspack-plugin"),N(e)?(0,a.__)("above-header prompts","newspack-plugin"):(0,a.__)("overlays","newspack-plugin")):O(e)?(0,a.__)("If multiple prompts are rendered in the same custom placement, only the most recent one will be displayed.","newspack-plugin"):"",H=(e,n)=>{const s=[];if("publish"===n.status&&(N(n)||A(n)||O(n))){const s=n.categories,t=e.filter((e=>{const t=e.categories,a=0===s.length&&0===t.length||s.some((e=>t.some((n=>e.term_id===n.term_id))));return"publish"===e.status&&e.id!==n.id&&(i=e,n.options.placement===i.options.placement)&&((e,n)=>{const s=e.map((e=>e.term_id)),t=n.map((e=>e.term_id));return!s.length&&!t.length||s.some((e=>-1<t.indexOf(e)))})(n.segments,e.segments)&&a;var i})),i=(0,f.applyFilters)("newspack.wizards.campaigns.conflictingPrompts",t,n,e);return 0<i.length?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("strong",{children:(0,a.sprintf)(
// Translators: %s: 'Conflicts' or 'Conflict' depending on number of conflicts.
// Translators: %s: 'Conflicts' or 'Conflict' depending on number of conflicts.
(0,a.__)("%s detected:","newspack-plugin"),1<i.length?(0,a.__)("Conflicts","newspack-plugin"):(0,a.__)("Conflict","newspack-plugin"))}),(0,u.jsx)("ul",{children:i.map((e=>(0,u.jsx)("li",{children:(0,u.jsxs)("p",{"data-testid":`conflict-warning-${n.id}`,children:[(0,u.jsx)("strong",{children:(0,a.sprintf)("%s: ",e.title)}),(0,u.jsx)("span",{children:B(n)})]})},e.id)))})]}):null}return s.length?s.join(" "):null},G=({options:{frequency:e}})=>I[e],{SettingsCard:U}=r.wB,J=({prompt:e,disabled:n,onClose:s,updatePopup:i})=>{const[p,c]=r.JL.useObjectState(e),{excluded_categories:o=[],excluded_tags:l=[]}=p.options||{},[d,g]=(0,t.useState)(0<o.length||0<l.length||!1);return(0,u.jsxs)(r.aF,{title:e.title,onRequestClose:s,isWide:!0,children:[(0,u.jsx)(r.$n,{onClick:()=>s(),className:"screen-reader-text",children:(0,a.__)("Close Modal","newspack-plugin")}),(0,u.jsxs)(r.xA,{gutter:64,columns:1,children:[(0,u.jsx)(U,{title:(0,a.__)("Campaigns","newspack-plugin"),description:(0,a.__)("Assign a prompt to one or more campaigns for easier management","newspack-plugin"),columns:1,className:"newspack-settings__campaigns",noBorder:!0,children:(0,u.jsx)(r.vn,{disabled:n,value:p.campaign_groups||[],onChange:e=>c({campaign_groups:e}),label:(0,a.__)("Campaigns","newspack-plugin"),taxonomy:"newspack_popups_taxonomy",hideLabelFromVision:!0})}),(0,u.jsxs)(U,{title:(0,a.__)("Settings","newspack-plugin"),description:(0,a.__)("When and how should the prompt be displayed","newspack-plugin"),columns:A(e)?3:2,className:"newspack-settings__settings",rowGap:16,noBorder:!0,children:[(0,u.jsx)(r.Yq,{label:(0,a.__)("Frequency","newspack-plugin"),disabled:n,onChange:e=>{c({options:{frequency:e}})},options:Object.keys(I).map((e=>({label:I[e],value:e}))),value:p.options.frequency}),(0,u.jsx)(r.Yq,{label:A(e)?(0,a.__)("Position","newspack-plugin"):(0,a.__)("Placement","newspack-plugin"),disabled:n,onChange:e=>{c({options:{placement:e}})},options:$(e),value:p.options.placement}),A(e)&&(0,u.jsx)(r.Yq,{label:(0,a.__)("Size","newspack-plugin"),disabled:n,onChange:e=>{c({options:{overlay_size:e}})},options:window.newspack_popups_wizard_data?.overlay_sizes,value:p.options.overlay_size})]}),(0,u.jsxs)(U,{title:(0,a.__)("Targeting","newspack-plugin"),description:()=>(0,u.jsxs)(u.Fragment,{children:[(0,a.__)("Under which conditions should the prompt be displayed","newspack-plugin"),(0,u.jsx)("br",{}),(0,a.__)("If multiple conditions are set, all will have to be satisfied in order to display the prompt","newspack-plugin")]}),className:"newspack-settings__targeting",columns:1,rowGap:16,noBorder:!0,children:[(0,u.jsxs)(r.xA,{columns:3,rowGap:16,children:[(0,u.jsx)(r.vn,{disabled:n,value:p.segments||[],onChange:e=>c({segments:e}),label:(0,a.__)("Segments","newspack-plugin"),taxonomy:"popup_segment"}),(0,u.jsx)(r.vn,{label:(0,a.__)("Post categories","newspack-plugin"),disabled:n,hideHelpFromVision:!0,value:p.categories||[],onChange:e=>c({categories:e}),description:(0,a.__)("Prompt will only appear on posts with the specified categories.","newspack-plugin")}),(0,u.jsx)(r.vn,{label:(0,a.__)("Post tags","newspack-plugin"),disabled:n,hideHelpFromVision:!0,taxonomy:"tags",value:p.tags||[],onChange:e=>c({tags:e}),description:(0,a.__)("Prompt will only appear on posts with the specified tags.","newspack-plugin")})]}),(0,u.jsx)("div",{children:(0,u.jsx)(r.$n,{isLink:!0,onClick:()=>g(!d),children:(0,a.sprintf)(
// Translators: whether to show or hide advanced settings fields.
// Translators: whether to show or hide advanced settings fields.
(0,a.__)("%s Advanced Settings","newspack-plugin"),d?(0,a.__)("Hide","newspack-plugin"):(0,a.__)("Show","newspack-plugin"))})}),d&&(0,u.jsxs)(r.xA,{columns:3,rowGap:16,children:[(0,u.jsx)(r.vn,{label:(0,a.__)("Category Exclusions","newspack-plugin"),disabled:n,hideHelpFromVision:!0,value:o||[],onChange:e=>c({options:{excluded_categories:e.map((e=>e.id))}}),description:(0,a.__)("Prompt will not appear on posts with the specified categories.","newspack-plugin")}),(0,u.jsx)(r.vn,{label:(0,a.__)("Tag Exclusions","newspack-plugin"),disabled:n,hideHelpFromVision:!0,taxonomy:"tags",value:l||[],onChange:e=>c({options:{excluded_tags:e.map((e=>e.id))}}),description:(0,a.__)("Prompt will not appear on posts with the specified tags.","newspack-plugin")})]})]})]}),(0,u.jsxs)(r.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,u.jsx)(r.$n,{onClick:s,variant:"secondary",children:(0,a.__)("Cancel","newspack-plugin")}),(0,u.jsx)(r.$n,{onClick:()=>{i(p).then(s)},variant:"primary",children:(0,a.__)("Save","newspack-plugin")})]})]})},W=e=>{const[n,s]=(0,t.useState)(!1),[i,p]=(0,t.useState)(!1),[c,o]=(0,t.useState)(!1),[d,g]=(0,t.useState)(null),{className:h,description:m,duplicated:w,duplicatePopup:_,inFlight:k,resetDuplicated:f,prompt:y={},segments:C,warning:S}=e,{campaign_groups:z,id:P,edit_link:A,title:N}=y;(0,t.useEffect)((()=>{c&&!d&&O()}),[c]);const O=async()=>{const e=parseInt(y?.duplicate_of||y.id);try{const n=await v()({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/${y.id}/duplicate`});g(n)}catch(e){g(N+(0,a.__)(" copy","newspack-plugin"))}};return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(r.Lz,{isSmall:!0,badge:E(y),className:h,title:N.length?(0,x.decodeEntities)(N):(0,a.__)("(no title)","newspack-plugin"),titleLink:(0,x.decodeEntities)(A),description:m,notification:S,notificationLevel:"error",actionText:(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)("div",{className:"newspack-popups-wizard__buttons",children:[(0,u.jsx)(r.$n,{className:n&&"popover-active",onClick:()=>s(!n),icon:b.A,label:(0,a.__)("Prompt settings","newspack-plugin"),tooltipPosition:"bottom center"}),(0,u.jsx)(r.$n,{className:i&&"popover-active",onClick:()=>p(!i),icon:l.A,label:(0,a.__)("More options","newspack-plugin"),tooltipPosition:"bottom center"}),i&&(0,u.jsx)(j,{onFocusOutside:()=>p(!1),prompt:y,setIsDuplicatePromptModalVisible:o,...e})]})})},P),n&&(0,u.jsx)(J,{prompt:y,disabled:k,onClose:()=>s(!1),segments:C,updatePopup:e.updatePopup}),c&&(0,u.jsx)(r.aF,{className:"newspack-popups__duplicate-modal",title:
// Translators: %s: The title of the item.
// Translators: %s: The title of the item.
(0,a.sprintf)((0,a.__)("Duplicate “%s”","newspack-plugin"),N),onRequestClose:()=>{o(!1),g(null),f()},children:w?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(r.$T,{isSuccess:!0,noticeText:(0,a.sprintf)(
// Translators: %s: The title of the item.
// Translators: %s: The title of the item.
(0,a.__)("Duplicate of “%s” created as a draft.","newspack-plugin"),N)}),!z&&(0,u.jsx)(r.$T,{isWarning:!0,noticeText:(0,a.__)("This prompt is currently not assigned to any campaign.","newspack-plugin")}),(0,u.jsxs)(r.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,u.jsx)(r.$n,{isSecondary:!0,onClick:()=>{o(!1),g(null),f()},children:(0,a.__)("Close","newspack-plugin")}),(0,u.jsx)(r.$n,{isPrimary:!0,href:`/wp-admin/post.php?post=${w}&action=edit`,children:(0,a.__)("Edit","newspack-plugin")})]})]}):(0,u.jsxs)(u.Fragment,{children:[!z&&(0,u.jsx)(r.$T,{isWarning:!0,noticeText:(0,a.__)("This prompt will not be assigned to any campaign.","newspack-plugin")}),(0,u.jsx)(r.xt,{disabled:k||null===d,label:(0,a.__)("Title","newspack-plugin"),value:d,onChange:e=>g(e)}),(0,u.jsxs)(r.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,u.jsx)(r.$n,{disabled:k,isSecondary:!0,onClick:()=>{o(!1),g(null),f()},children:(0,a.__)("Cancel","newspack-plugin")}),(0,u.jsx)(r.$n,{disabled:k||null===d,isPrimary:!0,onClick:()=>{const e=d.trim()||O();_(P,e)},children:(0,a.__)("Duplicate","newspack-plugin")})]})]})})]})},Z=(0,u.jsx)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24",children:(0,u.jsx)(d.Path,{d:"M4 9h16v2H4V9zm0 4h10v2H4v-2z"})}),Y=(0,u.jsxs)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24",children:[(0,u.jsx)(d.Path,{d:"M17 14H7v3h10v-3z"}),(0,u.jsx)(d.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})]}),Q=(0,u.jsxs)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24",children:[(0,u.jsx)(d.Path,{d:"M16 10H8v4h8v-4z"}),(0,u.jsx)(d.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})]}),K=(0,u.jsxs)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24",children:[(0,u.jsx)(d.Path,{d:"M17 7H7v3h10V7z"}),(0,u.jsx)(d.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})]}),X=(0,u.jsx)(d.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,u.jsx)(d.Path,{d:"M18 4H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm.5 14c0 .3-.2.5-.5.5H6c-.3 0-.5-.2-.5-.5V6c0-.3.2-.5.5-.5h12c.3 0 .5.2.5.5v12zM7 11h2V9H7v2zm0 4h2v-2H7v2zm3-4h7V9h-7v2zm0 4h7v-2h-7v2z"})}),ee=(0,u.jsx)(d.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,u.jsx)(d.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v3.5h-15V5c0-.3.2-.5.5-.5zm8 5.5h6.5v3.5H13V10zm-1.5 3.5h-7V10h7v3.5zm-7 5.5v-4h7v4.5H5c-.3 0-.5-.2-.5-.5zm14.5.5h-6V15h6.5v4c0 .3-.2.5-.5.5z"})}),ne=(e,n,s)=>{const t=[];return e&&t.push(`placement=${e}`),+n>0&&t.push(`group=${n}`),s&&t.push(`segment=${s}`),"/wp-admin/post-new.php?post_type=newspack_popups_cpt&"+t.join("&")},se=e=>{const{campaignData:n,campaignId:s,segment:i}=e,[p,c]=(0,t.useState)(!1),{label:o,id:l,prompts:d}=i,g="unassigned"!==s?parseInt(s):-1;let h;h="unassigned"===s?(0,a.__)("No unassigned prompts in this segment.","newspack-plugin"):n?(0,a.__)("No prompts in this segment for","newspack-plugin")+" "+n.name+".":(0,a.__)("No active prompts in this segment.","newspack-plugin");const k=D(i);return(0,u.jsxs)(r.Zp,{isSmall:!0,className:"newspack-campaigns__segment-group__card",children:[(0,u.jsxs)("div",{className:"newspack-campaigns__segment-group__card__segment",children:[(0,u.jsxs)("div",{className:"newspack-campaigns__segment-group__card__segment-title",children:[(0,u.jsx)("h3",{children:l?(0,u.jsxs)(r.$n,{href:`#/segments/${l}`,label:(0,a.__)("Edit Segment ","newspack-plugin"),isLink:!0,showTooltip:!0,tooltipPosition:"bottom center",children:[(0,a.__)("Segment: ","newspack-plugin"),o]}):o}),(0,u.jsx)("span",{className:"newspack-campaigns__segment-group__description",children:l?k():(0,a.__)("All readers, regardless of segment","newspack-plugin")})]}),(0,u.jsxs)("div",{className:"newspack-campaigns__segment-group__card__segment-actions",children:[(0,u.jsx)(_,{campaign:!!s&&g,segment:l,showUnpublished:!!s,renderButton:({showPreview:e})=>(0,u.jsx)(r.$n,{isSmall:!0,variant:"tertiary",onClick:()=>e(),children:(0,a.__)("Preview Segment","newspack-plugin")})}),"unassigned"!==s&&(0,u.jsxs)(t.Fragment,{children:[(0,u.jsx)(r.$n,{isSmall:!0,variant:"secondary",onClick:()=>c(!p),children:(0,a.__)("Add New Prompt","newspack-plugin")}),p&&(0,u.jsx)(r.aF,{title:(0,a.__)("Add New Prompt","newspack-plugin"),onRequestClose:()=>c(!1),shouldCloseOnEsc:!1,shouldCloseOnClickOutside:!1,isWide:!0,children:(0,u.jsxs)(r.xA,{gutter:32,columns:3,children:[(0,u.jsx)(r.dr,{href:ne("overlay-center",s,l),title:(0,a.__)("Center Overlay","newspack-plugin"),desc:(0,a.__)("Fixed at the center of the screen","newspack-plugin"),icon:Q}),(0,u.jsx)(r.dr,{href:ne("overlay-top",s,l),title:(0,a.__)("Top Overlay","newspack-plugin"),desc:(0,a.__)("Fixed at the top of the screen","newspack-plugin"),icon:K}),(0,u.jsx)(r.dr,{href:ne("overlay-bottom",s,l),title:(0,a.__)("Bottom Overlay","newspack-plugin"),desc:(0,a.__)("Fixed at the bottom of the screen","newspack-plugin"),icon:Y}),(0,u.jsx)(r.dr,{href:ne(null,s,l),title:(0,a.__)("Inline","newspack-plugin"),desc:(0,a.__)("Embedded in content","newspack-plugin"),icon:Z}),(0,u.jsx)(r.dr,{href:ne("archives",s,l),title:(0,a.__)("In Archive Pages","newspack-plugin"),desc:(0,a.__)("Embedded once or many times in archive pages","newspack-plugin"),icon:X}),(0,u.jsx)(r.dr,{href:ne("above-header",s,l),title:(0,a.__)("Above Header","newspack-plugin"),desc:(0,a.__)("Embedded at the very top of the page","newspack-plugin"),icon:m}),(0,u.jsx)(r.dr,{href:ne("custom",s,l),title:(0,a.__)("Custom Placement","newspack-plugin"),desc:(0,a.__)("Only appears when placed in content","newspack-plugin"),icon:w.A}),(0,u.jsx)(r.dr,{href:ne("manual",s,l),title:(0,a.__)("Manual Only","newspack-plugin"),desc:(0,a.__)("Only appears where Single Prompt block is inserted","newspack-plugin"),icon:ee})]})})]})]})]}),(0,u.jsx)(r.Zp,{noBorder:!0,className:"newspack-campaigns__segment-group__action-cards",children:d.map((n=>(0,u.jsx)(W,{className:M(n.status,i.configuration.is_disabled),description:T(n),warning:H(d,n),prompt:n,...e},n.id)))}),d.length<1?(0,u.jsx)("p",{children:h}):""]})},te=(0,t.createContext)({prompts:[]});var ae=s(6942),ie=s.n(ae),pe=s(7309),re=s.n(pe);const{useHistory:ce}=r.Ix,oe="active",le=e=>2===e?(0,a.__)("Rename Campaign","newspack-plugin"):1===e?(0,a.__)("Duplicate Campaign","newspack-plugin"):(0,a.__)("Add New Campaign","newspack-plugin"),de=e=>2===e?(0,a.__)("Rename","newspack-plugin"):1===e?(0,a.__)("Duplicate","newspack-plugin"):(0,a.__)("Add","newspack-plugin"),ue=(e,n)=>{if("trash"===n)return e.filter((({status:e})=>"trash"===e));const s=e.filter((({status:e})=>"trash"!==e));return oe===n?s.filter((({status:e})=>"publish"===e)):"all"===n?s.filter((({status:e})=>"trash"!==e)):"unassigned"===n?s.filter((({campaign_groups:e})=>!e||!e.length)):s.filter((({campaign_groups:e})=>e&&e.find((e=>+e.term_id==+n))))},ge=(e,n)=>{const s=[];return s.push(...e.map((({name:e,id:s,configuration:t,criteria:a})=>({label:e,id:s,configuration:t,criteria:a,prompts:n.filter((({segments:e})=>!!e&&!!e.find((e=>e.term_id===parseInt(s)))))})))),s.push({label:(0,a.__)("Everyone","newspack-plugin"),id:"",prompts:n.filter((({segments:e})=>0===e.length)),configuration:{}}),s},he=(0,r.c_)((e=>{const{campaignId:n=oe,campaigns:s=[],manageCampaignGroup:i,segments:p,createCampaignGroup:c,duplicateCampaignGroup:d,deleteCampaignGroup:h,archiveCampaignGroup:m,renameCampaignGroup:w}=e,_=(0,t.useRef)(null),[k,v]=(0,t.useState)(),[x,b]=(0,t.useState)(),[j,f]=(0,t.useState)(),[y,C]=(0,t.useState)(),S=(0,t.useContext)(te),z=ue(S,n),P=ue(S,"unassigned").length;(0,t.useEffect)((()=>{x&&_.current.querySelector("input").focus()}),[x]);const A=ce(),N=e=>{3===j?c(e):2===j?w(n,e):1===j&&d(n,e),b(!1)},O=s.filter((({status:e})=>"archive"!==e)),F=s.filter((({status:e})=>"archive"===e)),E=((e,n)=>n.reduce(((n,s)=>+e>0&&+e==+s.term_id?s:n),null))(n,s),$=[{key:oe,name:(0,a.__)("Active Prompts","newspack-plugin")},{key:"all",name:(0,a.__)("All Prompts","newspack-plugin")},{key:"trash",name:(0,a.__)("Trash","newspack-plugin")},...P?[{key:"unassigned",name:(0,a.__)("Unassigned Prompts","newspack-plugin")}]:[],...O.length?[{key:"header-campaigns",name:(0,a.__)("Campaigns","newspack-plugin"),className:"is-header"}]:[],...O.map((({term_id:e,name:n})=>({key:String(e),name:n,className:"newspack-campaigns__campaign-group__select-control-group-item"}))),...F.length?[{key:"header-archived-campaigns",name:(0,a.__)("Archived Campaigns","newspack-plugin"),className:"is-header"}]:[],...F.map((({term_id:e,name:n})=>({key:String(e),name:n+" "+(0,a.__)("(archived)","newspack-plugin"),className:"newspack-campaigns__campaign-group__select-control-group-item"})))];return(0,u.jsxs)(t.Fragment,{children:[(0,u.jsxs)(r.Zp,{headerActions:!0,noBorder:!0,children:[(0,u.jsxs)("div",{className:"newspack-campaigns__campaign-group__filter-group-actions",children:[(0,u.jsx)(r.Jv,{label:(0,a.__)("Campaigns","newspack-plugin"),options:$.map((e=>({...e,className:ie()(e.className,{"is-selected":e.key===n})}))),onChange:({selectedItem:{key:e}})=>oe===e?A.push("/campaigns"):A.push(`/campaigns/${e}`),value:re()($,["key",n||oe]),hideLabelFromVision:!0}),E&&(0,u.jsxs)("div",{className:"newspack-campaigns__campaign-group__filter-group-actions__button",children:[(0,u.jsx)(r.$n,{className:k&&"popover-active",onClick:()=>v(!k),icon:l.A,label:(0,a.__)("Actions","newspack-plugin"),tooltipPosition:"bottom center"}),k&&(0,u.jsx)(g,{dismiss:()=>v(!1),isArchive:E&&"archive"===E.status,onActivate:()=>i(z),onArchive:()=>m(n,!0),onDeactivate:()=>i(z,"DELETE"),onDelete:()=>h(n),onDuplicate:()=>{b(!0),C(""),f(1)},onRename:()=>{C(E.name),b(!0),f(2)},onUnarchive:()=>m(n,!1),hasPrompts:z.length>0,hasPublished:z.some((({status:e})=>"publish"===e))})]})]}),(0,u.jsxs)("div",{className:"newspack-campaigns__campaign-group__add-new-button",children:[(0,u.jsx)(r.$n,{isPrimary:!0,onClick:()=>{b(!x),C(""),f(3)},children:(0,a.__)("Add New Campaign","newspack-plugin")}),x&&(0,u.jsxs)(r.aF,{title:le(j),onRequestClose:()=>{b(!1)},children:[(0,u.jsx)("div",{ref:_,children:(0,u.jsx)(r.xt,{placeholder:(0,a.__)("Campaign Name","newspack-plugin"),onChange:C,label:(0,a.__)("Campaign Name","newspack-plugin"),hideLabelFromVision:!0,value:y,onKeyDown:e=>{o.ENTER===e.keyCode&&""!==y&&(e.preventDefault(),N(y))}})}),(0,u.jsxs)(r.Zp,{buttonsCard:!0,noBorder:!0,className:"justify-end",children:[(0,u.jsx)(r.$n,{variant:"secondary",onClick:()=>{b(!1)},children:(0,a.__)("Cancel","newspack-plugin")}),(0,u.jsx)(r.$n,{variant:"primary",disabled:!y,onClick:()=>N(y),children:de(j)})]})]})]})]}),ge(p,z).map(((s,t)=>oe===n&&s.configuration.is_disabled?null:(0,u.jsx)(se,{segment:s,campaignId:n,campaignData:E,...e},t)))]})})),me=(0,r.c_)((()=>(0,u.jsx)("div",{className:"newspack-campaigns-wizard-analytics__wrapper",children:(0,u.jsxs)(r.Zp,{isNarrow:!0,children:[(0,u.jsx)("h2",{children:(0,a.__)("Coming soon","newspack-plugin")}),(0,u.jsx)("p",{children:(0,u.jsxs)(u.Fragment,{children:[(0,a.__)("We’re currently redesigning this dashboard to accommodate GA4 and give you deeper insights into Campaign performance. In the meantime, you can find Campaign event data within your GA account. Review this ","newspack-plugin"),(0,u.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:"https://help.newspack.com/analytics/",children:(0,a.__)("help page","newspack-plugin")}),(0,a.__)(" to see how Campaign data is being recorded in GA.","newspack-plugin"),","]})}),(0,u.jsx)(r.Zp,{buttonsCard:!0,noBorder:!0,children:(0,u.jsx)(r.$n,{target:"_blank",rel:"noopener noreferrer",href:"https://help.newspack.com/analytics/",isPrimary:!0,children:(0,a.__)("View the help page","newspack-plugin")})})]})}))),we=(0,r.c_)((()=>(0,u.jsx)(r.x5,{pluginSlug:"newspack-popups-wizard",isWizard:!0,title:null})));var _e=s(7677);const ke=(0,u.jsx)(h.SVG,{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(h.Path,{d:"M8 7h2V5H8v2zm0 6h2v-2H8v2zm0 6h2v-2H8v2zm6-14v2h2V5h-2zm0 8h2v-2h-2v2zm0 6h2v-2h-2v2z"})});var ve=s(3756),xe=s(2485);const{NavLink:be,useHistory:je}=r.Ix,fe=()=>(0,u.jsx)(be,{to:"segments/new",children:(0,u.jsx)(r.$n,{variant:"primary",children:(0,a.__)("Add New Segment","newspack-plugin")})}),ye=({inFlight:e,segment:n,segments:s,deleteSegment:i,dropTargetIndex:p,setDropTargetIndex:c,index:g,sortSegments:h,totalSegments:m,wrapperRef:w,toggleSegmentStatus:_})=>{const[k,v]=(0,t.useState)(!1),[x,b]=(0,t.useState)(!1),j=()=>v(!1),f=je(),y=0===g,C=g+1===m,S=g===p,z=C&&p>=m,P=t=>{if(e)return;const a=[...s],i=t>g?t-1:t;a.splice(g,1),a.splice(i,0,n),a.forEach(((e,n)=>e.priority=n)),JSON.stringify(a)!==JSON.stringify(s)&&h(a)},A=()=>{if(e)return;let n=g-1;0>n&&(n=0),P(n)},N=()=>{if(e)return;let n=g+2;m<n&&(n=m),P(n)};return(0,u.jsx)("div",{className:"newspack-campaigns__draggable"+(x?" is-dragging":"")+(S?" is-drop-target":"")+(z?" drop-target-after":""),id:`segment-${n.id}`,children:(0,u.jsx)(d.Draggable,{elementId:`segment-${n.id}`,transferData:{},onDragStart:()=>{x||e||b(!0)},onDragEnd:()=>{e||(null!==p&&P(p),c(null),b(!1))},onDragOver:n=>{if(e)return;const s=w.current.getBoundingClientRect(),t=n.pageY<=s.top+window.scrollY,a=n.pageY>=s.bottom+window.scrollY;if(t||a||n.target.classList.contains("newspack-action-card")){let e=Array.prototype.slice.call(w.current.querySelectorAll(".newspack-campaigns__draggable")).indexOf(n.target.parentElement);(0>e||e===g+1)&&(e=g),t&&(e=0),a&&(e=m),c(e)}},children:({onDraggableStart:e,onDraggableEnd:s})=>(0,u.jsx)(r.Lz,{isSmall:!0,title:n.name,titleLink:`#/segments/${n.id}`,description:D(n),toggleChecked:!n.configuration.is_disabled,toggleOnChange:()=>_(n),badge:n.is_criteria_duplicated?(0,a.__)("Duplicate","newspack-plugin"):void 0,actionText:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(r.$n,{onClick:()=>v(!k),label:(0,a.__)("More options","newspack-plugin"),icon:l.A,className:k&&"popover-active"}),k&&(0,u.jsxs)(r.AM,{position:"bottom left",onKeyDown:e=>o.ESCAPE===e.keyCode&&j,onFocusOutside:j,children:[(0,u.jsx)(d.MenuItem,{onClick:()=>j(),className:"screen-reader-text",children:(0,a.__)("Close Popover","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>f.push(`/segments/${n.id}`),className:"newspack-button",children:(0,a.__)("Edit","newspack-plugin")}),(0,u.jsx)(d.MenuItem,{onClick:()=>i(n),className:"newspack-button",children:(0,a.__)("Delete","newspack-plugin")})]})]}),children:(0,u.jsxs)("div",{className:"newspack-campaigns__segment-priority-controls",children:[(0,u.jsx)("div",{className:"drag-handle",draggable:!0,onDragStart:e,onDragEnd:s,children:(0,u.jsx)(_e.A,{icon:ke,height:18,width:18})}),(0,u.jsxs)("div",{className:"movers",children:[(0,u.jsx)(r.$n,{icon:ve.A,onClick:A,disabled:y,label:(0,a.__)("Move segment position up","newspack-plugin")}),(0,u.jsx)(r.$n,{icon:xe.A,onClick:N,disabled:C,label:(0,a.__)("Move segment position down","newspack-plugin")})]})]})})})})},Ce=({wizardApiFetch:e,segments:n,setSegments:s,isLoading:i})=>{const[p,c]=(0,t.useState)(null),[o,l]=(0,t.useState)(null),[d,g]=(0,t.useState)(!1),[h,m]=(0,t.useState)(null),w=(0,t.useRef)(),_=n=>{g(!0),m(null),e({path:`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${n.id}`,method:"POST",quiet:!0,data:{name:n.name,configuration:{...n.configuration,is_disabled:!n.configuration.is_disabled},criteria:n.criteria}}).then((e=>{g(!1),s(e)})).catch((()=>{g(!1)}))},k=n=>{g(!0),m(null),e({path:`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${n.id}`,method:"DELETE",quiet:!0}).then((e=>{g(!1),s(e)})).catch((()=>{g(!1)}))},v=t=>{m(null),l(t),g(!0),e({path:"/newspack/v1/wizard/newspack-popups-wizard/segmentation-sort",method:"POST",data:{segmentIds:t.map((e=>e.id))},quiet:!0}).then((e=>{g(!1),l(null),s(e)})).catch((e=>{g(!1),m(e.message||(0,a.__)("There was an error sorting segments. Please try again.","newspack-plugin")),s(n)}))};if(null===n)return null;const x=o||n;return n.length?(0,u.jsxs)(t.Fragment,{children:[h&&(0,u.jsx)(r.$T,{noticeText:h,isError:!0}),(0,u.jsxs)(r.Zp,{headerActions:!0,noBorder:!0,children:[(0,u.jsx)("h2",{children:(0,a.__)("Audience segments","newspack-plugin")}),(0,u.jsx)(fe,{})]}),(0,u.jsx)("div",{className:"newspack-campaigns-wizard-segments__list"+(d?" is-loading":""),ref:w,children:x.map(((e,s)=>(0,u.jsx)(ye,{deleteSegment:k,inFlight:d||i>0,segment:e,segments:n,sortSegments:v,index:s,wrapperRef:w,dropTargetIndex:p,setDropTargetIndex:c,totalSegments:n.length,toggleSegmentStatus:_},e.id)))})]}):(0,u.jsxs)(t.Fragment,{children:[(0,u.jsxs)(r.Zp,{headerActions:!0,noBorder:!0,children:[(0,u.jsx)("h2",{children:(0,a.__)("You have no saved audience segments.","newspack-plugin")}),(0,u.jsx)(fe,{})]}),(0,u.jsx)("p",{children:(0,a.__)("Create audience segments to target visitors by engagement, activity, and more.","newspack-plugin")})]})};var Se=s(5255);function ze({label:e,help:n,placeholder:s,value:t,onChange:a,path:i}){const p=e=>({value:isNaN(parseInt(e.id))?e.id.toString():parseInt(e.id),label:e.title||e.name});return(0,u.jsx)(Se.A,{label:e,help:n,placeholder:s,tokens:t||[],fetchSuggestions:async()=>{const e=await v()({path:i});return(Array.isArray(e)?e:Object.values(e)).map(p)},fetchSavedInfo:async e=>{const n=await v()({path:i});return(Array.isArray(n)?n:Object.values(n)).filter((n=>e.includes(n.id))).map(p)},onChange:a})}const{useHistory:Pe}=r.Ix,{SettingsCard:Ae,SettingsSection:Ne,MinMaxSetting:Oe}=r.wB,Fe={is_disabled:!1};(0,f.addFilter)("newspack.criteria.input","newspack.favoriteCategories",(function(e,n,s,t){return"favorite_categories"===n.id?(0,u.jsx)(r.vn,{value:s||[],onChange:e=>{t(e.map((e=>e.id)))},label:n.name,hideLabelFromVision:!0}):e})),(0,f.addFilter)("newspack.criteria.input","newspack.newsletterSubscribedLists",(function(e,n,s,t){return["subscribed_lists","not_subscribed_lists"].includes(n.id)?(0,u.jsx)(ze,{placeholder:(0,a.__)("Start typing to search for lists…","newspack-plugin"),path:"/newspack-newsletters/v1/lists_config",value:s,onChange:t}):e})),(0,f.addFilter)("newspack.criteria.input","newspack.activeSubscriptions",(function(e,n,s,t){return["active_subscriptions","not_active_subscriptions"].includes(n.id)?(0,u.jsx)(ze,{placeholder:(0,a.__)("Start typing to search for products…","newspack-plugin"),path:"/newspack/v1/wizard/newspack-popups-wizard/subscription-products",value:s,onChange:t}):e})),(0,f.addFilter)("newspack.criteria.input","newspack.activeMemberships",(function(e,n,s,t){return["active_memberships","not_active_memberships"].includes(n.id)?(0,u.jsx)(ze,{placeholder:(0,a.__)("Start typing to search for membership plans…","newspack-plugin"),path:"/wc/v3/memberships/plans?per_page=100",value:s,onChange:t}):e}));const Ee=({segmentId:e,setSegments:n,wizardApiFetch:s})=>{const i=window.newspack_popups_wizard_data?.criteria||[],[p,c]=r.JL.useObjectState(Fe),[o,l]=(0,t.useState)(""),[g,h]=(0,t.useState)([]),[m,w]=(0,t.useState)([]),[_,k]=(0,t.useState)(""),v=Pe(),[x,b]=(0,t.useState)("[]"),j=m!==JSON.stringify(g)||_!==o||JSON.stringify(x.is_disabled)!==JSON.stringify(p.is_disabled),y=r.JL.usePrompt(j,(0,a.__)("There are unsaved changes to this segment. Discard changes?","newspack-plugin")),C="new"===e;(0,t.useEffect)((()=>{C||s({path:"/newspack/v1/wizard/newspack-popups-wizard/segmentation"}).then((n=>{const s=re()(n,(({id:n})=>n===e));if(s){const e={...Fe,...s.configuration};c(e),b(e),l(s.name),k(s.name),h([...s.criteria]),w(JSON.stringify(s.criteria))}}))}),[C]);const S=e=>{const n=(e=>{const n=g.find((n=>n.criteria_id===e));return n?n.value:""})(e.id),s=(t=e.id,e=>{const n=[...g],s=n.find((e=>e.criteria_id===t));s?!e||Array.isArray(e)&&0===e.length?n.splice(n.indexOf(s),1):Array.isArray(e)||"object"!=typeof e?s.value=e:s.value={...s.value,...e}:e&&n.push({criteria_id:t,value:e}),h(n)});var t;return(0,f.applyFilters)("newspack.criteria.input","range"===e.matching_function?(0,u.jsx)(Oe,{"data-testid":`newspack-criteria-${e.id}`,min:n?.min,max:n?.max,onChangeMin:e=>s({min:e}),onChangeMax:e=>s({max:e})}):e.options?.length?(0,u.jsx)(r.Yq,{"data-testid":`newspack-criteria-${e.id}`,isWide:!0,onChange:s,value:n,options:e.options}):(0,u.jsx)(r.xt,{"data-testid":`newspack-criteria-${e.id}`,isWide:!0,placeholder:e.placeholder,help:e.help,value:n,onChange:s}),e,n,s)};return(0,u.jsxs)(t.Fragment,{children:[(0,u.jsx)(r.xt,{placeholder:(0,a.__)("Untitled Segment","newspack-plugin"),value:o,onChange:l,label:(0,a.__)("Title","newspack-plugin"),className:"newspack-campaigns-wizard-segments__title"}),(0,u.jsx)(Ae,{title:(0,a.__)("Segment Status","newspack-plugin"),description:(0,a.__)("If not enabled, the segment will be ignored for reader segmentation.","newspack-plugin"),noBorder:!0,children:(0,u.jsx)(d.ToggleControl,{label:(0,a.__)("Segment enabled","newspack-plugin"),checked:!p.is_disabled,onChange:()=>c({is_disabled:!p.is_disabled})})}),(0,u.jsx)(Ae,{title:(0,a.__)("Reader Engagement","newspack-plugin"),description:(0,a.__)("Target readers based on their browsing behavior.","newspack-plugin"),noBorder:!0,children:i.filter((e=>"reader_engagement"===e.category)).map((e=>(0,u.jsx)(Ne,{title:e.name,description:e.description,children:S(e)},e.id)))}),(0,u.jsx)(Ae,{title:(0,a.__)("Registration","newspack-plugin"),description:(0,a.__)("Target readers based on their user account registration status.","newspack-plugin"),columns:3,noBorder:!0,children:i.filter((e=>"reader_activity"===e.category)).map((e=>(0,u.jsx)(Ne,{title:e.name,description:e.description,children:S(e)},e.id)))}),(0,u.jsx)(Ae,{title:(0,a.__)("Newsletters","newspack-plugin"),description:(0,a.__)("Target readers based on their newsletter subscription status.","newspack-plugin"),columns:3,noBorder:!0,children:i.filter((e=>"newsletter"===e.category)).map((e=>(0,u.jsx)(Ne,{title:e.name,description:e.description,children:S(e)},e.id)))}),(0,u.jsx)(Ae,{title:(0,a.__)("Reader Revenue","newspack-plugin"),description:(0,a.__)("Target readers based on their revenue activity.","newspack-plugin"),columns:3,noBorder:!0,children:i.filter((e=>"reader_revenue"===e.category)).map((e=>(0,u.jsx)(Ne,{title:e.name,description:e.description,children:S(e)},e.id)))}),(0,u.jsx)(Ae,{title:(0,a.__)("Referrer Sources","newspack-plugin"),description:(0,a.__)("Target readers based on where they’re coming from.","newspack-plugin"),notification:(0,a.__)("Segments using these options will apply only to the first page visited after coming from an external source.","newspack-plugin"),columns:2,noBorder:!0,children:i.filter((e=>"referrer_sources"===e.category)).map((e=>(0,u.jsx)(Ne,{title:e.name,description:e.description,children:S(e)},e.id)))}),(0,u.jsxs)("div",{className:"newspack-buttons-card",children:[(0,u.jsx)(r.$n,{disabled:!(()=>{const e={...p},n={...Fe};return delete e.is_disabled,delete n.is_disabled,o.length>0&&g.length})()||!C&&!j,isPrimary:!0,onClick:()=>{y(),s({path:C?"/newspack/v1/wizard/newspack-popups-wizard/segmentation":`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${e}`,method:"POST",data:{name:o,criteria:g,configuration:p},quiet:!0}).then(n).then(v.push("/segments"))},children:(0,a.__)("Save","newspack-plugin")}),(0,u.jsx)(r.$n,{isSecondary:!0,href:"#/segments",children:(0,a.__)("Cancel","newspack-plugin")})]})]})},$e=(0,r.c_)((({wizardApiFetch:e,match:n,...s})=>{const t=n.params.id;return t?(0,u.jsx)(Ee,{segmentId:t,wizardApiFetch:e,...s}):(0,u.jsx)(Ce,{wizardApiFetch:e,...s})})),{HashRouter:Ie,Redirect:Me,Route:Te,Switch:De}=c.A,Re=(0,a.__)("Campaigns","newspack-plugin"),Ve=(0,a.__)("Reach your readers with configurable campaigns","newspack-plugin"),Le=[{label:(0,a.__)("Campaigns","newpack-plugin"),path:"/campaigns",exact:!0},{label:(0,a.__)("Segments","newpack-plugin"),path:"/segments",exact:!0},{label:(0,a.__)("Analytics","newpack-plugin"),path:"/analytics",exact:!0},{label:(0,a.__)("Settings","newpack-plugin"),path:"/settings",exact:!0}];class qe extends t.Component{constructor(e){super(e),this.state={campaigns:[],prompts:[],segments:[],settings:[],previewUrl:null,duplicated:null,inFlight:!1}}onWizardReady=()=>{this.refetch()};refetch=()=>{const{setError:e,wizardApiFetch:n}=this.props;n({path:"/newspack/v1/wizard/newspack-popups-wizard/"}).then(this.updateAfterAPI).catch((n=>e(n)))};updatePopup=({id:e,...n})=>{const{setError:s,wizardApiFetch:t}=this.props;return this.setState({inFlight:!0}),t({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}`,method:"POST",data:{config:n},quiet:!0}).then(this.updateAfterAPI).catch((e=>s(e)))};deletePopup=e=>{const{setError:n,wizardApiFetch:s}=this.props;return s({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}`,method:"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e)))};restorePopup=e=>{const{setError:n,wizardApiFetch:s}=this.props;return s({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/restore`,method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e)))};publishPopup=e=>{const{setError:n,wizardApiFetch:s}=this.props;return s({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/publish`,method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e)))};unpublishPopup=e=>{const{setError:n,wizardApiFetch:s}=this.props;return s({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/publish`,method:"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e)))};duplicatePopup=(e,n)=>{const{setError:s,wizardApiFetch:t}=this.props;return this.setState({inFlight:!0}),t({path:(0,i.addQueryArgs)(`/newspack/v1/wizard/newspack-popups-wizard/${e}/duplicate`,{title:n}),method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((()=>{s({code:"duplicate_prompt_error",message:(0,a.__)("Error duplicating prompt. Please try again later.","newspack-plugin")})}))};previewUrlForPopup=({options:e,id:n})=>{const{placement:s,trigger_type:t}=e,a=window.newspack_popups_wizard_data?.preview_query_keys||{},i={};Object.keys(e).forEach((n=>{a.hasOwnProperty(n)&&(i[a[n]]=e[n])}));let r="/";return"archives"===s&&window.newspack_popups_wizard_data?.preview_archive?r=window.newspack_popups_wizard_data.preview_archive:("inline"===s||"scroll"===t)&&window&&window.newspack_popups_wizard_data?.preview_post&&(r=window.newspack_popups_wizard_data?.preview_post),`${r}?${(0,p.stringify)({...i,pid:n})}`};updateAfterAPI=({campaigns:e,prompts:n,segments:s,settings:t,duplicated:a=null})=>this.setState({campaigns:e,prompts:n,segments:s,settings:t,duplicated:a,inFlight:!1});manageCampaignGroup=(e,n="POST")=>{const{setError:s,wizardApiFetch:t}=this.props;return t({path:"/newspack/v1/wizard/newspack-popups-wizard/batch-publish/",data:{ids:e.map((e=>e.id))},method:n,quiet:!0}).then(this.updateAfterAPI).catch((e=>s(e)))};render(){const{pluginRequirements:e,setError:n,isLoading:s,wizardApiFetch:t,startLoading:a,doneLoading:i}=this.props,{campaigns:p,inFlight:c,prompts:o,segments:l,settings:d,previewUrl:g,duplicated:h}=this.state;return(0,u.jsx)(r.LQ,{url:g,renderButton:({showPreview:r})=>{const g={headerText:Re,subHeaderText:Ve,tabbedNavigation:Le,setError:n,isLoading:s,startLoading:a,doneLoading:i,wizardApiFetch:t,prompts:o,segments:l,settings:d,duplicated:h,inFlight:c},m={...g,manageCampaignGroup:this.manageCampaignGroup,updatePopup:this.updatePopup,deletePopup:this.deletePopup,restorePopup:this.restorePopup,duplicatePopup:this.duplicatePopup,previewPopup:e=>this.setState({previewUrl:this.previewUrlForPopup(e)},(()=>r())),publishPopup:this.publishPopup,resetDuplicated:()=>this.setState({duplicated:null}),unpublishPopup:this.unpublishPopup,refetch:this.refetch};return(0,u.jsx)(Ie,{hashType:"slash",children:(0,u.jsxs)(De,{children:[e,(0,u.jsx)(Te,{path:"/campaigns/:id?",render:e=>{const s=e.match.params.id;return(0,u.jsx)(te.Provider,{value:o,children:(0,u.jsx)(he,{...m,archiveCampaignGroup:(e,s)=>t({path:`/newspack/v1/wizard/newspack-popups-wizard/archive-campaign/${e}`,method:s?"POST":"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e))),campaignId:s,createCampaignGroup:s=>t({path:"/newspack/v1/wizard/newspack-popups-wizard/create-campaign/",method:"POST",data:{name:s},quiet:!0}).then((n=>{this.setState({campaigns:n.campaigns,prompts:n.prompts,segments:n.segments,settings:n.settings}),e.history.push(`/campaigns/${n.term_id}`)})).catch((e=>n(e))),deleteCampaignGroup:s=>t({path:`/newspack/v1/wizard/newspack-popups-wizard/delete-campaign/${s}`,method:"DELETE",quiet:!0}).then((n=>{this.setState({campaigns:n.campaigns,prompts:n.prompts,segments:n.segments,settings:n.settings}),e.history.push("/campaigns/")})).catch((e=>n(e))),duplicateCampaignGroup:(s,a)=>t({path:`/newspack/v1/wizard/newspack-popups-wizard/duplicate-campaign/${s}`,method:"POST",data:{name:a},quiet:!0}).then((n=>{this.setState({campaigns:n.campaigns,prompts:n.prompts,segments:n.segments,settings:n.settings}),e.history.push(`/campaigns/${n.term_id}`)})).catch((e=>n(e))),renameCampaignGroup:(e,s)=>t({path:`/newspack/v1/wizard/newspack-popups-wizard/rename-campaign/${e}`,method:"POST",data:{name:s},quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e))),campaigns:p})})}}),(0,u.jsx)(Te,{path:"/segments/:id?",render:e=>(0,u.jsx)($e,{...e,...g,setSegments:e=>this.setState({segments:e})})}),(0,u.jsx)(Te,{path:"/analytics",render:()=>(0,u.jsx)(me,{...g})}),(0,u.jsx)(Te,{path:"/settings",render:()=>(0,u.jsx)(we,{...g})}),(0,u.jsx)(Me,{to:"/campaigns"})]})})}})}}(0,t.render)((0,t.createElement)((0,r.Aq)(qe,["newspack-popups"])),document.getElementById("newspack-popups-wizard"))},3673:e=>{e.exports=function(e){for(var n=-1,s=null==e?0:e.length,t=0,a=[];++n<s;){var i=e[n];i&&(a[t++]=i)}return a}},1609:e=>{"use strict";e.exports=window.React},790:e=>{"use strict";e.exports=window.ReactJSXRuntime},6154:e=>{"use strict";e.exports=window.moment},1455:e=>{"use strict";e.exports=window.wp.apiFetch},6427:e=>{"use strict";e.exports=window.wp.components},7143:e=>{"use strict";e.exports=window.wp.data},6087:e=>{"use strict";e.exports=window.wp.element},2619:e=>{"use strict";e.exports=window.wp.hooks},8537:e=>{"use strict";e.exports=window.wp.htmlEntities},7723:e=>{"use strict";e.exports=window.wp.i18n},8558:e=>{"use strict";e.exports=window.wp.keycodes},5573:e=>{"use strict";e.exports=window.wp.primitives},3832:e=>{"use strict";e.exports=window.wp.url}},s={};function t(e){var a=s[e];if(void 0!==a)return a.exports;var i=s[e]={id:e,loaded:!1,exports:{}};return n[e].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}t.m=n,e=[],t.O=(n,s,a,i)=>{if(!s){var p=1/0;for(l=0;l<e.length;l++){for(var[s,a,i]=e[l],r=!0,c=0;c<s.length;c++)(!1&i||p>=i)&&Object.keys(t.O).every((e=>t.O[e](s[c])))?s.splice(c--,1):(r=!1,i<p&&(p=i));if(r){e.splice(l--,1);var o=a();void 0!==o&&(n=o)}}return n}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[s,a,i]},t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var s in n)t.o(n,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:n[s]})},t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),t.j=230,(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var n=t.g.document;if(!e&&n&&(n.currentScript&&(e=n.currentScript.src),!e)){var s=n.getElementsByTagName("script");if(s.length)for(var a=s.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=s[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),(()=>{var e={230:0};t.O.j=n=>0===e[n];var n=(n,s)=>{var a,i,[p,r,c]=s,o=0;if(p.some((n=>0!==e[n]))){for(a in r)t.o(r,a)&&(t.m[a]=r[a]);if(c)var l=c(t)}for(n&&n(s);o<p.length;o++)i=p[o],t.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return t.O(l)},s=globalThis.webpackChunknewspack=globalThis.webpackChunknewspack||[];s.forEach(n.bind(null,0)),s.push=n.bind(null,s.push.bind(s))})();var a=t.O(void 0,[223],(()=>t(4950)));a=t.O(a)})();