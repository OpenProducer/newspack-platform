(()=>{var e,t={9693:e=>{e.exports=function(e){for(var t=-1,a=null==e?0:e.length,n=0,s=[];++t<a;){var i=e[t];i&&(s[n++]=i)}return s}},9661:(e,t,a)=>{"use strict";a.r(t);var n=a(7462),s=a(4942),i=(a(5674),a(9307)),r=a(5736),c=a(6483),p=a(129),o=a(1732),l=a(9674),m=a(9630),d=a(7259),u=a(5609);const w=r.__,g=({dismiss:e,hasPrompts:t,hasPublished:a,isArchive:n,onActivate:s,onArchive:r,onDeactivate:c,onDelete:p,onDuplicate:l,onRename:d,onUnarchive:g})=>(0,i.createElement)(o.J2,{position:"bottom right",onFocusOutside:()=>e(),onKeyDown:t=>m.ESCAPE===t.keyCode&&e()},(0,i.createElement)(u.MenuItem,{onClick:()=>e(),className:"screen-reader-text"},w("Close Popover","newspack")),t&&(0,i.createElement)(u.MenuItem,{onClick:()=>{e(),s()},className:"newspack-button"},w("Activate all prompts","newspack")),a&&(0,i.createElement)(u.MenuItem,{onClick:()=>{e(),c()},className:"newspack-button"},w("Deactivate all prompts","newspack")),(0,i.createElement)(u.MenuItem,{onClick:()=>{e(),l()},className:"newspack-button"},w("Duplicate","newspack")),(0,i.createElement)(u.MenuItem,{onClick:()=>{e(),d()},className:"newspack-button"},w("Rename","newspack")),!n&&(0,i.createElement)(u.MenuItem,{onClick:()=>{e(),r()},className:"newspack-button"},w("Archive","newspack")),n&&(0,i.createElement)(u.MenuItem,{onClick:()=>{e(),g()},className:"newspack-button"},w("Unarchive","newspack")),(0,i.createElement)(u.MenuItem,{onClick:()=>{e(),p()},className:"newspack-button"},w("Delete","newspack")));var h=a(444);const k=(0,i.createElement)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,i.createElement)(h.Path,{d:"M18.5 10.5H10v8h8a.5.5 0 00.5-.5v-7.5zm-10 0h-3V18a.5.5 0 00.5.5h2.5v-8zM6 4h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2z"}));var v=a(5332);const E=e=>{const[t,a]=(0,i.useState)(null),[s,r]=(0,i.useState)(!1),[p,l]=(0,i.useState)(Math.floor(9999*Math.random())),m=window?.newspack_popups_wizard_data?.preview_post,d=window?.newspack_popups_wizard_data?.frontend_url||"/",{campaign:u=!1,onLoad:w=(()=>{}),segment:g="",showUnpublished:h=!1,url:k=m||d}=e;(0,i.useEffect)((()=>{s||a(v(k))}),[s]);const v=e=>{const t=g.length?[`segment:${g}`]:["segment:everyone"];return h&&t.push("show_unpublished:true"),u?t.push(`campaign:${u}`):t.push("all"),t.push("session_id:"+p),(0,c.addQueryArgs)(e,{view_as:t.join(";")})};return(0,i.createElement)(o.BA,(0,n.Z)({},e,{onLoad:e=>{e&&([...e.contentWindow.document.querySelectorAll("a")].forEach((e=>{const t=e.getAttribute("href");0===t.indexOf(d)&&e.setAttribute("href",v(t))})),r(!0),w(e))},onClose:()=>{l(Math.floor(9999*Math.random())),r(!1)},url:t}))};var _=a(6989),b=a.n(_),f=a(2629),y=a(9522);const C=r.__,z=({deletePopup:e,restorePopup:t,onFocusOutside:a,prompt:n,previewPopup:s,publishPopup:r,setIsDuplicatePromptModalVisible:c,unpublishPopup:p})=>{const{id:l,edit_link:d,status:w}=n,g="publish"===w,h="trash"===w;return(0,i.createElement)(o.J2,{position:"bottom left",onFocusOutside:a,onKeyDown:e=>m.ESCAPE===e.keyCode&&a(),className:"newspack-popover__campaigns__primary-popover"},(0,i.createElement)(u.MenuItem,{onClick:()=>a(),className:"screen-reader-text"},C("Close Popover","newspack")),h?(0,i.createElement)(i.Fragment,null,(0,i.createElement)(u.MenuItem,{onClick:()=>t(l),className:"newspack-button"},C("Restore","newspack")),(0,i.createElement)(u.MenuItem,{onClick:()=>e(l),className:"newspack-button"},C("Delete permanently","newspack"))):(0,i.createElement)(i.Fragment,null,(0,i.createElement)(u.MenuItem,{onClick:()=>{a(),s(n)},className:"newspack-button"},C("Preview","newspack")),(0,i.createElement)(u.MenuItem,{href:(0,f.decodeEntities)(d),className:"newspack-button",isLink:!0},C("Edit","newspack")),(0,i.createElement)(u.MenuItem,{onClick:()=>c(!0),className:"newspack-button"},C("Duplicate","newspack")),(0,i.createElement)(u.MenuItem,{onClick:()=>{a(),(g?p:r)(l)},className:"newspack-button"},C(g?"Deactivate":"Activate","newspack")),(0,i.createElement)(u.MenuItem,{onClick:()=>e(l),className:"newspack-button"},C("Delete","newspack"))),(0,i.createElement)("div",{className:"newspack-popover__campaigns__info"},C("ID:","newspack")," ",l))};var S=a(2694),P=a(8306),x=a.n(P),A=a(9693),N=a.n(A);const O=r.__,F=window.newspack_popups_wizard_data?.criteria||[],M=e=>-1<(window.newspack_popups_wizard_data?.overlay_placements||[]).indexOf(e.options.placement),I=e=>"above_header"===e.options.placement,T=e=>{const t=window.newspack_popups_wizard_data?.custom_placements||{};return-1<Object.keys(t).indexOf(e.options.placement)},D={top:O("Top Overlay","newspack"),top_left:O("Top Left Overlay","newspack"),top_right:O("Top Right Overlay","newspack"),center:O("Center Overlay","newspack"),center_left:O("Center Left Overlay","newspack"),center_right:O("Center Right Overlay","newspack"),bottom:O("Bottom Overlay","newspack"),bottom_left:O("Bottom Left Overlay","newspack"),bottom_right:O("Bottom Right Overlay","newspack"),inline:O("Inline","newspack"),archives:O("In archive pages","newspack"),above_header:O("Above Header","newspack"),manual:O("Manual Only","newspack")},Z=({options:{frequency:e,placement:t}})=>{const a=window.newspack_popups_wizard_data?.custom_placements||{};return"manual"===e||a.hasOwnProperty(t)?O("Custom Placement","newspack"):D[t]},$=e=>{const t=window.newspack_popups_wizard_data?.custom_placements,a=window.newspack_popups_wizard_data?.overlay_placements,n=Object.keys(D).filter((t=>M(e)?-1<a.indexOf(t):-1===a.indexOf(t))).map((e=>({label:D[e],value:e})));return!M(e)&&t?n.concat(Object.keys(t).map((e=>({label:t[e],value:e})))):n},H={once:O("Once a month","newspack"),weekly:O("Once a week","newspack"),daily:O("Once a day","newspack"),always:O("Every pageview","newspack"),custom:O("Custom frequency (edit prompt to manage)","newspack")},V=(e,t=!1)=>"publish"!==e||t?"newspack-card__is-disabled":"newspack-card__is-supported",j=e=>{const{categories:t,tags:a,campaign_groups:n,status:s}=e,i=[];if(n.length>0){const e=n.map((({name:e})=>e)).join(", ");i.push((1===n.length?O("Campaign: ","newspack"):O("Campaigns: ","newspack"))+e)}return t.length>0&&i.push(O("Categories: ","newspack")+t.map((e=>e.name)).join(", ")),a.length>0&&i.push(O("Tags: ","newspack")+a.map((e=>e.name)).join(", ")),"pending"===s&&i.push(O("Pending review","newspack")),"future"===s&&i.push(O("Scheduled","newspack")),i.push(O("Frequency: ","newspack")+U(e)),i.length?i.join(" | "):null},R=e=>{const t=[];if(e.configuration.is_disabled&&t.push(O("Segment disabled","newspack")),e.criteria)for(const a of F){const n=e.criteria.find((({criteria_id:e})=>e===a.id));if(n?.value){let e=n.value;if(a.options){const t=a.options.find((({value:e})=>e===n.value));t&&(e=t.label)}if(Array.isArray(e))e=e.join(", ");else if("object"==typeof e){const t=[];for(const a in e)e[a]&&t.push(`${a}: ${e[a]}`);e=t.join(", ")}const s=(0,S.applyFilters)("newspack.wizards.campaigns.segmentDescription.criteriaMessage",(0,r.sprintf)("%1$s: %2$s",a.name,e),e,a,n);s&&t.push(s)}}return()=>(0,i.createElement)(i.Fragment,null,t.map(((e,a)=>(0,i.createElement)(i.Fragment,{key:a},e," ",t.length!==a+1?" | ":null))))},q=x()((async e=>{const t=await Promise.all(e.map((async e=>{try{return(await b()({path:(0,c.addQueryArgs)("/wp/v2/categories/"+e,{_fields:"name"})})).name}catch(e){return console.warn(e),""}})));return N()(t)})),B=({ids:e})=>{const[t,a]=(0,i.useState)([]);return(0,i.useEffect)((()=>{q(e).then(a)}),[e]),t.length?(0,i.createElement)("span",null,O("Favorite Categories:","newspack")," ",t.length?t.join(", "):""):null};(0,S.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.favoriteCategories",((e,t,a,n)=>"favorite_categories"===a.id?n.value?.length?(0,i.createElement)(B,{ids:n.value}):null:e));const L=x()((async e=>{try{const t=await b()({path:e});return(Array.isArray(t)?t:Object.values(t)).map((e=>({id:isNaN(parseInt(e.id))?e.id.toString():parseInt(e.id),label:e.title||e.name})))}catch(e){return console.warn(e),[]}})),G=({label:e,ids:t,path:a})=>{const[n,s]=(0,i.useState)([]);return(0,i.useEffect)((()=>{L(a).then(s)}),[t]),n.length?(0,i.createElement)("span",null,e," ",n.length?n.filter((e=>t.includes(e.id))).map((e=>e.label)).join(", "):""):null};(0,S.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.newsletterSubscribedLists",((e,t,a,n)=>["subscribed_lists","not_subscribed_lists"].includes(a.id)?n.value?.length?(0,i.createElement)(G,{label:"subscribed_lists"===a.id?O("Subscribed to:"):O("Not subscribed to:"),ids:n.value,path:"/newspack-newsletters/v1/lists_config"}):null:e)),(0,S.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.activeSubscriptions",((e,t,a,n)=>["active_subscriptions","not_active_subscriptions"].includes(a.id)?n.value?.length?(0,i.createElement)(G,{label:"active_subscriptions"===a.id?O("Has active subscription(s):"):O("Does not have active subscription(s):"),ids:n.value,path:"/newspack/v1/wizard/newspack-popups-wizard/subscription-products"}):null:e)),(0,S.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.activeMemberships",((e,t,a,n)=>["active_memberships","not_active_memberships"].includes(a.id)?n.value?.length?(0,i.createElement)(G,{label:"active_memberships"===a.id?O("Has active membership(s):"):O("Does not have active membership(s):"),ids:n.value,path:"/wc/v3/memberships/plans?per_page=100"}):null:e));const W=(e,t)=>{const a=[];if("publish"===t.status&&(I(t)||M(t)||T(t))){const a=t.categories,n=e.filter((e=>{const n=e.categories,s=0===a.length&&0===n.length||a.some((e=>n.some((t=>e.term_id===t.term_id))));return"publish"===e.status&&e.id!==t.id&&(i=e,t.options.placement===i.options.placement)&&((e,t)=>{const a=e.map((e=>e.term_id)),n=t.map((e=>e.term_id));return!a.length&&!n.length||a.some((e=>-1<n.indexOf(e)))})(t.segments,e.segments)&&s;var i})),s=(0,S.applyFilters)("newspack.wizards.campaigns.conflictingPrompts",n,t,e);return 0<s.length?(0,i.createElement)(i.Fragment,null,(0,i.createElement)("strong",null,(0,r.sprintf)(O("%s detected:","newspack"),1<s.length?O("Conflicts","newspack"):O("Conflict","newspack"))),(0,i.createElement)("ul",null,s.map((e=>(0,i.createElement)("li",{key:e.id},(0,i.createElement)("p",{"data-testid":`conflict-warning-${t.id}`},(0,i.createElement)("strong",null,(0,r.sprintf)("%s: ",e.title)),(0,i.createElement)("span",null,((e,t)=>M(e)||I(e)?(0,r.sprintf)(O("If multiple%1$s %2$s share the same segment%3$s, only the most recent one will be displayed."),0===t.length?O(" uncategorized","newspack"):"",I(e)?O("above-header prompts","newspack"):O("overlays","newspack"),0<t.length?O(" and category filtering","newspack"):""):T(e)?(0,r.sprintf)(O("If multiple%1$s prompts in the same custom placement share the same segment%2$s, only the most recent one will be displayed."),0===t.length?O(" uncategorized","newspack"):"",0<t.length?O(" and category filtering","newspack"):""):"")(t,a)))))))):null}return a.length?a.join(" "):null},U=({options:{frequency:e}})=>H[e],Y=r.__,{SettingsCard:J}=o.Zr,K=({prompt:e,disabled:t,onClose:a,updatePopup:n})=>{const[s,c]=o.PT.useObjectState(e),{excluded_categories:p=[],excluded_tags:l=[]}=s.options||{},[m,d]=(0,i.useState)(0<p.length||0<l.length||!1);return(0,i.createElement)(o.u_,{title:e.title,onRequestClose:a,isWide:!0},(0,i.createElement)(o.zx,{onClick:()=>a(),className:"screen-reader-text"},Y("Close Modal","newspack")),(0,i.createElement)(o.rj,{gutter:64,columns:1},(0,i.createElement)(J,{title:Y("Campaigns","newspack"),description:Y("Assign a prompt to one or more campaigns for easier management","newspack"),columns:1,className:"newspack-settings__campaigns",noBorder:!0},(0,i.createElement)(o.HZ,{disabled:t,value:s.campaign_groups||[],onChange:e=>c({campaign_groups:e}),label:Y("Campaigns","newspack"),taxonomy:"newspack_popups_taxonomy",hideLabelFromVision:!0})),(0,i.createElement)(J,{title:Y("Settings","newspack"),description:Y("When and how should the prompt be displayed","newspack"),columns:M(e)?3:2,className:"newspack-settings__settings",rowGap:16,noBorder:!0},(0,i.createElement)(o.Yw,{label:Y("Frequency","newspack"),disabled:t,onChange:e=>{c({options:{frequency:e}})},options:Object.keys(H).map((e=>({label:H[e],value:e}))),value:s.options.frequency}),(0,i.createElement)(o.Yw,{label:M(e)?Y("Position"):Y("Placement"),disabled:t,onChange:e=>{c({options:{placement:e}})},options:$(e),value:s.options.placement}),M(e)&&(0,i.createElement)(o.Yw,{label:Y("Size"),disabled:t,onChange:e=>{c({options:{overlay_size:e}})},options:window.newspack_popups_wizard_data?.overlay_sizes,value:s.options.overlay_size})),(0,i.createElement)(J,{title:Y("Targeting","newspack"),description:()=>(0,i.createElement)(i.Fragment,null,Y("Under which conditions should the prompt be displayed","newspack"),(0,i.createElement)("br",null),Y("If multiple conditions are set, all will have to be satisfied in order to display the prompt","newspack")),className:"newspack-settings__targeting",columns:1,rowGap:16,noBorder:!0},(0,i.createElement)(o.rj,{columns:3,rowGap:16},(0,i.createElement)(o.HZ,{disabled:t,value:s.segments||[],onChange:e=>c({segments:e}),label:Y("Segments","newspack"),taxonomy:"popup_segment"}),(0,i.createElement)(o.HZ,{label:Y("Post categories","newspack "),disabled:t,hideHelpFromVision:!0,value:s.categories||[],onChange:e=>c({categories:e}),description:Y("Prompt will only appear on posts with the specified categories.","newspack")}),(0,i.createElement)(o.HZ,{label:Y("Post tags","newspack "),disabled:t,hideHelpFromVision:!0,taxonomy:"tags",value:s.tags||[],onChange:e=>c({tags:e}),description:Y("Prompt will only appear on posts with the specified tags.","newspack")})),(0,i.createElement)("div",null,(0,i.createElement)(o.zx,{isLink:!0,onClick:()=>d(!m)},(0,r.sprintf)(Y("%s Advanced Settings","newspack_popups_taxonomy"),Y(m?"Hide":"Show","newspack")))),m&&(0,i.createElement)(o.rj,{columns:3,rowGap:16},(0,i.createElement)(o.HZ,{label:Y("Category Exclusions","newspack "),disabled:t,hideHelpFromVision:!0,value:p||[],onChange:e=>c({options:{excluded_categories:e.map((e=>e.id))}}),description:Y("Prompt will not appear on posts with the specified categories.","newspack")}),(0,i.createElement)(o.HZ,{label:Y("Tag Exclusions","newspack "),disabled:t,hideHelpFromVision:!0,taxonomy:"tags",value:l||[],onChange:e=>c({options:{excluded_tags:e.map((e=>e.id))}}),description:Y("Prompt will not appear on posts with the specified tags.","newspack")})))),(0,i.createElement)(o.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,i.createElement)(o.zx,{onClick:a,variant:"secondary"},Y("Cancel","newspack")),(0,i.createElement)(o.zx,{onClick:()=>{n(s).then(a)},variant:"primary"},Y("Save","newspack"))))},X=r.__,Q=e=>{const[t,a]=(0,i.useState)(!1),[s,c]=(0,i.useState)(!1),[p,l]=(0,i.useState)(!1),[m,u]=(0,i.useState)(null),{className:w,description:g,duplicated:h,duplicatePopup:k,inFlight:v,resetDuplicated:E,prompt:_={},segments:C,warning:S}=e,{campaign_groups:P,id:x,edit_link:A,title:N}=_;(0,i.useEffect)((()=>{p&&!m&&O()}),[p]);const O=async()=>{const e=parseInt(_?.duplicate_of||_.id);try{const t=await b()({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/${_.id}/duplicate`});u(t)}catch(e){u(N+X(" copy","newspack-popups"))}};return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(o.fM,{isSmall:!0,badge:Z(_),className:w,title:N.length?(0,f.decodeEntities)(N):X("(no title)","newspack"),titleLink:(0,f.decodeEntities)(A),key:x,description:g,notification:S,notificationLevel:"error",actionText:(0,i.createElement)(i.Fragment,null,(0,i.createElement)("div",{className:"newspack-popups-wizard__buttons"},(0,i.createElement)(o.zx,{className:t&&"popover-active",onClick:()=>a(!t),icon:y.Z,label:X("Prompt settings","newspack"),tooltipPosition:"bottom center"}),(0,i.createElement)(o.zx,{className:s&&"popover-active",onClick:()=>c(!s),icon:d.Z,label:X("More options","newspack"),tooltipPosition:"bottom center"}),s&&(0,i.createElement)(z,(0,n.Z)({onFocusOutside:()=>c(!1),prompt:_,setIsDuplicatePromptModalVisible:l},e))))}),t&&(0,i.createElement)(K,{prompt:_,disabled:v,onClose:()=>a(!1),segments:C,updatePopup:e.updatePopup}),p&&(0,i.createElement)(o.u_,{className:"newspack-popups__duplicate-modal",title:(0,r.sprintf)(X("Duplicate “%s”","newspack"),N),onRequestClose:()=>{l(!1),u(null),E()}},h?(0,i.createElement)(i.Fragment,null,(0,i.createElement)(o.qX,{isSuccess:!0,noticeText:(0,r.sprintf)(X("Duplicate of “%s” created as a draft.","newspack"),N)}),!P&&(0,i.createElement)(o.qX,{isWarning:!0,noticeText:X("This prompt is currently not assigned to any campaign.","newspack")}),(0,i.createElement)(o.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,i.createElement)(o.zx,{isSecondary:!0,onClick:()=>{l(!1),u(null),E()}},X("Close","newspack")),(0,i.createElement)(o.zx,{isPrimary:!0,href:`/wp-admin/post.php?post=${h}&action=edit`},X("Edit","newspack")))):(0,i.createElement)(i.Fragment,null,!P&&(0,i.createElement)(o.qX,{isWarning:!0,noticeText:X("This prompt will not be assigned to any campaign.","newspack")}),(0,i.createElement)(o.w4,{disabled:v||null===m,label:X("Title","newspack"),value:m,onChange:e=>u(e)}),(0,i.createElement)(o.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,i.createElement)(o.zx,{disabled:v,isSecondary:!0,onClick:()=>{l(!1),u(null),E()}},X("Cancel","newspack")),(0,i.createElement)(o.zx,{disabled:v||null===m,isPrimary:!0,onClick:()=>{const e=m.trim()||O();k(x,e)}},X("Duplicate","newspack"))))))},ee=(0,i.createElement)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,i.createElement)(u.Path,{d:"M4 9h16v2H4V9zm0 4h10v2H4v-2z"})),te=(0,i.createElement)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,i.createElement)(u.Path,{d:"M17 14H7v3h10v-3z"}),(0,i.createElement)(u.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})),ae=(0,i.createElement)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,i.createElement)(u.Path,{d:"M16 10H8v4h8v-4z"}),(0,i.createElement)(u.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})),ne=(0,i.createElement)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,i.createElement)(u.Path,{d:"M17 7H7v3h10V7z"}),(0,i.createElement)(u.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})),se=(0,i.createElement)(u.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,i.createElement)(u.Path,{d:"M18 4H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm.5 14c0 .3-.2.5-.5.5H6c-.3 0-.5-.2-.5-.5V6c0-.3.2-.5.5-.5h12c.3 0 .5.2.5.5v12zM7 11h2V9H7v2zm0 4h2v-2H7v2zm3-4h7V9h-7v2zm0 4h7v-2h-7v2z"})),ie=(0,i.createElement)(u.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,i.createElement)(u.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v3.5h-15V5c0-.3.2-.5.5-.5zm8 5.5h6.5v3.5H13V10zm-1.5 3.5h-7V10h7v3.5zm-7 5.5v-4h7v4.5H5c-.3 0-.5-.2-.5-.5zm14.5.5h-6V15h6.5v4c0 .3-.2.5-.5.5z"})),re=r.__,ce=(e,t,a)=>{const n=[];return e&&n.push(`placement=${e}`),+t>0&&n.push(`group=${t}`),a&&n.push(`segment=${a}`),"/wp-admin/post-new.php?post_type=newspack_popups_cpt&"+n.join("&")},pe=e=>{const{campaignData:t,campaignId:a,segment:s}=e,[r,c]=(0,i.useState)(!1),{label:p,id:l,prompts:m}=s,d="unassigned"!==a?parseInt(a):-1;let u;u="unassigned"===a?re("No unassigned prompts in this segment.","newspack"):t?re("No prompts in this segment for","newspack")+" "+t.name+".":re("No active prompts in this segment.","newspack");const w=R(s);return(0,i.createElement)(o.Zb,{isSmall:!0,className:"newspack-campaigns__segment-group__card"},(0,i.createElement)("div",{className:"newspack-campaigns__segment-group__card__segment"},(0,i.createElement)("div",{className:"newspack-campaigns__segment-group__card__segment-title"},(0,i.createElement)("h3",null,l?(0,i.createElement)(o.zx,{href:`#/segments/${l}`,label:re("Edit Segment ","newspack"),isLink:!0,showTooltip:!0,tooltipPosition:"bottom center"},re("Segment: ","newspack"),p):p),(0,i.createElement)("span",{className:"newspack-campaigns__segment-group__description"},l?w():re("All readers, regardless of segment","newspack"))),(0,i.createElement)("div",{className:"newspack-campaigns__segment-group__card__segment-actions"},(0,i.createElement)(E,{campaign:!!a&&d,segment:l,showUnpublished:!!a,renderButton:({showPreview:e})=>(0,i.createElement)(o.zx,{isSmall:!0,variant:"tertiary",onClick:()=>e()},re("Preview Segment","newspack"))}),"unassigned"!==a&&(0,i.createElement)(i.Fragment,null,(0,i.createElement)(o.zx,{isSmall:!0,variant:"secondary",onClick:()=>c(!r)},re("Add New Prompt","newspack")),r&&(0,i.createElement)(o.u_,{title:re("Add New Prompt","newspack"),onRequestClose:()=>c(!1),shouldCloseOnEsc:!1,shouldCloseOnClickOutside:!1,isWide:!0},(0,i.createElement)(o.rj,{gutter:32,columns:3},(0,i.createElement)(o.Wu,{href:ce("overlay-center",a,l),title:re("Center Overlay","newspack"),desc:re("Fixed at the center of the screen","newspack"),icon:ae}),(0,i.createElement)(o.Wu,{href:ce("overlay-top",a,l),title:re("Top Overlay","newspack"),desc:re("Fixed at the top of the screen","newspack"),icon:ne}),(0,i.createElement)(o.Wu,{href:ce("overlay-bottom",a,l),title:re("Bottom Overlay","newspack"),desc:re("Fixed at the bottom of the screen","newspack"),icon:te}),(0,i.createElement)(o.Wu,{href:ce(null,a,l),title:re("Inline","newspack"),desc:re("Embedded in content","newspack"),icon:ee}),(0,i.createElement)(o.Wu,{href:ce("archives",a,l),title:re("In Archive Pages","newspack"),desc:re("Embedded once or many times in archive pages","newspack"),icon:se}),(0,i.createElement)(o.Wu,{href:ce("above-header",a,l),title:re("Above Header","newspack"),desc:re("Embedded at the very top of the page","newspack"),icon:k}),(0,i.createElement)(o.Wu,{href:ce("custom",a,l),title:re("Custom Placement","newspack"),desc:re("Only appears when placed in content","newspack"),icon:v.Z}),(0,i.createElement)(o.Wu,{href:ce("manual",a,l),title:re("Manual Only","newspack"),desc:re("Only appears where Single Prompt block is inserted","newspack"),icon:ie})))))),(0,i.createElement)(o.Zb,{noBorder:!0,className:"newspack-campaigns__segment-group__action-cards"},m.map((t=>(0,i.createElement)(Q,(0,n.Z)({className:V(t.status,s.configuration.is_disabled),description:j(t),warning:W(m,t),key:t.id,prompt:t},e))))),m.length<1?(0,i.createElement)("p",null,u):"")},oe=(0,i.createContext)({prompts:[]});var le=a(3967),me=a.n(le),de=a(3311),ue=a.n(de);const we=r.__,{useHistory:ge}=o.F0,he="active",ke=e=>we(2===e?"Rename Campaign":1===e?"Duplicate Campaign":"Add New Campaign","newspack"),ve=(e,t)=>{if("trash"===t)return e.filter((({status:e})=>"trash"===e));const a=e.filter((({status:e})=>"trash"!==e));return he===t?a.filter((({status:e})=>"publish"===e)):"all"===t?a.filter((({status:e})=>"trash"!==e)):"unassigned"===t?a.filter((({campaign_groups:e})=>!e||!e.length)):a.filter((({campaign_groups:e})=>e&&e.find((e=>+e.term_id==+t))))},Ee=(0,o.a4)((e=>{const{campaignId:t=he,campaigns:a=[],manageCampaignGroup:s,segments:r,createCampaignGroup:c,duplicateCampaignGroup:p,deleteCampaignGroup:l,archiveCampaignGroup:u,renameCampaignGroup:w}=e,h=(0,i.useRef)(null),[k,v]=(0,i.useState)(),[E,_]=(0,i.useState)(),[b,f]=(0,i.useState)(),[y,C]=(0,i.useState)(),z=(0,i.useContext)(oe),S=ve(z,t),P=ve(z,"unassigned").length;(0,i.useEffect)((()=>{E&&h.current.querySelector("input").focus()}),[E]);const x=ge(),A=e=>{3===b?c(e):2===b?w(t,e):1===b&&p(t,e),_(!1)},N=a.filter((({status:e})=>"archive"!==e)),O=a.filter((({status:e})=>"archive"===e)),F=((e,t)=>t.reduce(((t,a)=>+e>0&&+e==+a.term_id?a:t),null))(t,a),M=[{key:he,name:we("Active Prompts","newspack")},{key:"all",name:we("All Prompts","newspack")},{key:"trash",name:we("Trash","newspack")},...P?[{key:"unassigned",name:we("Unassigned Prompts","newspack")}]:[],...N.length?[{key:"header-campaigns",name:we("Campaigns","newspack"),className:"is-header"}]:[],...N.map((({term_id:e,name:t})=>({key:String(e),name:t,className:"newspack-campaigns__campaign-group__select-control-group-item"}))),...O.length?[{key:"header-archived-campaigns",name:we("Archived Campaigns","newspack"),className:"is-header"}]:[],...O.map((({term_id:e,name:t})=>({key:String(e),name:t+" "+we("(archived)","newspack"),className:"newspack-campaigns__campaign-group__select-control-group-item"})))];return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(o.Zb,{headerActions:!0,noBorder:!0},(0,i.createElement)("div",{className:"newspack-campaigns__campaign-group__filter-group-actions"},(0,i.createElement)(o.Yq,{label:we("Campaigns","newspack"),options:M.map((e=>({...e,className:me()(e.className,{"is-selected":e.key===t})}))),onChange:({selectedItem:{key:e}})=>he===e?x.push("/campaigns"):x.push(`/campaigns/${e}`),value:ue()(M,["key",t||he]),hideLabelFromVision:!0}),F&&(0,i.createElement)("div",{className:"newspack-campaigns__campaign-group__filter-group-actions__button"},(0,i.createElement)(o.zx,{className:k&&"popover-active",onClick:()=>v(!k),icon:d.Z,label:we("Actions","newspack"),tooltipPosition:"bottom center"}),k&&(0,i.createElement)(g,{dismiss:()=>v(!1),isArchive:F&&"archive"===F.status,onActivate:()=>s(S),onArchive:()=>u(t,!0),onDeactivate:()=>s(S,"DELETE"),onDelete:()=>l(t),onDuplicate:()=>{_(!0),C(""),f(1)},onRename:()=>{C(F.name),_(!0),f(2)},onUnarchive:()=>u(t,!1),hasPrompts:S.length>0,hasPublished:S.some((({status:e})=>"publish"===e))}))),(0,i.createElement)("div",{className:"newspack-campaigns__campaign-group__add-new-button"},(0,i.createElement)(o.zx,{isPrimary:!0,onClick:()=>{_(!E),C(""),f(3)}},we("Add New Campaign","newspack")),E&&(0,i.createElement)(o.u_,{title:ke(b),onRequestClose:()=>{_(!1)}},(0,i.createElement)("div",{ref:h},(0,i.createElement)(o.w4,{placeholder:we("Campaign Name","newspack"),onChange:C,label:we("Campaign Name","newspack"),hideLabelFromVision:!0,value:y,onKeyDown:e=>{m.ENTER===e.keyCode&&""!==y&&(e.preventDefault(),A(y))}})),(0,i.createElement)(o.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,i.createElement)(o.zx,{variant:"secondary",onClick:()=>{_(!1)}},we("Cancel","newspack")),(0,i.createElement)(o.zx,{variant:"primary",disabled:!y,onClick:()=>A(y)},(e=>we(2===e?"Rename":1===e?"Duplicate":"Add","newspack"))(b)))))),((e,t)=>{const a=[];return a.push(...e.map((({name:e,id:a,configuration:n,criteria:s})=>({label:e,id:a,configuration:n,criteria:s,prompts:t.filter((({segments:e})=>!!e&&!!e.find((e=>e.term_id===parseInt(a)))))})))),a.push({label:we("Everyone","newspack"),id:"",prompts:t.filter((({segments:e})=>0===e.length)),configuration:{}}),a})(r,S).map(((a,s)=>he===t&&a.configuration.is_disabled?null:(0,i.createElement)(pe,(0,n.Z)({key:s,segment:a,campaignId:t,campaignData:F},e)))))})),_e=r.__,be=(0,o.a4)((()=>(0,i.createElement)("div",{className:"newspack-campaigns-wizard-analytics__wrapper"},(0,i.createElement)(o.Zb,{isNarrow:!0},(0,i.createElement)("h2",null,_e("Coming soon","newspack")),(0,i.createElement)("p",null,(0,i.createElement)(i.Fragment,null,_e("We’re currently redesigning this dashboard to accommodate GA4 and give you deeper insights into Campaign performance. In the meantime, you can find Campaign event data within your GA account. Review this ","newspack"),(0,i.createElement)("a",{target:"_blank",rel:"noopener noreferrer",href:"https://help.newspack.com/analytics/"},_e("help page","newspack")),_e(" to see how Campaign data is being recorded in GA.","newspack"),",")),(0,i.createElement)(o.Zb,{buttonsCard:!0,noBorder:!0},(0,i.createElement)(o.zx,{target:"_blank",rel:"noopener noreferrer",href:"https://help.newspack.com/analytics/",isPrimary:!0},_e("View the help page","newspack"))))))),fe=(0,o.a4)((()=>(0,i.createElement)(o.d5,{pluginSlug:"newspack-popups-wizard",isWizard:!0,title:null})));var ye=a(1984);const Ce=(0,i.createElement)(h.SVG,{width:"18",height:"18",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18"},(0,i.createElement)(h.Path,{d:"M5 4h2V2H5v2zm6-2v2h2V2h-2zm-6 8h2V8H5v2zm6 0h2V8h-2v2zm-6 6h2v-2H5v2zm6 0h2v-2h-2v2z"}));var ze=a(6015),Se=a(3904);const Pe=r.__,{NavLink:xe,useHistory:Ae}=o.F0,Ne=()=>(0,i.createElement)(xe,{to:"segments/new"},(0,i.createElement)(o.zx,{variant:"primary"},Pe("Add New Segment","newspack"))),Oe=({inFlight:e,segment:t,segments:a,deleteSegment:n,dropTargetIndex:s,setDropTargetIndex:r,index:c,sortSegments:p,totalSegments:l,wrapperRef:w,toggleSegmentStatus:g})=>{const[h,k]=(0,i.useState)(!1),[v,E]=(0,i.useState)(!1),_=()=>k(!1),b=Ae(),f=0===c,y=c+1===l,C=c===s,z=y&&s>=l,S=n=>{if(e)return;const s=[...a],i=n>c?n-1:n;s.splice(c,1),s.splice(i,0,t),s.forEach(((e,t)=>e.priority=t)),JSON.stringify(s)!==JSON.stringify(a)&&p(s)},P=()=>{if(e)return;let t=c-1;0>t&&(t=0),S(t)},x=()=>{if(e)return;let t=c+2;l<t&&(t=l),S(t)};return(0,i.createElement)("div",{className:"newspack-campaigns__draggable"+(v?" is-dragging":"")+(C?" is-drop-target":"")+(z?" drop-target-after":""),id:`segment-${t.id}`},(0,i.createElement)(u.Draggable,{elementId:`segment-${t.id}`,transferData:{},onDragStart:()=>{v||e||E(!0)},onDragEnd:()=>{e||(null!==s&&S(s),r(null),E(!1))},onDragOver:t=>{if(e)return;const a=w.current.getBoundingClientRect(),n=t.pageY<=a.top+window.scrollY,s=t.pageY>=a.bottom+window.scrollY;if(n||s||t.target.classList.contains("newspack-action-card")){let e=Array.prototype.slice.call(w.current.querySelectorAll(".newspack-campaigns__draggable")).indexOf(t.target.parentElement);(0>e||e===c+1)&&(e=c),n&&(e=0),s&&(e=l),r(e)}}},(({onDraggableStart:e,onDraggableEnd:a})=>(0,i.createElement)(o.fM,{isSmall:!0,title:t.name,titleLink:`#/segments/${t.id}`,description:R(t),toggleChecked:!t.configuration.is_disabled,toggleOnChange:()=>g(t),badge:t.is_criteria_duplicated?Pe("Duplicate","newspack-plugin"):void 0,actionText:(0,i.createElement)(i.Fragment,null,(0,i.createElement)(o.zx,{onClick:()=>k(!h),label:Pe("More options","newspack"),icon:d.Z,className:h&&"popover-active"}),h&&(0,i.createElement)(o.J2,{position:"bottom left",onKeyDown:e=>m.ESCAPE===e.keyCode&&_,onFocusOutside:_},(0,i.createElement)(u.MenuItem,{onClick:()=>_(),className:"screen-reader-text"},Pe("Close Popover","newspack")),(0,i.createElement)(u.MenuItem,{onClick:()=>b.push(`/segments/${t.id}`),className:"newspack-button"},Pe("Edit","newspack")),(0,i.createElement)(u.MenuItem,{onClick:()=>n(t),className:"newspack-button"},Pe("Delete","newspack"))))},(0,i.createElement)("div",{className:"newspack-campaigns__segment-priority-controls"},(0,i.createElement)("div",{className:"drag-handle",draggable:!0,onDragStart:e,onDragEnd:a},(0,i.createElement)(ye.Z,{icon:Ce,height:18,width:18})),(0,i.createElement)("div",{className:"movers"},(0,i.createElement)(o.zx,{icon:ze.Z,onClick:P,disabled:f,label:Pe("Move segment position up","newspack")}),(0,i.createElement)(o.zx,{icon:Se.Z,onClick:x,disabled:y,label:Pe("Move segment position down","newspack")})))))))},Fe=({wizardApiFetch:e,segments:t,setSegments:a,isLoading:n})=>{const[s,r]=(0,i.useState)(null),[c,p]=(0,i.useState)(null),[l,m]=(0,i.useState)(!1),[d,u]=(0,i.useState)(null),w=(0,i.useRef)(),g=t=>{m(!0),u(null),e({path:`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${t.id}`,method:"POST",quiet:!0,data:{name:t.name,configuration:{...t.configuration,is_disabled:!t.configuration.is_disabled},criteria:t.criteria}}).then((e=>{m(!1),a(e)})).catch((e=>{console.error(e),m(!1)}))},h=t=>{m(!0),u(null),e({path:`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${t.id}`,method:"DELETE",quiet:!0}).then((e=>{m(!1),a(e)})).catch((e=>{console.error(e),m(!1)}))},k=n=>{u(null),p(n),m(!0),e({path:"/newspack/v1/wizard/newspack-popups-wizard/segmentation-sort",method:"POST",data:{segmentIds:n.map((e=>e.id))},quiet:!0}).then((e=>{m(!1),p(null),a(e)})).catch((e=>{m(!1),u(e.message||Pe("There was an error sorting segments. Please try again.")),a(t)}))};if(null===t)return null;const v=c||t;return t.length?(0,i.createElement)(i.Fragment,null,d&&(0,i.createElement)(o.qX,{noticeText:d,isError:!0}),(0,i.createElement)(o.Zb,{headerActions:!0,noBorder:!0},(0,i.createElement)("h2",null,Pe("Audience segments","newspack")),(0,i.createElement)(Ne,null)),(0,i.createElement)("div",{className:"newspack-campaigns-wizard-segments__list"+(l?" is-loading":""),ref:w},v.map(((e,a)=>(0,i.createElement)(Oe,{deleteSegment:h,key:e.id,inFlight:l||n>0,segment:e,segments:t,sortSegments:k,index:a,wrapperRef:w,dropTargetIndex:s,setDropTargetIndex:r,totalSegments:t.length,toggleSegmentStatus:g}))))):(0,i.createElement)(i.Fragment,null,(0,i.createElement)(o.Zb,{headerActions:!0,noBorder:!0},(0,i.createElement)("h2",null,Pe("You have no saved audience segments.","newspack")),(0,i.createElement)(Ne,null)),(0,i.createElement)("p",null,Pe("Create audience segments to target visitors by engagement, activity, and more.","newspack")))};var Me=a(288);function Ie({label:e,help:t,placeholder:a,value:n,onChange:s,path:r}){const c=e=>({value:isNaN(parseInt(e.id))?e.id.toString():parseInt(e.id),label:e.title||e.name});return(0,i.createElement)(Me.Z,{label:e,help:t,placeholder:a,tokens:n||[],fetchSuggestions:async()=>{const e=await b()({path:r});return(Array.isArray(e)?e:Object.values(e)).map(c)},fetchSavedInfo:async e=>{const t=await b()({path:r});return(Array.isArray(t)?t:Object.values(t)).filter((t=>e.includes(t.id))).map(c)},onChange:s})}const Te=r.__,{useHistory:De}=o.F0,{SettingsCard:Ze,SettingsSection:$e,MinMaxSetting:He}=o.Zr,Ve={is_disabled:!1};(0,S.addFilter)("newspack.criteria.input","newspack.favoriteCategories",(function(e,t,a,n){return"favorite_categories"===t.id?(0,i.createElement)(o.HZ,{value:a||[],onChange:e=>{n(e.map((e=>e.id)))},label:t.name,hideLabelFromVision:!0}):e})),(0,S.addFilter)("newspack.criteria.input","newspack.newsletterSubscribedLists",(function(e,t,a,n){return["subscribed_lists","not_subscribed_lists"].includes(t.id)?(0,i.createElement)(Ie,{placeholder:Te("Start typing to search for lists…","newspack-plugin"),path:"/newspack-newsletters/v1/lists_config",value:a,onChange:n}):e})),(0,S.addFilter)("newspack.criteria.input","newspack.activeSubscriptions",(function(e,t,a,n){return["active_subscriptions","not_active_subscriptions"].includes(t.id)?(0,i.createElement)(Ie,{placeholder:Te("Start typing to search for products…","newspack-plugin"),path:"/newspack/v1/wizard/newspack-popups-wizard/subscription-products",value:a,onChange:n}):e})),(0,S.addFilter)("newspack.criteria.input","newspack.activeMemberships",(function(e,t,a,n){return["active_memberships","not_active_memberships"].includes(t.id)?(0,i.createElement)(Ie,{placeholder:Te("Start typing to search for membership plans…","newspack-plugin"),path:"/wc/v3/memberships/plans?per_page=100",value:a,onChange:n}):e}));const je=({segmentId:e,setSegments:t,wizardApiFetch:a})=>{const n=window.newspack_popups_wizard_data?.criteria||[],[s,r]=o.PT.useObjectState(Ve),[c,p]=(0,i.useState)(""),[l,m]=(0,i.useState)([]),[d,w]=(0,i.useState)([]),[g,h]=(0,i.useState)(""),k=De(),[v,E]=(0,i.useState)("[]"),_=d!==JSON.stringify(l)||g!==c||JSON.stringify(v.is_disabled)!==JSON.stringify(s.is_disabled),b=o.PT.usePrompt(_,Te("There are unsaved changes to this segment. Discard changes?","newspack")),f="new"===e;(0,i.useEffect)((()=>{f||a({path:"/newspack/v1/wizard/newspack-popups-wizard/segmentation"}).then((t=>{const a=ue()(t,(({id:t})=>t===e));if(a){const e={...Ve,...a.configuration};r(e),E(e),p(a.name),h(a.name),m([...a.criteria]),w(JSON.stringify(a.criteria))}}))}),[f]);const y=e=>{const t=(e=>{const t=l.find((t=>t.criteria_id===e));return t?t.value:""})(e.id),a=(n=e.id,e=>{const t=[...l],a=t.find((e=>e.criteria_id===n));a?!e||Array.isArray(e)&&0===e.length?t.splice(t.indexOf(a),1):Array.isArray(e)||"object"!=typeof e?a.value=e:a.value={...a.value,...e}:e&&t.push({criteria_id:n,value:e}),m(t)});var n;return(0,S.applyFilters)("newspack.criteria.input","range"===e.matching_function?(0,i.createElement)(He,{"data-testid":`newspack-criteria-${e.id}`,min:t?.min,max:t?.max,onChangeMin:e=>a({min:e}),onChangeMax:e=>a({max:e})}):e.options?.length?(0,i.createElement)(o.Yw,{"data-testid":`newspack-criteria-${e.id}`,isWide:!0,onChange:a,value:t,options:e.options}):(0,i.createElement)(o.w4,{"data-testid":`newspack-criteria-${e.id}`,isWide:!0,placeholder:e.placeholder,help:e.help,value:t,onChange:a}),e,t,a)};return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(o.w4,{placeholder:Te("Untitled Segment","newspack"),value:c,onChange:p,label:Te("Title","newspack"),className:"newspack-campaigns-wizard-segments__title"}),(0,i.createElement)(Ze,{title:Te("Segment Status","newspack"),description:Te("If not enabled, the segment will be ignored for reader segmentation.","newspack"),noBorder:!0},(0,i.createElement)(u.ToggleControl,{label:Te("Segment enabled","newspack"),checked:!s.is_disabled,onChange:()=>r({is_disabled:!s.is_disabled})})),(0,i.createElement)(Ze,{title:Te("Reader Engagement","newspack"),description:Te("Target readers based on their browsing behavior.","newspack"),noBorder:!0},n.filter((e=>"reader_engagement"===e.category)).map((e=>(0,i.createElement)($e,{key:e.id,title:e.name,description:e.description},y(e))))),(0,i.createElement)(Ze,{title:Te("Registration","newspack"),description:Te("Target readers based on their user account registration status.","newspack"),columns:3,noBorder:!0},n.filter((e=>"reader_activity"===e.category)).map((e=>(0,i.createElement)($e,{key:e.id,title:e.name,description:e.description},y(e))))),(0,i.createElement)(Ze,{title:Te("Newsletters","newspack"),description:Te("Target readers based on their newsletter subscription status.","newspack"),columns:3,noBorder:!0},n.filter((e=>"newsletter"===e.category)).map((e=>(0,i.createElement)($e,{key:e.id,title:e.name,description:e.description},y(e))))),(0,i.createElement)(Ze,{title:Te("Reader Revenue","newspack"),description:Te("Target readers based on their revenue activity.","newspack"),columns:3,noBorder:!0},n.filter((e=>"reader_revenue"===e.category)).map((e=>(0,i.createElement)($e,{key:e.id,title:e.name,description:e.description},y(e))))),(0,i.createElement)(Ze,{title:Te("Referrer Sources","newspack"),description:Te("Target readers based on where they’re coming from.","newspack"),notification:Te("Segments using these options will apply only to the first page visited after coming from an external source.","newspack"),columns:2,noBorder:!0},n.filter((e=>"referrer_sources"===e.category)).map((e=>(0,i.createElement)($e,{key:e.id,title:e.name,description:e.description},y(e))))),(0,i.createElement)("div",{className:"newspack-buttons-card"},(0,i.createElement)(o.zx,{disabled:!(()=>{const e={...s},t={...Ve};return delete e.is_disabled,delete t.is_disabled,c.length>0&&l.length})()||!f&&!_,isPrimary:!0,onClick:()=>{b(),a({path:f?"/newspack/v1/wizard/newspack-popups-wizard/segmentation":`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${e}`,method:"POST",data:{name:c,criteria:l,configuration:s},quiet:!0}).then(t).then(k.push("/segments"))}},Te("Save","newspack")),(0,i.createElement)(o.zx,{isSecondary:!0,href:"#/segments"},Te("Cancel","newspack"))))},Re=(0,o.a4)((({wizardApiFetch:e,match:t,...a})=>{const s=t.params.id;return s?(0,i.createElement)(je,(0,n.Z)({segmentId:s,wizardApiFetch:e},a)):(0,i.createElement)(Fe,(0,n.Z)({wizardApiFetch:e},a))})),qe=r.__,{HashRouter:Be,Redirect:Le,Route:Ge,Switch:We}=l.Z,Ue=qe("Campaigns","newspack"),Ye=qe("Reach your readers with configurable campaigns","newspack"),Je=[{label:qe("Campaigns","newpack"),path:"/campaigns",exact:!0},{label:qe("Segments","newpack"),path:"/segments",exact:!0},{label:qe("Analytics","newpack"),path:"/analytics",exact:!0},{label:qe("Settings","newpack"),path:"/settings",exact:!0}];class Ke extends i.Component{constructor(e){super(e),(0,s.Z)(this,"onWizardReady",(()=>{this.refetch()})),(0,s.Z)(this,"refetch",(()=>{const{setError:e,wizardApiFetch:t}=this.props;t({path:"/newspack/v1/wizard/newspack-popups-wizard/"}).then(this.updateAfterAPI).catch((t=>e(t)))})),(0,s.Z)(this,"updatePopup",(({id:e,...t})=>{const{setError:a,wizardApiFetch:n}=this.props;return this.setState({inFlight:!0}),n({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}`,method:"POST",data:{config:t},quiet:!0}).then(this.updateAfterAPI).catch((e=>a(e)))})),(0,s.Z)(this,"deletePopup",(e=>{const{setError:t,wizardApiFetch:a}=this.props;return a({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}`,method:"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,s.Z)(this,"restorePopup",(e=>{const{setError:t,wizardApiFetch:a}=this.props;return a({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/restore`,method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,s.Z)(this,"publishPopup",(e=>{const{setError:t,wizardApiFetch:a}=this.props;return a({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/publish`,method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,s.Z)(this,"unpublishPopup",(e=>{const{setError:t,wizardApiFetch:a}=this.props;return a({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/publish`,method:"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,s.Z)(this,"duplicatePopup",((e,t)=>{const{setError:a,wizardApiFetch:n}=this.props;return this.setState({inFlight:!0}),n({path:(0,c.addQueryArgs)(`/newspack/v1/wizard/newspack-popups-wizard/${e}/duplicate`,{title:t}),method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((()=>{a({code:"duplicate_prompt_error",message:qe("Error duplicating prompt. Please try again later.","newspack")})}))})),(0,s.Z)(this,"previewUrlForPopup",(({options:e,id:t})=>{const{placement:a,trigger_type:n}=e,s=window.newspack_popups_wizard_data?.preview_query_keys||{},i={};Object.keys(e).forEach((t=>{s.hasOwnProperty(t)&&(i[s[t]]=e[t])}));let r="/";return"archives"===a&&window.newspack_popups_wizard_data?.preview_archive?r=window.newspack_popups_wizard_data.preview_archive:("inline"===a||"scroll"===n)&&window&&window.newspack_popups_wizard_data?.preview_post&&(r=window.newspack_popups_wizard_data?.preview_post),`${r}?${(0,p.stringify)({...i,pid:t})}`})),(0,s.Z)(this,"updateAfterAPI",(({campaigns:e,prompts:t,segments:a,settings:n,duplicated:s=null})=>this.setState({campaigns:e,prompts:t,segments:a,settings:n,duplicated:s,inFlight:!1}))),(0,s.Z)(this,"manageCampaignGroup",((e,t="POST")=>{const{setError:a,wizardApiFetch:n}=this.props;return n({path:"/newspack/v1/wizard/newspack-popups-wizard/batch-publish/",data:{ids:e.map((e=>e.id))},method:t,quiet:!0}).then(this.updateAfterAPI).catch((e=>a(e)))})),this.state={campaigns:[],prompts:[],segments:[],settings:[],previewUrl:null,duplicated:null,inFlight:!1}}render(){const{pluginRequirements:e,setError:t,isLoading:a,wizardApiFetch:s,startLoading:r,doneLoading:c}=this.props,{campaigns:p,inFlight:l,prompts:m,segments:d,settings:u,previewUrl:w,duplicated:g}=this.state;return(0,i.createElement)(o.BA,{url:w,renderButton:({showPreview:o})=>{const w={headerText:Ue,subHeaderText:Ye,tabbedNavigation:Je,setError:t,isLoading:a,startLoading:r,doneLoading:c,wizardApiFetch:s,prompts:m,segments:d,settings:u,duplicated:g,inFlight:l},h={...w,manageCampaignGroup:this.manageCampaignGroup,updatePopup:this.updatePopup,deletePopup:this.deletePopup,restorePopup:this.restorePopup,duplicatePopup:this.duplicatePopup,previewPopup:e=>this.setState({previewUrl:this.previewUrlForPopup(e)},(()=>o())),publishPopup:this.publishPopup,resetDuplicated:()=>this.setState({duplicated:null}),unpublishPopup:this.unpublishPopup,refetch:this.refetch};return(0,i.createElement)(Be,{hashType:"slash"},(0,i.createElement)(We,null,e,(0,i.createElement)(Ge,{path:"/campaigns/:id?",render:e=>{const a=e.match.params.id;return(0,i.createElement)(oe.Provider,{value:m},(0,i.createElement)(Ee,(0,n.Z)({},h,{archiveCampaignGroup:(e,a)=>s({path:`/newspack/v1/wizard/newspack-popups-wizard/archive-campaign/${e}`,method:a?"POST":"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e))),campaignId:a,createCampaignGroup:a=>s({path:"/newspack/v1/wizard/newspack-popups-wizard/create-campaign/",method:"POST",data:{name:a},quiet:!0}).then((t=>{this.setState({campaigns:t.campaigns,prompts:t.prompts,segments:t.segments,settings:t.settings}),e.history.push(`/campaigns/${t.term_id}`)})).catch((e=>t(e))),deleteCampaignGroup:a=>s({path:`/newspack/v1/wizard/newspack-popups-wizard/delete-campaign/${a}`,method:"DELETE",quiet:!0}).then((t=>{this.setState({campaigns:t.campaigns,prompts:t.prompts,segments:t.segments,settings:t.settings}),e.history.push("/campaigns/")})).catch((e=>t(e))),duplicateCampaignGroup:(a,n)=>s({path:`/newspack/v1/wizard/newspack-popups-wizard/duplicate-campaign/${a}`,method:"POST",data:{name:n},quiet:!0}).then((t=>{this.setState({campaigns:t.campaigns,prompts:t.prompts,segments:t.segments,settings:t.settings}),e.history.push(`/campaigns/${t.term_id}`)})).catch((e=>t(e))),renameCampaignGroup:(e,a)=>s({path:`/newspack/v1/wizard/newspack-popups-wizard/rename-campaign/${e}`,method:"POST",data:{name:a},quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e))),campaigns:p})))}}),(0,i.createElement)(Ge,{path:"/segments/:id?",render:e=>(0,i.createElement)(Re,(0,n.Z)({},e,w,{setSegments:e=>this.setState({segments:e})}))}),(0,i.createElement)(Ge,{path:"/analytics",render:()=>(0,i.createElement)(be,w)}),(0,i.createElement)(Ge,{path:"/settings",render:()=>(0,i.createElement)(fe,w)}),(0,i.createElement)(Le,{to:"/campaigns"})))}})}}(0,i.render)((0,i.createElement)((0,o.uF)(Ke,["newspack-popups"])),document.getElementById("newspack-popups-wizard"))},9196:e=>{"use strict";e.exports=window.React},6292:e=>{"use strict";e.exports=window.moment},6989:e=>{"use strict";e.exports=window.wp.apiFetch},5609:e=>{"use strict";e.exports=window.wp.components},9818:e=>{"use strict";e.exports=window.wp.data},9307:e=>{"use strict";e.exports=window.wp.element},2694:e=>{"use strict";e.exports=window.wp.hooks},2629:e=>{"use strict";e.exports=window.wp.htmlEntities},5736:e=>{"use strict";e.exports=window.wp.i18n},9630:e=>{"use strict";e.exports=window.wp.keycodes},444:e=>{"use strict";e.exports=window.wp.primitives},6483:e=>{"use strict";e.exports=window.wp.url}},a={};function n(e){var s=a[e];if(void 0!==s)return s.exports;var i=a[e]={id:e,loaded:!1,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=t,e=[],n.O=(t,a,s,i)=>{if(!a){var r=1/0;for(l=0;l<e.length;l++){for(var[a,s,i]=e[l],c=!0,p=0;p<a.length;p++)(!1&i||r>=i)&&Object.keys(n.O).every((e=>n.O[e](a[p])))?a.splice(p--,1):(c=!1,i<r&&(r=i));if(c){e.splice(l--,1);var o=s();void 0!==o&&(t=o)}}return t}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[a,s,i]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.j=964,(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");a.length&&(e=a[a.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={964:0};n.O.j=t=>0===e[t];var t=(t,a)=>{var s,i,[r,c,p]=a,o=0;if(r.some((t=>0!==e[t]))){for(s in c)n.o(c,s)&&(n.m[s]=c[s]);if(p)var l=p(n)}for(t&&t(a);o<r.length;o++)i=r[o],n.o(e,i)&&e[i]&&e[i][0](),e[r[o]]=0;return n.O(l)},a=globalThis.webpackChunkwebpack=globalThis.webpackChunkwebpack||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var s=n.O(void 0,[351],(()=>n(9661)));s=n.O(s);var i=window;for(var r in s)i[r]=s[r];s.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})})();