!function(){var e,t={9693:function(e){e.exports=function(e){for(var t=-1,a=null==e?0:e.length,n=0,s=[];++t<a;){var r=e[t];r&&(s[n++]=r)}return s}},9661:function(e,t,a){"use strict";a.r(t);var n=a(7462),s=a(4942),r=(a(5674),a(9307)),i=a(5736),c=a(6483),p=a(129),o=a(264),l=a(9674),m=a(9630),d=a(7259),u=a(5609);const w=i.__;var g=e=>{let{dismiss:t,hasPrompts:a,hasPublished:n,isArchive:s,onActivate:i,onArchive:c,onDeactivate:p,onDelete:l,onDuplicate:d,onRename:g,onUnarchive:h}=e;return(0,r.createElement)(o.J2,{position:"bottom right",onFocusOutside:()=>t(),onKeyDown:e=>m.ESCAPE===e.keyCode&&t()},(0,r.createElement)(u.MenuItem,{onClick:()=>t(),className:"screen-reader-text"},w("Close Popover","newspack")),a&&(0,r.createElement)(u.MenuItem,{onClick:()=>{t(),i()},className:"newspack-button"},w("Activate all prompts","newspack")),n&&(0,r.createElement)(u.MenuItem,{onClick:()=>{t(),p()},className:"newspack-button"},w("Deactivate all prompts","newspack")),(0,r.createElement)(u.MenuItem,{onClick:()=>{t(),d()},className:"newspack-button"},w("Duplicate","newspack")),(0,r.createElement)(u.MenuItem,{onClick:()=>{t(),g()},className:"newspack-button"},w("Rename","newspack")),!s&&(0,r.createElement)(u.MenuItem,{onClick:()=>{t(),c()},className:"newspack-button"},w("Archive","newspack")),s&&(0,r.createElement)(u.MenuItem,{onClick:()=>{t(),h()},className:"newspack-button"},w("Unarchive","newspack")),(0,r.createElement)(u.MenuItem,{onClick:()=>{t(),l()},className:"newspack-button"},w("Delete","newspack")))},h=a(444),k=(0,r.createElement)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,r.createElement)(h.Path,{d:"M18.5 10.5H10v8h8a.5.5 0 00.5-.5v-7.5zm-10 0h-3V18a.5.5 0 00.5.5h2.5v-8zM6 4h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2z"})),v=a(5332),E=e=>{const[t,a]=(0,r.useState)(null),[s,i]=(0,r.useState)(!1),[p,l]=(0,r.useState)(Math.floor(9999*Math.random())),m=window?.newspack_popups_wizard_data?.preview_post,d=window?.newspack_popups_wizard_data?.frontend_url||"/",{campaign:u=!1,onLoad:w=(()=>{}),segment:g="",showUnpublished:h=!1,url:k=m||d}=e;(0,r.useEffect)((()=>{s||a(v(k))}),[s]);const v=e=>{const t=g.length?[`segment:${g}`]:["segment:everyone"];return h&&t.push("show_unpublished:true"),u?t.push(`campaign:${u}`):t.push("all"),t.push("session_id:"+p),(0,c.addQueryArgs)(e,{view_as:t.join(";")})};return(0,r.createElement)(o.BA,(0,n.Z)({},e,{onLoad:e=>{e&&([...e.contentWindow.document.querySelectorAll("a")].forEach((e=>{const t=e.getAttribute("href");0===t.indexOf(d)&&e.setAttribute("href",v(t))})),i(!0),w(e))},onClose:()=>{l(Math.floor(9999*Math.random())),i(!1)},url:t}))},f=a(6989),_=a.n(f),b=a(2629),y=a(9522);const C=i.__;var z=e=>{let{deletePopup:t,restorePopup:a,onFocusOutside:n,prompt:s,previewPopup:i,publishPopup:c,setIsDuplicatePromptModalVisible:p,unpublishPopup:l}=e;const{id:d,edit_link:w,status:g}=s,h="publish"===g,k="trash"===g;return(0,r.createElement)(o.J2,{position:"bottom left",onFocusOutside:n,onKeyDown:e=>m.ESCAPE===e.keyCode&&n(),className:"newspack-popover__campaigns__primary-popover"},(0,r.createElement)(u.MenuItem,{onClick:()=>n(),className:"screen-reader-text"},C("Close Popover","newspack")),k?(0,r.createElement)(r.Fragment,null,(0,r.createElement)(u.MenuItem,{onClick:()=>a(d),className:"newspack-button"},C("Restore","newspack")),(0,r.createElement)(u.MenuItem,{onClick:()=>t(d),className:"newspack-button"},C("Delete permanently","newspack"))):(0,r.createElement)(r.Fragment,null,(0,r.createElement)(u.MenuItem,{onClick:()=>{n(),i(s)},className:"newspack-button"},C("Preview","newspack")),(0,r.createElement)(u.MenuItem,{href:(0,b.decodeEntities)(w),className:"newspack-button",isLink:!0},C("Edit","newspack")),(0,r.createElement)(u.MenuItem,{onClick:()=>p(!0),className:"newspack-button"},C("Duplicate","newspack")),(0,r.createElement)(u.MenuItem,{onClick:()=>{n(),(h?l:c)(d)},className:"newspack-button"},C(h?"Deactivate":"Activate","newspack")),(0,r.createElement)(u.MenuItem,{onClick:()=>t(d),className:"newspack-button"},C("Delete","newspack"))),(0,r.createElement)("div",{className:"newspack-popover__campaigns__info"},C("ID:","newspack")," ",d))},S=a(2694),P=a(8306),x=a.n(P),A=a(9693),N=a.n(A);const O=i.__,F=window.newspack_popups_wizard_data?.criteria||[],M=e=>-1<(window.newspack_popups_wizard_data?.overlay_placements||[]).indexOf(e.options.placement),I=e=>"above_header"===e.options.placement,T=e=>{const t=window.newspack_popups_wizard_data?.custom_placements||{};return-1<Object.keys(t).indexOf(e.options.placement)},D={top:O("Top Overlay","newspack"),top_left:O("Top Left Overlay","newspack"),top_right:O("Top Right Overlay","newspack"),center:O("Center Overlay","newspack"),center_left:O("Center Left Overlay","newspack"),center_right:O("Center Right Overlay","newspack"),bottom:O("Bottom Overlay","newspack"),bottom_left:O("Bottom Left Overlay","newspack"),bottom_right:O("Bottom Right Overlay","newspack"),inline:O("Inline","newspack"),archives:O("In archive pages","newspack"),above_header:O("Above Header","newspack"),manual:O("Manual Only","newspack")},Z=e=>{let{options:{frequency:t,placement:a}}=e;const n=window.newspack_popups_wizard_data?.custom_placements||{};return"manual"===t||n.hasOwnProperty(a)?O("Custom Placement","newspack"):D[a]},$=e=>{const t=window.newspack_popups_wizard_data?.custom_placements,a=window.newspack_popups_wizard_data?.overlay_placements,n=Object.keys(D).filter((t=>M(e)?-1<a.indexOf(t):-1===a.indexOf(t))).map((e=>({label:D[e],value:e})));return!M(e)&&t?n.concat(Object.keys(t).map((e=>({label:t[e],value:e})))):n},H={once:O("Once a month","newspack"),weekly:O("Once a week","newspack"),daily:O("Once a day","newspack"),always:O("Every pageview","newspack"),custom:O("Custom frequency (edit prompt to manage)","newspack")},V=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"publish"!==e||t?"newspack-card__is-disabled":"newspack-card__is-supported"},j=e=>{const{categories:t,tags:a,campaign_groups:n,status:s}=e,r=[];if(n.length>0){const e=n.map((e=>{let{name:t}=e;return t})).join(", ");r.push((1===n.length?O("Campaign: ","newspack"):O("Campaigns: ","newspack"))+e)}return t.length>0&&r.push(O("Categories: ","newspack")+t.map((e=>e.name)).join(", ")),a.length>0&&r.push(O("Tags: ","newspack")+a.map((e=>e.name)).join(", ")),"pending"===s&&r.push(O("Pending review","newspack")),"future"===s&&r.push(O("Scheduled","newspack")),r.push(O("Frequency: ","newspack")+U(e)),r.length?r.join(" | "):null},R=e=>{const t=[];if(e.configuration.is_disabled&&t.push(O("Segment disabled","newspack")),e.criteria)for(const a of F){const n=e.criteria.find((e=>{let{criteria_id:t}=e;return t===a.id}));if(n?.value){let e=n.value;if(a.options){const t=a.options.find((e=>{let{value:t}=e;return t===n.value}));t&&(e=t.label)}if(Array.isArray(e))e=e.join(", ");else if("object"==typeof e){const t=[];for(const a in e)e[a]&&t.push(`${a}: ${e[a]}`);e=t.join(", ")}const s=(0,S.applyFilters)("newspack.wizards.campaigns.segmentDescription.criteriaMessage",(0,i.sprintf)("%1$s: %2$s",a.name,e),e,a,n);s&&t.push(s)}}return()=>(0,r.createElement)(r.Fragment,null,t.map(((e,a)=>(0,r.createElement)(r.Fragment,{key:a},e," ",t.length!==a+1?" | ":null))))},q=x()((async e=>{const t=await Promise.all(e.map((async e=>{try{return(await _()({path:(0,c.addQueryArgs)("/wp/v2/categories/"+e,{_fields:"name"})})).name}catch(e){return console.warn(e),""}})));return N()(t)})),B=e=>{let{ids:t}=e;const[a,n]=(0,r.useState)([]);return(0,r.useEffect)((()=>{q(t).then(n)}),[t]),a.length?(0,r.createElement)("span",null,O("Favorite Categories:","newspack")," ",a.length?a.join(", "):""):null};(0,S.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.favoriteCategories",((e,t,a,n)=>"favorite_categories"===a.id?n.value?.length?(0,r.createElement)(B,{ids:n.value}):null:e));const L=x()((async e=>{try{const t=await _()({path:e});return(Array.isArray(t)?t:Object.values(t)).map((e=>({id:isNaN(parseInt(e.id))?e.id.toString():parseInt(e.id),label:e.title||e.name})))}catch(e){return console.warn(e),[]}})),G=e=>{let{label:t,ids:a,path:n}=e;const[s,i]=(0,r.useState)([]);return(0,r.useEffect)((()=>{L(n).then(i)}),[a]),s.length?(0,r.createElement)("span",null,t," ",s.length?s.filter((e=>a.includes(e.id))).map((e=>e.label)).join(", "):""):null};(0,S.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.newsletterSubscribedLists",((e,t,a,n)=>["subscribed_lists","not_subscribed_lists"].includes(a.id)?n.value?.length?(0,r.createElement)(G,{label:"subscribed_lists"===a.id?O("Subscribed to:"):O("Not subscribed to:"),ids:n.value,path:"/newspack-newsletters/v1/lists_config"}):null:e)),(0,S.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.activeSubscriptions",((e,t,a,n)=>["active_subscriptions","not_active_subscriptions"].includes(a.id)?n.value?.length?(0,r.createElement)(G,{label:"active_subscriptions"===a.id?O("Has active subscription(s):"):O("Does not have active subscription(s):"),ids:n.value,path:"/newspack/v1/wizard/newspack-popups-wizard/subscription-products"}):null:e)),(0,S.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.activeMemberships",((e,t,a,n)=>["active_memberships","not_active_memberships"].includes(a.id)?n.value?.length?(0,r.createElement)(G,{label:"active_memberships"===a.id?O("Has active membership(s):"):O("Does not have active membership(s):"),ids:n.value,path:"/wc/v3/memberships/plans?per_page=100"}):null:e));const W=(e,t)=>{const a=[];if("publish"===t.status&&(I(t)||M(t)||T(t))){const a=t.categories,n=e.filter((e=>{const n=e.categories,s=0===a.length&&0===n.length||a.some((e=>n.some((t=>e.term_id===t.term_id))));return"publish"===e.status&&e.id!==t.id&&(r=e,t.options.placement===r.options.placement)&&((e,t)=>{const a=e.map((e=>e.term_id)),n=t.map((e=>e.term_id));return!a.length&&!n.length||a.some((e=>-1<n.indexOf(e)))})(t.segments,e.segments)&&s;var r})),s=(0,S.applyFilters)("newspack.wizards.campaigns.conflictingPrompts",n,t,e);return 0<s.length?(0,r.createElement)(r.Fragment,null,(0,r.createElement)("strong",null,(0,i.sprintf)(O("%s detected:","newspack"),1<s.length?O("Conflicts","newspack"):O("Conflict","newspack"))),(0,r.createElement)("ul",null,s.map((e=>(0,r.createElement)("li",{key:e.id},(0,r.createElement)("p",{"data-testid":`conflict-warning-${t.id}`},(0,r.createElement)("strong",null,(0,i.sprintf)("%s: ",e.title)),(0,r.createElement)("span",null,((e,t)=>M(e)||I(e)?(0,i.sprintf)(O("If multiple%1$s %2$s share the same segment%3$s, only the most recent one will be displayed."),0===t.length?O(" uncategorized","newspack"):"",I(e)?O("above-header prompts","newspack"):O("overlays","newspack"),0<t.length?O(" and category filtering","newspack"):""):T(e)?(0,i.sprintf)(O("If multiple%1$s prompts in the same custom placement share the same segment%2$s, only the most recent one will be displayed."),0===t.length?O(" uncategorized","newspack"):"",0<t.length?O(" and category filtering","newspack"):""):"")(t,a)))))))):null}return a.length?a.join(" "):null},U=e=>{let{options:{frequency:t}}=e;return H[t]},Y=i.__,{SettingsCard:J}=o.Zr;var K=e=>{let{prompt:t,disabled:a,onClose:n,updatePopup:s}=e;const[c,p]=o.PT.useObjectState(t),{excluded_categories:l=[],excluded_tags:m=[]}=c.options||{},[d,u]=(0,r.useState)(0<l.length||0<m.length||!1);return(0,r.createElement)(o.u_,{title:t.title,onRequestClose:n,isWide:!0},(0,r.createElement)(o.zx,{onClick:()=>n(),className:"screen-reader-text"},Y("Close Modal","newspack")),(0,r.createElement)(o.rj,{gutter:64,columns:1},(0,r.createElement)(J,{title:Y("Campaigns","newspack"),description:Y("Assign a prompt to one or more campaigns for easier management","newspack"),columns:1,className:"newspack-settings__campaigns",noBorder:!0},(0,r.createElement)(o.HZ,{disabled:a,value:c.campaign_groups||[],onChange:e=>p({campaign_groups:e}),label:Y("Campaigns","newspack"),taxonomy:"newspack_popups_taxonomy",hideLabelFromVision:!0})),(0,r.createElement)(J,{title:Y("Settings","newspack"),description:Y("When and how should the prompt be displayed","newspack"),columns:M(t)?3:2,className:"newspack-settings__settings",rowGap:16,noBorder:!0},(0,r.createElement)(o.Yw,{label:Y("Frequency","newspack"),disabled:a,onChange:e=>{p({options:{frequency:e}})},options:Object.keys(H).map((e=>({label:H[e],value:e}))),value:c.options.frequency}),(0,r.createElement)(o.Yw,{label:M(t)?Y("Position"):Y("Placement"),disabled:a,onChange:e=>{p({options:{placement:e}})},options:$(t),value:c.options.placement}),M(t)&&(0,r.createElement)(o.Yw,{label:Y("Size"),disabled:a,onChange:e=>{p({options:{overlay_size:e}})},options:window.newspack_popups_wizard_data?.overlay_sizes,value:c.options.overlay_size})),(0,r.createElement)(J,{title:Y("Targeting","newspack"),description:()=>(0,r.createElement)(r.Fragment,null,Y("Under which conditions should the prompt be displayed","newspack"),(0,r.createElement)("br",null),Y("If multiple conditions are set, all will have to be satisfied in order to display the prompt","newspack")),className:"newspack-settings__targeting",columns:1,rowGap:16,noBorder:!0},(0,r.createElement)(o.rj,{columns:3,rowGap:16},(0,r.createElement)(o.HZ,{disabled:a,value:c.segments||[],onChange:e=>p({segments:e}),label:Y("Segments","newspack"),taxonomy:"popup_segment"}),(0,r.createElement)(o.HZ,{label:Y("Post categories","newspack "),disabled:a,hideHelpFromVision:!0,value:c.categories||[],onChange:e=>p({categories:e}),description:Y("Prompt will only appear on posts with the specified categories.","newspack")}),(0,r.createElement)(o.HZ,{label:Y("Post tags","newspack "),disabled:a,hideHelpFromVision:!0,taxonomy:"tags",value:c.tags||[],onChange:e=>p({tags:e}),description:Y("Prompt will only appear on posts with the specified tags.","newspack")})),(0,r.createElement)("div",null,(0,r.createElement)(o.zx,{isLink:!0,onClick:()=>u(!d)},(0,i.sprintf)(Y("%s Advanced Settings","newspack_popups_taxonomy"),Y(d?"Hide":"Show","newspack")))),d&&(0,r.createElement)(o.rj,{columns:3,rowGap:16},(0,r.createElement)(o.HZ,{label:Y("Category Exclusions","newspack "),disabled:a,hideHelpFromVision:!0,value:l||[],onChange:e=>p({options:{excluded_categories:e.map((e=>e.id))}}),description:Y("Prompt will not appear on posts with the specified categories.","newspack")}),(0,r.createElement)(o.HZ,{label:Y("Tag Exclusions","newspack "),disabled:a,hideHelpFromVision:!0,taxonomy:"tags",value:m||[],onChange:e=>p({options:{excluded_tags:e.map((e=>e.id))}}),description:Y("Prompt will not appear on posts with the specified tags.","newspack")})))),(0,r.createElement)(o.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,r.createElement)(o.zx,{onClick:n,variant:"secondary"},Y("Cancel","newspack")),(0,r.createElement)(o.zx,{onClick:()=>{s(c).then(n)},variant:"primary"},Y("Save","newspack"))))};const X=i.__;var Q=e=>{const[t,a]=(0,r.useState)(!1),[s,c]=(0,r.useState)(!1),[p,l]=(0,r.useState)(!1),[m,u]=(0,r.useState)(null),{className:w,description:g,duplicated:h,duplicatePopup:k,inFlight:v,resetDuplicated:E,prompt:f={},segments:C,warning:S}=e,{campaign_groups:P,id:x,edit_link:A,title:N}=f;(0,r.useEffect)((()=>{p&&!m&&O()}),[p]);const O=async()=>{const e=parseInt(f?.duplicate_of||f.id);try{const t=await _()({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/${f.id}/duplicate`});u(t)}catch(e){u(N+X(" copy","newspack-popups"))}};return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(o.fM,{isSmall:!0,badge:Z(f),className:w,title:N.length?(0,b.decodeEntities)(N):X("(no title)","newspack"),titleLink:(0,b.decodeEntities)(A),key:x,description:g,notification:S,notificationLevel:"error",actionText:(0,r.createElement)(r.Fragment,null,(0,r.createElement)("div",{className:"newspack-popups-wizard__buttons"},(0,r.createElement)(o.zx,{className:t&&"popover-active",onClick:()=>a(!t),icon:y.Z,label:X("Prompt settings","newspack"),tooltipPosition:"bottom center"}),(0,r.createElement)(o.zx,{className:s&&"popover-active",onClick:()=>c(!s),icon:d.Z,label:X("More options","newspack"),tooltipPosition:"bottom center"}),s&&(0,r.createElement)(z,(0,n.Z)({onFocusOutside:()=>c(!1),prompt:f,setIsDuplicatePromptModalVisible:l},e))))}),t&&(0,r.createElement)(K,{prompt:f,disabled:v,onClose:()=>a(!1),segments:C,updatePopup:e.updatePopup}),p&&(0,r.createElement)(o.u_,{className:"newspack-popups__duplicate-modal",title:(0,i.sprintf)(X("Duplicate “%s”","newspack"),N),onRequestClose:()=>{l(!1),u(null),E()}},h?(0,r.createElement)(r.Fragment,null,(0,r.createElement)(o.qX,{isSuccess:!0,noticeText:(0,i.sprintf)(X("Duplicate of “%s” created as a draft.","newspack"),N)}),!P&&(0,r.createElement)(o.qX,{isWarning:!0,noticeText:X("This prompt is currently not assigned to any campaign.","newspack")}),(0,r.createElement)(o.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,r.createElement)(o.zx,{isSecondary:!0,onClick:()=>{l(!1),u(null),E()}},X("Close","newspack")),(0,r.createElement)(o.zx,{isPrimary:!0,href:`/wp-admin/post.php?post=${h}&action=edit`},X("Edit","newspack")))):(0,r.createElement)(r.Fragment,null,!P&&(0,r.createElement)(o.qX,{isWarning:!0,noticeText:X("This prompt will not be assigned to any campaign.","newspack")}),(0,r.createElement)(o.w4,{disabled:v||null===m,label:X("Title","newspack"),value:m,onChange:e=>u(e)}),(0,r.createElement)(o.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,r.createElement)(o.zx,{disabled:v,isSecondary:!0,onClick:()=>{l(!1),u(null),E()}},X("Cancel","newspack")),(0,r.createElement)(o.zx,{disabled:v||null===m,isPrimary:!0,onClick:()=>{const e=m.trim()||O();k(x,e)}},X("Duplicate","newspack"))))))};const ee=(0,r.createElement)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,r.createElement)(u.Path,{d:"M4 9h16v2H4V9zm0 4h10v2H4v-2z"})),te=(0,r.createElement)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,r.createElement)(u.Path,{d:"M17 14H7v3h10v-3z"}),(0,r.createElement)(u.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})),ae=(0,r.createElement)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,r.createElement)(u.Path,{d:"M16 10H8v4h8v-4z"}),(0,r.createElement)(u.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})),ne=(0,r.createElement)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,r.createElement)(u.Path,{d:"M17 7H7v3h10V7z"}),(0,r.createElement)(u.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})),se=(0,r.createElement)(u.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,r.createElement)(u.Path,{d:"M18 4H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm.5 14c0 .3-.2.5-.5.5H6c-.3 0-.5-.2-.5-.5V6c0-.3.2-.5.5-.5h12c.3 0 .5.2.5.5v12zM7 11h2V9H7v2zm0 4h2v-2H7v2zm3-4h7V9h-7v2zm0 4h7v-2h-7v2z"})),re=(0,r.createElement)(u.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,r.createElement)(u.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v3.5h-15V5c0-.3.2-.5.5-.5zm8 5.5h6.5v3.5H13V10zm-1.5 3.5h-7V10h7v3.5zm-7 5.5v-4h7v4.5H5c-.3 0-.5-.2-.5-.5zm14.5.5h-6V15h6.5v4c0 .3-.2.5-.5.5z"})),ie=i.__,ce=(e,t,a)=>{const n=[];return e&&n.push(`placement=${e}`),+t>0&&n.push(`group=${t}`),a&&n.push(`segment=${a}`),"/wp-admin/post-new.php?post_type=newspack_popups_cpt&"+n.join("&")};var pe=e=>{const{campaignData:t,campaignId:a,segment:s}=e,[i,c]=(0,r.useState)(!1),{label:p,id:l,prompts:m}=s,d="unassigned"!==a?parseInt(a):-1;let u;u="unassigned"===a?ie("No unassigned prompts in this segment.","newspack"):t?ie("No prompts in this segment for","newspack")+" "+t.name+".":ie("No active prompts in this segment.","newspack");const w=R(s);return(0,r.createElement)(o.Zb,{isSmall:!0,className:"newspack-campaigns__segment-group__card"},(0,r.createElement)("div",{className:"newspack-campaigns__segment-group__card__segment"},(0,r.createElement)("div",{className:"newspack-campaigns__segment-group__card__segment-title"},(0,r.createElement)("h3",null,l?(0,r.createElement)(o.zx,{href:`#/segments/${l}`,label:ie("Edit Segment ","newspack"),isLink:!0,showTooltip:!0,tooltipPosition:"bottom center"},ie("Segment: ","newspack"),p):p),(0,r.createElement)("span",{className:"newspack-campaigns__segment-group__description"},l?w():ie("All readers, regardless of segment","newspack"))),(0,r.createElement)("div",{className:"newspack-campaigns__segment-group__card__segment-actions"},(0,r.createElement)(E,{campaign:!!a&&d,segment:l,showUnpublished:!!a,renderButton:e=>{let{showPreview:t}=e;return(0,r.createElement)(o.zx,{isSmall:!0,variant:"tertiary",onClick:()=>t()},ie("Preview Segment","newspack"))}}),"unassigned"!==a&&(0,r.createElement)(r.Fragment,null,(0,r.createElement)(o.zx,{isSmall:!0,variant:"secondary",onClick:()=>c(!i)},ie("Add New Prompt","newspack")),i&&(0,r.createElement)(o.u_,{title:ie("Add New Prompt","newspack"),onRequestClose:()=>c(!1),shouldCloseOnEsc:!1,shouldCloseOnClickOutside:!1,isWide:!0},(0,r.createElement)(o.rj,{gutter:32,columns:3},(0,r.createElement)(o.Wu,{href:ce("overlay-center",a,l),title:ie("Center Overlay","newspack"),desc:ie("Fixed at the center of the screen","newspack"),icon:ae}),(0,r.createElement)(o.Wu,{href:ce("overlay-top",a,l),title:ie("Top Overlay","newspack"),desc:ie("Fixed at the top of the screen","newspack"),icon:ne}),(0,r.createElement)(o.Wu,{href:ce("overlay-bottom",a,l),title:ie("Bottom Overlay","newspack"),desc:ie("Fixed at the bottom of the screen","newspack"),icon:te}),(0,r.createElement)(o.Wu,{href:ce(null,a,l),title:ie("Inline","newspack"),desc:ie("Embedded in content","newspack"),icon:ee}),(0,r.createElement)(o.Wu,{href:ce("archives",a,l),title:ie("In Archive Pages","newspack"),desc:ie("Embedded once or many times in archive pages","newspack"),icon:se}),(0,r.createElement)(o.Wu,{href:ce("above-header",a,l),title:ie("Above Header","newspack"),desc:ie("Embedded at the very top of the page","newspack"),icon:k}),(0,r.createElement)(o.Wu,{href:ce("custom",a,l),title:ie("Custom Placement","newspack"),desc:ie("Only appears when placed in content","newspack"),icon:v.Z}),(0,r.createElement)(o.Wu,{href:ce("manual",a,l),title:ie("Manual Only","newspack"),desc:ie("Only appears where Single Prompt block is inserted","newspack"),icon:re})))))),(0,r.createElement)(o.Zb,{noBorder:!0,className:"newspack-campaigns__segment-group__action-cards"},m.map((t=>(0,r.createElement)(Q,(0,n.Z)({className:V(t.status,s.configuration.is_disabled),description:j(t),warning:W(m,t),key:t.id,prompt:t},e))))),m.length<1?(0,r.createElement)("p",null,u):"")};const oe=(0,r.createContext)({prompts:[]});var le=a(4184),me=a.n(le),de=a(3311),ue=a.n(de);const we=i.__,{useHistory:ge}=o.F0,he="active",ke=e=>we(2===e?"Rename Campaign":1===e?"Duplicate Campaign":"Add New Campaign","newspack"),ve=(e,t)=>{if("trash"===t)return e.filter((e=>{let{status:t}=e;return"trash"===t}));const a=e.filter((e=>{let{status:t}=e;return"trash"!==t}));return he===t?a.filter((e=>{let{status:t}=e;return"publish"===t})):"all"===t?a.filter((e=>{let{status:t}=e;return"trash"!==t})):"unassigned"===t?a.filter((e=>{let{campaign_groups:t}=e;return!t||!t.length})):a.filter((e=>{let{campaign_groups:a}=e;return a&&a.find((e=>+e.term_id==+t))}))};var Ee=(0,o.a4)((e=>{const{campaignId:t=he,campaigns:a=[],manageCampaignGroup:s,segments:i,createCampaignGroup:c,duplicateCampaignGroup:p,deleteCampaignGroup:l,archiveCampaignGroup:u,renameCampaignGroup:w}=e,h=(0,r.useRef)(null),[k,v]=(0,r.useState)(),[E,f]=(0,r.useState)(),[_,b]=(0,r.useState)(),[y,C]=(0,r.useState)(),z=(0,r.useContext)(oe),S=ve(z,t),P=ve(z,"unassigned").length;(0,r.useEffect)((()=>{E&&h.current.querySelector("input").focus()}),[E]);const x=ge(),A=e=>{3===_?c(e):2===_?w(t,e):1===_&&p(t,e),f(!1)},N=a.filter((e=>{let{status:t}=e;return"archive"!==t})),O=a.filter((e=>{let{status:t}=e;return"archive"===t})),F=((e,t)=>t.reduce(((t,a)=>+e>0&&+e==+a.term_id?a:t),null))(t,a),M=[{key:he,name:we("Active Prompts","newspack")},{key:"all",name:we("All Prompts","newspack")},{key:"trash",name:we("Trash","newspack")},...P?[{key:"unassigned",name:we("Unassigned Prompts","newspack")}]:[],...N.length?[{key:"header-campaigns",name:we("Campaigns","newspack"),className:"is-header"}]:[],...N.map((e=>{let{term_id:t,name:a}=e;return{key:String(t),name:a,className:"newspack-campaigns__campaign-group__select-control-group-item"}})),...O.length?[{key:"header-archived-campaigns",name:we("Archived Campaigns","newspack"),className:"is-header"}]:[],...O.map((e=>{let{term_id:t,name:a}=e;return{key:String(t),name:a+" "+we("(archived)","newspack"),className:"newspack-campaigns__campaign-group__select-control-group-item"}}))];return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(o.Zb,{headerActions:!0,noBorder:!0},(0,r.createElement)("div",{className:"newspack-campaigns__campaign-group__filter-group-actions"},(0,r.createElement)(o.Yq,{label:we("Campaigns","newspack"),options:M.map((e=>({...e,className:me()(e.className,{"is-selected":e.key===t})}))),onChange:e=>{let{selectedItem:{key:t}}=e;return he===t?x.push("/campaigns"):x.push(`/campaigns/${t}`)},value:ue()(M,["key",t||he]),hideLabelFromVision:!0}),F&&(0,r.createElement)("div",{className:"newspack-campaigns__campaign-group__filter-group-actions__button"},(0,r.createElement)(o.zx,{className:k&&"popover-active",onClick:()=>v(!k),icon:d.Z,label:we("Actions","newspack"),tooltipPosition:"bottom center"}),k&&(0,r.createElement)(g,{dismiss:()=>v(!1),isArchive:F&&"archive"===F.status,onActivate:()=>s(S),onArchive:()=>u(t,!0),onDeactivate:()=>s(S,"DELETE"),onDelete:()=>l(t),onDuplicate:()=>{f(!0),C(""),b(1)},onRename:()=>{C(F.name),f(!0),b(2)},onUnarchive:()=>u(t,!1),hasPrompts:S.length>0,hasPublished:S.some((e=>{let{status:t}=e;return"publish"===t}))}))),(0,r.createElement)("div",{className:"newspack-campaigns__campaign-group__add-new-button"},(0,r.createElement)(o.zx,{isPrimary:!0,onClick:()=>{f(!E),C(""),b(3)}},we("Add New Campaign","newspack")),E&&(0,r.createElement)(o.u_,{title:ke(_),onRequestClose:()=>{f(!1)}},(0,r.createElement)("div",{ref:h},(0,r.createElement)(o.w4,{placeholder:we("Campaign Name","newspack"),onChange:C,label:we("Campaign Name","newspack"),hideLabelFromVision:!0,value:y,onKeyDown:e=>{m.ENTER===e.keyCode&&""!==y&&(e.preventDefault(),A(y))}})),(0,r.createElement)(o.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,r.createElement)(o.zx,{variant:"secondary",onClick:()=>{f(!1)}},we("Cancel","newspack")),(0,r.createElement)(o.zx,{variant:"primary",disabled:!y,onClick:()=>A(y)},(e=>we(2===e?"Rename":1===e?"Duplicate":"Add","newspack"))(_)))))),((e,t)=>{const a=[];return a.push(...e.map((e=>{let{name:a,id:n,configuration:s,criteria:r}=e;return{label:a,id:n,configuration:s,criteria:r,prompts:t.filter((e=>{let{segments:t}=e;return!!t&&!!t.find((e=>e.term_id===parseInt(n)))}))}}))),a.push({label:we("Everyone","newspack"),id:"",prompts:t.filter((e=>{let{segments:t}=e;return 0===t.length})),configuration:{}}),a})(i,S).map(((a,s)=>he===t&&a.configuration.is_disabled?null:(0,r.createElement)(pe,(0,n.Z)({key:s,segment:a,campaignId:t,campaignData:F},e)))))}));const fe=i.__;var _e=(0,o.a4)((()=>(0,r.createElement)("div",{className:"newspack-campaigns-wizard-analytics__wrapper"},(0,r.createElement)(o.Zb,{isNarrow:!0},(0,r.createElement)("h2",null,fe("Coming soon","newspack")),(0,r.createElement)("p",null,(0,r.createElement)(r.Fragment,null,fe("We’re currently redesigning this dashboard to accommodate GA4 and give you deeper insights into Campaign performance. In the meantime, you can find Campaign event data within your GA account. Review this ","newspack"),(0,r.createElement)("a",{target:"_blank",rel:"noopener noreferrer",href:"https://help.newspack.com/analytics/"},fe("help page","newspack")),fe(" to see how Campaign data is being recorded in GA.","newspack"),",")),(0,r.createElement)(o.Zb,{buttonsCard:!0,noBorder:!0},(0,r.createElement)(o.zx,{target:"_blank",rel:"noopener noreferrer",href:"https://help.newspack.com/analytics/",isPrimary:!0},fe("View the help page","newspack"))))))),be=(0,o.a4)((()=>(0,r.createElement)(o.d5,{pluginSlug:"newspack-popups-wizard",isWizard:!0,title:null}))),ye=a(1984),Ce=(0,r.createElement)(h.SVG,{width:"18",height:"18",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18"},(0,r.createElement)(h.Path,{d:"M5 4h2V2H5v2zm6-2v2h2V2h-2zm-6 8h2V8H5v2zm6 0h2V8h-2v2zm-6 6h2v-2H5v2zm6 0h2v-2h-2v2z"})),ze=a(6015),Se=a(3904);const Pe=i.__,{NavLink:xe,useHistory:Ae}=o.F0,Ne=()=>(0,r.createElement)(xe,{to:"segments/new"},(0,r.createElement)(o.zx,{variant:"primary"},Pe("Add New Segment","newspack"))),Oe=e=>{let{inFlight:t,segment:a,segments:n,deleteSegment:s,dropTargetIndex:i,setDropTargetIndex:c,index:p,sortSegments:l,totalSegments:w,wrapperRef:g,toggleSegmentStatus:h}=e;const[k,v]=(0,r.useState)(!1),[E,f]=(0,r.useState)(!1),_=()=>v(!1),b=Ae(),y=0===p,C=p+1===w,z=p===i,S=C&&i>=w,P=e=>{if(t)return;const s=[...n],r=e>p?e-1:e;s.splice(p,1),s.splice(r,0,a),s.forEach(((e,t)=>e.priority=t)),JSON.stringify(s)!==JSON.stringify(n)&&l(s)},x=()=>{if(t)return;let e=p-1;0>e&&(e=0),P(e)},A=()=>{if(t)return;let e=p+2;w<e&&(e=w),P(e)};return(0,r.createElement)("div",{className:"newspack-campaigns__draggable"+(E?" is-dragging":"")+(z?" is-drop-target":"")+(S?" drop-target-after":""),id:`segment-${a.id}`},(0,r.createElement)(u.Draggable,{elementId:`segment-${a.id}`,transferData:{},onDragStart:()=>{E||t||f(!0)},onDragEnd:()=>{t||(null!==i&&P(i),c(null),f(!1))},onDragOver:e=>{if(t)return;const a=g.current.getBoundingClientRect(),n=e.pageY<=a.top+window.scrollY,s=e.pageY>=a.bottom+window.scrollY;if(n||s||e.target.classList.contains("newspack-action-card")){let t=Array.prototype.slice.call(g.current.querySelectorAll(".newspack-campaigns__draggable")).indexOf(e.target.parentElement);(0>t||t===p+1)&&(t=p),n&&(t=0),s&&(t=w),c(t)}}},(e=>{let{onDraggableStart:t,onDraggableEnd:n}=e;return(0,r.createElement)(o.fM,{isSmall:!0,title:a.name,titleLink:`#/segments/${a.id}`,description:R(a),toggleChecked:!a.configuration.is_disabled,toggleOnChange:()=>h(a),badge:a.is_criteria_duplicated?Pe("Duplicate","newspack-plugin"):void 0,actionText:(0,r.createElement)(r.Fragment,null,(0,r.createElement)(o.zx,{onClick:()=>v(!k),label:Pe("More options","newspack"),icon:d.Z,className:k&&"popover-active"}),k&&(0,r.createElement)(o.J2,{position:"bottom left",onKeyDown:e=>m.ESCAPE===e.keyCode&&_,onFocusOutside:_},(0,r.createElement)(u.MenuItem,{onClick:()=>_(),className:"screen-reader-text"},Pe("Close Popover","newspack")),(0,r.createElement)(u.MenuItem,{onClick:()=>b.push(`/segments/${a.id}`),className:"newspack-button"},Pe("Edit","newspack")),(0,r.createElement)(u.MenuItem,{onClick:()=>s(a),className:"newspack-button"},Pe("Delete","newspack"))))},(0,r.createElement)("div",{className:"newspack-campaigns__segment-priority-controls"},(0,r.createElement)("div",{className:"drag-handle",draggable:!0,onDragStart:t,onDragEnd:n},(0,r.createElement)(ye.Z,{icon:Ce,height:18,width:18})),(0,r.createElement)("div",{className:"movers"},(0,r.createElement)(o.zx,{icon:ze.Z,onClick:x,disabled:y,label:Pe("Move segment position up","newspack")}),(0,r.createElement)(o.zx,{icon:Se.Z,onClick:A,disabled:C,label:Pe("Move segment position down","newspack")}))))})))};var Fe=e=>{let{wizardApiFetch:t,segments:a,setSegments:n,isLoading:s}=e;const[i,c]=(0,r.useState)(null),[p,l]=(0,r.useState)(null),[m,d]=(0,r.useState)(!1),[u,w]=(0,r.useState)(null),g=(0,r.useRef)(),h=e=>{d(!0),w(null),t({path:`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${e.id}`,method:"POST",quiet:!0,data:{name:e.name,configuration:{...e.configuration,is_disabled:!e.configuration.is_disabled},criteria:e.criteria}}).then((e=>{console.log(e),d(!1),n(e)})).catch((e=>{console.error(e),d(!1)}))},k=e=>{d(!0),w(null),t({path:`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${e.id}`,method:"DELETE",quiet:!0}).then((e=>{d(!1),n(e)})).catch((e=>{console.error(e),d(!1)}))},v=e=>{w(null),l(e),d(!0),t({path:"/newspack/v1/wizard/newspack-popups-wizard/segmentation-sort",method:"POST",data:{segmentIds:e.map((e=>e.id))},quiet:!0}).then((e=>{d(!1),l(null),n(e)})).catch((e=>{d(!1),w(e.message||Pe("There was an error sorting segments. Please try again.")),n(a)}))};if(null===a)return null;const E=p||a;return a.length?(0,r.createElement)(r.Fragment,null,u&&(0,r.createElement)(o.qX,{noticeText:u,isError:!0}),(0,r.createElement)(o.Zb,{headerActions:!0,noBorder:!0},(0,r.createElement)("h2",null,Pe("Audience segments","newspack")),(0,r.createElement)(Ne,null)),(0,r.createElement)("div",{className:"newspack-campaigns-wizard-segments__list"+(m?" is-loading":""),ref:g},E.map(((e,t)=>(0,r.createElement)(Oe,{deleteSegment:k,key:e.id,inFlight:m||s>0,segment:e,segments:a,sortSegments:v,index:t,wrapperRef:g,dropTargetIndex:i,setDropTargetIndex:c,totalSegments:a.length,toggleSegmentStatus:h}))))):(0,r.createElement)(r.Fragment,null,(0,r.createElement)(o.Zb,{headerActions:!0,noBorder:!0},(0,r.createElement)("h2",null,Pe("You have no saved audience segments.","newspack")),(0,r.createElement)(Ne,null)),(0,r.createElement)("p",null,Pe("Create audience segments to target visitors by engagement, activity, and more.","newspack")))},Me=a(288);function Ie(e){let{label:t,help:a,placeholder:n,value:s,onChange:i,path:c}=e;const p=e=>({value:isNaN(parseInt(e.id))?e.id.toString():parseInt(e.id),label:e.title||e.name});return(0,r.createElement)(Me.Z,{label:t,help:a,placeholder:n,tokens:s||[],fetchSuggestions:async()=>{const e=await _()({path:c});return(Array.isArray(e)?e:Object.values(e)).map(p)},fetchSavedInfo:async e=>{const t=await _()({path:c});return(Array.isArray(t)?t:Object.values(t)).filter((t=>e.includes(t.id))).map(p)},onChange:i})}const Te=i.__,{useHistory:De}=o.F0,{SettingsCard:Ze,SettingsSection:$e,MinMaxSetting:He}=o.Zr,Ve={is_disabled:!1};(0,S.addFilter)("newspack.criteria.input","newspack.favoriteCategories",(function(e,t,a,n){return"favorite_categories"===t.id?(0,r.createElement)(o.HZ,{value:a||[],onChange:e=>{n(e.map((e=>e.id)))},label:t.name,hideLabelFromVision:!0}):e})),(0,S.addFilter)("newspack.criteria.input","newspack.newsletterSubscribedLists",(function(e,t,a,n){return["subscribed_lists","not_subscribed_lists"].includes(t.id)?(0,r.createElement)(Ie,{placeholder:Te("Start typing to search for lists…","newspack-plugin"),path:"/newspack-newsletters/v1/lists_config",value:a,onChange:n}):e})),(0,S.addFilter)("newspack.criteria.input","newspack.activeSubscriptions",(function(e,t,a,n){return["active_subscriptions","not_active_subscriptions"].includes(t.id)?(0,r.createElement)(Ie,{placeholder:Te("Start typing to search for products…","newspack-plugin"),path:"/newspack/v1/wizard/newspack-popups-wizard/subscription-products",value:a,onChange:n}):e})),(0,S.addFilter)("newspack.criteria.input","newspack.activeMemberships",(function(e,t,a,n){return["active_memberships","not_active_memberships"].includes(t.id)?(0,r.createElement)(Ie,{placeholder:Te("Start typing to search for membership plans…","newspack-plugin"),path:"/wc/v3/memberships/plans?per_page=100",value:a,onChange:n}):e}));var je=e=>{let{segmentId:t,setSegments:a,wizardApiFetch:n}=e;const s=window.newspack_popups_wizard_data?.criteria||[],[i,c]=o.PT.useObjectState(Ve),[p,l]=(0,r.useState)(""),[m,d]=(0,r.useState)([]),[w,g]=(0,r.useState)([]),[h,k]=(0,r.useState)(""),v=De(),[E,f]=(0,r.useState)("[]"),_=w!==JSON.stringify(m)||h!==p||JSON.stringify(E.is_disabled)!==JSON.stringify(i.is_disabled),b=o.PT.usePrompt(_,Te("There are unsaved changes to this segment. Discard changes?","newspack")),y="new"===t;(0,r.useEffect)((()=>{y||n({path:"/newspack/v1/wizard/newspack-popups-wizard/segmentation"}).then((e=>{const a=ue()(e,(e=>{let{id:a}=e;return a===t}));if(a){const e={...Ve,...a.configuration};c(e),f(e),l(a.name),k(a.name),d([...a.criteria]),g(JSON.stringify(a.criteria))}}))}),[y]);const C=e=>{const t=(e=>{const t=m.find((t=>t.criteria_id===e));return t?t.value:""})(e.id),a=(n=e.id,e=>{const t=[...m],a=t.find((e=>e.criteria_id===n));a?!e||Array.isArray(e)&&0===e.length?t.splice(t.indexOf(a),1):Array.isArray(e)||"object"!=typeof e?a.value=e:a.value={...a.value,...e}:e&&t.push({criteria_id:n,value:e}),d(t)});var n;return(0,S.applyFilters)("newspack.criteria.input","range"===e.matching_function?(0,r.createElement)(He,{"data-testid":`newspack-criteria-${e.id}`,min:t?.min,max:t?.max,onChangeMin:e=>a({min:e}),onChangeMax:e=>a({max:e})}):e.options?.length?(0,r.createElement)(o.Yw,{"data-testid":`newspack-criteria-${e.id}`,isWide:!0,onChange:a,value:t,options:e.options}):(0,r.createElement)(o.w4,{"data-testid":`newspack-criteria-${e.id}`,isWide:!0,placeholder:e.placeholder,help:e.help,value:t,onChange:a}),e,t,a)};return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(o.w4,{placeholder:Te("Untitled Segment","newspack"),value:p,onChange:l,label:Te("Title","newspack"),className:"newspack-campaigns-wizard-segments__title"}),(0,r.createElement)(Ze,{title:Te("Segment Status","newspack"),description:Te("If not enabled, the segment will be ignored for reader segmentation.","newspack"),noBorder:!0},(0,r.createElement)(u.ToggleControl,{label:Te("Segment enabled","newspack"),checked:!i.is_disabled,onChange:()=>c({is_disabled:!i.is_disabled})})),(0,r.createElement)(Ze,{title:Te("Reader Engagement","newspack"),description:Te("Target readers based on their browsing behavior.","newspack"),noBorder:!0},s.filter((e=>"reader_engagement"===e.category)).map((e=>(0,r.createElement)($e,{key:e.id,title:e.name,description:e.description},C(e))))),(0,r.createElement)(Ze,{title:Te("Registration","newspack"),description:Te("Target readers based on their user account registration status.","newspack"),columns:3,noBorder:!0},s.filter((e=>"reader_activity"===e.category)).map((e=>(0,r.createElement)($e,{key:e.id,title:e.name,description:e.description},C(e))))),(0,r.createElement)(Ze,{title:Te("Newsletters","newspack"),description:Te("Target readers based on their newsletter subscription status.","newspack"),columns:3,noBorder:!0},s.filter((e=>"newsletter"===e.category)).map((e=>(0,r.createElement)($e,{key:e.id,title:e.name,description:e.description},C(e))))),(0,r.createElement)(Ze,{title:Te("Reader Revenue","newspack"),description:Te("Target readers based on their revenue activity.","newspack"),columns:3,noBorder:!0},s.filter((e=>"reader_revenue"===e.category)).map((e=>(0,r.createElement)($e,{key:e.id,title:e.name,description:e.description},C(e))))),(0,r.createElement)(Ze,{title:Te("Referrer Sources","newspack"),description:Te("Target readers based on where they’re coming from.","newspack"),notification:Te("Segments using these options will apply only to the first page visited after coming from an external source.","newspack"),columns:2,noBorder:!0},s.filter((e=>"referrer_sources"===e.category)).map((e=>(0,r.createElement)($e,{key:e.id,title:e.name,description:e.description},C(e))))),(0,r.createElement)("div",{className:"newspack-buttons-card"},(0,r.createElement)(o.zx,{disabled:!(()=>{const e={...i},t={...Ve};return delete e.is_disabled,delete t.is_disabled,p.length>0&&m.length})()||!y&&!_,isPrimary:!0,onClick:()=>{b(),n({path:y?"/newspack/v1/wizard/newspack-popups-wizard/segmentation":`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${t}`,method:"POST",data:{name:p,criteria:m,configuration:i},quiet:!0}).then(a).then(v.push("/segments"))}},Te("Save","newspack")),(0,r.createElement)(o.zx,{isSecondary:!0,href:"#/segments"},Te("Cancel","newspack"))))},Re=(0,o.a4)((e=>{let{wizardApiFetch:t,match:a,...s}=e;const i=a.params.id;return i?(0,r.createElement)(je,(0,n.Z)({segmentId:i,wizardApiFetch:t},s)):(0,r.createElement)(Fe,(0,n.Z)({wizardApiFetch:t},s))}));const qe=i.__,{HashRouter:Be,Redirect:Le,Route:Ge,Switch:We}=l.Z,Ue=qe("Campaigns","newspack"),Ye=qe("Reach your readers with configurable campaigns","newspack"),Je=[{label:qe("Campaigns","newpack"),path:"/campaigns",exact:!0},{label:qe("Segments","newpack"),path:"/segments",exact:!0},{label:qe("Analytics","newpack"),path:"/analytics",exact:!0},{label:qe("Settings","newpack"),path:"/settings",exact:!0}];class Ke extends r.Component{constructor(e){var t;super(e),t=this,(0,s.Z)(this,"onWizardReady",(()=>{this.refetch()})),(0,s.Z)(this,"refetch",(()=>{const{setError:e,wizardApiFetch:t}=this.props;t({path:"/newspack/v1/wizard/newspack-popups-wizard/"}).then(this.updateAfterAPI).catch((t=>e(t)))})),(0,s.Z)(this,"updatePopup",(e=>{let{id:t,...a}=e;const{setError:n,wizardApiFetch:s}=this.props;return this.setState({inFlight:!0}),s({path:`/newspack/v1/wizard/newspack-popups-wizard/${t}`,method:"POST",data:{config:a},quiet:!0}).then(this.updateAfterAPI).catch((e=>n(e)))})),(0,s.Z)(this,"deletePopup",(e=>{const{setError:t,wizardApiFetch:a}=this.props;return a({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}`,method:"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,s.Z)(this,"restorePopup",(e=>{const{setError:t,wizardApiFetch:a}=this.props;return a({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/restore`,method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,s.Z)(this,"publishPopup",(e=>{const{setError:t,wizardApiFetch:a}=this.props;return a({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/publish`,method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,s.Z)(this,"unpublishPopup",(e=>{const{setError:t,wizardApiFetch:a}=this.props;return a({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/publish`,method:"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,s.Z)(this,"duplicatePopup",((e,t)=>{const{setError:a,wizardApiFetch:n}=this.props;return this.setState({inFlight:!0}),n({path:(0,c.addQueryArgs)(`/newspack/v1/wizard/newspack-popups-wizard/${e}/duplicate`,{title:t}),method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((()=>{a({code:"duplicate_prompt_error",message:qe("Error duplicating prompt. Please try again later.","newspack")})}))})),(0,s.Z)(this,"previewUrlForPopup",(e=>{let{options:t,id:a}=e;const{placement:n,trigger_type:s}=t,r=window.newspack_popups_wizard_data?.preview_query_keys||{},i={};Object.keys(t).forEach((e=>{r.hasOwnProperty(e)&&(i[r[e]]=t[e])}));let c="/";return"archives"===n&&window.newspack_popups_wizard_data?.preview_archive?c=window.newspack_popups_wizard_data.preview_archive:("inline"===n||"scroll"===s)&&window&&window.newspack_popups_wizard_data?.preview_post&&(c=window.newspack_popups_wizard_data?.preview_post),`${c}?${(0,p.stringify)({...i,pid:a})}`})),(0,s.Z)(this,"updateAfterAPI",(e=>{let{campaigns:t,prompts:a,segments:n,settings:s,duplicated:r=null}=e;return this.setState({campaigns:t,prompts:a,segments:n,settings:s,duplicated:r,inFlight:!1})})),(0,s.Z)(this,"manageCampaignGroup",(function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POST";const{setError:n,wizardApiFetch:s}=t.props;return s({path:"/newspack/v1/wizard/newspack-popups-wizard/batch-publish/",data:{ids:e.map((e=>e.id))},method:a,quiet:!0}).then(t.updateAfterAPI).catch((e=>n(e)))})),this.state={campaigns:[],prompts:[],segments:[],settings:[],previewUrl:null,duplicated:null,inFlight:!1}}render(){const{pluginRequirements:e,setError:t,isLoading:a,wizardApiFetch:s,startLoading:i,doneLoading:c}=this.props,{campaigns:p,inFlight:l,prompts:m,segments:d,settings:u,previewUrl:w,duplicated:g}=this.state;return(0,r.createElement)(o.BA,{url:w,renderButton:o=>{let{showPreview:w}=o;const h={headerText:Ue,subHeaderText:Ye,tabbedNavigation:Je,setError:t,isLoading:a,startLoading:i,doneLoading:c,wizardApiFetch:s,prompts:m,segments:d,settings:u,duplicated:g,inFlight:l},k={...h,manageCampaignGroup:this.manageCampaignGroup,updatePopup:this.updatePopup,deletePopup:this.deletePopup,restorePopup:this.restorePopup,duplicatePopup:this.duplicatePopup,previewPopup:e=>this.setState({previewUrl:this.previewUrlForPopup(e)},(()=>w())),publishPopup:this.publishPopup,resetDuplicated:()=>this.setState({duplicated:null}),unpublishPopup:this.unpublishPopup,refetch:this.refetch};return(0,r.createElement)(Be,{hashType:"slash"},(0,r.createElement)(We,null,e,(0,r.createElement)(Ge,{path:"/campaigns/:id?",render:e=>{const a=e.match.params.id;return(0,r.createElement)(oe.Provider,{value:m},(0,r.createElement)(Ee,(0,n.Z)({},k,{archiveCampaignGroup:(e,a)=>s({path:`/newspack/v1/wizard/newspack-popups-wizard/archive-campaign/${e}`,method:a?"POST":"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e))),campaignId:a,createCampaignGroup:a=>s({path:"/newspack/v1/wizard/newspack-popups-wizard/create-campaign/",method:"POST",data:{name:a},quiet:!0}).then((t=>{this.setState({campaigns:t.campaigns,prompts:t.prompts,segments:t.segments,settings:t.settings}),e.history.push(`/campaigns/${t.term_id}`)})).catch((e=>t(e))),deleteCampaignGroup:a=>s({path:`/newspack/v1/wizard/newspack-popups-wizard/delete-campaign/${a}`,method:"DELETE",quiet:!0}).then((t=>{this.setState({campaigns:t.campaigns,prompts:t.prompts,segments:t.segments,settings:t.settings}),e.history.push("/campaigns/")})).catch((e=>t(e))),duplicateCampaignGroup:(a,n)=>s({path:`/newspack/v1/wizard/newspack-popups-wizard/duplicate-campaign/${a}`,method:"POST",data:{name:n},quiet:!0}).then((t=>{this.setState({campaigns:t.campaigns,prompts:t.prompts,segments:t.segments,settings:t.settings}),e.history.push(`/campaigns/${t.term_id}`)})).catch((e=>t(e))),renameCampaignGroup:(e,a)=>s({path:`/newspack/v1/wizard/newspack-popups-wizard/rename-campaign/${e}`,method:"POST",data:{name:a},quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e))),campaigns:p})))}}),(0,r.createElement)(Ge,{path:"/segments/:id?",render:e=>(0,r.createElement)(Re,(0,n.Z)({},e,h,{setSegments:e=>this.setState({segments:e})}))}),(0,r.createElement)(Ge,{path:"/analytics",render:()=>(0,r.createElement)(_e,h)}),(0,r.createElement)(Ge,{path:"/settings",render:()=>(0,r.createElement)(be,h)}),(0,r.createElement)(Le,{to:"/campaigns"})))}})}}(0,r.render)((0,r.createElement)((0,o.uF)(Ke,["newspack-popups"])),document.getElementById("newspack-popups-wizard"))},9196:function(e){"use strict";e.exports=window.React},6292:function(e){"use strict";e.exports=window.moment},6989:function(e){"use strict";e.exports=window.wp.apiFetch},5609:function(e){"use strict";e.exports=window.wp.components},9818:function(e){"use strict";e.exports=window.wp.data},9307:function(e){"use strict";e.exports=window.wp.element},2694:function(e){"use strict";e.exports=window.wp.hooks},2629:function(e){"use strict";e.exports=window.wp.htmlEntities},5736:function(e){"use strict";e.exports=window.wp.i18n},9630:function(e){"use strict";e.exports=window.wp.keycodes},444:function(e){"use strict";e.exports=window.wp.primitives},6483:function(e){"use strict";e.exports=window.wp.url}},a={};function n(e){var s=a[e];if(void 0!==s)return s.exports;var r=a[e]={id:e,loaded:!1,exports:{}};return t[e].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}n.m=t,e=[],n.O=function(t,a,s,r){if(!a){var i=1/0;for(l=0;l<e.length;l++){a=e[l][0],s=e[l][1],r=e[l][2];for(var c=!0,p=0;p<a.length;p++)(!1&r||i>=r)&&Object.keys(n.O).every((function(e){return n.O[e](a[p])}))?a.splice(p--,1):(c=!1,r<i&&(i=r));if(c){e.splice(l--,1);var o=s();void 0!==o&&(t=o)}}return t}r=r||0;for(var l=e.length;l>0&&e[l-1][2]>r;l--)e[l]=e[l-1];e[l]=[a,s,r]},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},n.j=964,function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");a.length&&(e=a[a.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),function(){var e={964:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var s,r,i=a[0],c=a[1],p=a[2],o=0;if(i.some((function(t){return 0!==e[t]}))){for(s in c)n.o(c,s)&&(n.m[s]=c[s]);if(p)var l=p(n)}for(t&&t(a);o<i.length;o++)r=i[o],n.o(e,r)&&e[r]&&e[r][0](),e[i[o]]=0;return n.O(l)},a=self.webpackChunkwebpack=self.webpackChunkwebpack||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var s=n.O(void 0,[351],(function(){return n(9661)}));s=n.O(s);var r=window;for(var i in s)r[i]=s[i];s.__esModule&&Object.defineProperty(r,"__esModule",{value:!0})}();