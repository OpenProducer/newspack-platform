(()=>{var e,t={9693:e=>{e.exports=function(e){for(var t=-1,n=null==e?0:e.length,a=0,r=[];++t<n;){var i=e[t];i&&(r[a++]=i)}return r}},4947:(e,t,n)=>{"use strict";n.r(t);var a=n(7462),r=n(4942),i=(n(5674),n(9307)),s=n(5736),o=n(6483),c=n(6989),l=n.n(c),p=n(129);function u(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}var d=n(1002);function m(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function h(e){m(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===(0,d.Z)(e)&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}function g(e,t){m(2,arguments);var n=h(e),a=u(t);return isNaN(a)?new Date(NaN):a?(n.setDate(n.getDate()+a),n):n}function w(e,t){m(2,arguments);var n=u(t);return g(e,-n)}var f=n(1383),v=n(9674),k=n(9630),b=n(7259),y=n(5609);const E=s.__,_=e=>{let{dismiss:t,hasPrompts:n,hasPublished:a,isArchive:r,onActivate:s,onArchive:o,onDeactivate:c,onDelete:l,onDuplicate:p,onRename:u,onUnarchive:d}=e;return(0,i.createElement)(f.J2,{position:"bottom right",onFocusOutside:()=>t(),onKeyDown:e=>k.ESCAPE===e.keyCode&&t()},(0,i.createElement)(y.MenuItem,{onClick:()=>t(),className:"screen-reader-text"},E("Close Popover","newspack")),n&&(0,i.createElement)(y.MenuItem,{onClick:()=>{t(),s()},className:"newspack-button"},E("Activate all prompts","newspack")),a&&(0,i.createElement)(y.MenuItem,{onClick:()=>{t(),c()},className:"newspack-button"},E("Deactivate all prompts","newspack")),(0,i.createElement)(y.MenuItem,{onClick:()=>{t(),p()},className:"newspack-button"},E("Duplicate","newspack")),(0,i.createElement)(y.MenuItem,{onClick:()=>{t(),u()},className:"newspack-button"},E("Rename","newspack")),!r&&(0,i.createElement)(y.MenuItem,{onClick:()=>{t(),o()},className:"newspack-button"},E("Archive","newspack")),r&&(0,i.createElement)(y.MenuItem,{onClick:()=>{t(),d()},className:"newspack-button"},E("Unarchive","newspack")),(0,i.createElement)(y.MenuItem,{onClick:()=>{t(),l()},className:"newspack-button"},E("Delete","newspack")))};var C=n(444);const S=(0,i.createElement)(C.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,i.createElement)(C.Path,{d:"M18.5 10.5H10v8h8a.5.5 0 00.5-.5v-7.5zm-10 0h-3V18a.5.5 0 00.5.5h2.5v-8zM6 4h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2z"}));var P=n(5332);const x=e=>{const[t,n]=(0,i.useState)(null),[r,s]=(0,i.useState)(!1),[c,l]=(0,i.useState)(Math.floor(9999*Math.random())),p=window?.newspack_popups_wizard_data?.preview_post,u=window?.newspack_popups_wizard_data?.frontend_url||"/",{campaign:d=!1,onLoad:m=(()=>{}),segment:h="",showUnpublished:g=!1,url:w=p||u}=e;(0,i.useEffect)((()=>{r||n(v(w))}),[r]);const v=e=>{const t=h.length?[`segment:${h}`]:["segment:everyone"];return g&&t.push("show_unpublished:true"),d?t.push(`campaign:${d}`):t.push("all"),t.push("session_id:"+c),(0,o.addQueryArgs)(e,{view_as:t.join(";")})};return(0,i.createElement)(f.BA,(0,a.Z)({},e,{onLoad:e=>{e&&([...e.contentWindow.document.querySelectorAll("a")].forEach((e=>{const t=e.getAttribute("href");0===t.indexOf(u)&&e.setAttribute("href",v(t))})),s(!0),m(e))},onClose:()=>{l(Math.floor(9999*Math.random())),s(!1)},url:t}))};var z=n(2629),T=n(9522);const M=s.__,D=e=>{let{deletePopup:t,restorePopup:n,onFocusOutside:a,prompt:r,previewPopup:s,publishPopup:o,setIsDuplicatePromptModalVisible:c,unpublishPopup:l}=e;const{id:p,edit_link:u,status:d}=r,m="publish"===d,h="trash"===d;return(0,i.createElement)(f.J2,{position:"bottom left",onFocusOutside:a,onKeyDown:e=>k.ESCAPE===e.keyCode&&a(),className:"newspack-popover__campaigns__primary-popover"},(0,i.createElement)(y.MenuItem,{onClick:()=>a(),className:"screen-reader-text"},M("Close Popover","newspack")),h?(0,i.createElement)(i.Fragment,null,(0,i.createElement)(y.MenuItem,{onClick:()=>n(p),className:"newspack-button"},M("Restore","newspack")),(0,i.createElement)(y.MenuItem,{onClick:()=>t(p),className:"newspack-button"},M("Delete permanently","newspack"))):(0,i.createElement)(i.Fragment,null,(0,i.createElement)(y.MenuItem,{onClick:()=>{a(),s(r)},className:"newspack-button"},M("Preview","newspack")),(0,i.createElement)(y.MenuItem,{href:(0,z.decodeEntities)(u),className:"newspack-button",isLink:!0},M("Edit","newspack")),(0,i.createElement)(y.MenuItem,{onClick:()=>c(!0),className:"newspack-button"},M("Duplicate","newspack")),(0,i.createElement)(y.MenuItem,{onClick:()=>{a(),(m?l:o)(p)},className:"newspack-button"},M(m?"Deactivate":"Activate","newspack")),(0,i.createElement)(y.MenuItem,{onClick:()=>t(p),className:"newspack-button"},M("Delete","newspack"))),(0,i.createElement)("div",{className:"newspack-popover__campaigns__info"},M("ID:","newspack")," ",p))};var N=n(2694),A=n(8306),O=n.n(A),F=n(9693),U=n.n(F);function W(e){return m(1,arguments),e instanceof Date||"object"===(0,d.Z)(e)&&"[object Date]"===Object.prototype.toString.call(e)}function q(e){if(m(1,arguments),!W(e)&&"number"!=typeof e)return!1;var t=h(e);return!isNaN(Number(t))}function I(e,t){m(2,arguments);var n=h(e).getTime(),a=u(t);return new Date(n+a)}function H(e,t){m(2,arguments);var n=u(t);return I(e,-n)}var j=864e5;function Y(e){m(1,arguments);var t=1,n=h(e),a=n.getUTCDay(),r=(a<t?7:0)+a-t;return n.setUTCDate(n.getUTCDate()-r),n.setUTCHours(0,0,0,0),n}function Z(e){m(1,arguments);var t=h(e),n=t.getUTCFullYear(),a=new Date(0);a.setUTCFullYear(n+1,0,4),a.setUTCHours(0,0,0,0);var r=Y(a),i=new Date(0);i.setUTCFullYear(n,0,4),i.setUTCHours(0,0,0,0);var s=Y(i);return t.getTime()>=r.getTime()?n+1:t.getTime()>=s.getTime()?n:n-1}function R(e){m(1,arguments);var t=Z(e),n=new Date(0);n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0);var a=Y(n);return a}var $=6048e5,B={};function L(){return B}function G(e,t){var n,a,r,i,s,o,c,l;m(1,arguments);var p=L(),d=u(null!==(n=null!==(a=null!==(r=null!==(i=null==t?void 0:t.weekStartsOn)&&void 0!==i?i:null==t||null===(s=t.locale)||void 0===s||null===(o=s.options)||void 0===o?void 0:o.weekStartsOn)&&void 0!==r?r:p.weekStartsOn)&&void 0!==a?a:null===(c=p.locale)||void 0===c||null===(l=c.options)||void 0===l?void 0:l.weekStartsOn)&&void 0!==n?n:0);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var g=h(e),w=g.getUTCDay(),f=(w<d?7:0)+w-d;return g.setUTCDate(g.getUTCDate()-f),g.setUTCHours(0,0,0,0),g}function V(e,t){var n,a,r,i,s,o,c,l;m(1,arguments);var p=h(e),d=p.getUTCFullYear(),g=L(),w=u(null!==(n=null!==(a=null!==(r=null!==(i=null==t?void 0:t.firstWeekContainsDate)&&void 0!==i?i:null==t||null===(s=t.locale)||void 0===s||null===(o=s.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==r?r:g.firstWeekContainsDate)&&void 0!==a?a:null===(c=g.locale)||void 0===c||null===(l=c.options)||void 0===l?void 0:l.firstWeekContainsDate)&&void 0!==n?n:1);if(!(w>=1&&w<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var f=new Date(0);f.setUTCFullYear(d+1,0,w),f.setUTCHours(0,0,0,0);var v=G(f,t),k=new Date(0);k.setUTCFullYear(d,0,w),k.setUTCHours(0,0,0,0);var b=G(k,t);return p.getTime()>=v.getTime()?d+1:p.getTime()>=b.getTime()?d:d-1}function Q(e,t){var n,a,r,i,s,o,c,l;m(1,arguments);var p=L(),d=u(null!==(n=null!==(a=null!==(r=null!==(i=null==t?void 0:t.firstWeekContainsDate)&&void 0!==i?i:null==t||null===(s=t.locale)||void 0===s||null===(o=s.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==r?r:p.firstWeekContainsDate)&&void 0!==a?a:null===(c=p.locale)||void 0===c||null===(l=c.options)||void 0===l?void 0:l.firstWeekContainsDate)&&void 0!==n?n:1),h=V(e,t),g=new Date(0);g.setUTCFullYear(h,0,d),g.setUTCHours(0,0,0,0);var w=G(g,t);return w}var X=6048e5;function J(e,t){for(var n=e<0?"-":"",a=Math.abs(e).toString();a.length<t;)a="0"+a;return n+a}const K=function(e,t){var n=e.getUTCFullYear(),a=n>0?n:1-n;return J("yy"===t?a%100:a,t.length)},ee=function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):J(n+1,2)},te=function(e,t){return J(e.getUTCDate(),t.length)},ne=function(e,t){return J(e.getUTCHours()%12||12,t.length)},ae=function(e,t){return J(e.getUTCHours(),t.length)},re=function(e,t){return J(e.getUTCMinutes(),t.length)},ie=function(e,t){return J(e.getUTCSeconds(),t.length)},se=function(e,t){var n=t.length,a=e.getUTCMilliseconds();return J(Math.floor(a*Math.pow(10,n-3)),t.length)};function oe(e,t){var n=e>0?"-":"+",a=Math.abs(e),r=Math.floor(a/60),i=a%60;if(0===i)return n+String(r);var s=t||"";return n+String(r)+s+J(i,2)}function ce(e,t){return e%60==0?(e>0?"-":"+")+J(Math.abs(e)/60,2):le(e,t)}function le(e,t){var n=t||"",a=e>0?"-":"+",r=Math.abs(e);return a+J(Math.floor(r/60),2)+n+J(r%60,2)}const pe={G:function(e,t,n){var a=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(a,{width:"abbreviated"});case"GGGGG":return n.era(a,{width:"narrow"});default:return n.era(a,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var a=e.getUTCFullYear(),r=a>0?a:1-a;return n.ordinalNumber(r,{unit:"year"})}return K(e,t)},Y:function(e,t,n,a){var r=V(e,a),i=r>0?r:1-r;return"YY"===t?J(i%100,2):"Yo"===t?n.ordinalNumber(i,{unit:"year"}):J(i,t.length)},R:function(e,t){return J(Z(e),t.length)},u:function(e,t){return J(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return J(a,2);case"Qo":return n.ordinalNumber(a,{unit:"quarter"});case"QQQ":return n.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(a,{width:"narrow",context:"formatting"});default:return n.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,n){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return J(a,2);case"qo":return n.ordinalNumber(a,{unit:"quarter"});case"qqq":return n.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(a,{width:"narrow",context:"standalone"});default:return n.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,n){var a=e.getUTCMonth();switch(t){case"M":case"MM":return ee(e,t);case"Mo":return n.ordinalNumber(a+1,{unit:"month"});case"MMM":return n.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(a,{width:"narrow",context:"formatting"});default:return n.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,n){var a=e.getUTCMonth();switch(t){case"L":return String(a+1);case"LL":return J(a+1,2);case"Lo":return n.ordinalNumber(a+1,{unit:"month"});case"LLL":return n.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(a,{width:"narrow",context:"standalone"});default:return n.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,n,a){var r=function(e,t){m(1,arguments);var n=h(e),a=G(n,t).getTime()-Q(n,t).getTime();return Math.round(a/X)+1}(e,a);return"wo"===t?n.ordinalNumber(r,{unit:"week"}):J(r,t.length)},I:function(e,t,n){var a=function(e){m(1,arguments);var t=h(e),n=Y(t).getTime()-R(t).getTime();return Math.round(n/$)+1}(e);return"Io"===t?n.ordinalNumber(a,{unit:"week"}):J(a,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):te(e,t)},D:function(e,t,n){var a=function(e){m(1,arguments);var t=h(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var a=t.getTime(),r=n-a;return Math.floor(r/j)+1}(e);return"Do"===t?n.ordinalNumber(a,{unit:"dayOfYear"}):J(a,t.length)},E:function(e,t,n){var a=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(a,{width:"short",context:"formatting"});default:return n.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,n,a){var r=e.getUTCDay(),i=(r-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(i);case"ee":return J(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},c:function(e,t,n,a){var r=e.getUTCDay(),i=(r-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(i);case"cc":return J(i,t.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(r,{width:"narrow",context:"standalone"});case"cccccc":return n.day(r,{width:"short",context:"standalone"});default:return n.day(r,{width:"wide",context:"standalone"})}},i:function(e,t,n){var a=e.getUTCDay(),r=0===a?7:a;switch(t){case"i":return String(r);case"ii":return J(r,t.length);case"io":return n.ordinalNumber(r,{unit:"day"});case"iii":return n.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(a,{width:"short",context:"formatting"});default:return n.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,n){var a=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(a,{width:"narrow",context:"formatting"});default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,t,n){var a,r=e.getUTCHours();switch(a=12===r?"noon":0===r?"midnight":r/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(a,{width:"narrow",context:"formatting"});default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,n){var a,r=e.getUTCHours();switch(a=r>=17?"evening":r>=12?"afternoon":r>=4?"morning":"night",t){case"B":case"BB":case"BBB":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(a,{width:"narrow",context:"formatting"});default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var a=e.getUTCHours()%12;return 0===a&&(a=12),n.ordinalNumber(a,{unit:"hour"})}return ne(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):ae(e,t)},K:function(e,t,n){var a=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(a,{unit:"hour"}):J(a,t.length)},k:function(e,t,n){var a=e.getUTCHours();return 0===a&&(a=24),"ko"===t?n.ordinalNumber(a,{unit:"hour"}):J(a,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):re(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):ie(e,t)},S:function(e,t){return se(e,t)},X:function(e,t,n,a){var r=(a._originalDate||e).getTimezoneOffset();if(0===r)return"Z";switch(t){case"X":return ce(r);case"XXXX":case"XX":return le(r);default:return le(r,":")}},x:function(e,t,n,a){var r=(a._originalDate||e).getTimezoneOffset();switch(t){case"x":return ce(r);case"xxxx":case"xx":return le(r);default:return le(r,":")}},O:function(e,t,n,a){var r=(a._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+oe(r,":");default:return"GMT"+le(r,":")}},z:function(e,t,n,a){var r=(a._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+oe(r,":");default:return"GMT"+le(r,":")}},t:function(e,t,n,a){var r=a._originalDate||e;return J(Math.floor(r.getTime()/1e3),t.length)},T:function(e,t,n,a){return J((a._originalDate||e).getTime(),t.length)}};var ue=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},de=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},me={p:de,P:function(e,t){var n,a=e.match(/(P+)(p+)?/)||[],r=a[1],i=a[2];if(!i)return ue(e,t);switch(r){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",ue(r,t)).replace("{{time}}",de(i,t))}};const he=me;function ge(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}var we=["D","DD"],fe=["YY","YYYY"];function ve(e){return-1!==we.indexOf(e)}function ke(e){return-1!==fe.indexOf(e)}function be(e,t,n){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("YY"===e)throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("D"===e)throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("DD"===e)throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var ye={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function Ee(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width?String(t.width):e.defaultWidth,a=e.formats[n]||e.formats[e.defaultWidth];return a}}var _e,Ce={date:Ee({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Ee({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Ee({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},Se={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function Pe(e){return function(t,n){var a;if("formatting"===(null!=n&&n.context?String(n.context):"standalone")&&e.formattingValues){var r=e.defaultFormattingWidth||e.defaultWidth,i=null!=n&&n.width?String(n.width):r;a=e.formattingValues[i]||e.formattingValues[r]}else{var s=e.defaultWidth,o=null!=n&&n.width?String(n.width):e.defaultWidth;a=e.values[o]||e.values[s]}return a[e.argumentCallback?e.argumentCallback(t):t]}}function xe(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.width,r=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],i=t.match(r);if(!i)return null;var s,o=i[0],c=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(c)?Te(c,(function(e){return e.test(o)})):ze(c,(function(e){return e.test(o)}));s=e.valueCallback?e.valueCallback(l):l,s=n.valueCallback?n.valueCallback(s):s;var p=t.slice(o.length);return{value:s,rest:p}}}function ze(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}function Te(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}const Me={code:"en-US",formatDistance:function(e,t,n){var a,r=ye[e];return a="string"==typeof r?r:1===t?r.one:r.other.replace("{{count}}",t.toString()),null!=n&&n.addSuffix?n.comparison&&n.comparison>0?"in "+a:a+" ago":a},formatLong:Ce,formatRelative:function(e,t,n,a){return Se[e]},localize:{ordinalNumber:function(e,t){var n=Number(e),a=n%100;if(a>20||a<10)switch(a%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:Pe({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:Pe({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:Pe({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:Pe({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:Pe({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(_e={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.match(_e.matchPattern);if(!n)return null;var a=n[0],r=e.match(_e.parsePattern);if(!r)return null;var i=_e.valueCallback?_e.valueCallback(r[0]):r[0];i=t.valueCallback?t.valueCallback(i):i;var s=e.slice(a.length);return{value:i,rest:s}}),era:xe({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:xe({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:xe({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:xe({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:xe({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};var De=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Ne=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ae=/^'([^]*?)'?$/,Oe=/''/g,Fe=/[a-zA-Z]/;function Ue(e,t,n){var a,r,i,s,o,c,l,p,d,g,w,f,v,k,b,y,E,_;m(2,arguments);var C=String(t),S=L(),P=null!==(a=null!==(r=null==n?void 0:n.locale)&&void 0!==r?r:S.locale)&&void 0!==a?a:Me,x=u(null!==(i=null!==(s=null!==(o=null!==(c=null==n?void 0:n.firstWeekContainsDate)&&void 0!==c?c:null==n||null===(l=n.locale)||void 0===l||null===(p=l.options)||void 0===p?void 0:p.firstWeekContainsDate)&&void 0!==o?o:S.firstWeekContainsDate)&&void 0!==s?s:null===(d=S.locale)||void 0===d||null===(g=d.options)||void 0===g?void 0:g.firstWeekContainsDate)&&void 0!==i?i:1);if(!(x>=1&&x<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var z=u(null!==(w=null!==(f=null!==(v=null!==(k=null==n?void 0:n.weekStartsOn)&&void 0!==k?k:null==n||null===(b=n.locale)||void 0===b||null===(y=b.options)||void 0===y?void 0:y.weekStartsOn)&&void 0!==v?v:S.weekStartsOn)&&void 0!==f?f:null===(E=S.locale)||void 0===E||null===(_=E.options)||void 0===_?void 0:_.weekStartsOn)&&void 0!==w?w:0);if(!(z>=0&&z<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!P.localize)throw new RangeError("locale must contain localize property");if(!P.formatLong)throw new RangeError("locale must contain formatLong property");var T=h(e);if(!q(T))throw new RangeError("Invalid time value");var M=ge(T),D=H(T,M),N={firstWeekContainsDate:x,weekStartsOn:z,locale:P,_originalDate:T},A=C.match(Ne).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,he[t])(e,P.formatLong):e})).join("").match(De).map((function(a){if("''"===a)return"'";var r=a[0];if("'"===r)return We(a);var i=pe[r];if(i)return null!=n&&n.useAdditionalWeekYearTokens||!ke(a)||be(a,t,String(e)),null!=n&&n.useAdditionalDayOfYearTokens||!ve(a)||be(a,t,String(e)),i(D,a,P.localize,N);if(r.match(Fe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+r+"`");return a})).join("");return A}function We(e){var t=e.match(Ae);return t?t[1].replace(Oe,"'"):e}const qe=s.__,Ie=window.newspack_popups_wizard_data?.criteria||[],He=e=>-1<(window.newspack_popups_wizard_data?.overlay_placements||[]).indexOf(e.options.placement),je=e=>"above_header"===e.options.placement,Ye=e=>{const t=window.newspack_popups_wizard_data?.custom_placements||{};return-1<Object.keys(t).indexOf(e.options.placement)},Ze={top:qe("Top Overlay","newspack"),top_left:qe("Top Left Overlay","newspack"),top_right:qe("Top Right Overlay","newspack"),center:qe("Center Overlay","newspack"),center_left:qe("Center Left Overlay","newspack"),center_right:qe("Center Right Overlay","newspack"),bottom:qe("Bottom Overlay","newspack"),bottom_left:qe("Bottom Left Overlay","newspack"),bottom_right:qe("Bottom Right Overlay","newspack"),inline:qe("Inline","newspack"),archives:qe("In archive pages","newspack"),above_header:qe("Above Header","newspack"),manual:qe("Manual Only","newspack")},Re=e=>{let{options:{frequency:t,placement:n}}=e;const a=window.newspack_popups_wizard_data?.custom_placements||{};return"manual"===t||a.hasOwnProperty(n)?qe("Custom Placement","newspack"):Ze[n]},$e=e=>{const t=window.newspack_popups_wizard_data?.custom_placements,n=window.newspack_popups_wizard_data?.overlay_placements,a=Object.keys(Ze).filter((t=>He(e)?-1<n.indexOf(t):-1===n.indexOf(t))).map((e=>({label:Ze[e],value:e})));return!He(e)&&t?a.concat(Object.keys(t).map((e=>({label:t[e],value:e})))):a},Be={once:qe("Once a month","newspack"),weekly:qe("Once a week","newspack"),daily:qe("Once a day","newspack"),always:qe("Every pageview","newspack"),custom:qe("Custom frequency (edit prompt to manage)","newspack")},Le=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"publish"!==e||t?"newspack-card__is-disabled":"newspack-card__is-supported"},Ge=e=>{const{categories:t,tags:n,campaign_groups:a,status:r}=e,i=[];if(a.length>0){const e=a.map((e=>{let{name:t}=e;return t})).join(", ");i.push((1===a.length?qe("Campaign: ","newspack"):qe("Campaigns: ","newspack"))+e)}return t.length>0&&i.push(qe("Categories: ","newspack")+t.map((e=>e.name)).join(", ")),n.length>0&&i.push(qe("Tags: ","newspack")+n.map((e=>e.name)).join(", ")),"pending"===r&&i.push(qe("Pending review","newspack")),"future"===r&&i.push(qe("Scheduled","newspack")),i.push(qe("Frequency: ","newspack")+Ke(e)),i.length?i.join(" | "):null},Ve=e=>{const t=[];if(e.configuration.is_disabled&&t.push(qe("Segment disabled","newspack")),e.criteria)for(const n of Ie){const a=e.criteria.find((e=>{let{criteria_id:t}=e;return t===n.id}));if(a?.value){let e=a.value;if(n.options){const t=n.options.find((e=>{let{value:t}=e;return t===a.value}));t&&(e=t.label)}if(Array.isArray(e))e=e.join(", ");else if("object"==typeof e){const t=[];for(const n in e)e[n]&&t.push(`${n}: ${e[n]}`);e=t.join(", ")}const r=(0,N.applyFilters)("newspack.wizards.campaigns.segmentDescription.criteriaMessage",(0,s.sprintf)("%1$s: %2$s",n.name,e),e,n,a);t.push(r)}}return()=>(0,i.createElement)(i.Fragment,null,t.map(((e,n)=>(0,i.createElement)(i.Fragment,{key:n},e," ",t.length!==n+1?" | ":null))))},Qe=O()((async e=>{const t=await Promise.all(e.map((async e=>{try{return(await l()({path:(0,o.addQueryArgs)("/wp/v2/categories/"+e,{_fields:"name"})})).name}catch(e){return console.warn(e),""}})));return U()(t)})),Xe=e=>{let{ids:t}=e;const[n,a]=(0,i.useState)([]);return(0,i.useEffect)((()=>{Qe(t).then(a)}),[t]),(0,i.createElement)("span",null,qe("Favorite Categories:","newspack")," ",n.length?n.join(", "):"")};(0,N.addFilter)("newspack.wizards.campaigns.segmentDescription.criteriaMessage","newspack.favoriteCategories",((e,t,n,a)=>"favorite_categories"===n.id?(0,i.createElement)(Xe,{ids:a.value}):e));const Je=(e,t)=>{const n=[];if("publish"===t.status&&(je(t)||He(t)||Ye(t))){const n=t.categories,a=e.filter((e=>{const a=e.categories,r=0===n.length&&0===a.length||n.some((e=>a.some((t=>e.term_id===t.term_id))));return"publish"===e.status&&e.id!==t.id&&(i=e,t.options.placement===i.options.placement)&&((e,t)=>{const n=e.map((e=>e.term_id)),a=t.map((e=>e.term_id));return!n.length&&!a.length||n.some((e=>-1<a.indexOf(e)))})(t.segments,e.segments)&&r;var i})),r=(0,N.applyFilters)("newspack.wizards.campaigns.conflictingPrompts",a,t,e);return 0<r.length?(0,i.createElement)(i.Fragment,null,(0,i.createElement)("strong",null,(0,s.sprintf)(qe("%s detected:","newspack"),1<r.length?qe("Conflicts","newspack"):qe("Conflict","newspack"))),(0,i.createElement)("ul",null,r.map((e=>(0,i.createElement)("li",{key:e.id},(0,i.createElement)("p",{"data-testid":`conflict-warning-${t.id}`},(0,i.createElement)("strong",null,(0,s.sprintf)("%s: ",e.title)),(0,i.createElement)("span",null,((e,t)=>He(e)||je(e)?(0,s.sprintf)(qe("If multiple%1$s %2$s share the same segment%3$s, only the most recent one will be displayed."),0===t.length?qe(" uncategorized","newspack"):"",je(e)?qe("above-header prompts","newspack"):qe("overlays","newspack"),0<t.length?qe(" and category filtering","newspack"):""):Ye(e)?(0,s.sprintf)(qe("If multiple%1$s prompts in the same custom placement share the same segment%2$s, only the most recent one will be displayed."),0===t.length?qe(" uncategorized","newspack"):"",0<t.length?qe(" and category filtering","newspack"):""):"")(t,n)))))))):null}return n.length?n.join(" "):null},Ke=e=>{let{options:{frequency:t}}=e;return Be[t]},et=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return Ue(e,"yyyy-MM-dd")},tt=s.__,{SettingsCard:nt}=f.Zr,at=e=>{let{prompt:t,disabled:n,onClose:a,updatePopup:r}=e;const[o,c]=f.PT.useObjectState(t),{excluded_categories:l=[],excluded_tags:p=[]}=o.options||{},[u,d]=(0,i.useState)(0<l.length||0<p.length||!1);return(0,i.createElement)(f.u_,{title:t.title,onRequestClose:a,isWide:!0},(0,i.createElement)(f.zx,{onClick:()=>a(),className:"screen-reader-text"},tt("Close Modal","newspack")),(0,i.createElement)(f.rj,{gutter:64,columns:1},(0,i.createElement)(nt,{title:tt("Campaigns","newspack"),description:tt("Assign a prompt to one or more campaigns for easier management","newspack"),columns:1,className:"newspack-settings__campaigns",noBorder:!0},(0,i.createElement)(f.HZ,{disabled:n,value:o.campaign_groups||[],onChange:e=>c({campaign_groups:e}),label:tt("Campaigns","newspack"),taxonomy:"newspack_popups_taxonomy",hideLabelFromVision:!0})),(0,i.createElement)(nt,{title:tt("Settings","newspack"),description:tt("When and how should the prompt be displayed","newspack"),columns:He(t)?3:2,className:"newspack-settings__settings",rowGap:16,noBorder:!0},(0,i.createElement)(f.Yw,{label:tt("Frequency","newspack"),disabled:n,onChange:e=>{c({options:{frequency:e}})},options:Object.keys(Be).map((e=>({label:Be[e],value:e}))),value:o.options.frequency}),(0,i.createElement)(f.Yw,{label:He(t)?tt("Position"):tt("Placement"),disabled:n,onChange:e=>{c({options:{placement:e}})},options:$e(t),value:o.options.placement}),He(t)&&(0,i.createElement)(f.Yw,{label:tt("Size"),disabled:n,onChange:e=>{c({options:{overlay_size:e}})},options:window.newspack_popups_wizard_data?.overlay_sizes,value:o.options.overlay_size})),(0,i.createElement)(nt,{title:tt("Targeting","newspack"),description:()=>(0,i.createElement)(i.Fragment,null,tt("Under which conditions should the prompt be displayed","newspack"),(0,i.createElement)("br",null),tt("If multiple conditions are set, all will have to be satisfied in order to display the prompt","newspack")),className:"newspack-settings__targeting",columns:1,rowGap:16,noBorder:!0},(0,i.createElement)(f.rj,{columns:3,rowGap:16},(0,i.createElement)(f.HZ,{disabled:n,value:o.segments||[],onChange:e=>c({segments:e}),label:tt("Segments","newspack"),taxonomy:"popup_segment"}),(0,i.createElement)(f.HZ,{label:tt("Post categories","newspack "),disabled:n,hideHelpFromVision:!0,value:o.categories||[],onChange:e=>c({categories:e}),description:tt("Prompt will only appear on posts with the specified categories.","newspack")}),(0,i.createElement)(f.HZ,{label:tt("Post tags","newspack "),disabled:n,hideHelpFromVision:!0,taxonomy:"tags",value:o.tags||[],onChange:e=>c({tags:e}),description:tt("Prompt will only appear on posts with the specified tags.","newspack")})),(0,i.createElement)("div",null,(0,i.createElement)(f.zx,{isLink:!0,onClick:()=>d(!u)},(0,s.sprintf)(tt("%s Advanced Settings","newspack_popups_taxonomy"),tt(u?"Hide":"Show","newspack")))),u&&(0,i.createElement)(f.rj,{columns:3,rowGap:16},(0,i.createElement)(f.HZ,{label:tt("Category Exclusions","newspack "),disabled:n,hideHelpFromVision:!0,value:l||[],onChange:e=>c({options:{excluded_categories:e.map((e=>e.id))}}),description:tt("Prompt will not appear on posts with the specified categories.","newspack")}),(0,i.createElement)(f.HZ,{label:tt("Tag Exclusions","newspack "),disabled:n,hideHelpFromVision:!0,taxonomy:"tags",value:p||[],onChange:e=>c({options:{excluded_tags:e.map((e=>e.id))}}),description:tt("Prompt will not appear on posts with the specified tags.","newspack")})))),(0,i.createElement)(f.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,i.createElement)(f.zx,{onClick:a,variant:"secondary"},tt("Cancel","newspack")),(0,i.createElement)(f.zx,{onClick:()=>{r(o).then(a)},variant:"primary"},tt("Save","newspack"))))},rt=s.__,it=e=>{let{value:t,description:n}=e;return(0,i.createElement)("div",{className:"newspack-popups-wizard__analytics-data--value"},(0,i.createElement)("strong",null,t,"%"),(0,i.createElement)("small",null,n))},st=e=>{let{error:t,id:n,analyticsData:a}=e;if(t)return(0,i.createElement)(f.RZ,{className:"newspack-popups-wizard__analytics-data--icon",text:rt("Could not fetch Analytics data","newspack")});if(!a)return(0,i.createElement)("div",{className:"newspack-popups-wizard__analytics-data--icon"},(0,i.createElement)(f.Pi,null));const{seen:r,load:s,form_submission:o}=a[n]||{};if(!r||!s)return(0,i.createElement)(f.RZ,{className:"newspack-popups-wizard__analytics-data--icon",text:rt("No Analytics data","newspack")});const c=Math.min(100,Math.round(r/s*100)),l=()=>(0,i.createElement)(it,{value:c,description:rt("viewability","newspack")});if(o){const e=Math.min(100,Math.round(o/r*100));return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(it,{value:e,description:rt("conversion rate","newspack")}),l())}return l()},ot=e=>{const[t,n]=(0,i.useState)(!1),[r,o]=(0,i.useState)(!1),[c,p]=(0,i.useState)(!1),[u,d]=(0,i.useState)(null),{className:m,description:h,duplicated:g,duplicatePopup:w,inFlight:v,resetDuplicated:k,prompt:y={},segments:E,warning:_,promptsAnalyticsData:C}=e,{campaign_groups:S,id:P,edit_link:x,title:M}=y;(0,i.useEffect)((()=>{c&&!u&&N()}),[c]);const N=async()=>{const e=parseInt(y?.duplicate_of||y.id);try{const t=await l()({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/${y.id}/duplicate`});d(t)}catch(e){d(M+rt(" copy","newspack-popups"))}};return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(f.fM,{isSmall:!0,badge:Re(y),className:m,title:M.length?(0,z.decodeEntities)(M):rt("(no title)","newspack"),titleLink:(0,z.decodeEntities)(x),key:P,description:h,notification:_,notificationLevel:"error",actionText:(0,i.createElement)(i.Fragment,null,(0,i.createElement)(st,{error:C?.error,analyticsData:C,id:y.id}),(0,i.createElement)("div",{className:"newspack-popups-wizard__buttons"},(0,i.createElement)(f.zx,{className:t&&"popover-active",onClick:()=>n(!t),icon:T.Z,label:rt("Prompt settings","newspack"),tooltipPosition:"bottom center"}),(0,i.createElement)(f.zx,{className:r&&"popover-active",onClick:()=>o(!r),icon:b.Z,label:rt("More options","newspack"),tooltipPosition:"bottom center"}),r&&(0,i.createElement)(D,(0,a.Z)({onFocusOutside:()=>o(!1),prompt:y,setIsDuplicatePromptModalVisible:p},e))))}),t&&(0,i.createElement)(at,{prompt:y,disabled:v,onClose:()=>n(!1),segments:E,updatePopup:e.updatePopup}),c&&(0,i.createElement)(f.u_,{className:"newspack-popups__duplicate-modal",title:(0,s.sprintf)(rt("Duplicate “%s”","newspack"),M),onRequestClose:()=>{p(!1),d(null),k()}},g?(0,i.createElement)(i.Fragment,null,(0,i.createElement)(f.qX,{isSuccess:!0,noticeText:(0,s.sprintf)(rt("Duplicate of “%s” created as a draft.","newspack"),M)}),!S&&(0,i.createElement)(f.qX,{isWarning:!0,noticeText:rt("This prompt is currently not assigned to any campaign.","newspack")}),(0,i.createElement)(f.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,i.createElement)(f.zx,{isSecondary:!0,onClick:()=>{p(!1),d(null),k()}},rt("Close","newspack")),(0,i.createElement)(f.zx,{isPrimary:!0,href:`/wp-admin/post.php?post=${g}&action=edit`},rt("Edit","newspack")))):(0,i.createElement)(i.Fragment,null,!S&&(0,i.createElement)(f.qX,{isWarning:!0,noticeText:rt("This prompt will not be assigned to any campaign.","newspack")}),(0,i.createElement)(f.w4,{disabled:v||null===u,label:rt("Title","newspack"),value:u,onChange:e=>d(e)}),(0,i.createElement)(f.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,i.createElement)(f.zx,{disabled:v,isSecondary:!0,onClick:()=>{p(!1),d(null),k()}},rt("Cancel","newspack")),(0,i.createElement)(f.zx,{disabled:v||null===u,isPrimary:!0,onClick:()=>{const e=u.trim()||N();w(P,e)}},rt("Duplicate","newspack"))))))},ct=(0,i.createElement)(y.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,i.createElement)(y.Path,{d:"M4 9h16v2H4V9zm0 4h10v2H4v-2z"})),lt=(0,i.createElement)(y.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,i.createElement)(y.Path,{d:"M17 14H7v3h10v-3z"}),(0,i.createElement)(y.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})),pt=(0,i.createElement)(y.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,i.createElement)(y.Path,{d:"M16 10H8v4h8v-4z"}),(0,i.createElement)(y.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})),ut=(0,i.createElement)(y.SVG,{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",width:"24"},(0,i.createElement)(y.Path,{d:"M17 7H7v3h10V7z"}),(0,i.createElement)(y.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM6 5.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5z"})),dt=(0,i.createElement)(y.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,i.createElement)(y.Path,{d:"M18 4H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm.5 14c0 .3-.2.5-.5.5H6c-.3 0-.5-.2-.5-.5V6c0-.3.2-.5.5-.5h12c.3 0 .5.2.5.5v12zM7 11h2V9H7v2zm0 4h2v-2H7v2zm3-4h7V9h-7v2zm0 4h7v-2h-7v2z"})),mt=(0,i.createElement)(y.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,i.createElement)(y.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v3.5h-15V5c0-.3.2-.5.5-.5zm8 5.5h6.5v3.5H13V10zm-1.5 3.5h-7V10h7v3.5zm-7 5.5v-4h7v4.5H5c-.3 0-.5-.2-.5-.5zm14.5.5h-6V15h6.5v4c0 .3-.2.5-.5.5z"})),ht=s.__,gt=(e,t,n)=>{const a=[];return e&&a.push(`placement=${e}`),+t>0&&a.push(`group=${t}`),n&&a.push(`segment=${n}`),"/wp-admin/post-new.php?post_type=newspack_popups_cpt&"+a.join("&")},wt=e=>{const{campaignData:t,campaignId:n,segment:r}=e,[s,o]=(0,i.useState)(!1),{label:c,id:l,prompts:p}=r,u="unassigned"!==n?parseInt(n):-1;let d;d="unassigned"===n?ht("No unassigned prompts in this segment.","newspack"):t?ht("No prompts in this segment for","newspack")+" "+t.name+".":ht("No active prompts in this segment.","newspack");const m=Ve(r);return(0,i.createElement)(f.Zb,{isSmall:!0,className:"newspack-campaigns__segment-group__card"},(0,i.createElement)("div",{className:"newspack-campaigns__segment-group__card__segment"},(0,i.createElement)("div",{className:"newspack-campaigns__segment-group__card__segment-title"},(0,i.createElement)("h3",null,l?(0,i.createElement)(f.zx,{href:`#/segments/${l}`,label:ht("Edit Segment ","newspack"),isLink:!0,showTooltip:!0,tooltipPosition:"bottom center"},ht("Segment: ","newspack"),c):c),(0,i.createElement)("span",{className:"newspack-campaigns__segment-group__description"},l?m():ht("All readers, regardless of segment","newspack"))),(0,i.createElement)("div",{className:"newspack-campaigns__segment-group__card__segment-actions"},(0,i.createElement)(x,{campaign:!!n&&u,segment:l,showUnpublished:!!n,renderButton:e=>{let{showPreview:t}=e;return(0,i.createElement)(f.zx,{isSmall:!0,variant:"tertiary",onClick:()=>t()},ht("Preview Segment","newspack"))}}),"unassigned"!==n&&(0,i.createElement)(i.Fragment,null,(0,i.createElement)(f.zx,{isSmall:!0,variant:"secondary",onClick:()=>o(!s)},ht("Add New Prompt","newspack")),s&&(0,i.createElement)(f.u_,{title:ht("Add New Prompt","newspack"),onRequestClose:()=>o(!1),shouldCloseOnEsc:!1,shouldCloseOnClickOutside:!1,isWide:!0},(0,i.createElement)(f.rj,{gutter:32,columns:3},(0,i.createElement)(f.Wu,{href:gt("overlay-center",n,l),title:ht("Center Overlay","newspack"),desc:ht("Fixed at the center of the screen","newspack"),icon:pt}),(0,i.createElement)(f.Wu,{href:gt("overlay-top",n,l),title:ht("Top Overlay","newspack"),desc:ht("Fixed at the top of the screen","newspack"),icon:ut}),(0,i.createElement)(f.Wu,{href:gt("overlay-bottom",n,l),title:ht("Bottom Overlay","newspack"),desc:ht("Fixed at the bottom of the screen","newspack"),icon:lt}),(0,i.createElement)(f.Wu,{href:gt(null,n,l),title:ht("Inline","newspack"),desc:ht("Embedded in content","newspack"),icon:ct}),(0,i.createElement)(f.Wu,{href:gt("archives",n,l),title:ht("In Archive Pages","newspack"),desc:ht("Embedded once or many times in archive pages","newspack"),icon:dt}),(0,i.createElement)(f.Wu,{href:gt("above-header",n,l),title:ht("Above Header","newspack"),desc:ht("Embedded at the very top of the page","newspack"),icon:S}),(0,i.createElement)(f.Wu,{href:gt("custom",n,l),title:ht("Custom Placement","newspack"),desc:ht("Only appears when placed in content","newspack"),icon:P.Z}),(0,i.createElement)(f.Wu,{href:gt("manual",n,l),title:ht("Manual Only","newspack"),desc:ht("Only appears where Single Prompt block is inserted","newspack"),icon:mt})))))),(0,i.createElement)(f.Zb,{noBorder:!0,className:"newspack-campaigns__segment-group__action-cards"},p.map((t=>(0,i.createElement)(ot,(0,a.Z)({className:Le(t.status,r.configuration.is_disabled),description:Ge(t),warning:Je(p,t),key:t.id,prompt:t},e))))),p.length<1?(0,i.createElement)("p",null,d):"")},ft=(0,i.createContext)({prompts:[]});var vt=n(4184),kt=n.n(vt),bt=n(3311),yt=n.n(bt);const Et=s.__,{useHistory:_t}=f.F0,Ct="active",St=e=>Et(2===e?"Rename Campaign":1===e?"Duplicate Campaign":"Add New Campaign","newspack"),Pt=(e,t)=>{if("trash"===t)return e.filter((e=>{let{status:t}=e;return"trash"===t}));const n=e.filter((e=>{let{status:t}=e;return"trash"!==t}));return Ct===t?n.filter((e=>{let{status:t}=e;return"publish"===t})):"all"===t?n.filter((e=>{let{status:t}=e;return"trash"!==t})):"unassigned"===t?n.filter((e=>{let{campaign_groups:t}=e;return!t||!t.length})):n.filter((e=>{let{campaign_groups:n}=e;return n&&n.find((e=>+e.term_id==+t))}))},xt=(0,f.a4)((e=>{const{campaignId:t=Ct,campaigns:n=[],manageCampaignGroup:r,segments:s,createCampaignGroup:o,duplicateCampaignGroup:c,deleteCampaignGroup:l,archiveCampaignGroup:p,renameCampaignGroup:u}=e,d=(0,i.useRef)(null),[m,h]=(0,i.useState)(),[g,w]=(0,i.useState)(),[v,y]=(0,i.useState)(),[E,C]=(0,i.useState)(),S=(0,i.useContext)(ft),P=Pt(S,t),x=Pt(S,"unassigned").length;(0,i.useEffect)((()=>{g&&d.current.querySelector("input").focus()}),[g]);const z=_t(),T=e=>{3===v?o(e):2===v?u(t,e):1===v&&c(t,e),w(!1)},M=n.filter((e=>{let{status:t}=e;return"archive"!==t})),D=n.filter((e=>{let{status:t}=e;return"archive"===t})),N=((e,t)=>t.reduce(((t,n)=>+e>0&&+e==+n.term_id?n:t),null))(t,n),A=[{key:Ct,name:Et("Active Prompts","newspack")},{key:"all",name:Et("All Prompts","newspack")},{key:"trash",name:Et("Trash","newspack")},...x?[{key:"unassigned",name:Et("Unassigned Prompts","newspack")}]:[],...M.length?[{key:"header-campaigns",name:Et("Campaigns","newspack"),className:"is-header"}]:[],...M.map((e=>{let{term_id:t,name:n}=e;return{key:String(t),name:n,className:"newspack-campaigns__campaign-group__select-control-group-item"}})),...D.length?[{key:"header-archived-campaigns",name:Et("Archived Campaigns","newspack"),className:"is-header"}]:[],...D.map((e=>{let{term_id:t,name:n}=e;return{key:String(t),name:n+" "+Et("(archived)","newspack"),className:"newspack-campaigns__campaign-group__select-control-group-item"}}))];return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(f.Zb,{headerActions:!0,noBorder:!0},(0,i.createElement)("div",{className:"newspack-campaigns__campaign-group__filter-group-actions"},(0,i.createElement)(f.Yq,{label:Et("Campaigns","newspack"),options:A.map((e=>({...e,className:kt()(e.className,{"is-selected":e.key===t})}))),onChange:e=>{let{selectedItem:{key:t}}=e;return Ct===t?z.push("/campaigns"):z.push(`/campaigns/${t}`)},value:yt()(A,["key",t||Ct]),hideLabelFromVision:!0}),N&&(0,i.createElement)("div",{className:"newspack-campaigns__campaign-group__filter-group-actions__button"},(0,i.createElement)(f.zx,{className:m&&"popover-active",onClick:()=>h(!m),icon:b.Z,label:Et("Actions","newspack"),tooltipPosition:"bottom center"}),m&&(0,i.createElement)(_,{dismiss:()=>h(!1),isArchive:N&&"archive"===N.status,onActivate:()=>r(P),onArchive:()=>p(t,!0),onDeactivate:()=>r(P,"DELETE"),onDelete:()=>l(t),onDuplicate:()=>{w(!0),C(""),y(1)},onRename:()=>{C(N.name),w(!0),y(2)},onUnarchive:()=>p(t,!1),hasPrompts:P.length>0,hasPublished:P.some((e=>{let{status:t}=e;return"publish"===t}))}))),(0,i.createElement)("div",{className:"newspack-campaigns__campaign-group__add-new-button"},(0,i.createElement)(f.zx,{isPrimary:!0,onClick:()=>{w(!g),C(""),y(3)}},Et("Add New Campaign","newspack")),g&&(0,i.createElement)(f.u_,{title:St(v),onRequestClose:()=>{w(!1)}},(0,i.createElement)("div",{ref:d},(0,i.createElement)(f.w4,{placeholder:Et("Campaign Name","newspack"),onChange:C,label:Et("Campaign Name","newspack"),hideLabelFromVision:!0,value:E,onKeyDown:e=>{k.ENTER===e.keyCode&&""!==E&&(e.preventDefault(),T(E))}})),(0,i.createElement)(f.Zb,{buttonsCard:!0,noBorder:!0,className:"justify-end"},(0,i.createElement)(f.zx,{variant:"secondary",onClick:()=>{w(!1)}},Et("Cancel","newspack")),(0,i.createElement)(f.zx,{variant:"primary",disabled:!E,onClick:()=>T(E)},(e=>Et(2===e?"Rename":1===e?"Duplicate":"Add","newspack"))(v)))))),((e,t)=>{const n=[];return n.push(...e.map((e=>{let{name:n,id:a,configuration:r,criteria:i}=e;return{label:n,id:a,configuration:r,criteria:i,prompts:t.filter((e=>{let{segments:t}=e;return!!t&&!!t.find((e=>e.term_id===parseInt(a)))}))}}))),n.push({label:Et("Everyone","newspack"),id:"",prompts:t.filter((e=>{let{segments:t}=e;return 0===t.length})),configuration:{}}),n})(s,P).map(((n,r)=>Ct===t&&n.configuration.is_disabled?null:(0,i.createElement)(wt,(0,a.Z)({key:r,segment:n,campaignId:t,campaignData:N},e)))))})),zt=s.__,Tt=(0,f.a4)((()=>(0,i.createElement)("div",{className:"newspack-campaigns-wizard-analytics__wrapper"},(0,i.createElement)(f.Zb,{isNarrow:!0},(0,i.createElement)("h2",null,zt("Coming soon","newspack")),(0,i.createElement)("p",null,[(0,i.createElement)(i.Fragment,null,zt("We’re currently redesigning this dashboard to accommodate GA4 and give you deeper insights into Campaign performance. In the meantime, you can find Campaign event data within your GA account. Review this ","newspack")),(0,i.createElement)(i.Fragment,null,(0,i.createElement)("a",{target:"_blank",rel:"noopener noreferrer",href:"https://help.newspack.com/analytics/"},zt("help page","newspack"))),(0,i.createElement)(i.Fragment,null,zt(" to see how Campaign data is being recorded in GA.","newspack"))]),(0,i.createElement)(f.Zb,{buttonsCard:!0,noBorder:!0},(0,i.createElement)(f.zx,{target:"_blank",rel:"noopener noreferrer",href:"https://help.newspack.com/analytics/",isPrimary:!0},zt("View the help page","newspack"))))))),Mt=(0,f.a4)((()=>(0,i.createElement)(f.d5,{pluginSlug:"newspack-popups-wizard",isWizard:!0,title:null})));var Dt=n(1984);const Nt=(0,i.createElement)(C.SVG,{width:"18",height:"18",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18"},(0,i.createElement)(C.Path,{d:"M5 4h2V2H5v2zm6-2v2h2V2h-2zm-6 8h2V8H5v2zm6 0h2V8h-2v2zm-6 6h2v-2H5v2zm6 0h2v-2h-2v2z"}));var At=n(6015),Ot=n(3904);const Ft=s.__,{NavLink:Ut,useHistory:Wt}=f.F0,qt=()=>(0,i.createElement)(Ut,{to:"segments/new"},(0,i.createElement)(f.zx,{variant:"primary"},Ft("Add New Segment","newspack"))),It=e=>{let{inFlight:t,segment:n,segments:a,deleteSegment:r,dropTargetIndex:s,setDropTargetIndex:o,index:c,sortSegments:l,totalSegments:p,wrapperRef:u,toggleSegmentStatus:d}=e;const[m,h]=(0,i.useState)(!1),[g,w]=(0,i.useState)(!1),v=()=>h(!1),E=Wt(),_=0===c,C=c+1===p,S=c===s,P=C&&s>=p,x=e=>{if(t)return;const r=[...a],i=e>c?e-1:e;r.splice(c,1),r.splice(i,0,n),r.forEach(((e,t)=>e.priority=t)),JSON.stringify(r)!==JSON.stringify(a)&&l(r)},z=()=>{if(t)return;let e=c-1;0>e&&(e=0),x(e)},T=()=>{if(t)return;let e=c+2;p<e&&(e=p),x(e)};return(0,i.createElement)("div",{className:"newspack-campaigns__draggable"+(g?" is-dragging":"")+(S?" is-drop-target":"")+(P?" drop-target-after":""),id:`segment-${n.id}`},(0,i.createElement)(y.Draggable,{elementId:`segment-${n.id}`,transferData:{},onDragStart:()=>{g||t||w(!0)},onDragEnd:()=>{t||(null!==s&&x(s),o(null),w(!1))},onDragOver:e=>{if(t)return;const n=u.current.getBoundingClientRect(),a=e.pageY<=n.top+window.scrollY,r=e.pageY>=n.bottom+window.scrollY;if(a||r||e.target.classList.contains("newspack-action-card")){let t=Array.prototype.slice.call(u.current.querySelectorAll(".newspack-campaigns__draggable")).indexOf(e.target.parentElement);(0>t||t===c+1)&&(t=c),a&&(t=0),r&&(t=p),o(t)}}},(e=>{let{onDraggableStart:t,onDraggableEnd:a}=e;return(0,i.createElement)(f.fM,{isSmall:!0,title:n.name,titleLink:`#/segments/${n.id}`,description:Ve(n),toggleChecked:!n.configuration.is_disabled,toggleOnChange:()=>d(n),actionText:(0,i.createElement)(i.Fragment,null,(0,i.createElement)(f.zx,{onClick:()=>h(!m),label:Ft("More options","newspack"),icon:b.Z,className:m&&"popover-active"}),m&&(0,i.createElement)(f.J2,{position:"bottom left",onKeyDown:e=>k.ESCAPE===e.keyCode&&v,onFocusOutside:v},(0,i.createElement)(y.MenuItem,{onClick:()=>v(),className:"screen-reader-text"},Ft("Close Popover","newspack")),(0,i.createElement)(y.MenuItem,{onClick:()=>E.push(`/segments/${n.id}`),className:"newspack-button"},Ft("Edit","newspack")),(0,i.createElement)(y.MenuItem,{onClick:()=>r(n),className:"newspack-button"},Ft("Delete","newspack"))))},(0,i.createElement)("div",{className:"newspack-campaigns__segment-priority-controls"},(0,i.createElement)("div",{className:"drag-handle",draggable:!0,onDragStart:t,onDragEnd:a},(0,i.createElement)(Dt.Z,{icon:Nt,height:18,width:18})),(0,i.createElement)("div",{className:"movers"},(0,i.createElement)(f.zx,{icon:At.Z,onClick:z,disabled:_,label:Ft("Move segment position up","newspack")}),(0,i.createElement)(f.zx,{icon:Ot.Z,onClick:T,disabled:C,label:Ft("Move segment position down","newspack")}))))})))},Ht=e=>{let{wizardApiFetch:t,segments:n,setSegments:a,isLoading:r}=e;const[s,o]=(0,i.useState)(null),[c,l]=(0,i.useState)(null),[p,u]=(0,i.useState)(!1),[d,m]=(0,i.useState)(null),h=(0,i.useRef)(),g=e=>{u(!0),m(null),t({path:`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${e.id}`,method:"POST",quiet:!0,data:{name:e.name,configuration:{...e.configuration,is_disabled:!e.configuration.is_disabled},criteria:e.criteria}}).then((e=>{console.log(e),u(!1),a(e)})).catch((e=>{console.error(e),u(!1)}))},w=e=>{u(!0),m(null),t({path:`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${e.id}`,method:"DELETE",quiet:!0}).then((e=>{u(!1),a(e)})).catch((e=>{console.error(e),u(!1)}))},v=e=>{m(null),l(e),u(!0),t({path:"/newspack/v1/wizard/newspack-popups-wizard/segmentation-sort",method:"POST",data:{segmentIds:e.map((e=>e.id))},quiet:!0}).then((e=>{u(!1),l(null),a(e)})).catch((e=>{u(!1),m(e.message||Ft("There was an error sorting segments. Please try again.")),a(n)}))};if(null===n)return null;const k=c||n;return n.length?(0,i.createElement)(i.Fragment,null,d&&(0,i.createElement)(f.qX,{noticeText:d,isError:!0}),(0,i.createElement)(f.Zb,{headerActions:!0,noBorder:!0},(0,i.createElement)("h2",null,Ft("Audience segments","newspack")),(0,i.createElement)(qt,null)),(0,i.createElement)("div",{className:"newspack-campaigns-wizard-segments__list"+(p?" is-loading":""),ref:h},k.map(((e,t)=>(0,i.createElement)(It,{deleteSegment:w,key:e.id,inFlight:p||r>0,segment:e,segments:n,sortSegments:v,index:t,wrapperRef:h,dropTargetIndex:s,setDropTargetIndex:o,totalSegments:n.length,toggleSegmentStatus:g}))))):(0,i.createElement)(i.Fragment,null,(0,i.createElement)(f.Zb,{headerActions:!0,noBorder:!0},(0,i.createElement)("h2",null,Ft("You have no saved audience segments.","newspack")),(0,i.createElement)(qt,null)),(0,i.createElement)("p",null,Ft("Create audience segments to target visitors by engagement, activity, and more.","newspack")))},jt=s.__,{useHistory:Yt}=f.F0,{SettingsCard:Zt,SettingsSection:Rt,MinMaxSetting:$t}=f.Zr,Bt={is_disabled:!1};(0,N.addFilter)("newspack.criteria.input","newspack.favoriteCategories",(function(e,t,n,a){return"favorite_categories"===t.id?(0,i.createElement)(f.HZ,{value:n||[],onChange:e=>{a(e.map((e=>e.id)))},label:t.name,hideLabelFromVision:!0}):e}));const Lt=e=>{let{segmentId:t,setSegments:n,wizardApiFetch:a}=e;const r=window.newspack_popups_wizard_data?.criteria||[],[s,o]=f.PT.useObjectState(Bt),[c,l]=(0,i.useState)(""),[p,u]=(0,i.useState)([]),[d,m]=(0,i.useState)([]),[h,g]=(0,i.useState)(""),w=Yt(),[v,k]=(0,i.useState)("[]"),b=d!==JSON.stringify(p)||h!==c||JSON.stringify(v.is_disabled)!==JSON.stringify(s.is_disabled),E=f.PT.usePrompt(b,jt("There are unsaved changes to this segment. Discard changes?","newspack")),_="new"===t;(0,i.useEffect)((()=>{_||a({path:"/newspack/v1/wizard/newspack-popups-wizard/segmentation"}).then((e=>{const n=yt()(e,(e=>{let{id:n}=e;return n===t}));if(n){const e={...Bt,...n.configuration};o(e),k(e),l(n.name),g(n.name),u([...n.criteria]),m(JSON.stringify(n.criteria))}}))}),[_]);const C=e=>{const t=(e=>{const t=p.find((t=>t.criteria_id===e));return t?t.value:""})(e.id),n=(a=e.id,e=>{const t=[...p],n=t.find((e=>e.criteria_id===a));n?e?Array.isArray(e)||"object"!=typeof e?n.value=e:n.value={...n.value,...e}:t.splice(t.indexOf(n),1):e&&t.push({criteria_id:a,value:e}),u(t)});var a;return(0,N.applyFilters)("newspack.criteria.input","range"===e.matching_function?(0,i.createElement)($t,{"data-testid":`newspack-criteria-${e.id}`,min:t?.min,max:t?.max,onChangeMin:e=>n({min:e}),onChangeMax:e=>n({max:e})}):e.options?.length?(0,i.createElement)(f.Yw,{"data-testid":`newspack-criteria-${e.id}`,isWide:!0,onChange:n,value:t,options:e.options}):(0,i.createElement)(f.w4,{"data-testid":`newspack-criteria-${e.id}`,isWide:!0,placeholder:e.placeholder,help:e.help,value:t,onChange:n}),e,t,n)};return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(f.w4,{placeholder:jt("Untitled Segment","newspack"),value:c,onChange:l,label:jt("Title","newspack"),className:"newspack-campaigns-wizard-segments__title"}),(0,i.createElement)(Zt,{title:jt("Segment Status","newspack"),description:jt("If not enabled, the segment will be ignored for reader segmentation.","newspack"),noBorder:!0},(0,i.createElement)(y.ToggleControl,{label:jt("Segment enabled","newspack"),checked:!s.is_disabled,onChange:()=>o({is_disabled:!s.is_disabled})})),(0,i.createElement)(Zt,{title:jt("Reader Engagement","newspack"),description:jt("Target readers based on their browsing behavior","newspack"),noBorder:!0},r.filter((e=>"reader_engagement"===e.category)).map((e=>(0,i.createElement)(Rt,{key:e.id,title:e.name,description:e.description},C(e))))),(0,i.createElement)(Zt,{title:jt("Reader Activity","newspack"),description:jt("Target readers based on their actions","newspack"),columns:3,noBorder:!0},r.filter((e=>"reader_activity"===e.category)).map((e=>(0,i.createElement)(Rt,{key:e.id,title:e.name,description:e.description},C(e))))),(0,i.createElement)(Zt,{title:jt("Referrer Sources","newspack"),description:jt("Target readers based on where they’re coming from","newspack"),notification:jt("Segments using these options will apply only to the first page visited after coming from an external source.","newspack"),columns:2,noBorder:!0},r.filter((e=>"referrer_sources"===e.category)).map((e=>(0,i.createElement)(Rt,{key:e.id,title:e.name,description:e.description},C(e))))),(0,i.createElement)("div",{className:"newspack-buttons-card"},(0,i.createElement)(f.zx,{disabled:!(()=>{const e={...s},t={...Bt};return delete e.is_disabled,delete t.is_disabled,c.length>0&&p.length})()||!_&&!b,isPrimary:!0,onClick:()=>{E(),a({path:_?"/newspack/v1/wizard/newspack-popups-wizard/segmentation":`/newspack/v1/wizard/newspack-popups-wizard/segmentation/${t}`,method:"POST",data:{name:c,criteria:p,configuration:s}}).then(n).then(w.push("/segments"))}},jt("Save","newspack")),(0,i.createElement)(f.zx,{isSecondary:!0,href:"#/segments"},jt("Cancel","newspack"))))},Gt=(0,f.a4)((e=>{let{wizardApiFetch:t,match:n,...r}=e;const s=n.params.id;return s?(0,i.createElement)(Lt,(0,a.Z)({segmentId:s,wizardApiFetch:t},r)):(0,i.createElement)(Ht,(0,a.Z)({wizardApiFetch:t},r))})),Vt=s.__,{HashRouter:Qt,Redirect:Xt,Route:Jt,Switch:Kt}=v.Z,en=Vt("Campaigns","newspack"),tn=Vt("Reach your readers with configurable campaigns","newspack"),nn=[{label:Vt("Campaigns","newpack"),path:"/campaigns",exact:!0},{label:Vt("Segments","newpack"),path:"/segments",exact:!0},{label:Vt("Analytics","newpack"),path:"/analytics",exact:!0},{label:Vt("Settings","newpack"),path:"/settings",exact:!0}];class an extends i.Component{constructor(e){var t;super(e),t=this,(0,r.Z)(this,"onWizardReady",(()=>{this.refetch({isInitial:!0})})),(0,r.Z)(this,"refetch",(function(){let{isInitial:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{setError:n,wizardApiFetch:a}=t.props;a({path:"/newspack/v1/wizard/newspack-popups-wizard/"}).then((n=>{if(t.updateAfterAPI(n),e){const e={start_date:et(w(new Date,30)),end_date:et(),with_report_by_id:!0};l()({path:`/newspack/v1/popups-analytics/report/?${(0,p.stringify)(e)}`}).then((e=>{let{report_by_id:n}=e;t.setState({promptsAnalyticsData:n})})).catch((e=>{t.setState({promptsAnalyticsData:{error:e}})}))}})).catch((e=>n(e)))})),(0,r.Z)(this,"updatePopup",(e=>{let{id:t,...n}=e;const{setError:a,wizardApiFetch:r}=this.props;return this.setState({inFlight:!0}),r({path:`/newspack/v1/wizard/newspack-popups-wizard/${t}`,method:"POST",data:{config:n},quiet:!0}).then(this.updateAfterAPI).catch((e=>a(e)))})),(0,r.Z)(this,"deletePopup",(e=>{const{setError:t,wizardApiFetch:n}=this.props;return n({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}`,method:"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,r.Z)(this,"restorePopup",(e=>{const{setError:t,wizardApiFetch:n}=this.props;return n({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/restore`,method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,r.Z)(this,"publishPopup",(e=>{const{setError:t,wizardApiFetch:n}=this.props;return n({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/publish`,method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,r.Z)(this,"unpublishPopup",(e=>{const{setError:t,wizardApiFetch:n}=this.props;return n({path:`/newspack/v1/wizard/newspack-popups-wizard/${e}/publish`,method:"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e)))})),(0,r.Z)(this,"duplicatePopup",((e,t)=>{const{setError:n,wizardApiFetch:a}=this.props;return this.setState({inFlight:!0}),a({path:(0,o.addQueryArgs)(`/newspack/v1/wizard/newspack-popups-wizard/${e}/duplicate`,{title:t}),method:"POST",quiet:!0}).then(this.updateAfterAPI).catch((()=>{n({code:"duplicate_prompt_error",message:Vt("Error duplicating prompt. Please try again later.","newspack")})}))})),(0,r.Z)(this,"previewUrlForPopup",(e=>{let{options:t,id:n}=e;const{placement:a,trigger_type:r}=t,i=window.newspack_popups_wizard_data?.preview_query_keys||{},s={};Object.keys(t).forEach((e=>{i.hasOwnProperty(e)&&(s[i[e]]=t[e])}));let o="/";return"archives"===a&&window.newspack_popups_wizard_data?.preview_archive?o=window.newspack_popups_wizard_data.preview_archive:("inline"===a||"scroll"===r)&&window&&window.newspack_popups_wizard_data?.preview_post&&(o=window.newspack_popups_wizard_data?.preview_post),`${o}?${(0,p.stringify)({...s,pid:n})}`})),(0,r.Z)(this,"updateAfterAPI",(e=>{let{campaigns:t,prompts:n,segments:a,settings:r,duplicated:i=null}=e;return this.setState({campaigns:t,prompts:n,segments:a,settings:r,duplicated:i,inFlight:!1})})),(0,r.Z)(this,"manageCampaignGroup",(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POST";const{setError:a,wizardApiFetch:r}=t.props;return r({path:"/newspack/v1/wizard/newspack-popups-wizard/batch-publish/",data:{ids:e.map((e=>e.id))},method:n,quiet:!0}).then(t.updateAfterAPI).catch((e=>a(e)))})),this.state={campaigns:[],prompts:[],promptsAnalyticsData:null,segments:[],settings:[],previewUrl:null,duplicated:null,inFlight:!1}}render(){const{pluginRequirements:e,setError:t,isLoading:n,wizardApiFetch:r,startLoading:s,doneLoading:o}=this.props,{campaigns:c,inFlight:l,prompts:p,segments:u,settings:d,previewUrl:m,duplicated:h,promptsAnalyticsData:g}=this.state;return(0,i.createElement)(f.BA,{url:m,renderButton:m=>{let{showPreview:w}=m;const f={headerText:en,subHeaderText:tn,tabbedNavigation:nn,setError:t,isLoading:n,startLoading:s,doneLoading:o,wizardApiFetch:r,prompts:p,segments:u,settings:d,duplicated:h,inFlight:l},v={...f,manageCampaignGroup:this.manageCampaignGroup,updatePopup:this.updatePopup,deletePopup:this.deletePopup,restorePopup:this.restorePopup,duplicatePopup:this.duplicatePopup,previewPopup:e=>this.setState({previewUrl:this.previewUrlForPopup(e)},(()=>w())),publishPopup:this.publishPopup,resetDuplicated:()=>this.setState({duplicated:null}),unpublishPopup:this.unpublishPopup,refetch:this.refetch};return(0,i.createElement)(Qt,{hashType:"slash"},(0,i.createElement)(Kt,null,e,(0,i.createElement)(Jt,{path:"/campaigns/:id?",render:e=>{const n=e.match.params.id;return(0,i.createElement)(ft.Provider,{value:p},(0,i.createElement)(xt,(0,a.Z)({},v,{archiveCampaignGroup:(e,n)=>r({path:`/newspack/v1/wizard/newspack-popups-wizard/archive-campaign/${e}`,method:n?"POST":"DELETE",quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e))),campaignId:n,createCampaignGroup:n=>r({path:"/newspack/v1/wizard/newspack-popups-wizard/create-campaign/",method:"POST",data:{name:n},quiet:!0}).then((t=>{this.setState({campaigns:t.campaigns,prompts:t.prompts,segments:t.segments,settings:t.settings}),e.history.push(`/campaigns/${t.term_id}`)})).catch((e=>t(e))),deleteCampaignGroup:n=>r({path:`/newspack/v1/wizard/newspack-popups-wizard/delete-campaign/${n}`,method:"DELETE",quiet:!0}).then((t=>{this.setState({campaigns:t.campaigns,prompts:t.prompts,segments:t.segments,settings:t.settings}),e.history.push("/campaigns/")})).catch((e=>t(e))),duplicateCampaignGroup:(n,a)=>r({path:`/newspack/v1/wizard/newspack-popups-wizard/duplicate-campaign/${n}`,method:"POST",data:{name:a},quiet:!0}).then((t=>{this.setState({campaigns:t.campaigns,prompts:t.prompts,segments:t.segments,settings:t.settings}),e.history.push(`/campaigns/${t.term_id}`)})).catch((e=>t(e))),renameCampaignGroup:(e,n)=>r({path:`/newspack/v1/wizard/newspack-popups-wizard/rename-campaign/${e}`,method:"POST",data:{name:n},quiet:!0}).then(this.updateAfterAPI).catch((e=>t(e))),campaigns:c,promptsAnalyticsData:g})))}}),(0,i.createElement)(Jt,{path:"/segments/:id?",render:e=>(0,i.createElement)(Gt,(0,a.Z)({},e,f,{setSegments:e=>this.setState({segments:e})}))}),(0,i.createElement)(Jt,{path:"/analytics",render:()=>(0,i.createElement)(Tt,f)}),(0,i.createElement)(Jt,{path:"/settings",render:()=>(0,i.createElement)(Mt,f)}),(0,i.createElement)(Xt,{to:"/campaigns"})))}})}}(0,i.render)((0,i.createElement)((0,f.uF)(an,["newspack-popups"])),document.getElementById("newspack-popups-wizard"))},9196:e=>{"use strict";e.exports=window.React},6292:e=>{"use strict";e.exports=window.moment},6989:e=>{"use strict";e.exports=window.wp.apiFetch},5609:e=>{"use strict";e.exports=window.wp.components},9818:e=>{"use strict";e.exports=window.wp.data},9307:e=>{"use strict";e.exports=window.wp.element},2694:e=>{"use strict";e.exports=window.wp.hooks},2629:e=>{"use strict";e.exports=window.wp.htmlEntities},5736:e=>{"use strict";e.exports=window.wp.i18n},9630:e=>{"use strict";e.exports=window.wp.keycodes},444:e=>{"use strict";e.exports=window.wp.primitives},6483:e=>{"use strict";e.exports=window.wp.url}},n={};function a(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.loaded=!0,i.exports}a.m=t,e=[],a.O=(t,n,r,i)=>{if(!n){var s=1/0;for(p=0;p<e.length;p++){n=e[p][0],r=e[p][1],i=e[p][2];for(var o=!0,c=0;c<n.length;c++)(!1&i||s>=i)&&Object.keys(a.O).every((e=>a.O[e](n[c])))?n.splice(c--,1):(o=!1,i<s&&(s=i));if(o){e.splice(p--,1);var l=r();void 0!==l&&(t=l)}}return t}i=i||0;for(var p=e.length;p>0&&e[p-1][2]>i;p--)e[p]=e[p-1];e[p]=[n,r,i]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.j=964,(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={964:0};a.O.j=t=>0===e[t];var t=(t,n)=>{var r,i,s=n[0],o=n[1],c=n[2],l=0;if(s.some((t=>0!==e[t]))){for(r in o)a.o(o,r)&&(a.m[r]=o[r]);if(c)var p=c(a)}for(t&&t(n);l<s.length;l++)i=s[l],a.o(e,i)&&e[i]&&e[i][0](),e[s[l]]=0;return a.O(p)},n=self.webpackChunkwebpack=self.webpackChunkwebpack||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=a.O(void 0,[351],(()=>a(4947)));r=a.O(r);var i=window;for(var s in r)i[s]=r[s];r.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})})();