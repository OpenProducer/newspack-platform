(()=>{var e={8084:()=>{window.newspackRAS=window.newspackRAS||[],window.newspackRAS.push((e=>{e.on("activity",(t=>{let{detail:{action:n,data:r,timestamp:a}}=t;if("article_view"!==n)return;const i=new Date(a);i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0);const o=6-i.getDay();i.setDate(i.getDate()+o);const s=i.getTime(),c=e.store.get("article_view_per_week")||{};c[s]||(c[s]={}),c[s][r.post_id]=!0,e.store.set("article_view_per_week",c),i.setMonth(i.getMonth()+1),i.setDate(1);const d=i.getTime(),u=e.store.get("article_view_per_month")||{};u[d]||(u[d]={}),u[d][r.post_id]=!0,e.store.set("article_view_per_month",u)}))}))}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";n.r(r),n.d(r,{authenticateOTP:()=>R,default:()=>q,dispatchActivity:()=>g,getActivities:()=>m,getAuthStrategy:()=>x,getCaptchaToken:()=>T,getOTPHash:()=>O,getReader:()=>S,getUniqueActivitiesBy:()=>y,hasAuthLink:()=>E,refreshAuthentication:()=>A,setAuthStrategy:()=>b,setAuthenticated:()=>k,setReaderEmail:()=>v,store:()=>_});const e={reader:"reader",data:"data",activity:"activity"},t=Object.values(e);function a(e){return t.includes(e)?`newspack-ras-${e}`:""}function i(e,t){if(!(e=a(e)))throw new Error("Invalid event");window.dispatchEvent(new CustomEvent(e,{detail:t}))}window.newspack_reader_data=window.newspack_reader_data||{};const o={storePrefix:newspack_reader_data?.store_prefix||"np_reader_",storage:window.localStorage,collections:{maxItems:1e3,maxAge:2592e6}},s=[];function c(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)throw new Error("Key is required.");const n=[o.storePrefix];return t&&n.push("_"),n.push(e),n.join("")}function d(e){const t=l("unsynced",!0)||[];t.includes(e)||(t.push(e),f("unsynced",t,!0))}function u(e){return JSON.stringify(e)}function w(e){return e&&"string"==typeof e?JSON.parse(e):e}function l(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)throw new Error("Key is required.");return w(o.storage.getItem(c(e,t)))}function f(t,n){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)throw new Error("Key is required.");if(null==n)throw new Error("Value cannot be undefined or null.");if("_"===t[0])throw new Error("Key cannot start with an underscore.");o.storage.setItem(c(t,r),u(n)),r||i(e.data,{key:t,value:n})}function p(e){if(!e)return"";const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length?decodeURIComponent(t.pop().split(";").shift()):void 0}function h(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:365;const r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3),document.cookie=`${e}=${t}; expires=${r.toUTCString()}; path=/`}setInterval((()=>{if(!s.length)return;const e=s.shift();(function(e){if(!e)return Promise.reject("Key is required.");if(!newspack_reader_data.api_url||!newspack_reader_data.nonce)return Promise.reject("API not available.");const t=l(e),n={key:e};t&&(n.value=JSON.stringify(t));const r=new XMLHttpRequest;return r.open(n.value?"POST":"DELETE",newspack_reader_data.api_url,!0),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("X-WP-Nonce",newspack_reader_data.nonce),r.send(JSON.stringify(n)),new Promise(((e,t)=>{r.onreadystatechange=()=>{if(4===r.readyState)return 200!==r.status?t(r):e(r)}}))})(e).then((()=>function(e){const t=l("unsynced",!0)||[];t.includes(e)&&(t.splice(t.indexOf(e),1),f("unsynced",t,!0))}(e))).catch((()=>d(e)))}),1e3),n(8084),window.newspack_ras_config=window.newspack_ras_config||{};const _=function(){const t=l("unsynced",!0)||[];for(const e of t)s.push(e);if(newspack_reader_data?.items){const e=Object.keys(newspack_reader_data.items);for(const n of e)t.includes(n)||f(n,JSON.parse(newspack_reader_data.items[n]))}return{get:e=>{if(!e)throw new Error("Key is required.");return l(e)},set:function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];f(e,t,!1),n&&(d(e),s.push(e))},delete:t=>{if(!t)throw new Error("Key is required.");o.storage.removeItem(c(t)),i(e.data,{key:t,value:void 0}),d(t),s.push(t)},add:(e,t)=>{if(!e)throw new Error("Key cannot be empty.");if(!t)throw new Error("Value cannot be empty.");let n=l(e)||[];if(!Array.isArray(n))throw new Error(`Store key '${e}' is not an array.`);if(o.collections.maxAge){const e=Date.now();n=n.filter((t=>!t.timestamp||e-t.timestamp<o.collections.maxAge))}n.push(t),n=n.slice(-o.collections.maxItems),f(e,n)}}}();function g(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const a={action:t,data:n,timestamp:r||Date.now()};return _.add("activity",a),i(e.activity,a),a}function m(e){const t=_.get("activity")||[];return e?t.filter((t=>t.action===e)):t}function y(e,t){const n=m(e),r=[],a={};for(const e of n){const n="function"==typeof t?t(e):e.data[t];a[n]||(r.push(e),a[n]=!0)}return r}function v(t){if(!t)return;const n=S();n.email=t,_.set("reader",n,!1),i(e.reader,n)}function k(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const n=_.get("reader")||{};if(!n.email)throw new Error("Reader email not set");n.authenticated=Boolean(t),_.set("reader",n,!1),i(e.reader,n)}function A(){const e=p("np_auth_reader");e?(v(e),k(!0)):v(p("np_auth_intention"))}function S(){return _.get("reader")||{}}function E(){const e=S(),t=p("np_auth_link");return!(!e?.email||!t)}const P=["pwd","link"];function O(){return p("np_otp_hash")}function R(e){return new Promise(((t,n)=>{const r=O(),a=S()?.email;return r?a?e?void fetch("",{method:"POST",headers:{Accept:"application/json"},body:new URLSearchParams({action:newspack_ras_config.otp_auth_action,email:a,hash:r,code:e})}).then((e=>e.json())).then((e=>{let{success:r,message:i,data:o}=e;const s={...o,email:a,authenticated:!!r,message:i};k(!!r),r?t(s):n(s)})):n({message:"Invalid code"}):n({message:"You must provide an email"}):n({message:"Code has expired",expired:!0})}))}function b(e){if(!P.includes(e))throw new Error("Invalid authentication strategy");return h("np_auth_strategy",e),e}function x(){return O()?"otp":p("np_auth_strategy")}function T(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"submit";return new Promise(((t,n)=>{const{grecaptcha:r}=window;if(!r||!newspack_ras_config)return t("");const{captcha_site_key:a}=newspack_ras_config;if(!a)return t("");r?.ready||n("Error loading the reCaptcha library."),r.ready((()=>{r.execute(a,{action:e}).then((e=>t(e))).catch((e=>n(e)))}))}))}!function(){const t=newspack_ras_config,n=t?.authenticated_email||p("np_auth_intention"),r=!!t?.authenticated_email,a=S(),o={email:n||a?.email,authenticated:r};a?.email===o?.email&&a?.authenticated===o?.authenticated||_.set("reader",o,!1),i(e.reader,o),function(){const e=newspack_ras_config.cid_cookie;p(e)||h(e,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9;return Math.random().toString(36).substr(2,e)}(12))}(),(newspack_reader_data?.reader_activity||[]).forEach((e=>{let{action:t,data:n}=e;return g(t,n)})),function(){const e=document.referrer?new URL(document.referrer).hostname:"";e&&e!==window.location.hostname&&_.set("referrer",e.replace("www.","").trim().toLowerCase())}()}();const I={store:_,on:function(e,t){if(!(e=a(e)))throw new Error("Invalid event");window.addEventListener(e,t)},off:function(e,t){if(!(e=a(e)))throw new Error("Invalid event");window.removeEventListener(e,t)},dispatchActivity:g,getActivities:m,getUniqueActivitiesBy:y,setReaderEmail:v,setAuthenticated:k,refreshAuthentication:A,getReader:S,hasAuthLink:E,getOTPHash:O,authenticateOTP:R,setAuthStrategy:b,getAuthStrategy:x,getCaptchaToken:T};function j(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((e=>{Array.isArray(e)&&"string"==typeof e[0]?g(...e):"function"==typeof e?e(I):console.warn("Invalid newspackRAS.push argument",e)}))}window.newspackReaderActivation=I,window.newspackRAS=window.newspackRAS||[],window.newspackRAS.forEach((e=>j(e))),window.newspackRAS.push=j;const q=I})();var a=window;for(var i in r)a[i]=r[i];r.__esModule&&Object.defineProperty(a,"__esModule",{value:!0})})();