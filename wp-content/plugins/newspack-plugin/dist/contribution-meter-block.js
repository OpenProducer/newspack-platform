(()=>{"use strict";var e,t={790:e=>{e.exports=window.ReactJSXRuntime},1455:e=>{e.exports=window.wp.apiFetch},4715:e=>{e.exports=window.wp.blockEditor},5573:e=>{e.exports=window.wp.primitives},6087:e=>{e.exports=window.wp.element},6427:e=>{e.exports=window.wp.components},7723:e=>{e.exports=window.wp.i18n},9021:(e,t,n)=>{var a=n(7723);const r=window.wp.blocks,s=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"newspack/contribution-meter","title":"Contribution Meter","category":"newspack","description":"Display progress toward your goal. Works seamlessly with the Donate block.","keywords":["donations","fundraising","revenue","progress","goal","campaign"],"textdomain":"newspack-plugin","supports":{"html":false,"align":["wide","full"],"className":true},"attributes":{"goalAmount":{"type":"number","default":1000},"startDate":{"type":"string","default":""},"endDate":{"type":"string","default":""},"progressBarColor":{"type":"string","default":""},"showGoal":{"type":"boolean","default":true},"showAmountRaised":{"type":"boolean","default":true},"showPercentage":{"type":"boolean","default":true},"thickness":{"type":"string","default":"s","enum":["xs","s","m","l"]},"previewMode":{"type":"boolean","default":false}},"example":{"attributes":{"previewMode":true,"goalAmount":2500}},"style":"file:../../../dist/contribution-meter-block.css"}');var o=n(4715),i=n(6427),l=n(6087),c=n(790),p=n(5573),u=(0,c.jsx)(p.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,c.jsx)(p.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12.218 5.377a.25.25 0 0 0-.436 0l-7.29 12.96a.25.25 0 0 0 .218.373h14.58a.25.25 0 0 0 .218-.372l-7.29-12.96Zm-1.743-.735c.669-1.19 2.381-1.19 3.05 0l7.29 12.96a1.75 1.75 0 0 1-1.525 2.608H4.71a1.75 1.75 0 0 1-1.525-2.608l7.29-12.96ZM12.75 17.46h-1.5v-1.5h1.5v1.5Zm-1.5-3h1.5v-5h-1.5v5Z"})}),d=n(1455),g=n.n(d);const _=window.wp.date,w=({attributes:e,setAttributes:t})=>{const{goalAmount:n,startDate:r,endDate:s,progressBarColor:l,thickness:p,showGoal:u,showAmountRaised:d,showPercentage:g}=e,w=r?new Date(r+"T00:00:00"):void 0,m=s?new Date(s+"T00:00:00"):void 0,h=window.newspack_contribution_meter_data?.maxEndDate,b=h?new Date(h+"T00:00:00"):void 0,k=window.newspack_contribution_meter_data?.currencySymbol||"$";return(0,c.jsxs)(o.InspectorControls,{children:[(0,c.jsx)(o.PanelColorSettings,{title:(0,a.__)("Color","newspack-plugin"),colorSettings:[{value:l,onChange:e=>t({progressBarColor:e}),label:(0,a.__)("Progress bar","newspack-plugin")}]}),(0,c.jsxs)(i.PanelBody,{title:(0,a.__)("Contribution data","newspack-plugin"),children:[(0,c.jsx)(i.BaseControl,{id:"contribution-meter-goal-amount",label:(0,a.__)("Goal amount","newspack-plugin")+` (${k})`,help:(0,a.__)("Set the total contribution goal.","newspack-plugin"),children:(0,c.jsx)("input",{id:"contribution-meter-goal-amount",type:"number",value:n,onChange:e=>t({goalAmount:parseInt(e.target.value,10)||0}),min:"0",step:"1",className:"components-text-control__input",style:{minHeight:"40px"}})}),(0,c.jsx)(i.BaseControl,{id:"contribution-meter-start-date",label:(0,a.__)("Start date","newspack-plugin"),help:(0,a.__)("Contributions from this date are included in the total amount raised.","newspack-plugin"),children:(0,c.jsx)(i.DatePicker,{currentDate:w,isInvalidDate:e=>{const t=window.newspack_contribution_meter_data?.minStartDate;return!!t&&e<new Date(t)},onChange:e=>{t({startDate:e?(0,_.dateI18n)("Y-m-d",e):""})}})}),(0,c.jsx)(i.ToggleControl,{label:(0,a.__)("Set end date","newspack-plugin"),checked:!!s,onChange:e=>{if(e){const e=new Date;t({endDate:(0,_.dateI18n)("Y-m-d",e)})}else t({endDate:""})},help:(0,a.__)("Enable this if the contribution meter should stop counting contributions after a specific date.","newspack-plugin")}),s&&(0,c.jsx)(i.BaseControl,{id:"contribution-meter-end-date",label:(0,a.__)("End date","newspack-plugin"),help:(0,a.__)("Contributions up to and including this date are counted in the total amount raised.","newspack-plugin"),children:(0,c.jsx)(i.DatePicker,{currentDate:m,isInvalidDate:e=>!w||e<w||!!(b&&e>b),onChange:e=>{t({endDate:e?(0,_.dateI18n)("Y-m-d",e):""})}})})]}),(0,c.jsxs)(i.PanelBody,{title:(0,a.__)("Progress bar","newspack-plugin"),initialOpen:!1,children:[(0,c.jsx)(i.ToggleControl,{label:(0,a.__)("Show goal","newspack-plugin"),checked:u,onChange:e=>t({showGoal:e}),help:(0,a.__)("Display the total target amount next to the progress bar.","newspack-plugin")}),(0,c.jsx)(i.ToggleControl,{label:(0,a.__)("Show amount raised","newspack-plugin"),checked:d,onChange:e=>t({showAmountRaised:e}),help:(0,a.__)("Display the total contributions received so far.","newspack-plugin")}),(0,c.jsx)(i.ToggleControl,{label:(0,a.__)("Show percentage","newspack-plugin"),checked:g,onChange:e=>t({showPercentage:e}),help:(0,a.__)("Display progress as a percentage of the goal.","newspack-plugin")}),(0,c.jsxs)(i.__experimentalToggleGroupControl,{label:(0,a.__)("Thickness","newspack-plugin"),value:p,onChange:e=>t({thickness:e}),isBlock:!0,help:(0,a.__)("Adjust the visual weight of the progress bar.","newspack-plugin"),__next40pxDefaultSize:!0,children:[(0,c.jsx)(i.__experimentalToggleGroupControlOption,{label:(0,a.__)("XS","newspack-plugin"),value:"xs",title:(0,a.__)("Extra Small","newspack-plugin")}),(0,c.jsx)(i.__experimentalToggleGroupControlOption,{label:(0,a.__)("S","newspack-plugin"),value:"s",title:(0,a.__)("Small","newspack-plugin")}),(0,c.jsx)(i.__experimentalToggleGroupControlOption,{label:(0,a.__)("M","newspack-plugin"),value:"m",title:(0,a.__)("Medium","newspack-plugin")}),(0,c.jsx)(i.__experimentalToggleGroupControlOption,{label:(0,a.__)("L","newspack-plugin"),value:"l",title:(0,a.__)("Large","newspack-plugin")})]})]})]})},m=e=>{const t=window.newspack_contribution_meter_data?.currencySymbol||"$",n=window.newspack_contribution_meter_data?.currencyPosition||"left",a=window.newspack_contribution_meter_data?.thousandSeparator||",",r=Math.round(e).toString().replace(/\B(?=(\d{3})+(?!\d))/g,a);switch(n){case"left":default:return t+r;case"right":return r+t;case"left_space":return t+" "+r;case"right_space":return r+" "+t}},h=(e=new Date)=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,b=({amountRaised:e,goal:t,percentage:n,showGoal:r,showAmountRaised:s,showPercentage:o,progressBarColor:i})=>{const l={};i&&(l.color=i);const p={width:`${n>100?100:n}%`},u=r||s||o;let d="";(o&&!r&&!s||!s&&r&&!o)&&(d="contribution-meter__text--right");const g=!o||r||s?void 0:{width:p.width};return(0,c.jsxs)("div",{className:"contribution-meter__linear",children:[u&&(0,c.jsxs)("div",{className:`contribution-meter__text ${d}`,style:g,children:[o&&!s&&r&&(0,c.jsxs)("span",{className:"contribution-meter__percentage",children:[n,"%"]}),s&&r&&(0,c.jsx)("span",{className:"contribution-meter__amount-raised-goal",children:(0,a.sprintf)(/* translators: 1: amount raised, 2: goal amount */ /* translators: 1: amount raised, 2: goal amount */
(0,a.__)("%1$s raised of %2$s goal","newspack-plugin"),m(e),m(t))}),s&&!r&&(0,c.jsx)("span",{className:"contribution-meter__amount-raised",children:(0,a.sprintf)(/* translators: %s: amount raised */ /* translators: %s: amount raised */
(0,a.__)("%s raised","newspack-plugin"),m(e))}),!s&&r&&(0,c.jsx)("span",{className:"contribution-meter__goal",children:(0,a.sprintf)(/* translators: %s: goal amount */ /* translators: %s: goal amount */
(0,a.__)("%s goal","newspack-plugin"),m(t))}),o&&!(!s&&r)&&(0,c.jsxs)("span",{className:"contribution-meter__percentage",children:[n,"%"]})]}),(0,c.jsx)("div",{className:"contribution-meter__bar-container",style:l,children:(0,c.jsx)("div",{className:"contribution-meter__bar-track",children:(0,c.jsx)("div",{className:"contribution-meter__bar-progress",style:p})})})]})},k={xs:4,s:8,m:12,l:16},x=({amountRaised:e,goal:t,percentage:n,showGoal:r,showAmountRaised:s,showPercentage:o,progressBarColor:i,thickness:l})=>{const p=k[l]||k.s,{radius:u,circumference:d,offset:g}=((e,t)=>{const n=e>100?100:e,a=36-t/2,r=2*Math.PI*a;return{radius:a,circumference:r,offset:r-n/100*r}})(n,p),_={};return i&&(_.color=i),(0,c.jsxs)("div",{className:"contribution-meter__circular",children:[(0,c.jsxs)("div",{className:"contribution-meter__circle-container",children:[(0,c.jsxs)("svg",{className:"contribution-meter__circle",style:_,viewBox:"0 0 72 72",role:"img","aria-label":(0,a.__)("Contribution progress indicator","newspack-plugin"),children:[(0,c.jsx)("title",{children:(0,a.__)("Contribution Meter","newspack-plugin")}),(0,c.jsx)("desc",{children:(0,a.sprintf)(/* translators: 1: percentage, 2: formatted goal amount */ /* translators: 1: percentage, 2: formatted goal amount */
(0,a.__)("%1$s%% progress toward %2$s goal","newspack-plugin"),n,m(t))}),(0,c.jsx)("circle",{className:"contribution-meter__circle-track",cx:36,cy:36,r:u,fill:"none",strokeWidth:p}),(0,c.jsx)("circle",{className:"contribution-meter__circle-progress",cx:36,cy:36,r:u,fill:"none",strokeWidth:p,strokeDasharray:d,strokeDashoffset:g,strokeLinecap:"butt",transform:"rotate(-90 36 36)"})]}),o&&(0,c.jsxs)("div",{className:"contribution-meter__circle-percentage newspack-ui__font--2xs",children:[n,"%"]})]}),(0,c.jsxs)("div",{className:"contribution-meter__data",children:[s&&(0,c.jsxs)("span",{className:"contribution-meter__amount-raised newspack-ui__font--m",children:[m(e)," ",(0,a.__)("raised","newspack-plugin")]}),r&&(0,c.jsxs)("span",{className:s?"contribution-meter__goal":"contribution-meter__goal contribution-meter__goal--primary newspack-ui__font--m",children:[m(t)," ",(0,a.__)("goal","newspack-plugin")]})]})]})};var f=n(5402),v=n(1349);const j=(0,a.__)("Contribution Meter","newspack-plugin"),{name:y}=s,C={title:j,icon:{src:f.A,foreground:v.A["primary-400"]},keywords:[(0,a.__)("donations","newspack-plugin"),(0,a.__)("fundraising","newspack-plugin"),(0,a.__)("revenue","newspack-plugin"),(0,a.__)("progress","newspack-plugin"),(0,a.__)("goal","newspack-plugin"),(0,a.__)("campaign","newspack-plugin"),(0,a.__)("contribution","newspack-plugin"),(0,a.__)("meter","newspack-plugin"),(0,a.__)("newspack","newspack-plugin")],description:(0,a.__)("Display progress toward your goal. Works seamlessly with the Donate block.","newspack-plugin"),edit:({attributes:e,setAttributes:t})=>{const{className:n,goalAmount:r,startDate:s,endDate:p,progressBarColor:d,thickness:_,showGoal:m,showAmountRaised:k,showPercentage:f,previewMode:v=!1}=e,j=n&&n.includes("is-style-circular")?"circular":"linear",[y,C]=(0,l.useState)(v?{amountRaised:1500}:null),[S,D]=(0,l.useState)(!v),[N,P]=(0,l.useState)(null);(0,l.useEffect)(()=>{s||t({startDate:h()})},[s,t]),(0,l.useEffect)(()=>{v||(s?(D(!0),P(null),g()({path:"/newspack/v1/contribution-meter",method:"POST",data:{startDate:s,...p&&{endDate:p}}}).then(e=>{C(e),D(!1)}).catch(e=>{P(e.message||(0,a.__)("Failed to load contribution data.","newspack-plugin")),D(!1)})):D(!1))},[s,p,v]);const T=y?.amountRaised||0,B=(0,l.useMemo)(()=>{if(!r||r<=0)return 0;const e=T/r*100;return Math.floor(10*e)/10},[T,r]),O=(0,l.useMemo)(()=>((e,t)=>[`contribution-meter--${e}`,`contribution-meter--thickness-${t}`,"newspack-ui","newspack-ui__font--s"].join(" "))(j,_),[j,_]),A=(0,o.useBlockProps)({className:O}),M={amountRaised:T,goal:r,percentage:B,showGoal:m,showAmountRaised:k,showPercentage:f,progressBarColor:d,thickness:_};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(w,{attributes:e,setAttributes:t}),(0,c.jsxs)("div",{...A,children:[S&&(0,c.jsxs)(i.Placeholder,{className:"contribution-meter-loading",children:[(0,c.jsx)(i.Spinner,{}),(0,a.__)("Loading contribution dataâ€¦","newspack-plugin")]}),!S&&N&&(0,c.jsx)(i.Placeholder,{icon:u,label:(0,a.__)("Error","newspack-plugin"),instructions:N,className:"contribution-meter-error"}),!S&&!N&&(0,c.jsxs)(c.Fragment,{children:["linear"===j&&(0,c.jsx)(b,{...M}),"circular"===j&&(0,c.jsx)(x,{...M})]})]})]})},save:()=>null};(0,r.registerBlockType)({name:y,...s},C),(0,r.registerBlockStyle)(y,{name:"linear",label:(0,a.__)("Linear","newspack-plugin"),isDefault:!0}),(0,r.registerBlockStyle)(y,{name:"circular",label:(0,a.__)("Circular","newspack-plugin"),example:{attributes:{className:"is-style-circular"}}})}},n={};function a(e){var r=n[e];if(void 0!==r)return r.exports;var s=n[e]={id:e,loaded:!1,exports:{}};return t[e](s,s.exports,a),s.loaded=!0,s.exports}a.m=t,e=[],a.O=(t,n,r,s)=>{if(!n){var o=1/0;for(p=0;p<e.length;p++){for(var[n,r,s]=e[p],i=!0,l=0;l<n.length;l++)(!1&s||o>=s)&&Object.keys(a.O).every(e=>a.O[e](n[l]))?n.splice(l--,1):(i=!1,s<o&&(o=s));if(i){e.splice(p--,1);var c=r();void 0!==c&&(t=c)}}return t}s=s||0;for(var p=e.length;p>0&&e[p-1][2]>s;p--)e[p]=e[p-1];e[p]=[n,r,s]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.j=1,(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={1:0};a.O.j=t=>0===e[t];var t=(t,n)=>{var r,s,[o,i,l]=n,c=0;if(o.some(t=>0!==e[t])){for(r in i)a.o(i,r)&&(a.m[r]=i[r]);if(l)var p=l(a)}for(t&&t(n);c<o.length;c++)s=o[c],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(p)},n=globalThis.webpackChunknewspack=globalThis.webpackChunknewspack||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=a.O(void 0,[223],()=>a(9021));r=a.O(r)})();