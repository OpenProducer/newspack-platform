tribe.events=tribe.events||{},tribe.events.views=tribe.events.views||{},tribe.events.views.manager={},function(e,t,r){"use strict";var n=e(window);r.nonces=null,r.selectors={container:'[data-js="tribe-events-view"]',form:'[data-js="tribe-events-view-form"]',link:'[data-js="tribe-events-view-link"]',dataScript:'[data-js="tribe-events-view-data"]',loader:".tribe-events-view-loader",loaderText:".tribe-events-view-loader__text",hiddenElement:".tribe-common-a11y-hidden",nonceScript:'[data-js="tribe-events-view-nonce-data"]'},r.lastLocation={origin:"",pathname:""},r.doingPopstate=!1,r.currentAjaxRequest=null,r.$lastContainer=e(),r.$containers=e(),r.cleanup=function(t){var n=e(t),i=n.find(r.selectors.form),a=n.find(r.selectors.dataScript),o={};a.length&&(o=JSON.parse(a.text().trim())),n.trigger("beforeCleanup.tribeEvents",[n,o]),n.find(r.selectors.link).off("click.tribeEvents",r.onLinkClick),i.length&&i.off("submit.tribeEvents",r.onSubmit),n.off("resize.tribeEvents"),n.trigger("afterCleanup.tribeEvents",[n,o])},r.setup=function(t,n){var i=e(e.find(r.selectors.nonceScript)),a=e(n),o=a.find(r.selectors.form),s=a.find(r.selectors.dataScript),c={};i.length&&(r.nonces=JSON.parse(e(i[0]).text().trim()),i.remove()),s.length&&(c=JSON.parse(s.text().trim())),a.trigger("beforeSetup.tribeEvents",[t,a,c]),a.find(r.selectors.link).on("click.tribeEvents",r.onLinkClick),o.length&&o.on("submit.tribeEvents",r.onSubmit),a.trigger("afterSetup.tribeEvents",[t,a,c])},r.getContainer=function(t){var n=e(t);return n.is(r.selectors.container)?n:n.parents(r.selectors.container).eq(0)},r.getContainerData=function(e){var t=e.find(r.selectors.dataScript);if(t.length)return JSON.parse(t.text().trim())},r.shouldManageUrl=function(e){var t=e.data("view-manage-url");return void 0===t||/^(true|1|on|yes)$/.test(String(t))},r.updateUrl=function(e){if(!r.doingPopstate&&r.shouldManageUrl(e)){var n=e.find(r.selectors.dataScript);if(n.length){var i=JSON.parse(n.text().trim());t.isObject(i)&&(t.isUndefined(i.url)||t.isUndefined(i.title)||(document.title=i.title,window.history.pushState(null,i.title,i.url),r.lastLocation.pathname=document.location.pathname,r.lastLocation.origin=document.location.origin))}}},r.onLinkClick=async function(t){var n=r.getContainer(this);n.trigger("beforeOnLinkClick.tribeEvents",t),t.preventDefault();var i=r.getContainerData(n),a=e(this),o=a.data("url")||a.attr("href"),s=i.prev_url,c=r.shouldManageUrl(n),d=n.data("view-shortcode"),l={prev_url:encodeURI(decodeURI(s)),url:encodeURI(decodeURI(o)),should_manage_url:c};return d&&(l.shortcode=d),await r.request(l,n),n.trigger("afterOnLinkClick.tribeEvents",t),!1},r.onSubmit=async function(t){var n=r.getContainer(this);n.trigger("beforeOnSubmit.tribeEvents",t),t.preventDefault();var i=e(this),a={view_data:Qs.parse(i.serialize())["tribe-events-views"]};return await r.request(a,n),n.trigger("afterOnSubmit.tribeEvents",t),!1},r.onPopState=async function(e){var t=e.originalEvent.target,n=t.location.href,i=r.getLastContainer();if(r.lastLocation.origin===t.location.origin&&r.lastLocation.pathname===t.location.pathname)return!1;if(r.lastLocation.pathname=document.location.pathname,r.lastLocation.origin=document.location.origin,!i)return!1;r.currentAjaxRequest&&r.currentAjaxRequest.abort(),r.doingPopstate=!0,i.trigger("beforePopState.tribeEvents",e);var a={url:n};return await r.request(a,i),!1},r.setupRequestData=function(t,n){var i=r.shouldManageUrl(n),a=r.getContainerData(n);t.url||(t.url=a.url),t.prev_url||(t.prev_url=a.prev_url),t.should_manage_url=i,r.nonces&&(t=e.extend(t,r.nonces));var o=n.data("tribeRequestData");return e.isPlainObject(o)?e.extend(o,t):t},r.request=async function(t,n,i={}){wp.hooks.doAction("tec.events.beforeRequest",t,n),n.trigger("beforeRequest.tribeEvents",[t,n]);var a=r.getAjaxSettings(n);a.data=r.setupRequestData(t,n),a.data=r.shirinkUrlComponents(n,a.data);try{const e=new URL(a.url,window.location.origin);e.search=new URLSearchParams(a.data).toString(),e.toString().length>2048&&(a.method="POST")}catch(e){}r.currentAjaxRequest=await e.ajax(e.extend(a,i)),r.ajaxComplete(n),n.trigger("afterRequest.tribeEvents",[t,n]),wp.hooks.doAction("tec.events.afterRequest",t,n)},r.shirinkUrlComponents=(e,n)=>{const{home_url:i,rest_url:a,rest_nonce:o,rest_method:s}=r.getContainerData(e);return t.reduce(n,((e,t,r)=>("prev_url"===r?e.pu=t.replace(i,""):"url"===r?e.u=t.replace(i,""):"should_manage_url"===r?e.smu=t:e[r]=t,e)),{})},r.getAjaxSettings=function(e){return{url:e.data("view-rest-url"),method:e.data("view-rest-method")||"POST",async:!0,beforeSend:r.ajaxBeforeSend,success:r.ajaxSuccess,error:r.ajaxError,context:e}},r.ajaxBeforeSend=function(e,t){var n=this,i=n.find(r.selectors.loader);if(n.trigger("beforeAjaxBeforeSend.tribeEvents",[e,t]),i.length){i.removeClass(r.selectors.hiddenElement.className());var a=i.find(r.selectors.loaderText);a.text(a.text())}n.attr("aria-busy","true"),n.trigger("afterAjaxBeforeSend.tribeEvents",[e,t])},r.ajaxComplete=function(e){var t=e.find(r.selectors.loader);e.trigger("beforeAjaxComplete.tribeEvents",[]),t.length&&t.addClass(r.selectors.hiddenElement.className()),e.trigger("afterAjaxComplete.tribeEvents",[]),r.doingPopstate&&(r.doingPopstate=!1),r.currentAjaxRequest=null},r.ajaxSuccess=function(t,n,i){var a=this;a.trigger("beforeAjaxSuccess.tribeEvents",[t,n,i]);var o=e(t.html),s=o.find(r.selectors.nonceScript);o=o.not(r.selectors.nonceScript),s.length&&(r.nonces=JSON.parse(e(s[0]).text().trim())),r.cleanup(a),document.dispatchEvent(new CustomEvent("containerReplaceBefore.tribeEvents",{detail:a})),a.replaceWith(o),a=o,r.setup(0,a),document.dispatchEvent(new CustomEvent("containerReplaceAfter.tribeEvents",{detail:a})),r.selectContainers(),r.updateUrl(a),a.trigger("afterAjaxSuccess.tribeEvents",[t,n,i]),r.shouldManageUrl(a)&&(r.$lastContainer=a)},r.ajaxError=function(e,t){this.trigger("beforeAjaxError.tribeEvents",[e,t]),this.trigger("afterAjaxError.tribeEvents",[e,t])},r.selectContainers=function(){return r.$containers=e(r.selectors.container),r.$containers},r.getLastContainer=function(){return r.$lastContainer.length||(r.$lastContainer=r.$containers.filter('[data-view-manage-url="1"]').eq(0)),r.$lastContainer},r.manageMobileFocusOrder=function(t){var r,n=t.data("tribeEventsState"),i=tribe.events.views.breakpoints&&tribe.events.views.breakpoints.breakpoints&&tribe.events.views.breakpoints.breakpoints.medium||768;if(n&&void 0!==n.isMobile?n.isMobile:t.outerWidth()<i){if((r=t.find("header.tribe-events-header")).length){var a=r.find('[data-js="tribe-events-top-bar-datepicker-button"]'),o=r.find(".tribe-events-header__events-bar"),s=r.find("a, button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex='-1'])"),c=o.length?o.find("button:not([disabled]), a, input:not([disabled]), select:not([disabled])"):e();s.each((function(){var t=e(this),r=t.is(a),n=t.closest(".tribe-events-header__events-bar").length>0,i=t.closest(".tribe-events-c-top-bar__datepicker").length>0,o=c.length&&c.index(t)>=0;r||n||i||o||(t.attr("tabindex","-1"),t.attr("data-tribe-mobile-focus-order","skipped"))})),c.length&&c.each((function(){var t=e(this);"skipped"!==t.attr("data-tribe-mobile-focus-order")&&(t.attr("tabindex","-1"),t.attr("data-tribe-mobile-focus-order","events-bar-skipped"))}));var d=function(){c.length&&c.each((function(){var t=e(this),r=t.attr("data-tribe-mobile-focus-order");("events-bar-skipped"===r||"skipped"===r&&t.closest(".tribe-events-header__events-bar").length)&&(t.removeAttr("tabindex"),t.attr("data-tribe-mobile-focus-order","events-bar"))}))};if(a.length){var l=a.attr("tabindex");("-1"===l||l&&parseInt(l,10)<0)&&a.removeAttr("tabindex"),a.attr("data-tribe-mobile-focus-order","datepicker"),a.off("focus.tribeMobileFocusOrder"),a.on("focus.tribeMobileFocusOrder",(function(){d()})),a.off("keydown.tribeMobileFocusOrder"),a.on("keydown.tribeMobileFocusOrder",(function(e){if(9===e.keyCode&&!e.shiftKey&&(d(),c.length))return e.preventDefault(),e.stopPropagation(),setTimeout((function(){c.first()[0].focus()}),0),!1})),a.off("blur.tribeMobileFocusOrder"),a.on("blur.tribeMobileFocusOrder",(function(){setTimeout((function(){c.length&&"events-bar"===c.first().attr("data-tribe-mobile-focus-order")&&a.attr("tabindex","-1")}),100)}))}c.length&&(c.off("focus.tribeMobileFocusOrder"),c.on("focus.tribeMobileFocusOrder",(function(){a.length&&a.attr("tabindex","-1")}))),r.off("focusout.tribeMobileFocusOrder"),r.on("focusout.tribeMobileFocusOrder",(function(t){var r=e(t.relatedTarget);r&&r.closest("header.tribe-events-header").length||setTimeout((function(){a.length&&"datepicker"===a.attr("data-tribe-mobile-focus-order")&&"-1"===a.attr("tabindex")&&a.removeAttr("tabindex"),c.length&&c.each((function(){var t=e(this);"events-bar"===t.attr("data-tribe-mobile-focus-order")&&(t.attr("tabindex","-1"),t.attr("data-tribe-mobile-focus-order","events-bar-skipped"))}))}),100)})),r.off("focusin.tribeMobileFocusOrder"),r.on("focusin.tribeMobileFocusOrder",(function(t){var n=e(t.target);(n.is(a)||n.closest(".tribe-events-c-top-bar__datepicker").length||a.length&&r.find("*").index(n[0])>=r.find("*").index(a[0]))&&d()})),r.find(".tribe-events-c-top-bar__nav").find("a, button").each((function(){var t=e(this);t.attr("tabindex","-1"),t.attr("data-tribe-mobile-focus-order","skipped")}))}}else(r=t.find("header.tribe-events-header")).length&&(r.off("focusin.tribeMobileFocusOrder focusout.tribeMobileFocusOrder"),r.find("[data-tribe-mobile-focus-order]").off("focus.tribeMobileFocusOrder keydown.tribeMobileFocusOrder blur.tribeMobileFocusOrder").each((function(){var t=e(this),r=t.attr("data-tribe-mobile-focus-order");"skipped"!==r&&"events-bar-skipped"!==r||t.removeAttr("tabindex"),t.removeAttr("data-tribe-mobile-focus-order")})))},r.initMobileFocusOrder=function(e,t,n){setTimeout((function(){r.manageMobileFocusOrder(n)}),10),n.on("resize.tribeEvents",(function(){r.manageMobileFocusOrder(n)}))},r.ready=function(){r.selectContainers().each(r.setup),r.lastLocation={origin:document.location.origin,pathname:document.location.pathname}},e(document).on("afterSetup.tribeEvents",r.selectors.container,r.initMobileFocusOrder),e(r.ready),n.on("popstate",r.onPopState)}(jQuery,window.underscore||window._,tribe.events.views.manager),window.tec=window.tec||{},window.tec.events=window.tec.events||{},window.tec.events.views=window.tec.events.views||{},window.tec.events.views.manager={};