(()=>{var e;e=window.commonIan||(window.commonIan={}),window.addEventListener("load",(function(t){e.icon=document.querySelector('[data-tec-ian-trigger="iconIan"]'),e.sidebar=document.querySelector('[data-tec-ian-trigger="sideIan"]'),e.notifications=document.querySelector('[data-tec-ian-trigger="notifications"]'),e.readAll=document.querySelector('[data-tec-ian-trigger="readAllIan"]'),e.optin=document.querySelector('[data-tec-ian-trigger="optinIan"]'),e.close=document.querySelector('[data-tec-ian-trigger="closeIan"]'),e.empty=document.querySelector('[data-tec-ian-trigger="emptyIan"]'),e.loader=document.querySelector('[data-tec-ian-trigger="loaderIan"]'),e.consent=e.notifications.dataset.consent,e.feed={read:[],unread:[]};const n=n=>{switch(i(),n.target.dataset.tecIanTrigger){case"iconIan":n.preventDefault(),n.stopPropagation(),e.sidebar.classList.toggle("is-hidden"),e.icon.classList.toggle("active");break;case"closeIan":n.preventDefault(),n.stopPropagation(),e.sidebar.classList.add("is-hidden"),e.icon.classList.remove("active");break;case"optinIan":n.preventDefault(),n.stopPropagation(),s();break;case"dismissIan":n.preventDefault(),n.stopPropagation(),c(n.target.dataset.id,n.target.dataset.slug);break;case"readIan":n.preventDefault(),n.stopPropagation(),t.stopPropagation(),l(n.target.dataset.id,n.target.dataset.slug);break;case"readAllIan":n.preventDefault(),n.stopPropagation(),p();break;default:console.log("e.composedPath",n.composedPath())}},a=()=>{const e=document.querySelector(".wrap .ian-header");let t={top:0,height:0};e&&(t=e.getBoundingClientRect());let n=document.getElementById("tribe-settings-tabs");n&&(n=window.innerWidth>500?n:document.querySelector(".tec-settings-header-wrap"),t=n.getBoundingClientRect());const a=document.getElementById("tec-admin-page-header");return a&&(t=a.getBoundingClientRect()),t.top+t.height},i=()=>{const t=a();e.sidebar.style.top=`${t}px`};let d=!1;const o=()=>{const t=window.innerWidth>782?32:window.innerWidth>600?46:0;window.scrollY,a()<=t?e.sidebar.style.top=t+"px":i(),d=!1},s=async()=>{e.optin.classList.add("disable"),e.loader.classList.remove("is-hidden");const t=new FormData;t.append("action","ian_optin"),t.append("nonce",e.nonce);try{(await fetch(e.ajaxUrl,{method:"POST",credentials:"same-origin",body:t}).then((e=>e.json()))).success&&r()}catch(e){console.error("Error during opt-in:",e)}finally{e.optin.classList.remove("disable"),e.loader.classList.add("is-hidden")}},r=async t=>{e.notifications.classList.remove("is-hidden"),t||e.loader.classList.remove("is-hidden");const n=new FormData;n.append("action","ian_get_feed"),n.append("nonce",e.nonce),n.append("plugin",g());try{const t=await fetch(e.ajaxUrl,{method:"POST",credentials:"same-origin",body:n}).then((e=>e.json()));if(e.loader.classList.add("is-hidden"),t.success)if(e.optin&&e.optin.remove(),0===t.data.length)e.feed={read:[],unread:[]},e.notifications.classList.add("is-hidden"),e.empty.classList.remove("is-hidden");else{let n="",a="";Object.entries(t.data).forEach((([e,t])=>{t.read?(n+=t.html,commonIan.feed.read.push(t)):(a+=t.html,commonIan.feed.unread.push(t))}));const i=`<div class="ian-sidebar__separator"><div>${e.readTxt}</div><span></span></div>`;e.notifications.innerHTML=a+i+n}m()}catch(e){console.error("Error fetching Ian feed:",e)}finally{e.loader.classList.add("is-hidden")}},c=async(t,n)=>{e.loader.classList.remove("is-hidden");const a=document.getElementById(`notification_${t}`);a.classList.add("fade-out");const i=new FormData;i.append("action","ian_dismiss"),i.append("slug",n),i.append("id",t),i.append("nonce",a.dataset.nonce);try{const n=await fetch(e.ajaxUrl,{method:"POST",credentials:"same-origin",body:i}).then((e=>e.json()));if(e.loader.classList.add("is-hidden"),n.success){a.remove();const{read:n,unread:i}=e.feed,d=e=>e.filter((e=>e.id!==parseInt(t)));e.feed.read=d(n),e.feed.unread=d(i),m()}else console.error("Failed to dismiss notification:",n.message||"Unknown error")}catch(e){console.error("Error dismissing notification:",e)}finally{e.loader.classList.add("is-hidden")}},l=async(t,n)=>{e.reading=t,e.loader.classList.remove("is-hidden");const a=document.getElementById(`notification_${t}`);a.classList.add("fade-out");const i=new FormData;i.append("action","ian_read"),i.append("slug",n),i.append("id",t),i.append("nonce",a.dataset.nonce);try{const n=await fetch(e.ajaxUrl,{method:"POST",credentials:"same-origin",body:i}).then((e=>e.json()));e.loader.classList.add("is-hidden"),n.success?(e.feed.read.unshift(e.feed.unread.find((e=>e.id===parseInt(t)))),e.feed.unread=e.feed.unread.filter((e=>e.id!==parseInt(t))),m(),document.querySelector(".ian-sidebar__separator").insertAdjacentElement("afterend",a),a.querySelector(".ian-sidebar__notification-link--right").remove(),a.classList.remove("fade-out")):console.error("Failed to read notification:",n.message||"Unknown error")}catch(e){console.error("Error reading notification:",e)}finally{e.loader.classList.add("is-hidden")}},p=async()=>{e.loader.classList.remove("is-hidden");const t=new FormData;t.append("action","ian_read_all"),t.append("nonce",e.nonce),t.append("unread",JSON.stringify(e.feed.unread.map((e=>e.slug))));try{const n=await fetch(e.ajaxUrl,{method:"POST",credentials:"same-origin",body:t}).then((e=>e.json()));if(e.loader.classList.add("is-hidden"),n.success){e.feed.read=[...e.feed.read,...e.feed.unread],e.feed.unread=[];const t=e.feed.read.map((e=>e.html)).join(""),n=`<div class="ian-sidebar__separator"><div>${e.readTxt}</div><span></span></div>`;e.notifications.innerHTML=n+t,document.querySelectorAll(".ian-sidebar__notification-link--right").forEach((e=>e.remove())),m()}else console.error("Failed to read all notifications:",n.message||"Unknown error")}catch(e){console.error("Error reading all notifications:",e)}finally{e.loader.classList.add("is-hidden")}},m=()=>{const t=e.feed.read.length>0,n=e.feed.unread.length>0,a=!n&&!t;e.icon.classList.toggle("unread",n),e.readAll.classList.toggle("is-hidden",!n),e.notifications.classList.toggle("is-hidden",a),e.empty.classList.toggle("is-hidden",!a),a||document.querySelector(".ian-sidebar__separator").classList.toggle("is-hidden",!t)},g=()=>document.body.classList.contains("tickets_page_tec-tickets-settings")?"et":"tec";var u;(()=>{document.querySelectorAll(".edit-php.post-type-tribe_events h1.wp-heading-inline, .post-php.post-type-tribe_events h1.wp-heading-inline").forEach((e=>{const t=e.nextElementSibling;if(t){const n=document.createElement("div");n.className="ian-header";const a=document.createElement("div");a.className="ian-inner-wrapper";const i=document.createElement("div");i.className="ian-client",i.setAttribute("data-tec-ian-trigger","iconIan"),e.parentNode.insertBefore(n,e),n.appendChild(a),a.appendChild(e),a.appendChild(t),a.appendChild(i)}}));const t=document.querySelector(".tec-settings-header-wrap");t&&t.insertAdjacentElement("afterend",e.sidebar)})(),e.icon=document.querySelector('[data-tec-ian-trigger="iconIan"]'),e.notifications=document.querySelector('[data-tec-ian-trigger="notifications"]'),e.readAll=document.querySelector('[data-tec-ian-trigger="readAllIan"]'),e.optin=document.querySelector('[data-tec-ian-trigger="optinIan"]'),e.close=document.querySelector('[data-tec-ian-trigger="closeIan"]'),e.empty=document.querySelector('[data-tec-ian-trigger="emptyIan"]'),e.loader=document.querySelector('[data-tec-ian-trigger="loaderIan"]'),e.consent=null!==(u=e.notifications?.dataset?.consent)&&void 0!==u?u:null,i(),document.querySelectorAll("[data-tec-ian-trigger]").forEach((e=>e.addEventListener("click",n))),document.addEventListener("click",(t=>{t.composedPath().includes(e.sidebar)||t.composedPath().includes(e.icon)||(e.sidebar&&e.sidebar.classList.add("is-hidden"),e.icon&&e.icon.classList.remove("active"))})),document.addEventListener("keydown",(t=>{(["Escape","Esc"].includes(t.key)||27===t.keyCode)&&(e.sidebar&&e.sidebar.classList.add("is-hidden"),e.icon&&e.icon.classList.remove("active"),i())})),window.addEventListener("resize",i),window.addEventListener("scroll",(()=>{d||(requestAnimationFrame(o),d=!0)})),"true"==e.consent&&r(!0)})),window.tec=window.tec||{},window.tec.common=window.tec.common||{},window.tec.common.ianClient={}})();