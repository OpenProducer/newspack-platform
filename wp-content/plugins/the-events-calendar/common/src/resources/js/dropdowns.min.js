var tribe_dropdowns=tribe_dropdowns||{};!function(e,t,a){"use strict";t.selector={dropdown:".tribe-dropdown",created:".tribe-dropdown-created"},e.fn.tribe_dropdowns=function(){return t.dropdown(this),this},t.freefrom_create_search_choice=function(e,t){var r=this.opts,o=r.$select;if(e.match(r.regexToken)&&(!o.is("[data-int]")||o.is("[data-int]")&&e.match(/\d+/))){var i={id:e,text:e,new:!0};return o.is("[data-create-choice-template]")&&(i.text=a.template(o.data("createChoiceTemplate"))({term:e})),i}},t.allow_html_markup=function(e){return e},t.search_id=function(e){var t=void 0;return void 0!==e.id?t=e.id:void 0!==e.ID?t=e.ID:void 0!==e.value&&(t=e.value),void 0===e?void 0:t},t.matcher=function(e,r){var o=this.element.data("dropdown"),i=-1!==r.toUpperCase().indexOf(e.toUpperCase());if(!i&&void 0!==o.tags){var s=a.where(o.tags,{text:r});if(o.tags.length>0&&a.isObject(s))i=-1!==t.search_id(s[0]).toUpperCase().indexOf(e.toUpperCase())}return i},t.init_selection=function(t,a){var r=t.is("[multiple]"),o=t.data("dropdown"),i=t.val().split(o.regexSplit),s=[];e(i).each(function(a,r){var i=function t(a,r){if(!e.isArray(r))return!1;for(var o in r){var i=r[o];if(i.hasOwnProperty("id")&&i.id==a.id)return i;if(i.hasOwnProperty("text")&&i.text==a.text)return i;if(i.hasOwnProperty("children")&&e.isArray(i.children)){var s=t(a,i.children);if(s)return s}}return!1}({id:this,text:this},o.ajax?t.data("options"):o.data);i&&s.push(i)}),s.length&&r?a(s):s.length&&a(s[0])},t.element=function(r,o){var i,s=e(r),n=(o=e.extend({},o),["depends","condition","conditionNot","condition-not","conditionNotEmpty","condition-not-empty","conditionEmpty","condition-empty","conditionIsNumeric","condition-is-numeric","conditionIsNotNumeric","condition-is-not-numeric","conditionChecked","condition-is-checked"]);if(s.addClass(t.selector.created.className()),o.$select=s,o.dropdownAutoWidth=!0,o.containerCss={},s.is(":visible")&&(o.containerCss.display="inline-block"),o.dropdownCss={},o.dropdownCss.width="auto",s.is("[data-dropdown-css-width]")&&(o.dropdownCss.width=s.data("dropdown-css-width"),o.dropdownCss.width||delete o.dropdownCss.width),o.matcher=t.matcher,s.is("select")||(o.id=t.search_id),o.allowClear=!0,s.is("[data-prevent-clear]")&&(o.allowClear=!1),s.is("[data-searching-placeholder]")&&(o.formatSearching=s.data("searching-placeholder")),s.is("[data-options]")&&(o.data=s.data("options"),s.is("select")||(o.initSelection=t.init_selection)),s.is("[data-allow-html]")&&(o.escapeMarkup=t.allow_html_markup),s.is("[data-hide-search]")&&(o.minimumResultsForSearch=1/0),s.is("[data-freeform]")&&(o.createSearchChoice=t.freefrom_create_search_choice),s.is("[multiple]")&&(o.multiple=!0,s.is("[data-maximum-selection-size]")&&(o.maximumSelectionSize=s.data("maximum-selection-size")),s.is("data-separator")||s.data("separator",","),a.isArray(s.data("separator"))?o.tokenSeparators=s.data("separator"):o.tokenSeparators=[s.data("separator")],o.separator=s.data("separator"),o.regexSeparatorElements=["^("],o.regexSplitElements=["(?:"],e.each(o.tokenSeparators,function(e,t){o.regexSeparatorElements.push("[^"+t+"]+"),o.regexSplitElements.push("["+t+"]")}),o.regexSeparatorElements.push(")$"),o.regexSplitElements.push(")"),o.regexSeparatorString=o.regexSeparatorElements.join(""),o.regexSplitString=o.regexSplitElements.join(""),o.regexToken=new RegExp(o.regexSeparatorString,"ig"),o.regexSplit=new RegExp(o.regexSplitString,"ig")),s.is("[data-tags]")&&(o.tags=s.data("tags"),o.initSelection=t.init_selection,o.createSearchChoice=function(e,t){if(e.match(o.regexToken))return{id:e,text:e}},0===o.tags.length&&(o.formatNoMatches=function(){return s.attr("placeholder")})),s.is("[data-source]")){var c=s.data("source");o.data={results:[]},o.escapeMarkup=t.allow_html_markup,o.formatResult=function(t,a,r){return void 0!==t.breadcrumbs?e.merge(t.breadcrumbs,[t.text]).join(" &#187; "):t.text},o.ajax={dataType:"json",type:"POST",url:t.ajaxurl(),results:function(t,a,r){return e.isPlainObject(t)&&void 0!==t.success?e.isPlainObject(t.data)&&void 0!==t.data.results?t.success?t.data:("string"===e.type(t.data.message)?console.error(t.data.message):console.error("The Select2 search failed in some way... Verify the source."),{results:[]}):(console.error("We received a malformed results array, could not complete the Select2 Search."),{results:[]}):(console.error("We received a malformed Object, could not complete the Select2 Search."),{results:[]})}},o.ajax.data=function(e,t){return{action:"tribe_dropdown",source:c,search:e,page:t,args:s.data("source-args")}}}s.data("dropdown",o),i=s.select2(o).select2("container"),n.length>0&&n.map(function(e){var t="data-"+e,a=s.attr(t);a&&this.attr(t,a)},i)},t.action_change=function(t){var r=e(this),o=e(this).data("value");r.is("[multiple]")&&r.is("[data-source]")&&(t.added?a.isArray(o)?o.push(t.added):o=[t.added]:o=a.isArray(o)?a.without(o,t.removed):[],r.data("value",o).attr("data-value",JSON.stringify(o)))},t.ajaxurl=function(){return void 0!==window.ajaxurl?window.ajaxurl:"undefined"!=typeof TEC&&void 0!==TEC.ajaxurl?TEC.ajaxurl:void console.error("Dropdowns framework cannot properly do an AJAX request without the WordPress `ajaxurl` variable setup.")},t.action_select2_removed=function(t){var a=e(this);a.is("[data-sticky-search]")&&a.is("[data-last-search]")&&a.removeAttr("data-last-search").removeData("lastSearch")},t.action_bugfix_group_select=function(a){var r=e(this).select2("data");e(".select2-drop:visible").find(".select2-selected").each(function(){var a=e(this),o=a.data("select2-data"),i=!0;void 0!==o.children&&(e.each(r,function(e,a){t.search_id(o)==t.search_id(a)&&(i=!1)}),i&&a.removeClass("select2-selected"))})},t.action_select2_close=function(t){var a=e(this),r=e(".select2-drop .select2-input.select2-focused");a.is("[data-sticky-search]")&&r.off("keyup-change.tribe")},t.action_select2_open=function(t){var a=e(this),r=e(".select2-drop .select2-input:visible");a.is("[data-search-placeholder]")&&r.attr("placeholder",a.data("searchPlaceholder")),a.is("[data-sticky-search]")&&(r.on("keyup-change.tribe",function(){a.data("lastSearch",e(this).val()).attr("data-last-search",e(this).val())}),a.is("[data-last-search]")&&r.val(a.data("lastSearch")).trigger("keyup-change"))},t.dropdown=function(e,a){var r=e.not(".select2-offscreen, .select2-container, "+t.selector.created.className());return 0===r.length?r:(a||(a={}),r.each(function(e,r){t.element(r,a)}).on("select2-open",t.action_select2_open).on("select2-close",t.action_select2_close).on("select2-removed",t.action_select2_removed).on("select2-loaded",t.action_bugfix_group_select).on("change",t.action_change),r)},e(function(){e(t.selector.dropdown).tribe_dropdowns()}),e(window).on("unload",function(){e(t.selector.dropdown).tribe_dropdowns()})}(jQuery,tribe_dropdowns,window.underscore||window._);