/**
 * This JS file was auto-generated via Terser.
 *
 * Contributors should avoid editing this file, but instead edit the associated
 * non minified file file. For more information, check out our engineering docs
 * on how we handle JS minification in our engineering docs.
 *
 * @see: https://evnt.is/dev-docs-minification
 */

!function(Ian){window.addEventListener("load",(function(event){Ian.icon=document.querySelector('[data-tec-ian-trigger="iconIan"]'),Ian.sidebar=document.querySelector('[data-tec-ian-trigger="sideIan"]'),Ian.notifications=document.querySelector('[data-tec-ian-trigger="notifications"]'),Ian.readAll=document.querySelector('[data-tec-ian-trigger="readAllIan"]'),Ian.optin=document.querySelector('[data-tec-ian-trigger="optinIan"]'),Ian.close=document.querySelector('[data-tec-ian-trigger="closeIan"]'),Ian.empty=document.querySelector('[data-tec-ian-trigger="emptyIan"]'),Ian.loader=document.querySelector('[data-tec-ian-trigger="loaderIan"]'),Ian.consent=Ian.notifications.dataset.consent,Ian.feed={read:[],unread:[]};const handleElementClick=e=>{switch(calculateSidebarPosition(),e.target.dataset.tecIanTrigger){case"iconIan":e.preventDefault(),e.stopPropagation(),Ian.sidebar.classList.toggle("is-hidden"),Ian.icon.classList.toggle("active");break;case"closeIan":e.preventDefault(),e.stopPropagation(),Ian.sidebar.classList.add("is-hidden"),Ian.icon.classList.remove("active");break;case"optinIan":e.preventDefault(),e.stopPropagation(),optinIan();break;case"dismissIan":e.preventDefault(),e.stopPropagation(),dismissIan(e.target.dataset.id,e.target.dataset.slug);break;case"readIan":e.preventDefault(),e.stopPropagation(),event.stopPropagation(),readIan(e.target.dataset.id,e.target.dataset.slug);break;case"readAllIan":e.preventDefault(),e.stopPropagation(),readAllIan();break;default:console.log("e.composedPath",e.composedPath())}},handleDocumentClick=e=>{e.composedPath().includes(Ian.sidebar)||e.composedPath().includes(Ian.icon)||(Ian.sidebar&&Ian.sidebar.classList.add("is-hidden"),Ian.icon&&Ian.icon.classList.remove("active"))},handleKeydown=e=>{(["Escape","Esc"].includes(e.key)||27===e.keyCode)&&(Ian.sidebar&&Ian.sidebar.classList.add("is-hidden"),Ian.icon&&Ian.icon.classList.remove("active"),calculateSidebarPosition())},getParentPosition=()=>{const wrapper=document.querySelector(".wrap .ian-header");let rect={top:0,height:0};wrapper&&(rect=wrapper.getBoundingClientRect());let settingstabs=document.getElementById("tribe-settings-tabs");return settingstabs&&(settingstabs=window.innerWidth>500?settingstabs:document.querySelector(".tec-settings-header-wrap"),rect=settingstabs.getBoundingClientRect()),rect.top+rect.height},calculateSidebarPosition=()=>{const bottomPosition=getParentPosition();Ian.sidebar.style.top=`${bottomPosition}px`};let ticking=!1;const onScroll=()=>{ticking||(requestAnimationFrame(updatePosition),ticking=!0)},updatePosition=()=>{const offset=window.innerWidth>782?32:window.innerWidth>600?46:0;window.scrollY;getParentPosition()<=offset?Ian.sidebar.style.top=offset+"px":calculateSidebarPosition(),ticking=!1},optinIan=async()=>{Ian.optin.classList.add("disable"),Ian.loader.classList.remove("is-hidden");const data=new FormData;data.append("action","ian_optin"),data.append("nonce",Ian.nonce);try{(await fetch(Ian.ajaxUrl,{method:"POST",credentials:"same-origin",body:data}).then((res=>res.json()))).success&&getIan()}catch(err){console.error("Error during opt-in:",err)}finally{Ian.optin.classList.remove("disable"),Ian.loader.classList.add("is-hidden")}},getIan=async init=>{Ian.notifications.classList.remove("is-hidden"),init||Ian.loader.classList.remove("is-hidden");const data=new FormData;data.append("action","ian_get_feed"),data.append("nonce",Ian.nonce),data.append("plugin",whichPlugin());try{const response=await fetch(Ian.ajaxUrl,{method:"POST",credentials:"same-origin",body:data}).then((res=>res.json()));if(Ian.loader.classList.add("is-hidden"),response.success)if(Ian.optin&&Ian.optin.remove(),0===response.data.length)Ian.feed={read:[],unread:[]},Ian.notifications.classList.add("is-hidden"),Ian.empty.classList.remove("is-hidden");else{let read="",unread="";Object.entries(response.data).forEach((([key,item])=>{item.read?(read+=item.html,commonIan.feed.read.push(item)):(unread+=item.html,commonIan.feed.unread.push(item))}));const separator=`<div class="ian-sidebar__separator"><div>${Ian.readTxt}</div><span></span></div>`;Ian.notifications.innerHTML=unread+separator+read}updateIan()}catch(err){console.error("Error fetching Ian feed:",err)}finally{Ian.loader.classList.add("is-hidden")}},dismissIan=async(id,slug)=>{Ian.loader.classList.remove("is-hidden");const el=document.getElementById(`notification_${id}`);el.classList.add("fade-out");const data=new FormData;data.append("action","ian_dismiss"),data.append("slug",slug),data.append("id",id),data.append("nonce",el.dataset.nonce);try{const response=await fetch(Ian.ajaxUrl,{method:"POST",credentials:"same-origin",body:data}).then((res=>res.json()));if(Ian.loader.classList.add("is-hidden"),response.success){el.remove();const{read:read,unread:unread}=Ian.feed,filterFeed=feed=>feed.filter((item=>item.id!==parseInt(id)));Ian.feed.read=filterFeed(read),Ian.feed.unread=filterFeed(unread),updateIan()}else console.error("Failed to dismiss notification:",response.message||"Unknown error")}catch(err){console.error("Error dismissing notification:",err)}finally{Ian.loader.classList.add("is-hidden")}},readIan=async(id,slug)=>{Ian.reading=id,Ian.loader.classList.remove("is-hidden");const el=document.getElementById(`notification_${id}`);el.classList.add("fade-out");const data=new FormData;data.append("action","ian_read"),data.append("slug",slug),data.append("id",id),data.append("nonce",el.dataset.nonce);try{const response=await fetch(Ian.ajaxUrl,{method:"POST",credentials:"same-origin",body:data}).then((res=>res.json()));Ian.loader.classList.add("is-hidden"),response.success?(Ian.feed.read.unshift(Ian.feed.unread.find((item=>item.id===parseInt(id)))),Ian.feed.unread=Ian.feed.unread.filter((item=>item.id!==parseInt(id))),updateIan(),document.querySelector(".ian-sidebar__separator").insertAdjacentElement("afterend",el),el.querySelector(".ian-sidebar__notification-link--right").remove(),el.classList.remove("fade-out")):console.error("Failed to read notification:",response.message||"Unknown error")}catch(err){console.error("Error reading notification:",err)}finally{Ian.loader.classList.add("is-hidden")}},readAllIan=async()=>{Ian.loader.classList.remove("is-hidden");const data=new FormData;data.append("action","ian_read_all"),data.append("nonce",Ian.nonce),data.append("unread",JSON.stringify(Ian.feed.unread.map((item=>item.slug))));try{const response=await fetch(Ian.ajaxUrl,{method:"POST",credentials:"same-origin",body:data}).then((res=>res.json()));if(Ian.loader.classList.add("is-hidden"),response.success){Ian.feed.read=[...Ian.feed.read,...Ian.feed.unread],Ian.feed.unread=[];const read=Ian.feed.read.map((item=>item.html)).join(""),separator=`<div class="ian-sidebar__separator"><div>${Ian.readTxt}</div><span></span></div>`;Ian.notifications.innerHTML=separator+read,document.querySelectorAll(".ian-sidebar__notification-link--right").forEach((el=>el.remove())),updateIan()}else console.error("Failed to read all notifications:",response.message||"Unknown error")}catch(err){console.error("Error reading all notifications:",err)}finally{Ian.loader.classList.add("is-hidden")}},updateIan=()=>{const hasRead=Ian.feed.read.length>0,hasUnread=Ian.feed.unread.length>0,isFeedEmpty=!hasUnread&&!hasRead;if(Ian.icon.classList.toggle("unread",hasUnread),Ian.readAll.classList.toggle("is-hidden",!hasUnread),Ian.notifications.classList.toggle("is-hidden",isFeedEmpty),Ian.empty.classList.toggle("is-hidden",!isFeedEmpty),!isFeedEmpty){document.querySelector(".ian-sidebar__separator").classList.toggle("is-hidden",!hasRead)}},whichPlugin=()=>document.body.classList.contains("tickets_page_tec-tickets-settings")?"et":"tec";(()=>{document.querySelectorAll(".edit-php.post-type-tribe_events h1, .post-php.post-type-tribe_events h1").forEach((heading=>{const pageAction=heading.nextElementSibling;if(pageAction){const wrapper=document.createElement("div");wrapper.className="ian-header";const innerWrapper=document.createElement("div");innerWrapper.className="ian-inner-wrapper";const clientDiv=document.createElement("div");clientDiv.className="ian-client",clientDiv.setAttribute("data-tec-ian-trigger","iconIan"),heading.parentNode.insertBefore(wrapper,heading),wrapper.appendChild(innerWrapper),innerWrapper.appendChild(heading),innerWrapper.appendChild(pageAction),innerWrapper.appendChild(clientDiv)}}));const settingsHeading=document.querySelector(".tec-settings-header-wrap");settingsHeading&&settingsHeading.insertAdjacentElement("afterend",Ian.sidebar)})(),calculateSidebarPosition(),document.querySelectorAll("[data-tec-ian-trigger]").forEach((element=>element.addEventListener("click",handleElementClick))),document.addEventListener("click",handleDocumentClick),document.addEventListener("keydown",handleKeydown),window.addEventListener("resize",calculateSidebarPosition),window.addEventListener("scroll",onScroll),"true"==Ian.consent&&getIan(!0)}))}(window.commonIan||(window.commonIan={}));